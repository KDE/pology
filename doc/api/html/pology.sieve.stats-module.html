<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>pology.sieve.stats</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="pology-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

      <th class="navbar" width="100%"></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="pology-module.html">Package&nbsp;pology</a> ::
        <a href="pology.sieve-module.html">Package&nbsp;sieve</a> ::
        Module&nbsp;stats
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
      </table>
    </td>
  </tr>
</table>
<!-- ==================== MODULE DESCRIPTION ==================== -->
<h1 class="epydoc">Module stats</h1><p class="nomargin-top"></p>
<p>Statistics: message and word counts by category, etc.</p>
  <p>Various statistics on catalogs, that may help review the progress, 
  split up the work, find out what needs updating, etc.</p>
  <p>Sieve parameters:</p>
  <ul>
    <li>
      <code>accels:&lt;chars&gt;</code>: accelerator markers in GUI 
      messages
    </li>
    <li>
      <code>detail</code>: give more detailed statistics
    </li>
    <li>
      <code>incomplete</code>: additionally list catalogs which are not 
      100% translated
    </li>
    <li>
      <code>incompfile:&lt;file&gt;</code>: write filenames of incomplete 
      catalogs into a file, one path per line
    </li>
    <li>
      <code>templates:&lt;spec&gt;</code>: compare translation with 
      templates (see below)
    </li>
    <li>
      <code>minwords:&lt;number&gt;</code>: count only messages with at 
      least this many words
    </li>
    <li>
      <code>maxwords:&lt;number&gt;</code>: count only messages with at 
      most this many words
    </li>
    <li>
      <code>lspan:&lt;from&gt;:&lt;to&gt;</code>: include only messages in 
      this range of lines
    </li>
    <li>
      <code>espan:&lt;from&gt;:&lt;to&gt;</code>: include only messages in 
      this range of entries
    </li>
    <li>
      <code>branch:&lt;branch_id&gt;</code>: consider only messages from 
      this branch (summit)
    </li>
    <li>
      <code>bydir</code>: display report by each leaf directory, followed 
      by totals
    </li>
    <li>
      <code>byfile</code>: display report by each catalog, followed by 
      totals
    </li>
    <li>
      <code>msgbar</code>: show statistics as ASCII bar of message counts
    </li>
    <li>
      <code>wbar</code>: show statistics as ASCII bar of word counts
    </li>
    <li>
      <code>absolute</code>: make bars show absolute rather than relative 
      info
    </li>
    <li>
      <code>ondiff</code>: split word and character counts in fuzzy 
      messages based on difference ratio
    </li>
    <li>
      <code>mincomp</code>: include only catalogs with sufficient 
      completeness
    </li>
    <li>
      <code>filter:&lt;hookspec&gt;</code>: apply F1A filtering hook to 
      translation prior to matching (see <a 
      href="pology.misc.langdep-module.html#get_hook_lreq" 
      class="link">misc.langdep.get_hook_lreq</a> for the format of hook 
      specifications)
    </li>
  </ul>
  <p>The accelerator characters should be removed from the messages before 
  counting, in order not to introduce word splits where there are none. If 
  accelerator character is not given by <code>accel</code> parameter, the 
  sieve will try to guess the accelerator; it may choose wrongly or decide 
  that there are no accelerators. E.g. an <code>X-Accelerator-Marker</code>
  header field is checked for the accelerator character.</p>
  <p>If there exists both the directory with translated POs and with 
  template POTs, using the <code>templates</code> parameter the sieve can 
  be instructed to count POTs with no same-named PO counterpart as fully 
  untranslated in the statistics. Value to <code>templates</code> parameter
  is in the form of <code>search:replace</code>, where <code>search</code> 
  is the substring in the directory paths of processed PO files that will 
  be replaced with <code>replace</code> string to construct directory paths
  of POTs. For example:</p>
<pre class="literalblock">
   $ cd $MYTRANSLATIONS
   $ ls
   my_lang  templates
   $ posieve.py stats -stemplates:my_lang:templates my_lang/
</pre>
  <p>Several parameters are used to restrict counting to catalogs and 
  messages satisfying a certain criterion:</p>
  <ul>
    <li>
      <code>minwords</code> and <code>maxwords</code> restrict counting to 
      messages satisfying these word limits, in <i>either</i> the original 
      or translation.
    </li>
    <li>
      Counting may be restricted to a range of messages, given by 
      parameters <code>lspan</code> (by referent line numbers) and 
      <code>espan</code> (by entry numbers). The span is inclusive by start
      value, exclusive by end value (e.g. <code>espan:4:8</code> includes 
      messages with entry numbers 4, 5, 6, 7). If start value is omitted 
      (e.g. <code>lspan::100</code>), 0 is assumed; if end value is omitted
      (e.g. <code>lspan:100:</code>), total number of lines or entries is 
      assumed.
    </li>
    <li>
      For <a href="pology.scripts.posummit-module.html" 
      class="link">summited</a> catalogs, <code>branch</code> parameter is 
      used to count only messages from the given branch (several branch IDs
      may be given as a comma-separated list).
    </li>
    <li>
      Fuzzy messages are often very easy to correct (e.g. a typo fixed), 
      which may make their word count misleading when estimating effort. To
      amend this somewhat, if parameter <code>ondiff</code> is issued the 
      word and character counts of fuzzy messages are reduced by the 
      difference ratio between current and previous <code>msgid</code> 
      fields, if previous <code>msgid</code> is available and the 
      difference between them is smaller than some threshold. The removed 
      parts of counts are added to translated category, so that total 
      counts remain the same.
    </li>
    <li>
      Parameter <code>mincomp</code> can be used to restrict counting only 
      to catalogs of completeness equal to or higher than this (measured by
      ratio of translated to all messages, excluding obsolete). This may be
      especially useful when there are no templates around, instead all 
      catalogs being initialized as empty, to include only those catalogs 
      which have been actually worked on.
    </li>
  </ul>
  <p>If more than one restriction parameter is used, all must be satisfied 
  for the catalog or message to be taken into account.</p>
  <h1 class="heading">Custom Contexts</h1>
    <p>Some older PO files will have message contexts embedded into the 
    <code>msgid</code> field, instead of using the Gettext proper 
    <code>msgctxt</code> field. There are several customary ways in which 
    this is done, but in general it depends on the translation environment 
    where such PO files are used.</p>
    <p>Embedded contexts will skew the statistics. Pology contains several 
    sieves for converting embedded context into <code>msgctxt</code> 
    context, named <code>normctx-*</code>, where <code>*</code> usually 
    names the translation environment in question. When the statistics on 
    such PO files is desired, the <code>stats</code> sieve should be 
    preceeded in the chain by the context conversion sieve:</p>
<pre class="literalblock">
   $ posieve.py --no-sync normctx-ooo,stats openoffice-fr/
</pre>
    <p>Note that <code>normctx-*</code> sieves, since they modify messages,
    would by default cause the catalogs to be modified on disk. Option 
    <code>--no-sync</code> is therefore used to prevent modified catalogs 
    from being synced to disk.</p>
  <h1 class="heading">Output Legend</h1>
    <p>The basic output is the table where rows present statistics for a 
    category of messages, and columns the statistical bits of data:</p>
<pre class="literalblock">
   $ posieve.py stats frobaz/
   -              msg  msg/tot  w-or  w/tot-or  w-tr  ch-or  ch-tr
   translated     ...    ...    ...     ...     ...    ...    ...
   fuzzy          ...    ...    ...     ...     ...    ...    ...
   untranslated   ...    ...    ...     ...     ...    ...    ...
   total          ...    ...    ...     ...     ...    ...    ...
   obsolete       ...    ...    ...     ...     ...    ...    ...
</pre>
    <p>The <code>total</code> row is the sum of <code>translated</code>, 
    <code>fuzzy</code>, and <code>untranslated</code>, but not 
    <code>obsolete</code>. The columns are as follows:</p>
    <ul>
      <li>
        <code>msg</code>: number of messages
      </li>
      <li>
        <code>msg/tot</code>: percentage of messages relative to 
        <code>total</code>
      </li>
      <li>
        <code>w-or</code>: number of words in original
      </li>
      <li>
        <code>w/tot-or</code>: percentage of words in original relative to 
        <code>total</code>
      </li>
      <li>
        <code>w-tr</code>: number of words in translation
      </li>
      <li>
        <code>ch-or</code>: number of characters in original
      </li>
      <li>
        <code>ch-tr</code>: number of characters in translation
      </li>
    </ul>
    <p>The output with <code>detail</code> parameter in effect is the same,
    with several columns of derived data appended to the table:</p>
    <ul>
      <li>
        <code>w-ef</code>: word expansion factor (increase in words from 
        original to translation)
      </li>
      <li>
        <code>ch-ef</code>: character expansion factor (increase in 
        characters from original to translation)
      </li>
      <li>
        <code>w/msg-or</code>: average of words per message in original
      </li>
      <li>
        <code>w/msg-tr</code>: average of words per message in translation
      </li>
      <li>
        <code>ch/w-or</code>: average of characters per message in original
      </li>
      <li>
        <code>ch/w-tr</code>: average of characters per message in 
        translation
      </li>
    </ul>
    <p>If any of the sieve parameters that restrict counting to certain 
    messages have been supplied, this is confirmed in output by a 
    <code>&gt;&gt;&gt;</code> message before the table. For example:</p>
<pre class="literalblock">
   $ posieve.py stats -smaxwords:5 frobaz/
   &gt;&gt;&gt; at-most-words: 5
   (...the stats table follows...)
</pre>
    <p>When <code>incomplete</code> parameter is given, the statistics 
    table is followed by a table of not fully translated catalogs, with 
    counts of fuzzy and untranslated messages and words:</p>
<pre class="literalblock">
   $ posieve.py stats -sincomplete frobaz/
   (...the stats table...)
   incomplete-catalog   msg/f   msg/u   msg/f+u   w/f   w/u   w/f+u
   frobaz/foxtrot.po        0      11        11     0   123     123
   frobaz/november.po      19      14        33    85    47     132
   frobaz/sierra.po        22       0        22   231     0     231
</pre>
    <p>In the column names, <code>msg/*</code> and <code>w/*</code> stand 
    for messages and words; <code>*/f</code>, <code>*/u</code>, and 
    <code>*/f+u</code> stand for fuzzy, untranslated, and the two 
    summed.</p>
    <p>When parameters <code>msgbar</code> or <code>wbar</code> are in 
    effect, statistics is given in the form of an ASCII bar, giving visual 
    relation between numbers of translated, fuzzy, and untranslated 
    messages or words:</p>
<pre class="literalblock">
   $ posieve.py stats -swbar frobaz/
   4572/1829/2533 w-or |&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#215;&#215;&#215;&#215;&#215;&#215;&#215;&#215;&#215;&#183;&#183;&#183;&#183;&#183;&#183;&#183;&#183;&#183;&#183;&#183;&#183;|
</pre>
    <p>A typical condensed overview of translation state is obtained 
    by:</p>
<pre class="literalblock">
   $ posieve.py stats -sbyfile -smsgbar frobaz/
   --- frobaz/foxtrot.po   34/ -/11 msgs |&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#183;&#183;&#183;&#183;&#183;|
   --- frobaz/november.po  58/19/14 msgs |&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#215;&#215;&#215;&#215;&#215;&#183;&#183;&#183;&#183;|
   --- frobaz/sierra.po    65/22/ - msgs |&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#215;&#215;&#215;&#215;&#215;&#215;|
   === (overall)          147/41/25 msgs |&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#164;&#215;&#215;&#215;&#215;&#183;&#183;&#183;|
</pre>
    <p>though one may want to use <code>-swbar</code> instead, as word 
    counts are more representative of amount of work needed to complete the
    translation. The rounding for bars is such that while there is at least
    one fuzzy or untranslated message or word, the bar will show one 
    incomplete cell.</p>
    <p>By default bars are presenting relative information, i.e. the 
    percentages of translated, fuzzy, and untranslated messages. This can 
    be changed into absolute display using the <code>absolute</code> 
    parameter, where single bar-cell stands for a fixed number of messages 
    or words, determined by taking into account the stats across all bars 
    in the run. When absolute mode is engaged, the bars are shown only for 
    the most specific count level (e.g. only for files if 
    <code>byfile</code> in effect).</p>
  <h1 class="heading">Notes on Counting</h1>
    <p>The word and character counts for a given message field are obtained
    in the following way:</p>
    <ul>
      <li>
        accelerator marker, if defined, is removed
      </li>
      <li>
        XML-like markup is eliminated (<code>&lt;...&gt;</code>)
      </li>
      <li>
        special tokens, such as format directives, are also eliminated 
        (e.g. <code>%s</code> in a message marked as <code>c-format</code>)
      </li>
      <li>
        the text is split into words by taking all contiguous sequences of 
        <code>word</code> characters, as defined by <code>\w</code> regular
        expression class (this means letters, numbers, underscore)
      </li>
      <li>
        all words not starting with a letter are eliminated
      </li>
      <li>
        the words that remain count into statistics
      </li>
    </ul>
    <p>In plural messages, the counts of the original are those of 
    <code>msgid</code> and <code>msgid_plural</code> fields 
    <i>averaged</i>, and so for the translation, the averages of all 
    <code>msgstr</code> fields. In this way, the comparative statistics 
    between the original and the translation is not skewed for languages 
    that have other than two plural forms.</p>

<hr />
<div class="fields">      <p><strong>Author:</strong>
        Chusslove Illich (&#1063;&#1072;&#1089;&#1083;&#1072;&#1074; &#1048;&#1083;&#1080;&#1115;) &lt;caslav.ilic@gmx.net&gt;
      </p>
      <p><strong>License:</strong>
        GPLv3
      </p>
</div><!-- ==================== CLASSES ==================== -->
<a name="section-Classes"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Classes</span></td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="pology.sieve.stats.Sieve-class.html" class="summary-name">Sieve</a>
    </td>
  </tr>
</table>
<!-- ==================== FUNCTIONS ==================== -->
<a name="section-Functions"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Functions</span></td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="setup_sieve"></a><span class="summary-sig-name">setup_sieve</span>(<span class="summary-sig-arg">p</span>)</span></td>
          <td align="right" valign="top">
            
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== VARIABLES ==================== -->
<a name="section-Variables"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Variables</span></td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="__package__"></a><span class="summary-name">__package__</span> = <code title="'pology.sieve'"><code class="variable-quote">'</code><code class="variable-string">pology.sieve</code><code class="variable-quote">'</code></code>
    </td>
  </tr>
</table>
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="pology-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

      <th class="navbar" width="100%"></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
