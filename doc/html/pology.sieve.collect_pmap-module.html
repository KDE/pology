<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>pology.sieve.collect_pmap</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="pology-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

      <th class="navbar" width="100%"></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="pology-module.html">Package&nbsp;pology</a> ::
        <a href="pology.sieve-module.html">Package&nbsp;sieve</a> ::
        Module&nbsp;collect_pmap
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
      </table>
    </td>
  </tr>
</table>
<!-- ==================== MODULE DESCRIPTION ==================== -->
<h1 class="epydoc">Module collect_pmap</h1><p class="nomargin-top"></p>
<p>Assemble a property map from entries embedded into manual 
  comments.</p>
  <p><i>Property maps</i> (short <i>pmaps</i>) are a component of <a 
  href="http://techbase.kde.org/Localization/Concepts/Transcript" 
  target="_top">Transcript</a>, translation scripting system of KDE 4, by 
  which properties of certain phrases can be defined for use in scripted 
  translations.</p>
  <p>A property map is a text file, containing a number of entries each 
  with one or more keys, followed by any number of key-value properties. An
  example entry, with grammatical declinations of a city name:</p>
<pre class="literalblock">
   =/Athens/Atina/nom=Atina/gen=Atine/dat=Atini/acc=Atinu//
</pre>
  <p>The first two characters define, respectively, the key-value separator
  (here <code>=</code>) and the property separator (here <code>/</code>) 
  for the current entry, and must not be alphanumeric. This is followed by 
  a number of entry keys delimited by property separators, and then by a 
  number of key-value properties each internaly delimited by the key-value 
  separator. The entry is terminated by double property separator. 
  Properties of an entry defined like this can later be fetched in the 
  scripting system by any of the entry keys; keys are case- and 
  whitespace-insensitive.</p>
  <p>This sieve will parse pmap entries out of manual comments in messages,
  collect them and write out a property map file. Entry keys should not be 
  specified, because the contents of <code>msgid</code> and 
  <code>msgstr</code> are automatically added as keys.</p>
  <p>Since each manual comment is one line, it is also allowed to drop the 
  final double separator which would normally terminate the entry. The 
  above example would thus look like this in PO message:</p>
<pre class="literalblock">
   # pmap: =/nom=Atina/gen=Atine/dat=Atini/acc=Atinu/
   msgctxt &quot;Greece/city&quot;
   msgid &quot;Athens&quot;
   msgstr &quot;Atina&quot;
</pre>
  <p>The manual comment starts with <code>pmap:</code> keyword, followed by
  normal pmap entry (except for default keys; only additional keys should 
  be specified). It is also possible to split the entry into several 
  comments, with only condition that all share the same set of 
  separators:</p>
<pre class="literalblock">
   # pmap: =/nom=Atina/gen=Atine/
   # pmap: =/dat=Atini/acc=Atinu/
</pre>
  <p>In case two or more parsed entries have same keys extracted from 
  translation, they are all thrown out of the collection and a warning is 
  reported.</p>
  <p>Entries are collected only from translated non-plural messages.</p>
  <p>Sieve parameters:</p>
  <ul>
    <li>
      <code>outfile</code>: file path into which to write the property map
    </li>
    <li>
      <code>propcons</code>: file defining constraints on property keys and
      values, used to validate parsed entries
    </li>
    <li>
      <code>extrakeys</code>: allow defining extra entry keys
    </li>
    <li>
      <code>derivs:&lt;file&gt;</code>: path to the file defining 
      derivators for synder entries
    </li>
    <li>
      <code>pmhead</code>: prefix for pmap entries (instead of default 
      <code>pmap:</code>)
    </li>
    <li>
      <code>sdhead</code>: prefix for synder entries (instead of default 
      <code>synder:</code>)
    </li>
  </ul>
  <p>If output file is not specified by <code>outfile</code> parameter, 
  nothing is written out. Such runs are useful for validation of 
  entries.</p>
  <p>Defining additional entry keys (other than <code>msgid</code> and 
  <code>msgstr</code>) is by default not allowed; issuing the 
  <code>extrakeys</code> parameter allows it.</p>
  <h1 class="heading">Derivating Entries</h1>
    <p>There is another, more succint way to define pmap entries in 
    comments. Instead of writting out all key-value combinations, it is 
    possible instead to generate them through use of <i>syntagma 
    derivators</i>, or synders for short. In the earlier example:</p>
<pre class="literalblock">
   # pmap: =/nom=Atina/gen=Atine/dat=Atini/acc=Atinu/
</pre>
    <p>it can be observed that each form has the same root, 
    <code>Atin</code>, followed by the appropriate ending for the given 
    form. This makes it convenient to reformulate it as syntagma 
    derivation:</p>
<pre class="literalblock">
   # synder: Atin|a
</pre>
    <p>Here <code>|a</code> is a <i>derivator</i>; all such derivators are 
    defined in a separate synder file (having {.sd} extension by 
    convention), and made known to the sieve through the 
    <code>derivs</code> parameter. The derivator in this example would be 
    defined like this:</p>
<pre class="literalblock">
   |a: nom=a, gen=e, dat=i, acc=u
</pre>
    <p>After the derivator name, the definition lists the keys as in the 
    pmap, but followed only by the appropriate endings for the given 
    declination. For details about syntagma derivation, see documentation 
    to <a href="pology.misc.synder-module.html" 
    class="link">pology.misc.synder</a> module.</p>
    <p>It is possible to mix pmap (<code># pmap: ...</code>) and synder 
    <code># synder: ...</code> entries throughout comments, in a single or 
    collection of PO files. For example, synder entries may be used to 
    cover majority of cases, which follow the general rules, while pmap 
    entries can be used for exceptions.</p>
    <p>On the other hand, a pmap entry can also be directly reformulated as
    a synder entry, without using a derivator:</p>
<pre class="literalblock">
   # synder: nom=Atina, gen=Atine, dat=Atini, acc=Atinu
</pre>
    <p>A question may come to mind here: why have pmap entries at all, if 
    synder entries can be used in the same capacity and beyond? Because 
    syntagma derivations have a lot of special syntax and rules (e.g. what 
    if the phrase itself contains a comma?) to keep in mind, while raw 
    pmaps have none past what was described above.</p>
  <h1 class="heading">Validating Entries</h1>
    <p>The <code>propcons</code> parameter can be used to provide a file 
    defining constraints on acceptable property keys, and values by each 
    key. Its format is the following:</p>
<pre class="literalblock">
   # Full-line comment.
   /key-regex-1/value-regex-1/flags # a trailing comment
   /key-regex-2/value-regex-2/flags
   :key-regex-3:value-regex-3:flags # different separator
   ...
</pre>
    <p>Regular expressions for keys and values are delimited by a separator
    defined by first non-whitespace character in the line, which must also 
    be non-alphanumeric. Before being applied, regular expressions are 
    automatically wrapped as <code>^(&lt;regex&gt;)$</code>, so e.g. an 
    expression to require a prefix is given as 
    <code>&lt;prefix&gt;.*</code> and a suffix as 
    <code>.*&lt;suffix&gt;</code>.</p>
    <p>For example, a constraint file defining no constraints on either 
    property keys or values is this:</p>
<pre class="literalblock">
   /.*/.*/
</pre>
    <p>A constraint definition file stating all allowed property keys, and 
    constraining values for some:</p>
<pre class="literalblock">
   /nom|gen|dat|acc/.*/
   /gender/m|f|n/
   /number/s|p/
</pre>
    <p>Flags following the trailing separator are a string of 
    single-character indicators. The following are defined:</p>
    <ul>
      <li>
        <code>i</code>: case-insensitive matching for the value
      </li>
      <li>
        <code>I</code>: case-insensitive matching for the key
      </li>
      <li>
        <code>t</code>: the value must both match the regular expression 
        <i>and</i> be equal to <code>msgstr</code> (if <code>i</code> is in
        effect too, equality check is also case-insensitive)
      </li>
      <li>
        <code>r</code>: regular expression for the key must match at least 
        one key among all defined properties
      </li>
    </ul>
    <p>Constraint definition file must be UTF-8 encoded.</p>

<hr />
<div class="fields">      <p><strong>Author:</strong>
        Chusslove Illich (&#1063;&#1072;&#1089;&#1083;&#1072;&#1074; &#1048;&#1083;&#1080;&#1115;) &lt;caslav.ilic@gmx.net&gt;
      </p>
      <p><strong>License:</strong>
        GPLv3
      </p>
</div><!-- ==================== CLASSES ==================== -->
<a name="section-Classes"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Classes</span></td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="pology.sieve.collect_pmap.Sieve-class.html" class="summary-name">Sieve</a>
    </td>
  </tr>
</table>
<!-- ==================== FUNCTIONS ==================== -->
<a name="section-Functions"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Functions</span></td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="setup_sieve"></a><span class="summary-sig-name">setup_sieve</span>(<span class="summary-sig-arg">p</span>)</span></td>
          <td align="right" valign="top">
            
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="pology-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

      <th class="navbar" width="100%"></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
