<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Chapter&nbsp;3.&nbsp;Sieving</title>
<link rel="stylesheet" href="data/style.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="index.html" title="Pology User Manual">
<link rel="up" href="index.html" title="Pology User Manual">
<link rel="prev" href="ch-poformat.html" title="Chapter&nbsp;2.&nbsp;The PO Format">
<link rel="next" href="ch-diffpatch.html" title="Chapter&nbsp;4.&nbsp;Diffing and Patching">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">Chapter&nbsp;3.&nbsp;Sieving</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="ch-poformat.html">Prev</a>&nbsp;</td>
<th width="60%" align="center">&nbsp;</th>
<td width="20%" align="right">&nbsp;<a accesskey="n" href="ch-diffpatch.html">Next</a></td>
</tr>
</table>
<hr></div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-sieve" id="ch-sieve"></a>Chapter&nbsp;3.&nbsp;Sieving</h2>
</div>
</div>
</div>
<p>Translator may want to apply batch-type operations to every message in a single PO file or in collection of PO files, such as searching and replacing text, computing statistics, or validating. However, batch-processing tools for general plain text (<span class="command"><strong>grep</strong></span>, <span class="command"><strong>sed</strong></span>, <span class="command"><strong>awk</strong></span>, etc.) are not very well suited to processing PO files. For example, when looking for a particular word, a generic search tool will not see it if it contains an <a class="link" href="ch-poformat.html#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator marker</a>; or, if looking for a two-word phrase, a generic tool will miss it if it is <a class="link" href="ch-poformat.html#sec-powrap" title="2.1.2.&nbsp;String Wrapping">wrapped</a>. Therefore many tools tailored specifically for batch-processing messages in PO files have been developed, such as those bundled with <a class="ulink" href="http://www.gnu.org/software/gettext/" target="_top">Gettext</a> (<span class="command"><strong>msggrep</strong></span>, <span class="command"><strong>msgfilter</strong></span>, <span class="command"><strong>msgattrib</strong></span>...), or from <a class="ulink" href="http://translate.sourceforge.net/wiki/toolkit/index" target="_top">Translate Toolkit</a> (<span class="command"><strong>pocount</strong></span>, <span class="command"><strong>pogrep</strong></span>, <span class="command"><strong>pofilter</strong></span>...).</p>
<p>Pology also provides a per-message batch-processing tool, the <span class="command"><strong>posieve</strong></span>. What was the need for it, given the myriad of other previously available and powerful tools? In accordance with philosophy of Pology, <span class="command"><strong>posieve</strong></span> goes deeper than these other tools. <span class="command"><strong>posieve</strong></span> makes easy that which is possible but awkward by combining generic command line tools. <span class="command"><strong>posieve</strong></span> is modular from the ground up, such that it is never a design problem to add new functionality to it, even when it is of narrow applicability. Users who know some Python can even write own "plugins" for it. Several processing modules can be applied in a single run of <span class="command"><strong>posieve</strong></span>, possibly affecting each other, in ways not possible by generic shell piping and not requiring temporary intermediate files.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svbasics" id="sec-svbasics"></a>3.1.&nbsp;Basic Usage of <span class="command"><strong>posieve</strong></span></h2>
</div>
</div>
</div>
<p>The <span class="command"><strong>posieve</strong></span> script itself is actually a simple shell which applies various processing modules, called <span class="emphasis"><em>sieves</em></span>, to every message in one or more PO files. Some sieves can also request to operate on the header of the PO file, which <span class="command"><strong>posieve</strong></span> will then feed to them. A sieve can only examine but also modify messages; if any message is modified, by default the modified PO file will be written out in place. Naturally, <span class="command"><strong>posieve</strong></span> has a number of options, but more interestingly, each sieve can define some parameters which determine its behavior. Pology comes with many internal sieves, which do things from general to obscure (possibly language or project specific), and users can define their own sieves.</p>
<p>Here is how you would run the <a class="link" href="ch-sieve.html#sv-stats" title="3.5.30.&nbsp;stats"><span class="command"><strong>stats</strong></span></a> sieve to collect statistics on all PO files in <code class="filename">frobaz/</code> directory:</p>
<pre class="programlisting">
$ posieve stats frobaz/
</pre>
<p>While PO files in <code class="filename">frobaz/</code> are being processed, you will see a progress bar with the current file and the number of files to process, and after some time the <span class="command"><strong>stats</strong></span> sive will present its findings in a table.</p>
<p>The first non-option argument in the <span class="command"><strong>posieve</strong></span> command line is the sieve name, and then any number of directory or file paths can be specified. <span class="command"><strong>posieve</strong></span> will consider file path arguments to be PO files, and recursively search directory paths to collect all files ending with <code class="filename">.po</code> or <code class="filename">.pot</code>. If no paths are specified, PO files to process will be collected from the current working directory.</p>
<p>If the sieve modifies a message and the new PO file is written out in place of the old, the user will be informed by an exclamation mark followed by the file path. An example of a sieve which modifies messages is the <a class="link" href="ch-sieve.html#sv-tag-untranslated" title="3.5.31.&nbsp;tag-untranslated"><span class="command"><strong>tag-untranslated</strong></span></a> sieve; it adds the <code class="literal">untranslated</code> flag to every untranslated message, so that you can look them up in a plain text editor (as opposed to <a class="link" href="ch-poformat.html#sec-poedlist" title="2.7.1.&nbsp;List of PO Editors">dedicated PO editor</a>):</p>
<pre class="programlisting">
$ posieve tag-untranslated frobaz/
! frobaz/alfa.po
! frobaz/bravo.po
! frobaz/charlie.po
Tagged 42 untranslated messages.
</pre>
<p><span class="command"><strong>posieve</strong></span> itself tracks message modifications and informs about modified PO files, whereas the final line in this example has been output by the <span class="command"><strong>tag-untranslated</strong></span> sieve. Sieves will frequently issue such final reports of their actions.</p>
<p>If a sieve defines some parameters to control its behavior, these can be issued using the <code class="option">-s</code>. This option takes the parameter specification as the argument, which is of the form <code class="literal"><em class="replaceable"><code>name</code></em>:<em class="replaceable"><code>value</code></em></code> or just <code class="literal"><em class="replaceable"><code>name</code></em></code> for switch-type parameters. More than one parameter can be issued by repeating the <code class="option">-s</code>. For example, the <span class="command"><strong>stats</strong></span> sieve can be instructed to take into account only messages with at most 5 words:</p>
<pre class="programlisting">
$ posieve stats -s maxwords:5 frobaz/
</pre>
<p>to show statistics in greater detail:</p>
<pre class="programlisting">
$ posieve stats -s detail frobaz/
</pre>
<p>or to ignore a certain accelerator marker and show bar-type statistics instead of tabular:</p>
<pre class="programlisting">
$ posieve stats -s accel:_ -s msgbar frobaz/
</pre>
<p><span class="command"><strong>posieve</strong></span> lists and shows descriptions of its options by the usual <code class="option">-h</code>/<code class="option">--help</code> option. Help for a sieve can be requested by issuing the <code class="option">-H</code>/<code class="option">--help-sieves</code> while a sieve name is present in the command line. All available internal sieves with short descriptions are listed using <code class="option">-l</code>/<code class="option">--list-sieves</code>.</p>
<p>Some sieves are language-specific, which can be seen by their names being of the form <span class="command"><strong><em class="replaceable"><code>langcode</code></em>:<em class="replaceable"><code>name</code></em></strong></span>. These sieves are primarily intendedfor use on PO files translated to indicated language, but depending on particularities, may be applicable to several more closely related languages. (A sieve which is doing language-specific things, but which is applicable to many languages, is more likely to be named as a general sieve.)</p>
<p>If <a class="link" href="ch-common.html#sec-cmshellcomp" title="9.1.&nbsp;Shell Completion">shell completion</a> is active, it can be used to complete sieve names and their parameters.</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svchains" id="sec-svchains"></a>3.2.&nbsp;Sieve Chains</h2>
</div>
</div>
</div>
<p>It is possible to issue several sieves at once, by passing a comma-separated list of sieve names to <span class="command"><strong>posieve</strong></span> in place of single sieve name. This is called a <span class="emphasis"><em>sieve chain</em></span>.</p>
<p>At minimum, chaining sieves is a performance improving measure, since each PO file is opened (and possibly written out) only once, instead of on each sieve run. For example, you can in one run compute the statistics to see how many messages need to be update and tag all untranslated messages:</p>
<pre class="programlisting">
$ posieve stats,tag-untranslated frobaz/
! frobaz/alfa.po
! frobaz/bravo.po
! frobaz/charlie.po
... (table with statistics) ...
Tagged 42 untranslated messages.
</pre>
<p>A message in the PO file is passed through each sieve in turn, in the order in which they are issued, before proceding to the next message. If a sieve modifies the message, the next sieve in the chain will operate on that modified version of the message. This means that the ordering of sieves in the command line is significant in general, and that it is interchangable only if the sieves in the chain are independent of each other (as in this example). Chain order also determines the order in which sieve reports are shown; if in this example the order had been <code class="literal">tag-untranslated,stats</code>, then first the tagged messages line would be written out, followed by the statistics table.</p>
<p>Other than for performance, sieve chains are useful when messages should be modified in a particular way before a sieve gets to operate on it. A good example is when statistics is to be computed on PO files which contain old <a class="link" href="ch-poformat.html#p-embctxt">embedded contexts</a>, where if nothing would be done, contexts would add to the word count of the original text. To avoid this, a <a class="link" href="ch-sieve.html#sv-normctxt-sep" title="3.5.22.&nbsp;normctxt-sep">context normalization</a> sieve (which converts embedded contexts to <code class="varname">msgctxt</code>) can be chained with statistics sieve, and the <span class="command"><strong>posieve</strong></span> instructed not to write modifications to the PO file. If the embedded context is of the single-separator type, with separator character <code class="literal">|</code>, the sieve chain is:</p>
<pre class="programlisting">
$ posieve --no-sync normctxt-sep,stats -s sep:'|' frobaz/
Converted 21 separator-embedded contexts.
... (table with statistics) ...
</pre>
<p>The <code class="option">--no-sync</code> option prevents writing modified messages in the PO file on disk. Note that <code class="literal">|</code> as parameter value is quoted, because it would be interpreted as a shell pipe otherwise.</p>
<p>Finally, some sieves can stop messages from being pushed further through the sieve chain, so they can be used as a prefilter to other sieves. The archetypal example of this the <a class="link" href="ch-sieve.html#sv-find-messages" title="3.5.17.&nbsp;find-messages"><span class="command"><strong>find-messages</strong></span></a>, which stops non-matched messages from further sieving. For example, to include into statistics only the messages containing the word "quasar", this would be executed:</p>
<pre class="programlisting">
$ posieve find-messages,stats -s msgid:quasar -s nomsg
Found 12 messages satisfying the conditions.
... (table with statistics) ...
</pre>
<p>The <code class="option">msgid:</code> parameter specifies the word (actually, a regular expression) to be looked up in the original text, while <code class="option">nomsg</code> parameter tells <span class="command"><strong>find-messages</strong></span> not to write out matched messages to standard output, which it would by default do. Note that no path was specified, meaning that all PO files in current working directory and below will be sieved.</p>
<p>Examples of sieve chaining so far should have raised the following question: when several sieves are issued, to which of them are the parameters specified by <code class="option">-s</code> options passed? The answer is that a parameter is sent to all sieves which accept parameter of that name. Continuing the previous example, if message texts can contain accelerator marker <code class="literal">&amp;</code>, this would be specified like this:</p>
<pre class="programlisting">
$ posieve find-messages,stats -s msgid:quasar -s nomsg -s accel:'&amp;'
</pre>
<p><span class="command"><strong>find-messages</strong></span> will accept <code class="option">accel</code> in order to also match messages like <code class="literal">"Charybdis Q&amp;uasar"</code>, while <span class="command"><strong>stats</strong></span> will use it to properly split text into words for counting them.</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svoptions" id="sec-svoptions"></a>3.3.&nbsp;Command Line Options</h2>
</div>
</div>
</div>
<p>Options specific to <span class="command"><strong>posieve</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-a</code>, <code class="option">--announce-entry</code></span></dt>
<dd>
<p>A sieve may be buggy and crash or keep <span class="command"><strong>posieve</strong></span> in infinite loop on a particular PO entry (header or message). When this option is given, each PO entry will be announced before sieving it, so that you can see exactly where the problem occurs.</p>
</dd>
<dt><span class="term"><code class="option">-b</code>, <code class="option">--skip-obsolete</code></span></dt>
<dd>
<p>By default <span class="command"><strong>posieve</strong></span> will process all messages in the PO file, including the obsolete. Sometimes sieving obsolete messages is not desired, for example when running translation validation sieves. This option can then be used to skip obsolete messages.</p>
</dd>
<dt><span class="term"><code class="option">-c</code>, <code class="option">--msgfmt-check</code></span></dt>
<dd>
<p>For <span class="command"><strong>posieve</strong></span> to process the PO file, it is only necessary that basic PO syntax is valid, i.e. that <span class="command"><strong>msgfmt</strong></span> can compile the file. <span class="command"><strong>msgfmt</strong></span> also offers stricter validation mode: to have <span class="command"><strong>posieve</strong></span> run this stricter validation on the PO file, issue this option. Invalid files will be reported and will not be sieved.</p>
</dd>
<dt><span class="term"><code class="option">--force-sync</code></span></dt>
<dd>
<p>When some messages in the PO file are modified, by default only those messages will be reformatted (e.g. strings wrapped as selected) when the PO file is modified on disk. This makes <span class="command"><strong>posieve</strong></span> friendly to version control systems. Sometimes, however, you may want that all messages are reformatted, modified or not, and then you can issue this option.</p>
</dd>
<dt><span class="term"><code class="option">-h</code>, <code class="option">--help</code></span></dt>
<dd>
<p>General help on <span class="command"><strong>posieve</strong></span>.</p>
</dd>
<dt><span class="term"><code class="option">-H</code>, <code class="option">--help-sieves</code></span></dt>
<dd>
<p><code class="option">-h</code>/<code class="option">--help</code> shows only description of <span class="command"><strong>posieve</strong></span> and its options, while this option shows the descriptions and available parameters of issued sieves. For example:</p>
<pre class="programlisting">
$ posieve find-messages,stats -H
</pre>
<p>would output help for <span class="command"><strong>find-messages</strong></span> and <span class="command"><strong>stats</strong></span> sieves.</p>
</dd>
<dt><span class="term"><code class="option">--issued-params</code></span></dt>
<dd>
<p>List of all sieve parameters and their values that would be issued. Used to check <a class="link" href="ch-sieve.html#p-svparconfcmd">the interplay of command line and configuration</a> on sieve parameters.</p>
</dd>
<dt><span class="term"><code class="option">-l</code>, <code class="option">--list-sieves</code></span></dt>
<dd>
<p>List of all internal sieves, with short descriptions.</p>
</dd>
<dt><span class="term"><code class="option">--list-options</code>; <code class="option">--list-sieve-names</code>; <code class="option">--list-sieve-params</code></span></dt>
<dd>
<p>Simple listings of global options, internal sieve names, and parameters of issued sieves. Intended mainly for writting shell completion definitions.</p>
</dd>
<dt><span class="term"><code class="option">-m <em class="replaceable"><code>OUTFILE</code></em></code>, <code class="option">--output-modified=<em class="replaceable"><code>OUTFILE</code></em></code></span></dt>
<dd>
<p>If some PO files were modified by sieving, you may want to follow up with a command to process only those files. <span class="command"><strong>posieve</strong></span> will by default output the paths of modified PO files, but also other information, which makes parsing this output for modified paths ungainly. Instead, this option can be used to specify a file to which path of all modified PO files will be written to, one per line.</p>
</dd>
<dt><span class="term"><code class="option">--no-skip</code></span></dt>
<dd>
<p>If a sieve reports an error, <span class="command"><strong>posieve</strong></span> normally skips the problematic message and continues sieving the rest of the PO file, if possible. This is sometimes not desired, when this option will tell <span class="command"><strong>posieve</strong></span> to abort with an error message in such cases.</p>
</dd>
<dt><span class="term"><code class="option">--no-sync</code></span></dt>
<dd>
<p>All messages modified by sieves are by default written back to disk, i.e. their PO files modifed. This option prevents modification of PO files. This comes handy in two cases. One is when you want to check what effect a modifying sieve will have before actually accepting it (a "dry" run). The other case is when you use a modifying sieve as a filter for the next sieve in chain, which only needs to examine messages.</p>
</dd>
<dt><span class="term"><code class="option">-q</code>, <code class="option">--quiet</code></span></dt>
<dd>
<p><span class="command"><strong>posieve</strong></span> normally shows the progress of sieving, which can be cancelled by this option. (Sieves will still output their own lines.)</p>
</dd>
<dt><span class="term"><code class="option">-s <em class="replaceable"><code>PARAM</code></em>[:<em class="replaceable"><code>VALUE</code></em>]</code></span></dt>
<dd>
<p>The central option of <span class="command"><strong>posieve</strong></span>, which is used to issue parameters to sieves.</p>
</dd>
<dt><span class="term"><code class="option">-S <em class="replaceable"><code>PARAM</code></em></code></span></dt>
<dd>
<p>When a sieve parameter is issued <a class="link" href="ch-sieve.html#p-confsvpar">through user configuration</a>, this option can be used to cancel it for one particular run.</p>
</dd>
<dt><span class="term"><code class="option">--version</code></span></dt>
<dd>
<p>Release and copyright information on <span class="command"><strong>posieve</strong></span>.</p>
</dd>
<dt><span class="term"><code class="option">-v</code>, <code class="option">--verbose</code></span></dt>
<dd>
<p>More verbose output, where <span class="command"><strong>posieve</strong></span> shows the sieving modes, lists files which are being sieved, etc.</p>
</dd>
</dl>
</div>
<p>Options common with other Pology tools:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-F FILE</code>, <code class="option">--files-from=FILE</code></span></dt>
<dd>
<p>See <a class="xref" href="ch-common.html#sec-cmffrom" title="9.5.&nbsp;Reading Paths From a File">Section&nbsp;9.5, “Reading Paths From a File”</a>.</p>
</dd>
<dt><span class="term"><code class="option">-e REGEX</code>, <code class="option">--exclude-name=REGEX</code>; <code class="option">-E REGEX</code>, <code class="option">--exclude-path=REGEX</code>; <code class="option">-i REGEX</code>, <code class="option">--include-name=REGEX</code>; <code class="option">-I REGEX</code>, <code class="option">--include-path=REGEX</code></span></dt>
<dd>
<p>See <a class="xref" href="ch-common.html#sec-cmincexc" title="9.4.&nbsp;Path Inclusion and Exclusion">Section&nbsp;9.4, “Path Inclusion and Exclusion”</a>.</p>
</dd>
<dt><span class="term"><code class="option">-R</code>, <code class="option">--raw-colors</code>; <code class="option">--coloring-type</code></span></dt>
<dd>
<p>See <a class="xref" href="ch-common.html#sec-cmcolors" title="9.6.&nbsp;Output Coloring">Section&nbsp;9.6, “Output Coloring”</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svconfig" id="sec-svconfig"></a>3.4.&nbsp;User Configuration</h2>
</div>
</div>
</div>
<p>The following <a class="link" href="ch-common.html#sec-cmconfig" title="9.2.&nbsp;User Configuration">configuration</a> fields can be used to modify general behavior of <span class="command"><strong>posieve</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[posieve]/skip-on-error=[*yes|no]</code></span></dt>
<dd>
<p>Setting to <code class="literal">no</code> is counterpart to <code class="option">--no-skip</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[posieve]/msgfmt-check=[yes|*no]</code></span></dt>
<dd>
<p>Setting to <code class="literal">yes</code> is counterpart to <code class="option">-c</code>/<code class="option">--msgfmt-check</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[posieve]/skip-obsolete=[yes|*no]</code></span></dt>
<dd>
<p>Setting to <code class="literal">yes</code> is counterpart to <code class="option">-b</code>/<code class="option">--skip-obsolete</code> command line option.</p>
</dd>
</dl>
</div>
<p>For configuration fields that have counterpart command line options, the command line option always takes precedence if issued.</p>
<p><a name="p-confsvpar" id="p-confsvpar"></a>Configuration can also be used to issue sieve parameters, by specifying <code class="literal">[posieve]/param-<em class="replaceable"><code>name</code></em></code> fields. For example, parameters <code class="option">transl</code> (a switch) and <code class="option">accel</code> (with value <code class="literal">&amp;</code>) are issued to all sieves that accept them by writing:</p>
<pre class="programlisting">
[posieve]
param-transl = yes
param-accel = &amp;
</pre>
<p>To issue parameters only to certain sieves, parameter name can be followed by a sieve list of the form <code class="literal">/<em class="replaceable"><code>sieve1</code></em>,<em class="replaceable"><code>sieve2</code></em>,...</code>; to <span class="emphasis"><em>prevent</em></span> the parameter from being issued only to certain sieves, prepend <code class="literal">~</code> to the sieve list. For example:</p>
<pre class="programlisting">
[posieve]
param-transl/find-messages = yes  # only for find-messages
param-accel/~stats = &amp;            # not for stats
</pre>
<p>Same parameters can sometimes be repeated in the command line, when it is logically meaningfull to provide several values of that type to a sieve. However, same-name fields cannot be used in configuration to supply several values, because they override each other. Instead, a dot and a unique string (within the sequence) can be appended to the parameter name to make it a unique configuration field:</p>
<pre class="programlisting">
[posieve]
param-accel.0 = &amp;
param-accel.1 = _
</pre>
<p>Strings after the dot can be anything, but a sequence of numbers or letters in alphabetical order is the least confusing choice.</p>
<p><a name="p-svparconfcmd" id="p-svparconfcmd"></a>Sieve parameters should be issued from the configuration only as a matter of convenience, when they are almost always used in sieve runs. But occasionaly the parameter issued from the configuration is not appropriate for the given run. Instead of going to configuration and commenting the parameter out temporarily, it can be cancelled in the command line using the <code class="option">-S</code> option (note capital S) followed by the parameter name. You can use <code class="option">--issued-params</code> option to confirm which parameters will be issued after both the command line and the configuration have been taken into account.</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svinternal" id="sec-svinternal"></a>3.5.&nbsp;Internal Sieves</h2>
</div>
</div>
</div>
<p>This section describes the sieves which are contained in Pology distribution and provides instruction for their use.</p>
<p>Parameters which take a value (which are not switches) may or may not have a default value, and when they do, it will be given in square brackets (<code class="literal">[...]</code>) in the header.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-apply-filter" id="sv-apply-filter"></a>3.5.1.&nbsp;<span class="command"><strong>apply-filter</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>apply-filter</strong></span> is used to pipe translation through one or several <span class="emphasis"><em>hooks</em></span> (see <a class="xref" href="ch-common.html#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">Section&nbsp;9.10, “Processing Hooks”</a>). The hooks may modify the translation, validate it, or do something else. More precisely, the following hook types are applicable:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>F1A, F3A, F3C, to modify the translation and write changes back to the PO file;</p>
</li>
<li class="listitem">
<p>V1A, V3A, V3C, to validate the translation, with standard validation output (highlighted spans and problem messages);</p>
</li>
<li class="listitem">
<p>S1A, S3A, S3C, for any side-effect processing on translation (but no modification).</p>
</li>
</ul>
</div>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">filter:<em class="replaceable"><code>hookspec</code></em></code></span></dt>
<dd>
<p>The hook specification. Can be repeated to add several hooks, which are then applied in the order of specification.</p>
</dd>
<dt><span class="term"><code class="option">showmsg</code></span></dt>
<dd>
<p>Report every modified message to standard output. (For validation hooks, message is automatically reported if not valid.)</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-apply-header-filter" id="sv-apply-header-filter"></a>3.5.2.&nbsp;<span class="command"><strong>apply-header-filter</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>apply-header-filter</strong></span> is the counterpart to <span class="command"><strong>apply-filter</strong></span> to operate on headers instead of messages. Here the applicable hook types are accordingly F4B, V4B, S4B.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">filter:<em class="replaceable"><code>hookspec</code></em></code></span></dt>
<dd>
<p>The hook specification. Can be repeated to add several hooks, which are then applied in the order of specification.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-bad-patterns" id="sv-bad-patterns"></a>3.5.3.&nbsp;<span class="command"><strong>bad-patterns</strong></span></h3>
</div>
</div>
</div>
<p>Sometimes it is possible to use simple pattern matching to discover things that should never appear in the text, such as common grammar or orthographical errors. <span class="command"><strong>bad-patterns</strong></span> can apply such patterns to translation, either as plain substring matching or <a class="link" href="ch-common.html#sec-cmregex" title="9.3.&nbsp;Regular Expressions">regular expressions</a>. Patterns can be given as parameters, or more conveniently, read from files.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">pattern:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>The pattern to search for. Can be repeated to search for several patterns.</p>
</dd>
<dt><span class="term"><code class="option">fromfile:<em class="replaceable"><code>path</code></em></code></span></dt>
<dd>
<p>Read patterns to search for from the file. Each line contains one pattern. If line starts with <code class="literal">#</code>, it is treated as comment. Empty lines are ignored. Trailing and leading whitespace is removed from patterns; if it is significant, it can be given inside <code class="literal">[...]</code> regex operator. This parameter can be repeated to read patterns from several files.</p>
</dd>
<dt><span class="term"><code class="option">rxmatch</code></span></dt>
<dd>
<p>By default patterns are treated as plain substrings. This parameter requests to treat patterns as regular expressions.</p>
</dd>
<dt><span class="term"><code class="option">casesens</code></span></dt>
<dd>
<p>By default patterns are case-sensitive. This parameter make them case-insensitive.</p>
</dd>
</dl>
</div>
<div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Caution</h3>
<p>This sieve is deprecated. Use <a class="link" href="ch-sieve.html#sv-check-rules" title="3.5.7.&nbsp;check-rules"><span class="command"><strong>check-rules</strong></span></a> instead, which applies Pology's <a class="link" href="ch-lingo.html#sec-lgrules" title="8.5.&nbsp;Validation Rules">validation rules</a>.</p>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-docbook4" id="sv-check-docbook4"></a>3.5.4.&nbsp;<span class="command"><strong>check-docbook4</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-docbook4</strong></span> checks PO files extracted from Docbook 4.x files. Docbook is an XML format, typically used for documenting software.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">showmsg</code></span></dt>
<dd>
<p>Instead of just showing the message location and problem description, also show the complete message with problematic segments higlighted.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
</dl>
</div>
<p>Currently performed checks:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Markup validity. Docbook is a complex XML format, and nothing short of full validation of XML files generated from translated PO files can show if the translation is technically valid. Therefore <span class="command"><strong>check-docbook4</strong></span> checks only well-formedness, whether tags are defined by Docbook, and some nesting constraints, and that on the level of single message. But this is already enough to catch great majority of usual translation errors.</p>
<p>This check can be skipped on a message by adding to it the <code class="literal">no-check-markup</code> <a class="link" href="ch-common.html#p-trflag">translator flag</a>.</p>
</li>
<li class="listitem">
<p>Message insertion placeholders. Some extractors of Docbook split out into standalone messages contextually separate units that are found in the middle of flowing paragraphs (e.g. footnotes). When that happens, a special placeholder is left in the originating message, so that the markup can be reconstructed when the translated Docbook file is built. Such placeholders must be carried into translation.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-grammar" id="sv-check-grammar"></a>3.5.5.&nbsp;<span class="command"><strong>check-grammar</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-grammar</strong></span> checks translation with LanguageTool, an open source grammar and style checker (<a class="ulink" href="http://www.languagetool.org/" target="_top">http://www.languagetool.org/</a>). LanguageTool supports a number of languages to greater or smaller extent, which you can check on <a class="ulink" href="http://www.languagetool.org/languages/" target="_top">its web site</a>.</p>
<p>LanguageTool can be run as standalone program or in client-server mode, and this sieve expects the latter. This means that LanguageTool has to be up and running before this sieve is run. Messages in which problems are discovered are reported to standard output.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">lang:<em class="replaceable"><code>code</code></em></code></span></dt>
<dd>
<p>The language code for which to apply the rules. If not given, it will be read from each PO file in turn, and if not found there either, an error will be signaled.</p>
</dd>
<dt><span class="term"><code class="option">host:<em class="replaceable"><code>hostname</code></em></code> [<code class="literal">localhost</code>]</span></dt>
<dd>
<p>Name of the host where the LanguageTool server is running. The default value of <code class="literal">localhost</code> means that it is running on the same computer where the sieve is run.</p>
</dd>
<dt><span class="term"><code class="option">port:<em class="replaceable"><code>number</code></em></code> [<code class="literal">8081</code>]</span></dt>
<dd>
<p>TCP port of the host on which the LanguageTool server listens for queries.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-kde4" id="sv-check-kde4"></a>3.5.6.&nbsp;<span class="command"><strong>check-kde4</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-kde4</strong></span> checks PO files extracted from program code based on KDE4 library and its translation system. Note that this really means what it says; this sieve should <span class="emphasis"><em>not</em></span> be used to check just any PO file which happens to be part of the KDE project (e.g. PO files covering .desktop files, pure Qt code, etc.).</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">strict</code></span></dt>
<dd>
<p>Partly due to historical reasons, and partly due to programmers being sloppy, the original text itself is sometimes not valid by some checks. By default, when the original is not valid, the translation is not expected to be valid either, i.e. it is not checked. This parameter requires that the translation is always checked, regardless of the validity of the original (problems can almost always be avoided in the translation).</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
</dl>
</div>
<p>Currently performed checks:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Markup validity. KDE4 messages can contain a mix of <a class="ulink" href="http://techbase.kde.org/Development/Tutorials/Localization/i18n_Semantics" target="_top">KUIT</a> and <a class="ulink" href="http://doc.qt.nokia.com/4.6/richtext-html-subset.html" target="_top">Qt rich text</a> markup. Although Qt rich text does not have to be well-formed in XML sense, this check expects well-formedness to be preserved in translation if the original is such (also see the <code class="option">strict</code> parameter).</p>
<p>This check can be skipped on a message by adding to it the <code class="literal">no-check-markup</code> <a class="link" href="ch-common.html#p-trflag">translator flag</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-rules" id="sv-check-rules"></a>3.5.7.&nbsp;<span class="command"><strong>check-rules</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-rules</strong></span> applies language- and project-dependent Pology <span class="emphasis"><em>validation rules</em></span> to translation. See <a class="xref" href="ch-lingo.html#sec-lgrules" title="8.5.&nbsp;Validation Rules">Section&nbsp;8.5, “Validation Rules”</a> for detailed discussion on writing and applying rules.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">lang:<em class="replaceable"><code>code</code></em></code></span></dt>
<dd>
<p>The language code for which to apply the rules. If not given, it will be each PO file in turn, and if not found there either, an will be signaled.</p>
</dd>
<dt><span class="term"><code class="option">env:<em class="replaceable"><code>environment&gt;</code></em></code></span></dt>
<dd>
<p>The language environment for which to apply the rules (see <a class="xref" href="ch-lingo.html#sec-lglangenv" title="8.1.&nbsp;The Notion of Language in Pology">Section&nbsp;8.1, “The Notion of Language in Pology”</a>). Several environments can be given as comma-separated list, in which case the later environment in the list takes precedence on conflicted rules. If not given, it may also be read from PO files (see <a class="link" href="ch-common.html#hdr-x-environment"><code class="literal">X-Environment</code></a> in <a class="xref" href="ch-common.html#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>).</p>
</dd>
<dt><span class="term"><code class="option">envonly</code></span></dt>
<dd>
<p>When language environment is given, only the rules explicitly belonging to it are applied, while general rules for the selected language are ignored.</p>
</dd>
<dt><span class="term"><code class="option">rule:<em class="replaceable"><code>identifiers</code></em></code></span></dt>
<dd>
<p>Comma-separated list of rule identifiers, to apply only those rules. If a rule selected in this way is disabled in its definition, this enables it.</p>
</dd>
<dt><span class="term"><code class="option">rulerx:<em class="replaceable"><code>regexes</code></em></code></span></dt>
<dd>
<p>Like <code class="option">rule</code>, but the values are interpreted as regular expressions by which to match rule identifiers.</p>
</dd>
<dt><span class="term"><code class="option">norule:<em class="replaceable"><code>identifiers</code></em></code></span></dt>
<dd>
<p>Inverse of the <code class="option">rule</code> parameter: selected rules are not applied, and all other are applied.</p>
</dd>
<dt><span class="term"><code class="option">norulerx:<em class="replaceable"><code>regexes</code></em></code></span></dt>
<dd>
<p>Inverse of the <code class="option">rulerx</code> parameter: selected rules are not applied, and all other are applied.</p>
</dd>
<dt><span class="term"><code class="option">stat</code></span></dt>
<dd>
<p>Rules can take time to apply to all sieved PO files, and this parameter requests to write out some statistics of rule application at the end of sieving.</p>
</dd>
<dt><span class="term"><code class="option">accel:<em class="replaceable"><code>characters</code></em></code></span></dt>
<dd>
<p>Characters to consider as <a class="link" href="ch-poformat.html#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator markers</a>. If not given, they may be read from sieved PO files. Note that this parameter in itself does nothing: it only makes it possible for a particular rule or group of rules to remove the accelerator before matching.</p>
</dd>
<dt><span class="term"><code class="option">markup:<em class="replaceable"><code>types</code></em></code></span></dt>
<dd>
<p>The type of text markup used in messages, by keyword. It can also be a comma-separated list of keywords. If not given, it may be read from sieved PO files. See description of <a class="link" href="ch-common.html#hdr-x-text-markup"><code class="literal">X-Text-Markup</code></a> in <a class="xref" href="ch-common.html#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a> for the list of markup keywords currently known to Pology. Similarly to <code class="option">accel</code> parameter, this parameter only enables rules to remove the markup (or do something else) before matching.</p>
</dd>
<dt><span class="term"><code class="option">xml:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>By default, messages failed by rules are reported to standard output, and this parameter requests that they be written into a custom (but simple) XML format.</p>
</dd>
<dt><span class="term"><code class="option">rfile:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>By default internal Pology rules are applied, and this parameter can be used to apply external rules instead, defined in the given rule file.</p>
</dd>
<dt><span class="term"><code class="option">rdir:<em class="replaceable"><code>directory</code></em></code></span></dt>
<dd>
<p>Like <code class="option">rfile</code>, but external rules are read from a directory containing any number of rule files.</p>
</dd>
<dt><span class="term"><code class="option">branch:<em class="replaceable"><code>branch</code></em></code></span></dt>
<dd>
<p>Apply rules only to messages from given branch (<a class="link" href="ch-summit.html" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">summit</a>). Several branches may be given as comma-separated list.</p>
</dd>
<dt><span class="term"><code class="option">showfmsg</code></span></dt>
<dd>
<p>Rules are sometimes applied to the filtered instead of the original message, and when such message is failed, it may not be obvious what triggered the rule. This parameter requests that the filtered message is written out too when the original message is reported.</p>
</dd>
<dt><span class="term"><code class="option">nomsg</code></span></dt>
<dd>
<p>When a message is failed, by default it is output in full together with the problem description. This parameter requests that only the problem description is output.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
<dt><span class="term"><code class="option">mark</code></span></dt>
<dd>
<p>To each failed message a <code class="literal">failed-rule</code> flag is added, modifying the PO file. Modified files can then be opened in the editor, and failed messages looked up by this flag.</p>
</dd>
</dl>
</div>
<p>One or more rules can be disabled on a particular message in the PO file itself, by adding a special translator comment that starts with <code class="literal">skip-rule:</code> and continues with comma-separated list of rule identifiers:</p>
<pre class="programlisting">
# skip-rule: <em class="replaceable"><code>ruleid1</code></em>, <em class="replaceable"><code>ruleid2</code></em>, ...
</pre></div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-spell" id="sv-check-spell"></a>3.5.8.&nbsp;<span class="command"><strong>check-spell</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-spell</strong></span> checks spelling of translation by splitting it into words and passing them through GNU Aspell (<a class="ulink" href="http://aspell.net/" target="_top">http://aspell.net/</a>). This sieve is a more specific counterpart to <a class="link" href="ch-sieve.html#sv-check-spell-ec" title="3.5.9.&nbsp;check-spell-ec"><span class="command"><strong>check-spell-ec</strong></span></a>, which exposes some options specific to Aspell and requires no external Python modules, only the Aspell installation. Also read <a class="xref" href="ch-lingo.html#sec-lgspell" title="8.2.&nbsp;Spell Checking">Section&nbsp;8.2, “Spell Checking”</a> for details on spell-checking in Pology.</p>
<p><span class="command"><strong>check-spell</strong></span> behaves mostly the same as <span class="command"><strong>check-spell-ec</strong></span>, and accepts all the same parameters with same meanings; the exception is the <code class="option">provider</code> parameter, which is not present here since Aspell is the fixed provider. Only the parameters specific to this sieve are described in the following:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">enc:<em class="replaceable"><code>encoding</code></em></code></span></dt>
<dd>
<p>The encoding in which the text should be sent to Aspell.</p>
</dd>
<dt><span class="term"><code class="option">var:<em class="replaceable"><code>variety</code></em></code></span></dt>
<dd>
<p>The variety of the Aspell dictionary, if any.</p>
</dd>
<dt><span class="term"><code class="option">xml:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>By default, messages with unknown words are reported to standard output, and this parameter requests that they be written into a custom (but simple) XML format.</p>
</dd>
</dl>
</div>
<p>Aspell can be configured for use in Pology through user configuration, so that it is not necessary to issue some parameters on every run. See <a class="xref" href="ch-common.html#sec-cmcfgaspell" title="9.2.3.&nbsp;The [aspell] section">Section&nbsp;9.2.3, “The <code class="literal">[aspell]</code> section”</a>.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-spell-ec" id="sv-check-spell-ec"></a>3.5.9.&nbsp;<span class="command"><strong>check-spell-ec</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-spell-ec</strong></span> uses the Enchant library (<a class="ulink" href="http://www.abisource.com/projects/enchant/" target="_top">http://www.abisource.com/projects/enchant/</a>) through PyEnchant Python module (<a class="ulink" href="http://pyenchant.sourceforge.net" target="_top">http://pyenchant.sourceforge.net</a>) to provide uniform access to different spell-checkers, such as Aspell, Ispell, Hunspell, etc. Translation is first split into words, possibly eliminating markup and other literal content, and the words are then fed to spell-checker. Messages containing unknown words are reported to standard output, with list of replacement suggestions.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">provider:<em class="replaceable"><code>keyword</code></em></code></span></dt>
<dd>
<p>The spell-checker that Enchant should use. The value is one of keywords defined by Enchant (e.g. <code class="literal">aspell</code>, <code class="literal">hunspell</code>...), and can be seen by running <span class="command"><strong>enchant-lsmod</strong></span> command (only providers available on the system are shown). If not given either by this parameter or in user configuration, Enchant will try to select a provider on its own.</p>
</dd>
<dt><span class="term"><code class="option">lang:<em class="replaceable"><code>code</code></em></code></span></dt>
<dd>
<p>The language code for which the spelling is checked. If not given, it will be read from each PO file in turn, and if not found there either, an error will be signaled.</p>
</dd>
<dt><span class="term"><code class="option">env:<em class="replaceable"><code>environment&gt;</code></em></code></span></dt>
<dd>
<p>The language environment for which to include supplemental dictionaries (see <a class="xref" href="ch-lingo.html#sec-lglangenv" title="8.1.&nbsp;The Notion of Language in Pology">Section&nbsp;8.1, “The Notion of Language in Pology”</a>). Several environments can be given as comma-separated list, in which case the union of their dictionaries is used. If not given, environments may be read from PO files (see <a class="link" href="ch-common.html#hdr-x-environment"><code class="literal">X-Environment</code></a> in <a class="xref" href="ch-common.html#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>) or from user configuration.</p>
</dd>
<dt><span class="term"><code class="option">accel:<em class="replaceable"><code>characters</code></em></code></span></dt>
<dd>
<p>Characters to consider as <a class="link" href="ch-poformat.html#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator markers</a>, to remove them before splitting text into words. If not given, they may be read from PO files (see <a class="link" href="ch-common.html#hdr-x-accelerator-marker"><code class="literal">X-Acclerator-Marker</code></a> in <a class="xref" href="ch-common.html#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>).</p>
</dd>
<dt><span class="term"><code class="option">markup:<em class="replaceable"><code>types</code></em></code></span></dt>
<dd>
<p>The type of text markup used in messages, by keyword. It can also be a comma-separated list of keywords. If not given, it may be read from PO files (see <a class="link" href="ch-common.html#hdr-x-text-markup"><code class="literal">X-Text-Markup</code></a> in <a class="xref" href="ch-common.html#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>; there the list of markup keywords currently known to Pology is given as well).</p>
</dd>
<dt><span class="term"><code class="option">skip:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Words matched by this regular expression are not sent to spell-checker.</p>
</dd>
<dt><span class="term"><code class="option">filter:<em class="replaceable"><code>hookspec</code></em></code></span></dt>
<dd>
<p>The hook to modify the text before splitting into words and spell-checking them (see <a class="xref" href="ch-common.html#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">Section&nbsp;9.10, “Processing Hooks”</a>). The hook type must be F1A, F3A, or F3C. The parameter can be repeated to add several hooks, which are then applied in the order of specification.</p>
</dd>
<dt><span class="term"><code class="option">suponly</code></span></dt>
<dd>
<p>By default, internal supplemental spelling dictionaries are added to the system dictionary of the selected spell-checker. This parameter can be issued to instead use only internal dictionaries and not the system dictionary.</p>
</dd>
<dt><span class="term"><code class="option">list</code></span></dt>
<dd>
<p>By default, when an unknown word is found, the complete message is output, with the problematic word highlighted and possibly the replacement suggestions. With this parameter, only a plain sorted list of unknown words, one per line, is output at the end of sieving. This is useful when a lot of false positives are expected, to quickly add them to the supplemental dictionary.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on messages containing unknown words in Lokalize.</p>
</dd>
</dl>
</div>
<p><span class="command"><strong>check-spell-ec</strong></span> may be told to skip checking specific messages and words, and it may use internal supplemental spelling dictionaries. See <a class="xref" href="ch-lingo.html#sec-lgspell" title="8.2.&nbsp;Spell Checking">Section&nbsp;8.2, “Spell Checking”</a> for these and other details on spell-checking in Pology.</p>
<p>Enchant can be configured for use in Pology through user configuration, so that it is not necessary to issue some parameters on every run. See <a class="xref" href="ch-common.html#sec-cmcfgenchant" title="9.2.2.&nbsp;The [enchant] section">Section&nbsp;9.2.2, “The <code class="literal">[enchant]</code> section”</a>.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-tp-kde" id="sv-check-tp-kde"></a>3.5.10.&nbsp;<span class="command"><strong>check-tp-kde</strong></span></h3>
</div>
</div>
</div>
<p>The <a class="ulink" href="http://l10n.kde.org/" target="_top">KDE Translation Project</a> contains a great number of PO files extracted from various types of sources. This results in that for each message, there are things that the translation can, must or must not contain, for the translation to be technically valid. When run over PO files within the KDE TP, <span class="command"><strong>check-tp-kde</strong></span> will first try to determine the type of each message and then apply appropriate technical checks to it. Message type is determined based on file location, file header, message flags and contexts; even a particular message in a particular file may be checked for some very specific issue.</p>
<p><a name="p-techprob" id="p-techprob"></a>"Technical" issues are those which should be fixed regardless of the language and style of translation, because they can lead to loss of functionality, information or presentation to the user. For example, a technical issue would be badly paired XML tags in translation, when in the original they were well paired; a non-technical issue (and thus not checked) would be when the original ends with a certain punctuation, but translation does not -- whether such details are errors or not, depends on the target language and translation style.</p>
<p>For the sieve to function properly, it needs to detect the project subdirectory of each PO file up to topmost division within the branch, e.g. <code class="filename">messages/kdebase</code> <code class="filename">docmessages/kdegames</code>. This means that the local copy of the repository tree needs to follow the repository layout up to that point, e.g. <code class="filename">kde-trunk-ui/kdebase</code> and <code class="filename">kde-trunk-doc/kdegames</code> would not be valid local paths.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">strict</code></span></dt>
<dd>
<p>Sometimes the original text itself may not be valid against a certain check. When this is the case, by default the translation is not expected to be valid either, and the check is skipped. Issuing this parameter will force all checks on translation, regardless of whether the original is valid or not. It may still be possible to avoid some checks on those messages that just cannot be repared through translation, if those checks define their own mechanism of cancelation (like adding a special translator comment).</p>
</dd>
<dt><span class="term"><code class="option">check:<em class="replaceable"><code>keywords</code></em></code></span></dt>
<dd>
<p>Comma-separated list of checks to apply, by keyword, instead of all. Available checks are listed below.</p>
</dd>
<dt><span class="term"><code class="option">showmsg</code></span></dt>
<dd>
<p>By default, when the message does not pass a check, only its location and the problem are reported. This parameter requests that message is reported in total, possibly with problematic segments of translation highlighted.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
</dl>
</div>
<p>Currently available checks (keyword in parenthesis):</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>KDE4 markup checking (<code class="literal">kde4markup</code>).</p>
</li>
<li class="listitem">
<p>Qt markup checking (<code class="literal">qtmarkup</code>).</p>
</li>
<li class="listitem">
<p>Docbook markup checking (<code class="literal">dbmarkup</code>)</p>
</li>
<li class="listitem">
<p>HTML markup checking (<code class="literal">htmlmarkup</code>).</p>
</li>
<li class="listitem">
<p>No translation scripting in "dumb" messages (<code class="literal">nots</code>). Translations fetched at runtime by KDE4 translation system may use <a class="ulink" href="http://techbase.kde.org/Localization/Concepts/Transcript" target="_top">translation scripting</a>. This check will make sure that scripting is not attempted for other types of messages (used by Qt-only code, for .desktop files, etc.).</p>
</li>
<li class="listitem">
<p>Qt datetime format messages (<code class="literal">qtdt</code>). A message is considered to be in this format if it contains the string <code class="literal">qtdt-format</code> in its <code class="varname">msgctxt</code> string or among flags.</p>
</li>
<li class="listitem">
<p>Validity of translator credits (<code class="literal">trcredits</code>). PO files may contain meta-messages to input translator credits, which should have both valid translations on their own and some congruence between them.</p>
</li>
<li class="listitem">
<p>Query placeholders in Plasma runners (<code class="literal">plrunq</code>). Messages in Plasma runners may contain special query placeholder <code class="literal">:q:</code>, which should be present in translation too.</p>
</li>
<li class="listitem">
<p>File-specific checking (<code class="literal">catspec</code>). Certain messages in certain PO files have special validity requirements, and this check activates all such file-specific checks.</p>
</li>
</ul>
</div>
<p>All markup checks can be skipped on a message by adding the <code class="literal">no-check-markup</code> <a class="link" href="ch-common.html#p-trflag">translator flag</a>.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-tp-wesnoth" id="sv-check-tp-wesnoth"></a>3.5.11.&nbsp;<span class="command"><strong>check-tp-wesnoth</strong></span></h3>
</div>
</div>
</div>
<p>PO files of <a class="ulink" href="http://www.wesnoth.org/" target="_top">The Battle of Wesnoth</a> contain a mix of well-known and custom markup and format directives. <span class="command"><strong>check-tp-wesnoth</strong></span> heuristically determines the type of each message in a Wesnoth PO file and applies appropriate technical checks to it (where "technical" has the same meaning as in <a class="link" href="ch-sieve.html#p-techprob">the <span class="command"><strong>check-tp-kde</strong></span> sieve</a>).</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">check:<em class="replaceable"><code>keywords</code></em></code></span></dt>
<dd>
<p>Comma-separated list of checks to apply, by keyword, instead of all. Available checks are listed below.</p>
</dd>
<dt><span class="term"><code class="option">showmsg</code></span></dt>
<dd>
<p>Instead of just showing the message location and problem description, also show the complete message, possibly with higlighted problematic segments.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
</dl>
</div>
<p>Currently available checks (keyword in parenthesis):</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>().</p>
</li>
<li class="listitem">
<p>Stray context separators in translation (<code class="literal">ctxtsep</code>). Wesnoth is still embedding disambiguating context into <code class="varname">msgid</code>, by putting it in front of the actual text and separated by <code class="literal">^</code>. An unwary translator will sometimes mistakes such context for part of the original text, and translate it too.</p>
</li>
<li class="listitem">
<p>Congruence of WML interpolations (<code class="literal">interp</code>). WML interpolations look like <code class="literal">"...side $side_number is..."</code> and normally must match between the original and translation, or else the player would loose information. Only in very rare cases (e.g. some plurals and Markov chain generators) some interpolations may be missing in translation, and then they can be listed space-separated in a translator comment to silence the check:</p>
<pre class="programlisting">
# ignore-interpolations: <em class="replaceable"><code>interp1</code></em> <em class="replaceable"><code>interp2</code></em> ...
</pre>
<p>(the <code class="literal">$</code> character is not necessary in the list).</p>
</li>
<li class="listitem">
<p>WML markup checking (<code class="literal">wml</code>). If WML in translation is not valid, player may see some visual artifacts. Also, links in WML must match between original and translation, to avoid loss of information.</p>
</li>
<li class="listitem">
<p>Pango markup checking (<code class="literal">pango</code>). Pango is used in some places for visual text markup instead of WML.</p>
</li>
<li class="listitem">
<p>Congruence of leading and trailing space (<code class="literal">space</code>). For many languages, significant leading and trailing space from the original should be preserved. A heuristic is used to determine when leading or trailing space is significant. Only languages explicitly specified internally are checked for this.</p>
</li>
<li class="listitem">
<p>Docbook validity (<code class="literal">docbook</code>). Docbook is actually not used as a source format anywhere in Wesnoth, but the Wesnoth manual is converted into Docbook specifically to facilitate translation (weird as it may sound).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-collect-pmap" id="sv-collect-pmap"></a>3.5.12.&nbsp;<span class="command"><strong>collect-pmap</strong></span></h3>
</div>
</div>
</div>
<p><span class="emphasis"><em>Property maps</em></span> (or <span class="emphasis"><em>pmaps</em></span> for short) are one way in which arbitrary properties of language phrases can be defined for use in scripted translations, such as provided by <a class="ulink" href="http://techbase.kde.org/Localization/Concepts/Transcript" target="_top">Transcript</a>, the translation scripting system in KDE 4.</p>
<p>A property map is a text file with a number of entries, each defining the properties of a certain phrase. A pmap entry starts with one or more keys and continues with arbitrary number of key-value properties. An example entry would be grammar declinations of a noun:</p>
<pre class="programlisting">
=/Athens/Atina/nom=Atina/gen=Atine/dat=Atini/acc=Atinu//
</pre>
<p>The first two characters define, in order, the key-value separator (here <code class="literal">=</code>) and the property separator (here <code class="literal">/</code>) for the current entry. The two separators can be any non-alphanumeric characters, and must be different. Then follows a number of entry keys, delimited by property separators, and then a number of key-value properties, each internaly delimited by the key-value separator. The entry is terminated by double property separator. Properties of an entry can be fetched in the translation scripting system by any of the entry keys; keys are case- and whitespace-insensitive.</p>
<p><span class="command"><strong>collect-pmap</strong></span> will parse pmap entries from manual comments in messages, collect them, and write out a property map file. It is not necessary to explicitly specify entry keys, since the contents of <code class="varname">msgid</code> and <code class="varname">msgstr</code> are automatically added as keys. Since each manual comment is one line, it is also allowed to drop the final double separator which would normally terminate the entry. The above example would thus look like this in a PO message:</p>
<pre class="programlisting">
# pmap: =/nom=Atina/gen=Atine/dat=Atini/acc=Atinu/
msgctxt "Greece/city"
msgid "Athens"
msgstr "Atina"
</pre>
<p>The manual comment starts with <code class="literal">pmap:</code> keyword, which is followed by a normal pmap entry, except for missing keys (but additional keys can be specified when <code class="varname">msgid</code> and <code class="varname">msgstr</code> are not sufficient). It is also possible to split the entry into several comments, with only condition that all share the same set of separators:</p>
<pre class="programlisting">
# pmap: =/nom=Atina/gen=Atine/
# pmap: =/dat=Atini/acc=Atinu/
</pre>
<p>After collecting pmap entries from all processed PO files, if two or more entries end up having same keys, they are all removed from the collection and a warning is reported.</p>
<p>Pmap entries are collected only from translated, non-plural messages.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">outfile:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>File path into which the property map should be written. If not given, nothing is written out; this is useful for validating entries.</p>
</dd>
<dt><span class="term"><code class="option">propcons:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>Path to the file which defines constraints on property keys and values, used to validate parsed entries (see <a class="xref" href="ch-sieve.html#sec-svvalpmap" title="3.5.12.2.&nbsp;Validating Entries">Section&nbsp;3.5.12.2, “Validating Entries”</a>).</p>
</dd>
<dt><span class="term"><code class="option">extrakeys</code></span></dt>
<dd>
<p>By default, it is actually not possible to add any aditional entry keys besides the automatically added <code class="varname">msgid</code> and <code class="varname">msgstr</code>. This gives extra safety against errors, such as translator mistyping the key-value pair. If additional keys are actually needed, this parameter can be issued to accept them.</p>
</dd>
<dt><span class="term"><code class="option">derivs:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>Path to the file which defines derivators for synder entries (see <a class="xref" href="ch-sieve.html#sec-svsynder" title="3.5.12.1.&nbsp;Derivating Entries">Section&nbsp;3.5.12.1, “Derivating Entries”</a>).</p>
</dd>
<dt><span class="term"><code class="option">pmhead:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>Default <code class="literal">pmap:</code> as entry prefix may not be the most convenient; for example, when the language of translation is not written with Latin script. This parameter makes makes it possibly to use an arbitrary string for the entry prefix.</p>
</dd>
<dt><span class="term"><code class="option">sdhead:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>Like <code class="option">pmhead</code>, but for prefix to synder entries, instead of the default <code class="literal">synder:</code> (see <a class="xref" href="ch-sieve.html#sec-svsynder" title="3.5.12.1.&nbsp;Derivating Entries">Section&nbsp;3.5.12.1, “Derivating Entries”</a>).</p>
</dd>
</dl>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svsynder" id="sec-svsynder"></a>3.5.12.1.&nbsp;Derivating Entries</h4>
</div>
</div>
</div>
<p>There is another, more succint way to define pmap entries in comments. Instead of writting out all key-value combinations, it is possible instead to generate them by using <span class="emphasis"><em>syntagma derivators</em></span> (or <span class="emphasis"><em>synders</em></span>) for short. From the earlier example:</p>
<pre class="programlisting">
# pmap: =/nom=Atina/gen=Atine/dat=Atini/acc=Atinu/
</pre>
<p>it can be observed that each form has the same root, <code class="literal">Atin</code>, followed by the appropriate ending for that form type. This makes it convenient to reformulate it as a syntagma derivation:</p>
<pre class="programlisting">
# synder: Atin|a
</pre>
<p>Here <code class="literal">|a</code> is a <span class="emphasis"><em>derivator</em></span>; all derivators are defined in a separate synder file (with <code class="filename">.sd</code> extension by convention) and made known to the sieve through the <code class="option">derivs</code> parameter. The derivator in this example would be defined like this:</p>
<pre class="programlisting">
|a: nom=a, gen=e, dat=i, acc=u
</pre>
<p>First comes the derivator name, starting with <code class="literal">|</code> and ending with <code class="literal">:</code>, and then the comma-separated list of key-value pairs similar as in the pmap entry, except that now only the endings for the given form are specified. Synders are actually a standalone subsystem of Pology, see <a class="xref" href="ch-lingo.html#sec-lgsynder" title="8.6.&nbsp;Syntagma Derivation">Section&nbsp;8.6, “Syntagma Derivation”</a> for all details.</p>
<p>It is possible to mix pmap (<code class="literal"># pmap: ...</code>) and synder (<code class="literal"># synder: ...</code>) entries in translator comments. For example, synder entries may be used to cover majority of cases, which follow the general language rules, while pmap entries can be used for exceptions.</p>
<p>On the other hand, every pmap entry can be reformulated as a synder entry which does not refer to an external derivator:</p>
<pre class="programlisting">
# synder: nom=Atina, gen=Atine, dat=Atini, acc=Atinu
</pre>
<p>This begs the question of what is the need for pmap entries at all, if synder entries can be used in the same capacity and beyond? Pmap entries are still useful because synders have a lot of special syntax and rules to keep in mind (e.g. what if the phrase itself contains a comma?), while raw pmaps have none past what was described above.</p>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svvalpmap" id="sec-svvalpmap"></a>3.5.12.2.&nbsp;Validating Entries</h4>
</div>
</div>
</div>
<p>The <code class="literal">propcons</code> parameter can be used to specify a file which defines constraints on acceptable property keys, and on values by each key. Its format is the following:</p>
<pre class="programlisting">
# Full-line comment.
/key_regex_1/value_regex_1/flags # a trailing comment
/key_regex_2/value_regex_2/flags
:key_regex_3:value_regex_3:flags # different separator
# etc.
</pre>
<p>Regular expressions for keys and values are delimited by a separator defined by first non-whitespace character in the line, which must also be non-alphanumeric. Before being compiled, regular expressions are automatically wrapped as <code class="literal">^(<em class="replaceable"><code>regex</code></em>)$</code>, so that an expression to require a certain prefix is given as <code class="literal"><em class="replaceable"><code>prefix</code></em>.*</code> and a suffix as <code class="literal">.*<em class="replaceable"><code>suffix</code></em></code>. A property key must match one of the key regexs, or else it is considered invalid. Value to that property must then match the value regexes attached to all matched key regexes.</p>
<p>For example, a constraint file defining no constraints on either property keys or values is:</p>
<pre class="programlisting">
/.*/.*/
</pre>
<p>while a file explicitly listing all allowed property keys, and constraining values to some of them, would be:</p>
<pre class="programlisting">
/nom|gen|dat|acc/.*/
/gender/m|f|n/
/number/s|p/
</pre>
<p>The last separator in the constraint can be followed by a string of single-character flags. These flags are currently defined:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">i</code>: case-insensitive matching for the value.</p>
</li>
<li class="listitem">
<p><code class="literal">I</code>: case-insensitive matching for the key.</p>
</li>
<li class="listitem">
<p><code class="literal">t</code>: the value must both match the regular expression and be equal to <code class="varname">msgstr</code>. If <code class="literal">i</code> flag is added too, equality check is also case-insensitive.</p>
</li>
<li class="listitem">
<p><code class="literal">r</code>: regular expression for the key must match at least one key among all defined properties.</p>
</li>
</ul>
</div>
<p>Constraint definition file must be encoded with UTF-8.</p>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-diff-previous" id="sv-diff-previous"></a>3.5.13.&nbsp;<span class="command"><strong>diff-previous</strong></span></h3>
</div>
</div>
</div>
<p>When PO files are merged with <code class="option">--previous</code> option to <span class="command"><strong>msgmerge</strong></span>, fuzzy messages will retain the previous version of original text (<code class="varname">msgctxt</code>, <code class="varname">msgid</code> and <code class="varname">msgid_plural</code>) under <code class="literal">#|</code> comments. Then <span class="command"><strong>diff-previous</strong></span> can be used to embedded differences from previous to current original into previous original strings. For example, the message:</p>
<pre class="programlisting">
#: main.c:110
#, fuzzy
#| msgid "The Record of The Witch River"
msgid "Records of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre>
<p>will become after sieving:</p>
<pre class="programlisting">
#: main.c:110
#, fuzzy
#| msgid "{-The Record-}{+Records+} of The Witch River"
msgid "Records of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre>
<p>Text editors may even provide highlighting for the wrapped difference segments (e.g. Kwrite/Kate).</p>
<p>This sieve is very useful if your PO editor does not show differences in the original by itself. To be able to easily see exactly what was changed in the original is important both for efficiency and for quality. Think of a long paragraph in which only one word was changed: without a diff it will take you time to reread it, and you may even miss that changed word.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">strip</code></span></dt>
<dd>
<p>Instead of embedding diffs, remove them from messages, recovering the original form of previous strings. This is useful if you did not update all fuzzy messages but you anyway want to send the PO file away (commit it to the repository, etc.).</p>
</dd>
<dt><span class="term"><code class="option">branch:<em class="replaceable"><code>branch</code></em></code></span></dt>
<dd>
<p>Embed diffs only into messages from given branch (<a class="link" href="ch-summit.html" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">summit</a>). Several branches may be given as comma-separated list.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-empty-fuzzies" id="sv-empty-fuzzies"></a>3.5.14.&nbsp;<span class="command"><strong>empty-fuzzies</strong></span></h3>
</div>
</div>
</div>
<p>For every fuzzy message, <span class="command"><strong>empty-fuzzies</strong></span> removes the translation and fuzzy data (the <code class="literal">fuzzy</code> flag, previous strings). Translator comments are kept by default, but they can be removed as well. Obsolete fuzzy messages are completely removed.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">rmcomments</code></span></dt>
<dd>
<p>Also remove translator comments from fuzzy messages.</p>
</dd>
<dt><span class="term"><code class="option">noprev</code></span></dt>
<dd>
<p>Empty only those fuzzy messages which do not have previous strings (i.e. when the PO file was merged without <code class="option">--previous</code> option to <span class="command"><strong>msgmerge</strong></span>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-equip-header-tp-kde" id="sv-equip-header-tp-kde"></a>3.5.15.&nbsp;<span class="command"><strong>equip-header-tp-kde</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>equip-header-tp-kde</strong></span> applies <a class="link" href="ch-common.html#hk-proj-kde-header-equip-header">the <code class="literal">kde%header/equip-header</code> hook</a> to headers of PO files within the KDE Translation Project.</p>
<p>There are no parameters.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-fancy-quote" id="sv-fancy-quote"></a>3.5.16.&nbsp;<span class="command"><strong>fancy-quote</strong></span></h3>
</div>
</div>
</div>
<p>Ordinary ASCII quotes are easy to type on most keyboard layouts, and these quotes are frequently encountered in non-typeset English texts, rather than proper English quotes. These proper quotes are sometimes called "fancy" quotes. When translating from English, translators can thus be easily moved to use ASCII quotes themselves, instead of the fancy quotes appropriate for their language. To somewhat correct this, <span class="command"><strong>fancy-quote</strong></span> can be used to replace ASCII quotes in the translation with selected pairs of fancy quotes.</p>
<p>ASCII quotes that are part of text markup (e.g. attribute values in XML-like tags) must not be replaced, and this sieve will use heuristics to determine such places. In fact, it will replace quotes rather conservatively. Nevertheless, unless some sort of automatic validation is available, converted text should be manually inspected for correctness.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">single:<em class="replaceable"><code>quotes</code></em></code></span></dt>
<dd>
<p>Opening and closing quote to replace ASCII single quotes (i.e. <em class="replaceable"><code>quotes</code></em> is a two-character string). If not given, single quotes are not replaced (but see the <code class="option">longsingle</code> parameter).</p>
</dd>
<dt><span class="term"><code class="option">single:<em class="replaceable"><code>quotes</code></em></code></span></dt>
<dd>
<p>Opening and closing quote to replace ASCII double quotes. If not given, double quotes are not replaced (but see the <code class="option">longdouble</code> parameter).</p>
</dd>
<dt><span class="term"><code class="option">longsingle:<em class="replaceable"><code>open</code></em>,<em class="replaceable"><code>close</code></em></code></span></dt>
<dd>
<p>Alternative to <code class="option">single</code>, if opening and closing quotes are not single characters. The value are the opening quote string and the closing quote string, separated by comma.</p>
</dd>
<dt><span class="term"><code class="option">longdouble:<em class="replaceable"><code>open</code></em>,<em class="replaceable"><code>close</code></em></code></span></dt>
<dd>
<p>Alternative to <code class="option">double</code>, if opening and closing quotes are not single characters.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-find-messages" id="sv-find-messages"></a>3.5.17.&nbsp;<span class="command"><strong>find-messages</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>find-messages</strong></span> is the search and replace workhorse of Pology. It applies one or several conditions to different parts of the PO message, with selectable boolean linking between them. If the message is matched as whole, it is reported and possibly some replacements are done. Messages are by default reported to standard output, with full location reference (PO file path, line and entry number), but can also be opened directly in one of supported PO editors (see <a class="xref" href="ch-common.html#sec-cmsupped" title="9.7.1.&nbsp;PO Editors">Section&nbsp;9.7.1, “PO Editors”</a>).</p>
<p>When used in a sieve chain, <span class="command"><strong>find-messages</strong></span> will stop further sieving of messages which did not satisfy the conditions. This makes it useful as a filter for selecting subsets of messages on which other sieves should operate.</p>
<p>There are three logical groups of parameters: matching parameters, replacement parameters, and general parameters. Matching and replacement parameters have certain relationships between themselves, while general parameters have mutually independent effects (i.e. as usual for sieve parameters).</p>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svfmmpar" id="sec-svfmmpar"></a>3.5.17.1.&nbsp;Matching Parameters</h4>
</div>
</div>
</div>
<p>Matching parameters specify patterns for matching by parts of the message, or represent binary conditions (whether the message is translated, etc.). For example:</p>
<pre class="programlisting">
$ posieve find-messages -s msgid:'foo bar'
</pre>
<p>will report all messages which contain the phrase "foo bar" in their <code class="varname">msgid</code> (or <code class="varname">msgid_plural</code>) string. When several matching parameters are given, by default the message is matched if all patterns match; that is, boolean linking of conditions is AND. This:</p>
<pre class="programlisting">
$ posieve find-messages -s msgid:'foo bar' -s transl
</pre>
<p>will report all messages that contain "foo bar" in original <span class="emphasis"><em>and</em></span> are translated. Boolean linking can be switched to OR by issuing the <code class="option">or</code> parameter. To find all messages that contain the word "tooltip" in <span class="emphasis"><em>either</em></span> context or comments:</p>
<pre class="programlisting">
$ posieve find-messages -s msgctxt:tooltip -s comment:tooltip -s or
</pre>
<p>(Actually, the effect of <code class="option">or</code> is somewhat more specific, see its description below.) String matching is by default case insensitive, which can be changed globally by issuing the <code class="option">case</code> parameter.</p>
<p>Every matching parameter has a negative counterpart, named by prepending <code class="literal">n</code> to the original parameter, which matches when the original parameter does not. Running:</p>
<pre class="programlisting">
$ posieve find-messages -s msgid:'hello' -s nmsgstr:'zdravo'
</pre>
<p>would find all messages that contain "hello" in the original and do <span class="emphasis"><em>not</em></span> contain "zdravo" in the translation (a typical usage pattern in quick terminology checks).</p>
<p>To find all messages not matching a set of conditions, in principle it would be possible to negate the whole condition set by switching between positive/negative parameters and AND/OR-linking, but this can be cumbersome. Instead, the <code class="option">invert</code> parameter can be issued to report messages that are not matched by the condition set.</p>
<p>Sometimes neither simple AND nor simple OR boolean linking is sufficient to form the search. Therefore the <code class="option">fexpr</code> parameter is provided, which can be used to specify a search expression with explicit boolean operators and parentheses for controlling the evaluation order. With <code class="option">fexpr</code>, the previous example could be reformulated as:</p>
<pre class="programlisting">
$ posieve find-messages -s fexpr:'msgid/hello/ and not msgstr/zdravo/'
</pre>
<p>For details, see the description of <code class="option">fexpr</code> below.</p>
<p>Currently defined matching parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">(n)msgctxt:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Regular expression to match the <code class="varname">msgctxt</code> string.</p>
</dd>
<dt><span class="term"><code class="option">(n)msgid:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Regular expression to match the <code class="varname">msgid</code> and <code class="varname">msgid_plural</code> strings. The condition is satisfed as whole if <span class="emphasis"><em>either</em></span> of these strings matches.</p>
</dd>
<dt><span class="term"><code class="option">(n)msgstr:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Regular expression to match <code class="varname">msgstr</code> strings. The condition is satisfed as whole if any of the <code class="varname">msgstr</code> strings matches.</p>
</dd>
<dt><span class="term"><code class="option">(n)comment:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Regular expression to match extracted and translator comments and source reference comments. The condition is satisfed as whole if any of these comments matches.</p>
</dd>
<dt><span class="term"><code class="option">(n)flag:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Regular expression to match flags. This matches each flag in turn, and not the flag comment as a monolithic string. The condition is satisfed as whole if any flag matches.</p>
</dd>
<dt><span class="term"><code class="option">(n)transl</code></span></dt>
<dd>
<p>The message must be translated.</p>
</dd>
<dt><span class="term"><code class="option">(n)obsol</code></span></dt>
<dd>
<p>The message must be obsolete.</p>
</dd>
<dt><span class="term"><code class="option">(n)active</code></span></dt>
<dd>
<p>The message must be active, i.e. translated and not obsolete.</p>
</dd>
<dt><span class="term"><code class="option">(n)plural</code></span></dt>
<dd>
<p>The message must be a plural message.</p>
</dd>
<dt><span class="term"><code class="option">(n)maxchar:<em class="replaceable"><code>number</code></em></code></span></dt>
<dd>
<p>Original and translation can have at most this many characters. The condition is satisfied as whole if all these strings satisfy it.</p>
</dd>
<dt><span class="term"><code class="option">(n)lspan:<em class="replaceable"><code>start</code></em>:<em class="replaceable"><code>end</code></em></code></span></dt>
<dd>
<p>The referent line number of the message (the line in which its <code class="varname">msgid</code> string starts) must fall within given range. The starting number is included in the range, the ending number is not.</p>
</dd>
<dt><span class="term"><code class="option">(n)espan:<em class="replaceable"><code>start</code></em>:<em class="replaceable"><code>end</code></em></code></span></dt>
<dd>
<p>Like <code class="option">lspan</code>, but instead of line numbers it applies to entry numbers. These are the numbers that dedicated PO editors usually report in their user interfaces.</p>
</dd>
<dt><span class="term"><code class="option">(n)branch:<em class="replaceable"><code>branch</code></em></code></span></dt>
<dd>
<p>The message must belong to this branch (<a class="link" href="ch-summit.html" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">summit</a>). Several branches may be given as comma-separated list.</p>
</dd>
<dt><span class="term"><code class="option">(n)fexpr:<em class="replaceable"><code>expression</code></em></code></span></dt>
<dd>
<p>Boolean expression with explict boolean operators and parenthesis for priority, constructed out of any of the other matching parameters. If a match parameter needs a value (like a regular expression), in the expression it is given as <code class="literal"><em class="replaceable"><code>match</code></em>/<em class="replaceable"><code>value</code></em>/</code>, where any nonalphanumeric character can be used consistently instead of <code class="literal">/</code> (in case the value itself contains <code class="literal">/</code>). For example, the expression:</p>
<pre class="programlisting">
fexpr:'(msgctxt/foo/ or comment/foo/) and msgid/bar/'
</pre>
<p>is satisfied if either the context or comments contain "foo", and the original text contains "bar".</p>
<p>If matching is influenced by a general parameter (e.g. case sensitivity), in the expression it may be able to take overriding modifiers in form of single characters after the value, i.e. <code class="literal"><em class="replaceable"><code>match</code></em>/<em class="replaceable"><code>value</code></em>/<em class="replaceable"><code>modifiers</code></em></code>. Assuming that <code class="option">case</code> parameter has not been issued, the expression:</p>
<pre class="programlisting">
fexpr:'msgid/quuk/ and msgstr/Qaak/c'
</pre>
<p>will be satisfied if the original text contains "quuk" in any casing, and translation contains exactly "Qaak". Currently available modifiers are:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">c</code>: matching is case-sensitive.</p>
</li>
<li class="listitem">
<p><code class="literal">i</code>: matching is case-insensitive. May be needed when string matching is globally case-sensitive due to <code class="option">case</code> being issued.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svfmrpar" id="sec-svfmrpar"></a>3.5.17.2.&nbsp;Replacement Parameters</h4>
</div>
</div>
</div>
<p>Replacement is done in pair with matching the appropriate string in the message. For example, to replace each appearance of "foobar" with "fumbar" in translation, this would be run:</p>
<pre class="programlisting">
$ posieve find-messages -s msgstr:foobar -s replace:fumbar
</pre>
<p>The <code class="option">replace</code> parameter works in pair with <code class="option">msgstr</code>, i.e. <code class="option">replace</code> cannot be issued without issuing <code class="option">msgstr</code> as well. There are two possible problems with replacement as straightforward as this. The first is that if "foobar" was a whole word (or start of a word), and this word in the text started with upper-case letter, the replacement would make it lower-case. This can be avoided by executing replacement twice with case sensitivity:</p>
<pre class="programlisting">
$ posieve find-messages -s msgstr:foobar -s replace:fumbar -scase
$ posieve find-messages -s msgstr:Foobar -s replace:Fumbar -scase
</pre>
<p>The other problem is if the word is split by an accelerator marker, for example:</p>
<pre class="programlisting">
msgstr "... f_oobar ..."
</pre>
<p>The search may still find the word (see the <code class="option">accel</code> parameter below), but direct replacement would cause the loss of accelerator marker, and therefore it is not done.<sup>[<a name="id431966" href="#ftn.id431966" class="footnote" id="id431966">8</a>]</sup> To see such cases, you should monitor the output of <span class="command"><strong>find-messages</strong></span> (always a good idea when doing batch replacement), where matched and replaced parts of the text will be highlighted.</p>
<p>As usual for replacement based on regular expression, the replacement string may contain <code class="literal">\<em class="replaceable"><code>number</code></em></code> references to groups defined in the matching pattern. For example, the previous example of case-aware replacement could be more efficiently and more elegantly performed with:</p>
<pre class="programlisting">
$ posieve find-messages -s msgstr:'(f)oobar' -s replace:'\1umbar'
</pre>
<p>(Though this is possible only if the original and the replacement start with the same letter.)</p>
<p>Currently defined replacement parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">replace:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>The string to replace the match by <code class="option">msgstr</code> parameter. Can contain regular expression group references.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svfmgpar" id="sec-svfmgpar"></a>3.5.17.3.&nbsp;General Parameters</h4>
</div>
</div>
</div>
<p>Parameters influencing general behavior of <span class="command"><strong>find-messages</strong></span> are as follows:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">or</code></span></dt>
<dd>
<p>Boolean OR instead of AND linking of conditions, but only for string matchers: <code class="option">msgctxt</code>, <code class="option">msgid</code>, <code class="option">msgstr</code>, <code class="option">comment</code>. This restriction may seem odd, but it is what is mostly needed in practice. For example, the set of conditions:</p>
<pre class="programlisting">
-s msgctxt:tooltip -s comment:tooltip -s transl -s or
</pre>
<p>would match all translated messages which have "tooltip" in context or in comments, and not messages which are either translated or have "tooltip" in context or in comments. For full control over the expression, use the <code class="option">fexpr</code> parameter.</p>
</dd>
<dt><span class="term"><code class="option">invert</code></span></dt>
<dd>
<p>Inverts the selection: messages satisfying the condition set are <span class="emphasis"><em>not</em></span> selected.</p>
</dd>
<dt><span class="term"><code class="option">accel:<em class="replaceable"><code>characters</code></em></code></span></dt>
<dd>
<p>Characters to consider as <a class="link" href="ch-poformat.html#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator markers</a>, to remove before applying matching patterns. If not given, they may be read from PO files (see <a class="link" href="ch-common.html#hdr-x-accelerator-marker"><code class="literal">X-Acclerator-Marker</code></a> in <a class="xref" href="ch-common.html#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>).</p>
</dd>
<dt><span class="term"><code class="option">case</code></span></dt>
<dd>
<p>Matching patterns for strings and comments are by default case-insensitive, and this parameter switches them to case-sensitive.</p>
</dd>
<dt><span class="term"><code class="option">mark</code></span></dt>
<dd>
<p>To each selected message a <code class="literal">match</code> flag is added, modifying the PO file. Modified files can then be opened in the editor, and selected messages looked up by this flag. This is typically done when something should be modified in selected messages, but doing that automatically (using <code class="option">replace</code> parameter) is not possible or safe enough. Also useful here is the option <code class="option">-m</code>/<code class="option">--output-modified</code> of <span class="command"><strong>posieve</strong></span>, to write out the paths of modified PO files into a separate file, which can then be fed to the editor.</p>
</dd>
<dt><span class="term"><code class="option">filter:<em class="replaceable"><code>hookspec</code></em></code></span></dt>
<dd>
<p>The hook to modify the translation before applying the <code class="option">msgstr</code> matcher to it. The hook type must be F1A. The parameter can be repeated to add several hooks.</p>
</dd>
<dt><span class="term"><code class="option">nomsg</code></span></dt>
<dd>
<p>Do not report selected messages, either to standard output or to PO editors. Useful when <span class="command"><strong>find-messages</strong></span> is a pre-filter in the sieve chain.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on selected messages in Lokalize (unless <code class="option">nomsg</code> is in effect).</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-generate-xml" id="sv-generate-xml"></a>3.5.18.&nbsp;<span class="command"><strong>generate-xml</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>generate-xml</strong></span> creates a partial XML representation of a group of PO files.</p>
<p>The output XML format is as follows. Each PO file in the group is represented by a <code class="literal">&lt;po&gt;</code> element, which contains a list of <code class="literal">&lt;msg&gt;</code> elements, one for each message. The C<code class="literal">&lt;msg&gt;</code> element contains the usual parts of a PO message:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">&lt;line&gt;</code>: referent line number of the message</p>
</li>
<li class="listitem">
<p><code class="literal">&lt;refentry&gt;</code>: referent entry number of the message</p>
</li>
<li class="listitem">
<p><code class="literal">&lt;status&gt;</code>: current status of the message (obsolete, translated, untranslated, fuzzy)</p>
</li>
<li class="listitem">
<p><code class="literal">&lt;msgid&gt;</code>: the original text</p>
</li>
<li class="listitem">
<p><code class="literal">&lt;msgstr&gt;</code>: the translation</p>
</li>
<li class="listitem">
<p><code class="literal">&lt;msgctxt&gt;</code>: disambiguating context</p>
</li>
</ul>
</div>
<p>If the PO message contains plural forms, they will be represented with <code class="literal">&lt;plural&gt;</code> subelements of <code class="literal">&lt;msgstr&gt;</code>.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">xml:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>By default the XML content is written to standard output, and this parameter can be used to send it to a file instead</p>
</dd>
<dt><span class="term"><code class="option">translatedOnly</code></span></dt>
<dd>
<p>Only translated messages are exported to XML (i.e. fuzzy, untranslated and obsolete are ignored).</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-merge-corr-tree" id="sv-merge-corr-tree"></a>3.5.19.&nbsp;<span class="command"><strong>merge-corr-tree</strong></span></h3>
</div>
</div>
</div>
<p>When doing corrections on a copy of PO files tree, it is not possible to easily merge back just the updated translations, because word wrapping in PO file can be different, generating much more difference than it should.</p>
<p>Additionally, tools like <span class="command"><strong>pogrep</strong></span> from <a class="ulink" href="http://translate.sourceforge.net/wiki/toolkit/index" target="_top">Translate Toolkit</a> will create new partial tree as output, containing matched messages only. <span class="command"><strong>merge-corr-tree</strong></span> will help you to merge changes made in that partial tree back into the main tree.</p>
<p>The main PO files tree is the input, and the <code class="option">pathdelta</code> parameter is used to provide the path difference to where the partial correction tree is located.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">pathdelta:<em class="replaceable"><code>search</code></em>:<em class="replaceable"><code>replace</code></em></code></span></dt>
<dd>
<p>Specifies that the partial tree is located at path obtained when <code class="literal"><em class="replaceable"><code>search</code></em></code> is replaced with <code class="literal"><em class="replaceable"><code>replace</code></em></code> in the input path.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-normalize-header" id="sv-normalize-header"></a>3.5.20.&nbsp;<span class="command"><strong>normalize-header</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>normalize-header</strong></span> applies <a class="link" href="ch-common.html#hk-normalize-canonical-header">the <code class="literal">normalize/canonical-header</code> hook</a> to PO file headers.</p>
<p>There are no parameters.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-normctxt-delim" id="sv-normctxt-delim"></a>3.5.21.&nbsp;<span class="command"><strong>normctxt-delim</strong></span></h3>
</div>
</div>
</div>
<p>In older PO files, disambiguating contexts may be embedded into <code class="varname">msgid</code> strings, as the initial part of the string delimited from the actual text with predefined substrings, here called the "head" and the "tail". For example, in:</p>
<pre class="programlisting">
msgid ""
"_:this-is-context\n"
"This is original text"
msgstr "This is translated text"
</pre>
<p>the head is the underscore-colon sequence (<code class="literal">_:</code>), and the tail the newline (<code class="literal">\n</code>). <span class="command"><strong>normctxt-delim</strong></span> will convert embedded contexts of the delimiter-type to proper <code class="varname">msgctxt</code> strings.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">head:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>The head of the delimiter-type embedded context.</p>
</dd>
<dt><span class="term"><code class="option">tail:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>The tail of the delimiter-type embedded context.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-normctxt-sep" id="sv-normctxt-sep"></a>3.5.22.&nbsp;<span class="command"><strong>normctxt-sep</strong></span></h3>
</div>
</div>
</div>
<p>In older PO files, disambiguating contexts may be embedded into <code class="varname">msgid</code> strings, as the initial part of the string separated from the actual text by a predefined substring. For example, in:</p>
<pre class="programlisting">
msgid "this-is-context|This is original text"
msgstr "This is translated text"
</pre>
<p>the separator string is the pipe character (<code class="literal">|</code>). <span class="command"><strong>normctxt-sep</strong></span> will convert embedded contexts of the separator-type to proper <code class="varname">msgctxt</code> strings.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">sep:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>The string that separates the context and the text in separator-type embedded context.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-remove-fuzzy-comments" id="sv-remove-fuzzy-comments"></a>3.5.23.&nbsp;<span class="command"><strong>remove-fuzzy-comments</strong></span></h3>
</div>
</div>
</div>
<p>Being translator's input, translator comments are copied verbatim to fuzzy messages created on merging with template. Depending on the purpose of translator comments (e.g. see <a class="xref" href="ch-common.html#sec-cmskipcheck" title="9.11.&nbsp;Skipping and Selecting Checks">Section&nbsp;9.11, “Skipping and Selecting Checks”</a> for some special types), it may be better to automatically remove some of them from fuzzy messages (and then possibly add them back manually when updating the translation). If run without any parameters <span class="command"><strong>remove-fuzzy-comments</strong></span> will do nothing, so one or more parameters need to be given to actually remove any comment.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">all</code></span></dt>
<dd>
<p>Simply all translator comments in fuzzy messages are removed.</p>
</dd>
<dt><span class="term"><code class="option">nopipe</code></span></dt>
<dd>
<p>Translator comments containing <a class="link" href="ch-common.html#p-trflag">translator flags</a> (see <a class="xref" href="ch-common.html#sec-cmskipcheck" title="9.11.&nbsp;Skipping and Selecting Checks">Section&nbsp;9.11, “Skipping and Selecting Checks”</a>) are removed.</p>
</dd>
<dt><span class="term"><code class="option">pattern:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Translator comment must match the given regular expression to be removed.</p>
</dd>
<dt><span class="term"><code class="option">exclude:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Translator comment is removed if it does not match the given regular expression.</p>
</dd>
<dt><span class="term"><code class="option">case</code></span></dt>
<dd>
<p>Matching patterns are by default case-insensitive, and this parameter switches to case-sensitivity.</p>
</dd>
</dl>
</div>
<p>When several removal criteria are specified, first those other than <code class="option">pattern</code> and <code class="option">exclude</code> are applied in unspecified order, then the <code class="option">pattern</code> match, and finally the <code class="option">exclude</code> match.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-remove-obsolete" id="sv-remove-obsolete"></a>3.5.24.&nbsp;<span class="command"><strong>remove-obsolete</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>remove-obsolete</strong></span> simply removes all obsolete messages, whether fuzzy or translated, from the PO file.</p>
<p>There are no parameters.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-remove-previous" id="sv-remove-previous"></a>3.5.25.&nbsp;<span class="command"><strong>remove-previous</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>remove-previous</strong></span> removes previous strings, i.e. <code class="literal">#| ...</code> comments, from messages.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">all</code></span></dt>
<dd>
<p>Previous strings are by default removed only from non-fuzzy messages. This parameter specifies to remove previous strings from all messages, including fuzzy.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-resolve-aggregates" id="sv-resolve-aggregates"></a>3.5.26.&nbsp;<span class="command"><strong>resolve-aggregates</strong></span></h3>
</div>
</div>
</div>
<p>In its default mode of operation, <span class="command"><strong>msgcat(1)</strong></span> produces an aggregate message when in different catalogs it encounters a message with the same key but different translation or translator or extracted comments. A general aggregate message looks like this:</p>
<pre class="programlisting">
# #-#-#-#-#  po-file-name-1 (project-version-id-1)  #-#-#-#-#
# manual-comments-1
# #-#-#-#-#  po-file-name-2 (project-version-id-2)  #-#-#-#-#
# manual-comments-2
# ...
# #-#-#-#-#  po-file-name-n (project-version-id-n)  #-#-#-#-#
# manual-comments-n
#. #-#-#-#-#  po-file-name-1 (project-version-id-1)  #-#-#-#-#
#. automatic-comments-1
#. #-#-#-#-#  po-file-name-2 (project-version-id-2)  #-#-#-#-#
#. automatic-comments-2
#. ...
#. #-#-#-#-#  po-file-name-n (project-version-id-n)  #-#-#-#-#
#. automatic-comments-n
#: source-refs-1 source-refs-2 ... source-refs-n
#, fuzzy, other-flags
msgctxt "context"
msgid "original-text"
msgstr ""
"#-#-#-#-#  po-file-name-1 (project-version-id-1)  #-#-#-#-#\n"
"translated-text-1\n"
"#-#-#-#-#  po-file-name-2 (project-version-id-2)  #-#-#-#-#\n"
"translated-text-2\n"
"..."
"#-#-#-#-#  po-file-name-n (project-version-id-n)  #-#-#-#-#\n"
"translated-text-n"
</pre>
<p>Each message part is aggregated only if different in at least one message in the group. For example, extracted comments may be aggregated while translations not.</p>
<p><span class="command"><strong>resolve-aggregates</strong></span> is used to resolve aggregate messages of this kind into normal messages, by picking one variant from each aggregated part.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">first</code></span></dt>
<dd>
<p>By default, the picked variant is the one with most occurences, or the first of the several with same number of occurences. If this parameter is issued, the first variant is picked unconditionally.</p>
</dd>
<dt><span class="term"><code class="option">unfuzzy</code></span></dt>
<dd>
<p>Aggregated messages are always made fuzzy, leaving no way to determine if and which of the original messages were fuzzy. Therefore, by default, the resolved message is left fuzzy too. If, however, it is known beforehand that none of the original messages were fuzzy, resolved messages can be unfuzzied by issuing this parameter.</p>
</dd>
<dt><span class="term"><code class="option">keepsrc</code></span></dt>
<dd>
<p>Since there is no information based on which the aggregated source references can be split into originating groups, they are entirely removed unless this parameter is issued.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-resolve-alternatives" id="sv-resolve-alternatives"></a>3.5.27.&nbsp;<span class="command"><strong>resolve-alternatives</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>resolve-alternatives</strong></span> resolves <span class="emphasis"><em>alternatives directives</em></span> found in the translation into one of the alternatives.</p>
<p>An alternative directive is a substring of the form <code class="literal">~@/.../.../...</code>, for example:</p>
<pre class="programlisting">
msgstr "I see a ~@/pink/white/ elephant."
</pre>
<p><code class="literal">~@</code> is the directive head, which is followed by a character that defines the delimiter of alternatives (can be arbitrary), and then by alternatives themselves. The number of alternatives per directive is not defined by the directive itself, but it is provided as the sieve parameter (i.e. all alternative directives must have some number of alternatives).</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">alt:<em class="replaceable"><code>N</code></em>,<em class="replaceable"><code>M</code></em>t</code></span></dt>
<dd>
<p>Specifies how to resolve alternatives. <code class="literal"><em class="replaceable"><code>N</code></em></code> is the index (starting from 1) of the alternative to take from each directive, and <code class="literal"><em class="replaceable"><code>M</code></em></code> is the number of alternatives per directive. Example: <code class="literal">alt:1,2t</code>.</p>
</dd>
</dl>
</div>
<p>If an alternatives directive is invalid (e.g. too little alternatives), it is reported to standard output. If at least one alternatives directive in the text is not valid, the text is not modifed.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-resolve-entities" id="sv-resolve-entities"></a>3.5.28.&nbsp;<span class="command"><strong>resolve-entities</strong></span></h3>
</div>
</div>
</div>
<p>XML entities are substrings of the form <code class="literal">&lt;<em class="replaceable"><code>entityname</code></em>&gt;</code>, typically encountered in XML-like text markups, but elsewhere too. They are resolved into underlying, human-readable values at build time (when translated text documents are created) or at run time (in translated user interfaces). Sometimes it may be better to have them resolved already in the PO file itself, and that is what <span class="command"><strong>resolve-entities</strong></span> does.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">entdef:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>Path to the file which contains entitiy definitions. It can be repeated to add several files.</p>
<p>Entity definition files are plain text files of the following format:</p>
<pre class="programlisting">
&lt;!-- This is a commment. --&gt;
&lt;!ENTITY name1 'value1'&gt;
&lt;!ENTITY name2 'value2'&gt;
&lt;!ENTITY name3 'value3'&gt;
...
</pre></dd>
<dt><span class="term"><code class="option">ignore:<em class="replaceable"><code>entitynames</code></em></code></span></dt>
<dd>
<p>Entities which should be ignored during resolution. Standard XML entities (<code class="literal">&amp;lt;</code>, <code class="literal">&amp;gt;</code>, <code class="literal">&amp;apos;</code>, <code class="literal">&amp;quot;</code>, <code class="literal">&amp;amp;</code>) are ignored by default.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-set-header" id="sv-set-header"></a>3.5.29.&nbsp;<span class="command"><strong>set-header</strong></span></h3>
</div>
</div>
</div>
<p>Sometimes a PO header field or comment needs to be updated in many PO files at once, and <span class="command"><strong>set-header</strong></span> serves that purpose.</p>
<p>Parameters for setting and removing header fields:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">field:<em class="replaceable"><code>name</code></em>:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the field with given name to given value. This parameter can be repeated to set several fields in one run.</p>
<p>By default, <code class="option">field</code> will actually set the field only if it is already present in the header. To add the field if not present, the <code class="option">create</code> parameter must be issued as well. If the field is being added, parameters <code class="option">after</code> and <code class="option">before</code> can be used to specify where to insert it, or else the new field is appended at the end of the header. If the field is present but not positioned according to <code class="option">after</code> and <code class="option">before</code>, the <code class="option">reorder</code> parameter can be issued to move the field within the header.</p>
</dd>
<dt><span class="term"><code class="option">create</code></span></dt>
<dd>
<p>The field should be added if it is not present in the header.</p>
</dd>
<dt><span class="term"><code class="option">after</code></span></dt>
<dd>
<p>When a field is added, it should be inserted after this field.</p>
</dd>
<dt><span class="term"><code class="option">before</code></span></dt>
<dd>
<p>When a field is added, it should be inserted before this field.</p>
</dd>
<dt><span class="term"><code class="option">reorder</code></span></dt>
<dd>
<p>If the field is present, but it is in the wrong place according to <code class="option">after</code> and <code class="option">before</code>, this parameter will cause it to be reinserted in proper place.</p>
</dd>
<dt><span class="term"><code class="option">remove:<em class="replaceable"><code>field</code></em></code></span></dt>
<dd>
<p>Remove the field with this name. If there are several fileds of that name, all are removed.</p>
</dd>
<dt><span class="term"><code class="option">removerx:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Remove all fields matched by the given regular expression.</p>
</dd>
</dl>
</div>
<p>Parameters for setting and removing header comments:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">title:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the title comment to the given value. It can be repeated, since the title can be composed of multiple comment lines.</p>
</dd>
<dt><span class="term"><code class="option">rmtitle</code></span></dt>
<dd>
<p>Remove title comments.</p>
</dd>
<dt><span class="term"><code class="option">copyright:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the copyright comment to the given value.</p>
</dd>
<dt><span class="term"><code class="option">rmcopyright</code></span></dt>
<dd>
<p>Remove the copyright comment.</p>
</dd>
<dt><span class="term"><code class="option">license:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the license comment to the given value.</p>
</dd>
<dt><span class="term"><code class="option">rmlicense</code></span></dt>
<dd>
<p>Remove the license comment.</p>
</dd>
<dt><span class="term"><code class="option">author:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the author comment to the given value. It can be repeated, since there may be more authors (i.e. translators).</p>
</dd>
<dt><span class="term"><code class="option">rmauthor</code></span></dt>
<dd>
<p>Remove author comments.</p>
</dd>
<dt><span class="term"><code class="option">comment:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the free comment to the given value. It can be repeated, since there can be any number of free comment lines.</p>
</dd>
<dt><span class="term"><code class="option">rmcomment</code></span></dt>
<dd>
<p>Remove free comments.</p>
</dd>
<dt><span class="term"><code class="option">rmallcomm</code></span></dt>
<dd>
<p>Remove all header comments.</p>
</dd>
</dl>
</div>
<p>Note that all existing comments of given type are removed before setting the new ones, i.e. the new comments are <span class="emphasis"><em>not</em></span> appended to the existing. For example, if single <code class="option">author</code> parameter is issued, with a translator name and email address as value, this one translator will replace all existing translators in the header comments.</p>
<p>Comment values are checked for some minimal consistency, e.g. author comments must contain email addresses, licence comments the word "licence", etc.</p>
<p>Value strings (both of fields and comments) may contain %-directives, which are expanded to catalog-dependent substrings prior to setting the value. Currently available directive are:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">%poname</code>: PO domain name (equal to file name without <code class="filename">.po</code> extension)</p>
</li>
</ul>
</div>
<p>If literal % character is needed (e.g. when setting the <code class="literal">Plural-Forms</code> field), it can be escaped by doubling it, <code class="literal">%%</code>. The directive can also be given inside braces, as <code class="literal">%{...}</code> when it would be ambiguous otherwise.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-stats" id="sv-stats"></a>3.5.30.&nbsp;<span class="command"><strong>stats</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>stats</strong></span> collects statistics on PO files, such as message and word counts, and more. Statistics can be presented in several ways and on several levels.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">accel:<em class="replaceable"><code>characters</code></em></code></span></dt>
<dd>
<p>Characters to consider as <a class="link" href="ch-poformat.html#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator markers</a>, to remove them when splitting text to count words. If not given, they may be read from PO files (see <a class="link" href="ch-common.html#hdr-x-accelerator-marker"><code class="literal">X-Acclerator-Marker</code></a> in <a class="xref" href="ch-common.html#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>), or else some usual accelerator marker characters are removed.</p>
</dd>
<dt><span class="term"><code class="option">detail</code></span></dt>
<dd>
<p>In table views, by default only message, word, and character counts are given. This parameter requests additional derived data, such as expansion factors (ratio of words in translation to words in original), number of words per message, etc.</p>
</dd>
<dt><span class="term"><code class="option">incomplete</code></span></dt>
<dd>
<p>When run over a collection of PO files, all non-fully translated PO files are listed separately, with very brief statistics of incompleteness.</p>
</dd>
<dt><span class="term"><code class="option">incompfile:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>Write a file with paths of all non-fully translated PO files, one per line. This file can then be fed with <code class="option">-f</code>/<code class="option">--from-files</code> back to <span class="command"><strong>posieve</strong></span> or another script, to process only incomplete PO files.</p>
</dd>
<dt><span class="term"><code class="option">templates:<em class="replaceable"><code>search</code></em>:<em class="replaceable"><code>replace</code></em></code></span></dt>
<dd>
<p>If there exists both a directory with translated PO files and with POT (template) files, and not every POT file has the corresponding PO file, this parameter can be used to count POT files without PO counterpart as fully untranslated in statistics. Value to the parameter are two strings separated by colon: the first string will be searched for in directory paths of processed PO files, and replaced with the second string to construct corresponding directory paths of POT files. For example:</p>
<pre class="programlisting">
$ cd $MYTRANSLATIONS
$ ls
my_lang  templates
$ posieve stats -s templates:my_lang:templates my_lang/
</pre></dd>
<dt><span class="term"><code class="option">minwords:<em class="replaceable"><code>number</code></em></code></span></dt>
<dd>
<p>Only messages with at least this many words (in any of original or translation strings) are counted into statistics.</p>
</dd>
<dt><span class="term"><code class="option">maxwords:<em class="replaceable"><code>number</code></em></code></span></dt>
<dd>
<p>Only messages with at most this many words (in any of original or translation strings) are counted into statistics.</p>
</dd>
<dt><span class="term"><code class="option">lspan:<em class="replaceable"><code>start</code></em>:<em class="replaceable"><code>end</code></em></code></span></dt>
<dd>
<p>Only messages with referent line numbers (line number of <code class="varname">msgid</code>) in this range are counted into statistics. The starting line is included in the range, the ending line is not. If start is omitted (e.g. <code class="option">lspan::500</code>) it is assumed 0, and if end is omitted (e.g. <code class="option">lspan:300</code> or <code class="option">lspan:300:</code>) it is assumed the total number of lines.</p>
</dd>
<dt><span class="term"><code class="option">espan:<em class="replaceable"><code>start</code></em>:<em class="replaceable"><code>end</code></em></code></span></dt>
<dd>
<p>Only messages with entry numbers (as reported by PO editors) in this range are counted into statistics. Same boundary inclusion and omission rules as for <code class="option">lspan</code> apply; e.g. <code class="option">espan:4:8</code> means to count messages with entry numbers 4, 5, 6, and 7.</p>
</dd>
<dt><span class="term"><code class="option">branch:<em class="replaceable"><code>branch</code></em></code></span></dt>
<dd>
<p>Only messages from given branch are counted into statistics (<a class="link" href="ch-summit.html" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">summit</a>). Several branches may be given as comma-separated list.</p>
</dd>
<dt><span class="term"><code class="option">bydir</code></span></dt>
<dd>
<p>Statistics is broken by directories, that is a report is displayed for each group of PO files in the same directory (and not below it). More usually used with bar displays than with tabular displays.</p>
</dd>
<dt><span class="term"><code class="option">byfile</code></span></dt>
<dd>
<p>Statistics is broken by files, that is a report is displayed for each PO file. Usually used with bar displays.</p>
</dd>
<dt><span class="term"><code class="option">msgbar</code></span></dt>
<dd>
<p>Instead of a table with detailed statistics, only message counts are shown, accompanied with a text-art bar. Mostly useful in combination with <code class="option">bydir</code> and <code class="option">byfile</code>.</p>
</dd>
<dt><span class="term"><code class="option">wbar</code></span></dt>
<dd>
<p>Like <code class="option">msgbar</code>, but to have word instead of message counts.</p>
</dd>
<dt><span class="term"><code class="option">absolute</code></span></dt>
<dd>
<p>Bar displays (on <code class="option">msgbar</code> and <code class="option">wbar</code>) are normaly relative, meaning that when <code class="option">byfile</code> or <code class="option">bydir</code> is in effect, each bar is of same length. This parameter makes bars scaled to sizes of PO files or directories. For example, if <code class="option">msgbar</code> and <code class="option">byfile</code> are issued, then the bar of a PO file with twice as many messages as another PO file will be twice as long.</p>
</dd>
<dt><span class="term"><code class="option">ondiff</code></span></dt>
<dd>
<p>Fuzzy messages are often very easy to correct (e.g. a typo fixed), which may make their word count misleading when estimating translation effort. This can be amended by issuing this parameter, to reduce word and character counts of fuzzy messages by the difference ratio between current and previous original text, providing that the previous original is available and that the difference is smaller than some threshold. Removed parts of counts are added to translated category, so that total counts remain the same.</p>
</dd>
<dt><span class="term"><code class="option">mincomp:<em class="replaceable"><code>fraction</code></em></code></span></dt>
<dd>
<p>Only those PO files which have translation completeness (measured by the ratio of translated to all messages, excluding obsolete) equal to or higher than the given fraction are included into statistics. This is especially useful when for each new template an empty PO file is automatically produced (instead of translators having to start work from a template), to include into statistics only those files which have actually seen some translation (using a small non-zero number for the fraction, e.g. <code class="option">fraction:1e-6</code>).</p>
</dd>
<dd>
<p>The hook to modify the translation before splitting it to count words and characters (see <a class="xref" href="ch-common.html#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">Section&nbsp;9.10, “Processing Hooks”</a>). The hook type must be F1A. The parameter can be repeated to add several hooks, which are then applied in the order of specification.</p>
</dd>
</dl>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svstemctxt" id="sec-svstemctxt"></a>3.5.30.1.&nbsp;Handling Embedded Contexts</h4>
</div>
</div>
</div>
<p>Some older PO files will have disambiguating contexts embedded into the <code class="varname">msgid</code> string, instead of using the newer standard <code class="varname">msgctxt</code> string. There are several customary ways in which this is done, but in general it depends on the translation environment where such PO files are used.</p>
<p>Embedded contexts will skew the statistics. Pology contains several sieves for converting embedded contexts into <code class="varname">msgctxt</code> contexts, named <span class="command"><strong>normctxt-*</strong></span>. When statistics on such PO files is computed, a sieve chain should be used in which the <span class="command"><strong>stats</strong></span> sieve is preceeded by the context conversion sieve. For example, if the embedded context starts the <code class="varname">msgid</code> and ends with <code class="literal">|</code>, statistics should be computed with:</p>
<pre class="programlisting">
$ posieve --no-sync normctxt-sep,stats -s sep:'|' ...
</pre>
<p>Note that <span class="command"><strong>normctxt-*</strong></span> sieves, since they modify messages, would by default cause PO files to be modified on disk. Option <code class="option">--no-sync</code> is therefore issued to prevent modifications to sieved files.</p>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svstoutleg" id="sec-svstoutleg"></a>3.5.30.2.&nbsp;Output Legend</h4>
</div>
</div>
</div>
<p>The default output from <span class="command"><strong>stats</strong></span> is a table where rows present statistics for a category of messages, and columns the particular categories of data:</p>
<pre class="programlisting">
$ posieve stats frobaz/
-              msg  msg/tot  w-or  w/tot-or  w-tr  ch-or  ch-tr
translated     ...    ...    ...     ...     ...    ...    ...
fuzzy          ...    ...    ...     ...     ...    ...    ...
untranslated   ...    ...    ...     ...     ...    ...    ...
total          ...    ...    ...     ...     ...    ...    ...
obsolete       ...    ...    ...     ...     ...    ...    ...
</pre>
<p>The <code class="literal">total</code> row is the sum of <code class="literal">translated</code>, <code class="literal">fuzzy</code>, and <code class="literal">untranslated</code> rows, whereas <code class="literal">obsolete</code> row is excluded. The columns are as follows:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">msg</code>: number of messages</p>
</li>
<li class="listitem">
<p><code class="literal">msg/tot</code>: percentage of messages relative to total</p>
</li>
<li class="listitem">
<p><code class="literal">w-or</code>: number of words in the original</p>
</li>
<li class="listitem">
<p><code class="literal">w/tot-or</code>: percentage of words in the original relative to total</p>
</li>
<li class="listitem">
<p><code class="literal">w-tr</code>: number of words in the translation</p>
</li>
<li class="listitem">
<p><code class="literal">ch-or</code>: number of characters in original</p>
</li>
<li class="listitem">
<p><code class="literal">ch-tr</code>: number of characters in the translation</p>
</li>
</ul>
</div>
<p>The output with <code class="option">detail</code> parameter in effect is the same as default, with several columns of derived data appended to the table:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">w-ef</code>: word expansion factor (increase in words from the original to the translation)</p>
</li>
<li class="listitem">
<p><code class="literal">ch-ef</code>: character expansion factor (increase in characters from the original to the translation)</p>
</li>
<li class="listitem">
<p><code class="literal">w/msg-or</code>: average of number words per message in the original</p>
</li>
<li class="listitem">
<p><code class="literal">w/msg-tr</code>: average number of words per message in the translation</p>
</li>
<li class="listitem">
<p><code class="literal">ch/w-or</code>: average number of characters per message in the original</p>
</li>
<li class="listitem">
<p><code class="literal">ch/w-tr</code>: average number of characters per message in the translation</p>
</li>
</ul>
</div>
<p>If any of the sieve parameters that restrict or modify counting (such as <code class="option">ondiff</code>, <code class="option">lspan</code>, etc.) have been issued, this is indicated in the output by a <code class="literal">modifiers: ...</code> line:</p>
<pre class="programlisting">
$ posieve stats -s maxwords:5 -s ondiff frobaz/
(...the statistics table...)
modifiers: at most 5 words and scaled fuzzy counts
</pre>
<p>When the <code class="option">incomplete</code> parameter is given, the statistics table is followed by a table of non-fully translated PO files, with counts of fuzzy and untranslated messages and words:</p>
<pre class="programlisting">
$ posieve stats -s incomplete frobaz/
(...the overall statistics table...)
catalog              msg/f   msg/u   msg/f+u   w/f   w/u   w/f+u
frobaz/foxtrot.po        0      11        11     0   123     123
frobaz/november.po      19      14        33    85    47     132
frobaz/sierra.po        22       0        22   231     0     231
</pre>
<p>In the column names, <code class="literal">msg/*</code> and <code class="literal">w/*</code> stand for messages and words; <code class="literal">*/f</code>, <code class="literal">*/u</code>, and <code class="literal">*/f+u</code> stand for fuzzy, untranslated, and the two summed.</p>
<p>When parameters <code class="option">msgbar</code> or <code class="option">wbar</code> are in effect, statistics is presented in the form of a text-art bar, giving visual relation between numbers of translated, fuzzy, and untranslated messages or words:</p>
<pre class="programlisting">
$ posieve stats -s wbar frobaz/
4572/1829/2533 w-or |¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤×××××××××············|
</pre>
<p>A typical condensed overview of translation state is obtained by:</p>
<pre class="programlisting">
$ posieve stats -s byfile -s msgbar frobaz/
frobaz/foxtrot.po   34/ -/11 msgs |¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤·····|
frobaz/november.po  58/19/14 msgs |¤¤¤¤¤¤¤¤¤¤¤×××××····|
frobaz/sierra.po    65/22/ - msgs |¤¤¤¤¤¤¤¤¤¤¤¤¤¤××××××|
(overall)          147/41/25 msgs |¤¤¤¤¤¤¤¤¤¤¤¤¤××××···|
</pre>
<p>Note that while message counts are the classic for bar overviews (<code class="option">msgbar</code>), you are probably better off looking at word counts (<code class="option">wbar</code>) instead, because word counts represent more closely the amount of work needed to complete the translation. Rounding of fractions for bars is such that as long as there is at least one fuzzy or untranslated message (or word), the bar will show one incomplete cell.</p>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svstnotes" id="sec-svstnotes"></a>3.5.30.3.&nbsp;Notes on Counting</h4>
</div>
</div>
</div>
<p>Word and character counts for a message string are obtained by processing it in the following order:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Accelerator markers are removed.</p>
</li>
<li class="listitem">
<p>Text markup is eliminated (e.g. XML-like tags).</p>
</li>
<li class="listitem">
<p>Other special substrings, such as format directives, are also eliminated (e.g. <code class="literal">%s</code> in messages with <code class="literal">c-format</code> flag).</p>
</li>
<li class="listitem">
<p>Text is split into words by taking all contiguous sequences of "word characters", which include letters, numbers, and underscore.</p>
</li>
<li class="listitem">
<p>All words not starting with a letter are eliminated.</p>
</li>
<li class="listitem">
<p>Words that remain are counted into statistics. Whitespace is not included in character count.</p>
</li>
</ul>
</div>
<p>In plural messages, counts for the original are the average of <code class="varname">msgid</code> and <code class="varname">msgid_plural</code> strings, and likewise the average of all <code class="varname">msgstr</code> strings for the translation. In this way, the comparative statistics between the original and the translation is not skewed for languages that have more or less than two plural forms.</p>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-tag-untranslated" id="sv-tag-untranslated"></a>3.5.31.&nbsp;<span class="command"><strong>tag-untranslated</strong></span></h3>
</div>
</div>
</div>
<p>Some translators like to edit PO files with a plain text editor, which may provide no special support for editing PO files, other than perhaps PO syntax highlighting. In this scenario, <span class="command"><strong>tag-untranslated</strong></span> can be used to equip untranslated messages with <code class="literal">untranslated</code> flag, so that they can be easily looked up in the editor.</p>
<p>Since <code class="literal">untranslated</code> is not one of defined PO flags, it will be lost if the PO file is merged with the template. This is intentional: the only purpose of this flag is to facilitate immediate editing of the PO file, and you may miss to remove some of them while editing. There is no reason for <code class="literal">untranslated</code> flags to persist in that case. Also, if the flag is not removed after the message has been translated, a subsequent run of this sieve will remove the flag.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">strip</code></span></dt>
<dd>
<p>Instead of being added, <code class="literal">untranslated</code> flags are stripped. This is useful when you had no time to translate all messages but you want to send the PO file away.</p>
</dd>
<dt><span class="term"><code class="option">wfuzzy</code></span></dt>
<dd>
<p><code class="literal">untranslated</code> flags are added to fuzzy messages as well. This can be useful to be able to jump in the text editor through all incomplete message by just giving <strong class="userinput"><code>, untranslated</code></strong><sup>[<a name="id465494" href="#ftn.id465494" class="footnote" id="id465494">9</a>]</sup>, or when the set of messages to be updated has been limited somehow (e.g. by the <code class="option">branch</code> parameter).</p>
</dd>
<dt><span class="term"><code class="option">branch:<em class="replaceable"><code>branch</code></em></code></span></dt>
<dd>
<p>Tag only untranslated messages from given branch (<a class="link" href="ch-summit.html" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">summit</a>). Several branches may be given as comma-separated list.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-unfuzzy-context-only" id="sv-unfuzzy-context-only"></a>3.5.32.&nbsp;<span class="command"><strong>unfuzzy-context-only</strong></span></h3>
</div>
</div>
</div>
<p>Sometimes the message is made fuzzy during merging only due to change in the <code class="varname">msgctxt</code> string, or its addition or removal. Some translators and languages may be less dependent on contexts than the other, or they may be in a hurry prior to the release of the translation, and then <span class="command"><strong>unfuzzy-context-only</strong></span> can be used to unfuzzy these messages in which only the context was modified. This state can be detected by comparing the current and the previous strings in the fuzzy message, i.e. the PO file must have been merged with <code class="option">--previous</code> option to <span class="command"><strong>msgmerge</strong></span>.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">noreview</code></span></dt>
<dd>
<p>By default, unfuzzied messages will also be given a translator comment with <code class="literal">unreviewed-context</code> string, so that you may find and review these messages at a later time. This parameter will prevent the addition of such comment, but it is usually safer to review automatically unfuzzied messages when you find the time.</p>
</dd>
<dt><span class="term"><code class="option">eqmsgid</code></span></dt>
<dd>
<p>Sometimes a lot of messages in the code may be semi-automatically equipped with contexts (e.g. to group items by a common property), and then it may be necessary to review only those messages which got split into two or more messages due to newly added contexts. This parameter may be issued to specifically report all translated messages which have the their <code class="varname">msgid</code> string equal to an unfuzzied message, including unfuzzied messages themselves. Depending on exactly what kind of contexts have been added, the <code class="option">noreview</code> parameter may be useful here as well.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-unfuzzy-ctxmark-only" id="sv-unfuzzy-ctxmark-only"></a>3.5.33.&nbsp;<span class="command"><strong>unfuzzy-ctxmark-only</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>unfuzzy-ctxmark-only</strong></span> has a similar but less wide effect compared to the <span class="command"><strong>unfuzzy-context-only</strong></span> sieve. It unfuzzies a message only if the only change that caused fuzzyness is in a specific part of <code class="varname">msgctxt</code> string, the <span class="emphasis"><em>UI context marker</em></span>.</p>
<p>UI context markers are en element of <a class="ulink" href="http://techbase.kde.org/Development/Tutorials/Localization/i18n_Semantics" target="_top">KUIT markup</a> (KDE user interface text), which state more formally the user interface context in which the text given by the PO message is used. This may be important for translation, since style guidelines will typically somewhat depend on where in the UI the text is seen. For example, there may be two messages in the code which have exactly the same text in English, but one is used as a menu item, and the other as a dialog title; with KUIT, they would be marked as:</p>
<pre class="programlisting">
msgctxt "@action:inmenu File"
msgid "Export as HTML"
msgstr ""

msgctxt "@title:window"
msgid "Export as HTML"
msgstr ""
</pre>
<p>The UI context marker here is the leading part of <code class="varname">msgctxt</code>, starting with <code class="literal">@...</code> and ending with first whitespace. <span class="command"><strong>unfuzzy-ctxmark-only</strong></span> will unfuzzy the message if only this marker has changed (or was added or removed), but not if the change was in the rest of the context (after the first whitespace).</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">noreview</code></span></dt>
<dd>
<p>See the same-name parameter of <span class="command"><strong>unfuzzy-ctxmark-only</strong></span>. Using it here is probably somewhat safer, but this in general it depends on translation style guidelines.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-unfuzzy-inplace-only" id="sv-unfuzzy-inplace-only"></a>3.5.34.&nbsp;<span class="command"><strong>unfuzzy-inplace-only</strong></span></h3>
</div>
</div>
</div>
<p>Some text markups may have a "permissible" or "sloppy" mode, where some tags do not have to be explicitly terminated. The typical example is HTML, where <code class="literal">&lt;br&gt;</code>, <code class="literal">&lt;hr&gt;</code>, etc. do not have to be written as <code class="literal">&lt;br/&gt;</code>. (This is unlike XHTML, which is an XML instance and therefore strict in this respect.) When this permissible markup was used in the code, a programmer revisiting that code at a later time may consider it a poor style, and go about fixing it. This may cause some messages in the PO file to become fuzzy. <span class="command"><strong>unfuzzy-inplace-only</strong></span> will recognize some of these situations in a fuzzy message (by comparing the current and previous strings) and automatically modify the translation accordingly and unfuzzy the message.</p>
<p>There are no parameters.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-update-header" id="sv-update-header"></a>3.5.35.&nbsp;<span class="command"><strong>update-header</strong></span></h3>
</div>
</div>
</div>
<p>When translation on a PO file starts for the first time, or when a previously translated PO file is being updated after merging, <span class="command"><strong>update-header</strong></span> can be used to automatically set and update PO header fields to proper values. The revision date is taken as current, while other pieces of information are read from the user configuration (see <a class="xref" href="ch-common.html#sec-cmconfig" title="9.2.&nbsp;User Configuration">Section&nbsp;9.2, “User Configuration”</a>). Note that this sieve is normally only of use when you are translating with a plain text editor, while dedicated PO editors should do this automatically when the PO file is saved after editing.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">proj:<em class="replaceable"><code>projectid</code></em></code></span></dt>
<dd>
<p>The ID of the project to which the PO files to be updated belong. This ID is used to construct the name of the configuration section as <code class="literal">[project-<em class="replaceable"><code>projectid</code></em>]</code>, which contains the project data fields. Also used are the fields from the <code class="literal">[user]</code>, whenever they are not overriden in project's section. See <a class="xref" href="ch-common.html#sec-cmcfguser" title="9.2.1.&nbsp;The [user] section">Section&nbsp;9.2.1, “The <code class="literal">[user]</code> section”</a> and <a class="xref" href="ch-common.html#sec-cmcfgproj" title="9.2.4.&nbsp;Per-project sections ([project-*])">Section&nbsp;9.2.4, “Per-project sections (<code class="literal">[project-*]</code>)”</a>.</p>
</dd>
<dt><span class="term"><code class="option">init</code></span></dt>
<dd>
<p>By default, the sieve tries to detect if the header has been initialized before or not, because it differs somewhat what should be changed in the header on initialization and on update. This parameter can be issued to unconditionally treat the header as not initialized, i.e. overwrite any existing content.</p>
</dd>
<dt><span class="term"><code class="option">onmod</code></span></dt>
<dd>
<p>The header should be updated only if the PO file was otherwise modified. This parameter makes sense only in a sieve chane, when this sieve is preceded by a potentially modifying sieve.</p>
</dd>
</dl>
</div>
<p>An example of a user configuration appropriate for this sieve would be:</p>
<pre class="programlisting">
[user]
name = Chusslove Illich
original-name = Часлав Илић
email = caslav.ilic@gmx.net
po-editor = Kate

[project-kde]
language = sr
language-team = Serbian
team-email = kde-i18n-sr@kde.org
plural-forms = nplurals=4; plural=n==1 ? 3 : n%%10==1 &amp;&amp; \
               n%%100!=11 ? 0 : n%%10&gt;=2 &amp;&amp; n%%10&lt;=4 &amp;&amp; \
               (n%%100&lt;10 || n%%100&gt;=20) ? 1 : 2;
</pre>
<p>Note that percent characters in the <code class="literal">plural-forms</code> field are escaped by doubling, because single <code class="literal">%</code> in configuration has special meaning. Also note splitting into several lines by trailing <code class="literal">\</code> (only for better looks, since configuration lines can be arbitrarily long).</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-fr:setUbsp" id="sv-fr:setUbsp"></a>3.5.36.&nbsp;<span class="command"><strong>fr:setUbsp</strong></span></h3>
</div>
</div>
</div>
<p>In French language, some punctuation characters are separated with a certain amount of whitespace from the preceding word. This is unlike in English, so unwary French translators sometimes miss to add the required space before such punctuation when translating from English. <span class="command"><strong>fr:setUbsp</strong></span> will heuristically detect such places and insert the space.</p>
<p>There are no parameters.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-ru:fill-doc-date-kde" id="sv-ru:fill-doc-date-kde"></a>3.5.37.&nbsp;<span class="command"><strong>ru:fill-doc-date-kde</strong></span></h3>
</div>
</div>
</div>
<p>Each translation file for a docbook in KDE has a string for documentation last update date in the format 'yyyy-mm-dd'. This sieve automatically translated those strings into Russian. The sieve uses <span class="command"><strong>date</strong></span> command in order to change date formatting. But Russian names of months are hardcoded, so that you do not need to set up Russian locale to use the sieve.</p>
<p>There are no parameters.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svexternal" id="sec-svexternal"></a>3.6.&nbsp;Using External Sieves</h2>
</div>
</div>
</div>
<p>Each internal sieve is a single Python file in <code class="filename">sieve/</code> subdirectory (and in <code class="filename">lang/<em class="replaceable"><code>langcode</code></em>/sieve/</code> for language-specific sieves). The Python file is named like the sieve, only with hyphens replaced with underscores and with <code class="filename">.py</code> extension. <span class="command"><strong>posieve</strong></span> therefore knows how to find which file to execute when an internal sieve name is given as its first argument.</p>
<p>However, instead of an internal sieve name, the first argument to <span class="command"><strong>posieve</strong></span> can also be an explicit path (relative or absolute) to a Python file which implements a sieve. Explicit paths can also be part of a sieve chain, mixed with internal sieve names. This is all there is to running external sieves; see <a class="xref" href="ch-prog.html#sec-prsieves" title="11.3.&nbsp;Writing Sieves">Section&nbsp;11.3, “Writing Sieves”</a> for instructions on how to write one.</p>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id431966" href="#id431966" class="para" id="ftn.id431966">8</a>]</sup> Some heuristics for reinsertion of the accelerator marker may be implemented in the future.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id465494" href="#id465494" class="para" id="ftn.id465494">9</a>]</sup> Alternatively, if the editor provides regular expressions for searches, you can search for <strong class="userinput"><code>, fuzzy|, untranslated</code></strong>.</p>
</div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="ch-poformat.html">Prev</a>&nbsp;</td>
<td width="20%" align="center">&nbsp;</td>
<td width="40%" align="right">&nbsp;<a accesskey="n" href="ch-diffpatch.html">Next</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter&nbsp;2.&nbsp;The PO Format&nbsp;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;4.&nbsp;Diffing and Patching</td>
</tr>
</table>
</div>
</body>
</html>
