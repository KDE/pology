<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Pology User Manual</title>
<link rel="stylesheet" href="data/style.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<meta name="description" content="Pology is a Python library and collection of scripts for in-depth processing of PO files. The library is designed for easy and robust writing of custom scripts in field environments. The scripts perform wide variety of tasks, from precision operations on individual messages in PO files, to cross-file operations on large collections of PO files. Special support is provided for common elements in PO translation workflow, such as translation editors and version control systems, as well as for language-specific and project-specific needs. This document is the referent source of information on Pology. It describes the functionality available to end users, but also gives the overview of programming with Pology, since Pology is easily extensible and users are encouraged to introduce their own processing elements.">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div lang="en_US" class="book">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="id529362" id="id529362"></a>Pology User Manual</h1>
</div>
<div>
<div class="authorgroup">
<div class="author">
<h3 class="author"><span class="firstname">Chusslove</span> <span class="surname">Illich</span></h3>
<code class="email">&lt;<a class="email" href="mailto:caslav.ilic@gmx.net">caslav.ilic@gmx.net</a>&gt;</code></div>
</div>
</div>
<div>
<div class="abstract">
<p class="title"><b>Abstract</b></p>
<p>Pology is a Python library and collection of scripts for in-depth processing of PO files. The library is designed for easy and robust writing of custom scripts in field environments. The scripts perform wide variety of tasks, from precision operations on individual messages in PO files, to cross-file operations on large collections of PO files. Special support is provided for common elements in PO translation workflow, such as translation editors and version control systems, as well as for language-specific and project-specific needs.</p>
<p>This document is the referent source of information on Pology. It describes the functionality available to end users, but also gives the overview of programming with Pology, since Pology is easily extensible and users are encouraged to introduce their own processing elements.</p>
</div>
</div>
</div>
<hr></div>
<div class="toc">
<dl>
<dt><span class="chapter"><a href="#ch-about">1. A Study of PO</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-install">1.1. Obtaining and Installing</a></span></dt>
<dt><span class="sect1"><a href="#sec-deps">1.2. Dependencies</a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="#ch-poformat">2. The PO Format</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-pobasic">2.1. Basic Syntax</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-posrcref">2.1.1. Source References</a></span></dt>
<dt><span class="sect2"><a href="#sec-powrap">2.1.2. String Wrapping</a></span></dt>
<dt><span class="sect2"><a href="#sec-pomsguniq">2.1.3. Uniqueness of Messages</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-pocontext">2.2. Message Context</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-poautocmnt">2.2.1. Extracted Comments</a></span></dt>
<dt><span class="sect2"><a href="#sec-podisamb">2.2.2. Disambiguating Contexts</a></span></dt>
<dt><span class="sect2"><a href="#sec-pomancmnt">2.2.3. Translator Comments</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-poconssub">2.3. Constructive Substrings</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-poformdir">2.3.1. Format Directives</a></span></dt>
<dt><span class="sect2"><a href="#sec-pomarkup">2.3.2. Text Markup</a></span></dt>
<dt><span class="sect2"><a href="#sec-poescapes">2.3.3. Escape Sequences</a></span></dt>
<dt><span class="sect2"><a href="#sec-poaccel">2.3.4. Accelerators</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-poplurals">2.4. Plural Forms</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-pononum">2.4.1. Omitting The Number</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-pomerge">2.5. Merging With Templates</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-pofuzzy">2.5.1. Fuzzy Messages</a></span></dt>
<dt><span class="sect2"><a href="#sec-pofuzztr">2.5.2. Treatment of Fuzzy Messages</a></span></dt>
<dt><span class="sect2"><a href="#sec-poobsol">2.5.3. Obsolete Messages</a></span></dt>
<dt><span class="sect2"><a href="#sec-ponewfile">2.5.4. Starting a New PO file</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-poheader">2.6. PO Header</a></span></dt>
<dt><span class="sect1"><a href="#sec-poedrepr">2.7. Representation in Editors</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-poedlist">2.7.1. List of PO Editors</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="chapter"><a href="#ch-sieve">3. Sieving</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-svbasics">3.1. Basic Usage of <span class="command"><strong>posieve</strong></span></a></span></dt>
<dt><span class="sect1"><a href="#sec-svchains">3.2. Sieve Chains</a></span></dt>
<dt><span class="sect1"><a href="#sec-svoptions">3.3. Command Line Options</a></span></dt>
<dt><span class="sect1"><a href="#sec-svconfig">3.4. User Configuration</a></span></dt>
<dt><span class="sect1"><a href="#sec-svinternal">3.5. Internal Sieves</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sv-apply-filter">3.5.1. <span class="command"><strong>apply-filter</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-apply-header-filter">3.5.2. <span class="command"><strong>apply-header-filter</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-bad-patterns">3.5.3. <span class="command"><strong>bad-patterns</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-check-docbook4">3.5.4. <span class="command"><strong>check-docbook4</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-check-grammar">3.5.5. <span class="command"><strong>check-grammar</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-check-kde4">3.5.6. <span class="command"><strong>check-kde4</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-check-rules">3.5.7. <span class="command"><strong>check-rules</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-check-spell">3.5.8. <span class="command"><strong>check-spell</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-check-spell-ec">3.5.9. <span class="command"><strong>check-spell-ec</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-check-tp-kde">3.5.10. <span class="command"><strong>check-tp-kde</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-check-tp-wesnoth">3.5.11. <span class="command"><strong>check-tp-wesnoth</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-collect-pmap">3.5.12. <span class="command"><strong>collect-pmap</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-diff-previous">3.5.13. <span class="command"><strong>diff-previous</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-empty-fuzzies">3.5.14. <span class="command"><strong>empty-fuzzies</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-equip-header-tp-kde">3.5.15. <span class="command"><strong>equip-header-tp-kde</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-fancy-quote">3.5.16. <span class="command"><strong>fancy-quote</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-find-messages">3.5.17. <span class="command"><strong>find-messages</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-generate-xml">3.5.18. <span class="command"><strong>generate-xml</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-merge-corr-tree">3.5.19. <span class="command"><strong>merge-corr-tree</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-normalize-header">3.5.20. <span class="command"><strong>normalize-header</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-normctxt-delim">3.5.21. <span class="command"><strong>normctxt-delim</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-normctxt-sep">3.5.22. <span class="command"><strong>normctxt-sep</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-remove-fuzzy-comments">3.5.23. <span class="command"><strong>remove-fuzzy-comments</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-remove-obsolete">3.5.24. <span class="command"><strong>remove-obsolete</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-remove-previous">3.5.25. <span class="command"><strong>remove-previous</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-resolve-aggregates">3.5.26. <span class="command"><strong>resolve-aggregates</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-resolve-alternatives">3.5.27. <span class="command"><strong>resolve-alternatives</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-resolve-entities">3.5.28. <span class="command"><strong>resolve-entities</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-set-header">3.5.29. <span class="command"><strong>set-header</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-stats">3.5.30. <span class="command"><strong>stats</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-tag-untranslated">3.5.31. <span class="command"><strong>tag-untranslated</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-unfuzzy-context-only">3.5.32. <span class="command"><strong>unfuzzy-context-only</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-unfuzzy-ctxmark-only">3.5.33. <span class="command"><strong>unfuzzy-ctxmark-only</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-unfuzzy-inplace-only">3.5.34. <span class="command"><strong>unfuzzy-inplace-only</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-update-header">3.5.35. <span class="command"><strong>update-header</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-fr:setUbsp">3.5.36. <span class="command"><strong>fr:setUbsp</strong></span></a></span></dt>
<dt><span class="sect2"><a href="#sv-ru:fill-doc-date-kde">3.5.37. <span class="command"><strong>ru:fill-doc-date-kde</strong></span></a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-svexternal">3.6. Using External Sieves</a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="#ch-diffpatch">4. Diffing and Patching</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-dpformat">4.1. The Embedded Diff Format</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-dpfrmembstr">4.1.1. Embedding Differences into Strings</a></span></dt>
<dt><span class="sect2"><a href="#sec-dpfrmincparts">4.1.2. Message Parts Included in Diffing</a></span></dt>
<dt><span class="sect2"><a href="#sec-dpfrmpairing">4.1.3. Pairing Messages From Two PO Files</a></span></dt>
<dt><span class="sect2"><a href="#sec-dpfrmcollect">4.1.4. Collecting Diffed Messages</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-dpdiff">4.2. Producing Ediffs with <span class="command"><strong>poediff</strong></span></a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-dpdiffvcs">4.2.1. Diffing With Underlying VCS</a></span></dt>
<dt><span class="sect2"><a href="#sec-dpdiffopt">4.2.2. Command Line Options</a></span></dt>
<dt><span class="sect2"><a href="#sec-dpdiffcfg">4.2.3. User Configuration</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-dppatch">4.3. Applying Ediffs as Patches with <span class="command"><strong>poepatch</strong></span></a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-dppatchrej">4.3.1. Handling Rejected Ediffs</a></span></dt>
<dt><span class="sect2"><a href="#sec-dppatchemb">4.3.2. Embedding Patches</a></span></dt>
<dt><span class="sect2"><a href="#sec-dppatchopt">4.3.3. Command Line Options</a></span></dt>
<dt><span class="sect2"><a href="#sec-dppatchcfg">4.3.4. User Configuration</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="chapter"><a href="#ch-summit">5. Summitting Translation Branches</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-susetup">5.1. Setting Up The Summit with <span class="command"><strong>posummit</strong></span></a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-sustpdirect">5.1.1. Setting Up Direct Summit</a></span></dt>
<dt><span class="sect2"><a href="#sec-sustpdyntpl">5.1.2. Setting Up Summit over Dynamic Templates</a></span></dt>
<dt><span class="sect2"><a href="#sec-sustpstattpl">5.1.3. Setting Up Summit over Static Templates</a></span></dt>
<dt><span class="sect2"><a href="#sec-sustpptransf">5.1.4. Transforming Branch Paths</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-sumaintain">5.2. Maintaining the Summit</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-sumntbasic">5.2.1. Centralized Summit Maintenance</a></span></dt>
<dt><span class="sect2"><a href="#sec-sumntdistrib">5.2.2. Distributed Summit Maintenance</a></span></dt>
<dt><span class="sect2"><a href="#sec-sumntmism">5.2.3. Handling Mismatches Between Branches and Summit</a></span></dt>
<dt><span class="sect2"><a href="#sec-sumntdeps">5.2.4. Checking Summit Dependencies</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-suconfig">5.3. Elements of Summit Configuration</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-sucfghooks">5.3.1. Summit Hooks</a></span></dt>
<dt><span class="sect2"><a href="#sec-sucfgvcs">5.3.2. Integration with Version Control Systems</a></span></dt>
<dt><span class="sect2"><a href="#sec-sucfgwrap">5.3.3. Text Wrapping in PO Files</a></span></dt>
<dt><span class="sect2"><a href="#sec-sucfgviv">5.3.4. Vivification of Summit PO Files</a></span></dt>
<dt><span class="sect2"><a href="#sec-sucfgbmrg">5.3.5. Merging in Branches</a></span></dt>
<dt><span class="sect2"><a href="#sec-sucfghead">5.3.6. Propagation of Header Parts</a></span></dt>
<dt><span class="sect2"><a href="#sec-sucfgascf">5.3.7. Filtering by Ascription on Scatter</a></span></dt>
<dt><span class="sect2"><a href="#sec-sucfgbranch">5.3.8. Other Branch Options</a></span></dt>
<dt><span class="sect2"><a href="#sec-sucfgbonmrg">5.3.9. Other Merge Options</a></span></dt>
<dt><span class="sect2"><a href="#sec-sucfgbonsct">5.3.10. Other Scatter Options</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-suproblems">5.4. Disadvantages to Summit Workflow and Remedies</a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="#ch-ascript">6. Ascribing Modifications and Reviews</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-ascrevcomp">6.1. Review Stages vs. Ascription</a></span></dt>
<dt><span class="sect1"><a href="#sec-ascsetup">6.2. Setting up Ascription with <span class="command"><strong>poascribe</strong></span></a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-ascinit">6.2.1. Initial Ascription</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-ascdailytr">6.3. Daily Use for Translators</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-asctrnocomm">6.3.1. Translators Without Commit Access</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-ascdailyrev">6.4. Daily Use for Reviewers</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-ascbaserev">6.4.1. Basic Reviewing</a></span></dt>
<dt><span class="sect2"><a href="#sec-ascselrev">6.4.2. Selecting Messages for Review</a></span></dt>
<dt><span class="sect2"><a href="#sec-ascfgrev">6.4.3. Fine-Grained Reviews</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-ascmaint">6.5. General Maintenance Procedures</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-ascmerge">6.5.1. Ascribing Merges</a></span></dt>
<dt><span class="sect2"><a href="#sec-ascshuffle">6.5.2. Shuffling Ascription PO Files</a></span></dt>
<dt><span class="sect2"><a href="#sec-ascfltrel">6.5.3. Filtering for Release</a></span></dt>
<dt><span class="sect2"><a href="#sec-asctrim">6.5.4. Trimming Ascription History</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-ascoptions">6.6. Command Line Options</a></span></dt>
<dt><span class="sect1"><a href="#sec-ascconfig">6.7. User Configuration</a></span></dt>
<dt><span class="sect1"><a href="#sec-ascsels">6.8. Review Selectors</a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="#ch-misctools">7. Miscellaneous Tools</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-mirewrap">7.1. Rewrapping PO Files with <span class="command"><strong>porewrap</strong></span></a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-mirwopts">7.1.1. Command Line Options</a></span></dt>
<dt><span class="sect2"><a href="#sec-mirwcfg">7.1.2. User Configuration</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-miselfmerge">7.2. Self-Merging PO Files with <span class="command"><strong>poselfmerge</strong></span></a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-mismopts">7.2.1. Command Line Options</a></span></dt>
<dt><span class="sect2"><a href="#sec-mismcfg">7.2.2. User Configuration</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-mimtrans">7.3. Machine Translation with <span class="command"><strong>pomtrans</strong></span></a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-mimtopts">7.3.1. Command Line Options</a></span></dt>
<dt><span class="sect2"><a href="#sec-mimtservs">7.3.2. Supported Machine Translation Services</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="chapter"><a href="#ch-lingo">8. Language Validation and Derivation</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-lglangenv">8.1. The Notion of Language in Pology</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#id581444">8.1.1. Supported Languages and Environments</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-lgspell">8.2. Spell Checking</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-lgspdicts">8.2.1. Internal Spelling Dictionaries</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgspskip">8.2.2. Skipping Messages and Words</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-lggrammar">8.3. Grammar Checking</a></span></dt>
<dt><span class="sect1"><a href="#sec-lguirefs">8.4. Automatic Insertion of UI Labels</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-lguiformat">8.4.1. Wrapping UI References</a></span></dt>
<dt><span class="sect2"><a href="#sec-lguinorm">8.4.2. Normalization of UI Text</a></span></dt>
<dt><span class="sect2"><a href="#sec-lguilink">8.4.3. Linking to Originating PO Files</a></span></dt>
<dt><span class="sect2"><a href="#sec-lguinotes">8.4.4. Notes on UI Reference Resolution</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-lgrules">8.5. Validation Rules</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-lgrltour">8.5.1. Guided Tour of the Rule System</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgrlfiles">8.5.2. Layout of Rule Files</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgrltrigpat">8.5.3. Rule Triggers</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgrlsubdirs">8.5.4. Rule Subdirectives</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgrlglobdirs">8.5.5. Global Directives in Rule Files</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgrlenvs">8.5.6. Effect of Rule Environments</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgrlfilter">8.5.7. Filtering Messages</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgrlquotesc">8.5.8. Quoting and Escaping</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgrlfalse">8.5.9. Canceling False Positives</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-lgsynder">8.6. Syntagma Derivation</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-lgsdbasic">8.6.1. Basic Derivations</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgsdmulexp">8.6.2. Multiple Expansions</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgsdexpmask">8.6.3. Expansion Masks</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgsdspecprop">8.6.4. Special Properties</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgsdtags">8.6.5. Text Tags</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgsdalts">8.6.6. Alternative Derivations</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgsdwspace">8.6.7. Treatment of Whitespace</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgsdorg">8.6.8. Uniqueness, Ordering, and Inclusions</a></span></dt>
<dt><span class="sect2"><a href="#sec-lgsderrors">8.6.9. Error Handling</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="chapter"><a href="#ch-common">9. Common Functionality</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-cmshellcomp">9.1. Shell Completion</a></span></dt>
<dt><span class="sect1"><a href="#sec-cmconfig">9.2. User Configuration</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-cmcfguser">9.2.1. The <code class="literal">[user]</code> section</a></span></dt>
<dt><span class="sect2"><a href="#sec-cmcfgenchant">9.2.2. The <code class="literal">[enchant]</code> section</a></span></dt>
<dt><span class="sect2"><a href="#sec-cmcfgaspell">9.2.3. The <code class="literal">[aspell]</code> section</a></span></dt>
<dt><span class="sect2"><a href="#sec-cmcfgproj">9.2.4. Per-project sections (<code class="literal">[project-*]</code>)</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-cmregex">9.3. Regular Expressions</a></span></dt>
<dt><span class="sect1"><a href="#sec-cmincexc">9.4. Path Inclusion and Exclusion</a></span></dt>
<dt><span class="sect1"><a href="#sec-cmffrom">9.5. Reading Paths From a File</a></span></dt>
<dt><span class="sect1"><a href="#sec-cmcolors">9.6. Output Coloring</a></span></dt>
<dt><span class="sect1"><a href="#sec-cminttools">9.7. Integration with Other Tools</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-cmsupped">9.7.1. PO Editors</a></span></dt>
<dt><span class="sect2"><a href="#sec-cmsuppvcs">9.7.2. Version Control Systems</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-cmwrap">9.8. Line Wrapping in PO Messages</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-cmwropts">9.8.1. Common Command Line Options for Wrapping</a></span></dt>
<dt><span class="sect2"><a href="#sec-cmwrcfg">9.8.2. Common User Configuration Fields for Wrapping</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-cmheader">9.9. Influential Header Fields</a></span></dt>
<dt><span class="sect1"><a href="#sec-cmhooks">9.10. Processing Hooks</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-cmhooktypes">9.10.1. Hook Types</a></span></dt>
<dt><span class="sect2"><a href="#sec-cminthooks">9.10.2. List of Internal Hooks</a></span></dt>
<dt><span class="sect2"><a href="#sec-cmexthooks">9.10.3. Using External Hooks</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-cmskipcheck">9.11. Skipping and Selecting Checks</a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="#ch-combined">10. Combined Arms Tactics</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-cbcompend">10.1. Creating and Using PO Compendia</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-cbcomptm">10.1.1. Why Translation Memory?</a></span></dt>
<dt><span class="sect2"><a href="#sec-cmcompcr">10.1.2. Maintaining a Centralized PO Compendium</a></span></dt>
<dt><span class="sect2"><a href="#sec-cmcompuse">10.1.3. Applying the PO Compendium</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-cbeffedit">10.2. Efficiently Translating with a Text Editor</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-cbeffedfeat">10.2.1. Expected Features of the Text Editor</a></span></dt>
<dt><span class="sect2"><a href="#sec-cbeffstats">10.2.2. Statistics on PO Files</a></span></dt>
<dt><span class="sect2"><a href="#sec-cbeffupdate">10.2.3. Updating PO Files After Merging</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-cbsumasc">10.3. Summit with Ascription</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-cbsamultsum">10.3.1. Several Summits with Unified Ascription</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="chapter"><a href="#ch-prog">11. Programming with Pology</a></span></dt>
<dd>
<dl>
<dt><span class="sect1"><a href="#sec-prfile">11.1. PO File Abstraction</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-prmsg">11.1.1. Message</a></span></dt>
<dt><span class="sect2"><a href="#sec-prcat">11.1.2. Catalog</a></span></dt>
<dt><span class="sect2"><a href="#sec-prhead">11.1.3. Header</a></span></dt>
</dl>
</dd>
<dt><span class="sect1"><a href="#sec-prmonitor">11.2. Monitored Objects</a></span></dt>
<dt><span class="sect1"><a href="#sec-prsieves">11.3. Writing Sieves</a></span></dt>
<dt><span class="sect1"><a href="#sec-prhooks">11.4. Writing Hooks</a></span></dt>
<dt><span class="sect1"><a href="#sec-prascsel">11.5. Writing Ascription Selectors</a></span></dt>
<dt><span class="sect1"><a href="#sec-prcstyle">11.6. Coding Style</a></span></dt>
<dd>
<dl>
<dt><span class="sect2"><a href="#sec-prcsi18n">11.6.1. User-Visible Text and Internationalization</a></span></dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-about" id="ch-about"></a>Chapter&nbsp;1.&nbsp;A Study of PO</h2>
</div>
</div>
</div>
<p>Many people like to use computer programs in their native language. On the average, the working language of developers of a computer program, and the native language of its users, are different. This means that programs need to be <span class="emphasis"><em>translated</em></span>. For this to be possible, first the program has to be written in such a way that it can fetch and display translations in the language set by the user. Then, there has to exist a method to collect discrete pieces of text (such as button labels, menu items, messages in dialogs...) from the program. Collected pieces of text are written into one or more files of a certain format, which the translators can work on. Finally, translated files may need to be converted into a form that the program can interpret and show translation to the user. There are many different translation systems, which support one or more of these elements of translation process.</p>
<p>In the realm of free software, one particular translation system has become ubiquitous: the <a class="ulink" href="http://www.gnu.org/software/gettext/" target="_top">GNU Gettext</a>. It covers all the elements of the translation process. It provides a way for programmers to write translatable programs, a way for text to be extracted and collected for translation, a file format on which the translators work, and a set of tools for processing translation files. Beyond the technical aspects, Gettext has evolved a set of conventions, workflows and communication patterns -- a translation <span class="emphasis"><em>culture</em></span> of sorts.</p>
<p>The most salient element of Gettext from translators' perspective is the translation file format it defines, the PO<sup>[<a name="id585665" href="#ftn.id585665" class="footnote" id="id585665">1</a>]</sup> format. Along with other parts of Gettext, the PO format has developed over the years into the technically most capable translation file format today. Its features both enable high quality and efficiency of translation, and yet can all "fit into one person's head". <a class="link" href="#ch-poformat" title="Chapter&nbsp;2.&nbsp;The PO Format">A chapter of this manual</a> provides a tour of the PO format from translator's perspective.</p>
<p>Aside from the tools provided by GNU Gettext itself, many other tools for processing PO files have been written. These consist of translation editors (or "PO editors"), which provide translators with more power in editing PO files, and batch-processing tools, for purposes more specific than those covered by Gettext (e.g. conversion from and to other file formats). <span class="emphasis"><em>Pology</em></span> is one of these specific batch-processing tools.</p>
<p>Pology consists of a <a class="ulink" href="http://www.python.org/" target="_top">Python</a> library, with much translation-related functionality beyond basic manipulation of PO file objects, and a collection of scripts based on this library. Both the library and the scripts have this basic trait: they tend to go in depth. Pology is designed to apply precision tasks to standalone PO files, to process collections of PO files in sophisticated ways, and while doing this to cooperate well with other tools commonly used to handle PO files (such as PO editors and version control systems). On the programming side Pology strives for simplicity and robustness, so that users who know (some) Python can easily add functionality for their custom needs. To achieve this, Pology fully relies on the conventions of the PO format, without trying to abstract the translation file format.</p>
<p>As one measure of attention to detail, Pology has sections of language-specific and project-specific functionality, and even combinations of those. Users are encouraged to contribute their custom solutions into the main distribution, if these solutions can possibly serve needs of others.</p>
<p>In short, Pology is <span class="emphasis"><em>a study of PO</em></span>.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-install" id="sec-install"></a>1.1.&nbsp;Obtaining and Installing</h2>
</div>
</div>
</div>
<p>Pology is still not a released piece of software, so most likely it cannot be found in operating system's software repositories. Nevertheless, it can be obtained in prepared for use quite simply. To fetch the latest development version of Pology from its version control repository, execute<sup>[<a name="id537338" href="#ftn.id537338" class="footnote" id="id537338">2</a>]</sup>:</p>
<pre class="programlisting">
$ cd <em class="replaceable"><code>PARDIR</code></em>
$ svn checkout svn://anonsvn.kde.org/home/kde/trunk/l10n-support/pology
</pre>
<p>This will create the <code class="filename">pology/</code> subdirectory inside the parent directory <em class="replaceable"><code>PARDIR</code></em>, and download full source of Pology in it. When you want to update to the latest version later on, you do not have to download everything again. Instead you can execute <strong class="userinput"><code>svn update</code></strong> in Pology's root directory:</p>
<pre class="programlisting">
$ cd <em class="replaceable"><code>PARDIR</code></em>/pology
$ svn update
</pre>
<p>and only the modifications since the checkout (or the last update) will be downloaded and applied to the existing source tree.</p>
<p>To prepare Pology for use, it is sufficient to set two environment variables, e.g. in the Bash shell:</p>
<pre class="programlisting">
$ export PATH=<em class="replaceable"><code>PARDIR</code></em>/pology/bin:$PATH
$ export PYTHONPATH=<em class="replaceable"><code>PARDIR</code></em>/pology:$PYTHONPATH
</pre>
<p>You can put these commands in the shell startup script (<code class="filename">~/.bashrc</code> for Bash shell), so that paths are already set whenever you start a shell. Setting <code class="envar">PATH</code> will ready Pology's script for execution, and <code class="envar">PYTHONPATH</code> its Python library for use in custom Python scripts. It is also possible that there are some scripts in Pology which are specific to the language into which you translte. To make these ready for use as well, additionally add to path:</p>
<pre class="programlisting">
$ export PATH=<em class="replaceable"><code>PARDIR</code></em>/pology/lang/<em class="replaceable"><code>LANG</code></em>/bin:$PATH
</pre>
<p>where <em class="replaceable"><code>LANG</code></em> is the language code of your language.</p>
<p>Pology provides <a class="link" href="#sec-cmshellcomp" title="9.1.&nbsp;Shell Completion"><span class="emphasis"><em>shell completion</em></span></a> for some of the included scripts, which you can activate by sourcing the corresponding completion definition file. For example, for Bash:</p>
<pre class="programlisting">
$ . <em class="replaceable"><code>PARDIR</code></em>/pology/completion/bash/pology
</pre></div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-deps" id="sec-deps"></a>1.2.&nbsp;Dependencies</h2>
</div>
</div>
</div>
<p>The following lists the dependencies of Pology, and notes whether they are required or optional, and what they are used for.</p>
<p>Required external Python packages:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>None.</p>
</li>
</ul>
</div>
<p>Required general software:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><a class="ulink" href="http://www.gnu.org/software/gettext/" target="_top">Gettext</a> &gt;= 0.17. Some Pology scripts use Gettext tools internally, and the library module <a class="ulink" href="../../api/html/pology.gtxtools-module.html" target="_top"><code class="literal">pology.gtxtools</code></a> wraps some of Gettext tools for use inside Python scripts.</p>
</li>
<li class="listitem">
<p><a class="ulink" href="http://www.python.org/" target="_top">Python</a> &gt;= 2.5.</p>
</li>
</ul>
</div>
<p>Optional external Python packages:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><a class="ulink" href="http://freedesktop.org/wiki/Software/DBusBindings" target="_top"><span class="package">python-dbus</span></a> &gt;= 0.81. Used for communication with various external applications (e.g. with the <a class="ulink" href="http://userbase.kde.org/Lokalize" target="_top">Lokalize</a> PO editor).</p>
</li>
<li class="listitem">
<p><a class="ulink" href="http://www.rfk.id.au/software/pyenchant/" target="_top"><span class="package">python-enchant</span></a> &gt;= 1.5.2. Frontend to various spell-checkers, used by most of Pology's spell checking functionality.</p>
</li>
</ul>
</div>
<p>Optional general software:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><a class="ulink" href="http://www.apertium.org/" target="_top">Apertium</a> &gt;= 0.2. A free/open-source machine translation platform, used by <a class="link" href="#sec-mimtrans" title="7.3.&nbsp;Machine Translation with pomtrans">the <span class="command"><strong>pomtrans</strong></span> script</a>.</p>
</li>
<li class="listitem">
<p><a class="ulink" href="http://www.languagetool.org/" target="_top">LanguageTool</a> &gt;= 1.0. Open source language checker, used by the <a class="link" href="#sv-check-grammar" title="3.5.5.&nbsp;check-grammar"><span class="command"><strong>check-grammar</strong></span></a> sieve.</p>
</li>
<li class="listitem">
<p>Version control systems. Used by various Pology scripts that process PO files on the collection level, when the PO files are under version control. Currently supported: <a class="ulink" href="http://git-scm.com/" target="_top">Git</a> &gt;= 1.6, <a class="ulink" href="http://subversion.tigris.org/" target="_top">Subversion</a> &gt;= 1.4.</p>
</li>
</ul>
</div>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id585665" href="#id585665" class="para" id="ftn.id585665">1</a>]</sup> "PO" is an acronym for "portable object". This phrase is a quite generic term from the depths of computer science, opaque for practicing translators. Texts on software translation therefore always write simply "PO format", "PO files", etc.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id537338" href="#id537338" class="para" id="ftn.id537338">2</a>]</sup> <span class="command"><strong>svn</strong></span> is the primary command of <a class="ulink" href="http://subversion.tigris.org/" target="_top">Subversion</a> version control system. Subversion is almost certainly ready for installation from your operating system's package repositories.</p>
</div>
</div>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-poformat" id="ch-poformat"></a>Chapter&nbsp;2.&nbsp;The PO Format</h2>
</div>
</div>
</div>
<p>There is no formal specification of the PO format; instead, the related parts of <a class="ulink" href="http://www.gnu.org/software/gettext/manual/html_node/index.html" target="_top">the Gettext manual</a> serve as its working definition. Although the PO format has been documented both by the Gettext manual and elsewhere, in smaller and greater detail, it will be presented here as well. This is in order to thoroughly explain how the format elements influence the translation practice, and to make sure that the terms used in the rest of this manual are understood in their precise meaning.</p>
<p>Before going into the format description, it is useful to give an overview of usage contexts for the PO format and of the basic principles behind it.</p>
<p><a name="p-dynstattr" id="p-dynstattr"></a>There are three distinct contexts in which PO files are used:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><span class="emphasis"><em>Native dynamic translations</em></span>. Many programs use the PO format as the native format for their user interface text. These include the KDE and Gnome desktop environments, GNU tools, etc. Translated PO files are compiled into binary MO files (which is done by the <span class="command"><strong>msgfmt</strong></span> command from Gettext) and installed in a proper location. Then the program fetches translations from them at runtime, which is what makes this "dynamic" translation.</p>
</li>
<li class="listitem">
<p><span class="emphasis"><em>Intermediate dynamic translations</em></span>. Some software keeps user interface text in their own custom format. This is the case, for example, with Mozilla and OpenOffice programs. Such custom format files are first converted into PO files, translated, and then converted back into the original format, for runtime consumption by these programs.</p>
</li>
<li class="listitem">
<p><a name="p-intsttr" id="p-intsttr"></a><span class="emphasis"><em>Intermediate static translations</em></span>. Static text data, such as software documentation, is converted from its source format into the PO format, translated, and then converted back into the original format. An example of such documentation format would be the <a class="ulink" href="http://www.docbook.org/" target="_top">Docbook</a>. Out of translated files in the original format, the final documents for user consumption are created, such as PDF files or HTML pages.</p>
</li>
</ul>
</div>
<p>This variety of usage should be kept in mind, as while the PO format is one, the text exposed for translation in PO files will have embedded elements which are tightly related to the source of what is translated. For example, user interface text will frequently contain <span class="emphasis"><em>format directives</em></span>, while documentation text may be written with HTML-like markup. This means that the translator should be aware, in general, of what kind of source is being translated through a particular PO file.</p>
<p>The development of the PO format has been driven solely by the needs of its users, as with time these needs became well formulated and generalizable. Thanks to this, features of the PO format other than the very basic can be gradually introduced as necessary, and stay out of the way when they are not. The format is quite compact, human-readable and editable without special-purpose tools (though, of course, these come in handy). These aspects benefit the learning curve, everyday usage, and instructional texts such as this one.</p>
<p>Although translators will frequently prefer to work on PO files using dedicated PO editors, which purport to hide "technical details" such as the underlying file format, they should nevertheless understand the PO format well. This is because the PO format is more than a simple container of the text to be translated, instead it reflects important concepts in the translation workflow. To put it more concretely, the translator should determine out how a given dedicated PO editor exposes the bits of information from the PO file in its interface, and whether it trully exposes all of them.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-pobasic" id="sec-pobasic"></a>2.1.&nbsp;Basic Syntax</h2>
</div>
</div>
</div>
<p>The PO format is a plain text format, written in files with <code class="filename">.po</code> extension. A PO file contains a number of <span class="emphasis"><em>messages</em></span>, partly independent text segments to be translated, which have been grouped into one file according to some logical division of what is being translated. For example, a standalone program will frequently have all its user interface messages in one PO file, and all documentation messages in another; or, user interface may be split into several PO files by major program modules, documentation split by chapters, etc. PO files are also called <span class="emphasis"><em>message catalogs</em></span>.</p>
<p>Here is an excerpt from the middle of a PO file, showing three simple messages, which are untranslated:</p>
<pre class="programlisting">
#: finddialog.cpp:38
msgid "Globular Clusters"
msgstr ""
⁠
#: finddialog.cpp:39
msgid "Gaseous Nebulae"
msgstr ""
⁠
#: finddialog.cpp:40
msgid "Planetary Nebulae"
msgstr ""
</pre>
<p>Each message contains the keyword <code class="varname">msgid</code>, which is followed by the original string (usually in English for software), wrapped in double quotes. The keyword <code class="varname">msgstr</code> denotes the string which to become the translation, also double-quoted. After you go through the PO file and add translations, these messages would read:</p>
<pre class="programlisting">
#: finddialog.cpp:38
msgid "Globular Clusters"
msgstr "Globularna jata"
⁠
#: finddialog.cpp:39
msgid "Gaseous Nebulae"
msgstr "Gasne magline"
⁠
#: finddialog.cpp:40
msgid "Planetary Nebulae"
msgstr "Planetarne magline"
</pre>
<p>Based on this example, translating a PO file looks rather simple, and for the most part it is. There exists, however, a number of details which you have to take into account from time to time, in order to produce translation of high quality. The rest of this chapter deals with such details.</p>
<p>As is usual with text formats, immediately something must be said about the <span class="emphasis"><em>text encoding</em></span> of a PO file. While you could use encodings other than UTF-8 if no non-ASCII letters are used in the original text, you really <span class="emphasis"><em>should</em></span> use UTF-8. The encoding is specified within the PO file itself, and by default it is UTF-8; if you want to use another encoding, you must specify it in the <a class="link" href="#sec-poheader" title="2.6.&nbsp;PO Header">PO header</a> (described later).</p>
<p>Leaving some messages in the PO file untranslated is technically not a problem. For every untranslated message, programs will typically show the original text to the user, so that not all information is lost. Format converters (such as used in <a class="link" href="#p-intsttr">intermediate static</a> translations) may do the same, or decline to create the target file unless the PO file is translated fully or over a prescribed threshold. Of course, you should strive to have the PO files under your maintenance completely translated, in order for the users not to be faced with mixed original and translated text.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-posrcref" id="sec-posrcref"></a>2.1.1.&nbsp;Source References</h3>
</div>
</div>
</div>
<p>Each message in the previous example also contains the <span class="emphasis"><em>source reference comment</em></span>, which is the line starting with <code class="literal">#:</code> above the <code class="literal">msgid "..."</code> line. It tells from which source file of the program code (or source document of any kind), and the line in that source file, the message has been extracted into the PO file. This piece of data may look strange at first--of what use is it to translators, to merit inclusion in the PO file? Since the PO format has been developed in context of free software, the source reference enables you to actually look up the message in the source file, when you need <span class="emphasis"><em>more context</em></span> to translate a certain message. This does not require of you to be a programmer, as source code is frequently readable enough to infer the message context without actually understanding the code.</p>
<p>For example, in the translation the text in title position may need to have a certain grammatical or ortographical form, and it may not be apparent from the PO file alone if the message:</p>
<pre class="programlisting">
#: addcatdialog.cpp:45
msgid "Import Catalog"
msgstr ""
</pre>
<p>is used in title position. By following the source reference, you find this statement in the source file <code class="filename">addcatdialog.cpp</code>, line 45:</p>
<pre class="programlisting">
setCaption( i18n( "Import Catalog" ) );
</pre>
<p>The <code class="literal">setCaption(...)</code> bit makes it highly likely that the message is indeed being used in a title position. Some dedicated PO editors provide ways to quickly and comfortably look up source references, just by pressing a keyboard shortcut, which makes this approach to context determination that much easier.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-powrap" id="sec-powrap"></a>2.1.2.&nbsp;String Wrapping</h3>
</div>
</div>
</div>
<p>When a message is long or contains some logical line-breaks, its original and translation strings may be <span class="emphasis"><em>wrapped</em></span> in the PO file (with wrapping boundary usually at column 80), such as this:</p>
<pre class="programlisting">
#: indimenu.cpp:96
msgid ""
"No INDI devices currently running. To run devices, please select devices "
"from the Device Manager in the devices menu."
msgstr ""
</pre>
<p>This wrapping is entirely invisible to the consumer of the PO file. PO processing tools introduce wrapping mostly as a convenience to translators who like to work on PO files with plain text editors. This means that you are free to wrap the translation (the <code class="varname">msgstr</code> string) in the same way, differently, or not to wrap it at all. You should only not forget to enclose each wrapped line in double quotes, same as it is done for <code class="varname">msgid</code>. For example, this translation of the previous message:</p>
<pre class="programlisting">
#: indimenu.cpp:96
msgid ""
"No INDI devices (...)"
"(...) in the devices menu."
msgstr ""
"Nema INDI uređaja (...)"
"(...) u meniju uređaja."
</pre>
<p>is equivalent to this one:</p>
<pre class="programlisting">
#: indimenu.cpp:96
msgid ""
"No INDI devices (...)"
"(...) in the devices menu."
msgstr "Nema INDI uređaja (...) u meniju uređaja."
</pre>
<p>Dedicated PO editors may even not show wrapping to the translator, or wrap lines on their own independently of the underlying PO file. Curiosly enough, most PO editors seem to follow the original wrapping, at least by default. At any rate, if you would like to have all strings non-wrapped (including <code class="varname">msgid</code>) or vice versa, there are command line tools to achieve this.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-pomsguniq" id="sec-pomsguniq"></a>2.1.3.&nbsp;Uniqueness of Messages</h3>
</div>
</div>
</div>
<p>A message in the PO file is <span class="emphasis"><em>uniquely identified</em></span> by its <code class="varname">msgid</code> string (this is not entirely true, as will be explained shortly, but consider it approximately true for the moment). This means that, as the source which is translated evolves in time, a message may change some of its elements or the position within the PO file, but as long as it has the same <code class="varname">msgid</code> string, it is the same message. Those other, non-identifying elements include the translation (<code class="varname">msgstr</code> string), source reference comments, etc. Position means either the line number in the PO file, or relative position to other messages.</p>
<p>The first consequence of this fact is that the only reliable way to report a message to someone is to state its <code class="varname">msgid</code> string, in full or in sufficient part, even if the other person has access to the PO file where the message is found.<sup>[<a name="id529664" href="#ftn.id529664" class="footnote" id="id529664">3</a>]</sup> Newcomer translators are sometimes not briefed about this, and then they at first report the line number of the message, or its ordinal number in the range of all messages, without giving the <code class="varname">msgid</code>. Line numbers cannot work because, for example, of the arbitrary line wrapping as described previously. Ordinal numbers do not work because your PO file may be slightly older or newer than that of the other person, and the ordinals may have changed in the meantime.</p>
<p>The second consequence is that there cannot be two messages with the same <code class="varname">msgid</code> in the same PO file (again not exactly true, see later). If the same text has been used two or more times in the source, then in the PO file it will appear as a single message, with its source reference comment (<code class="literal">#:</code>) listing all appearances. For example, the source reference of this message:</p>
<pre class="programlisting">
#: colorscheme.cpp:79 skycomponents/equator.cpp:31
msgid "Equator"
msgstr ""
</pre>
<p>shows that it is used at two places in the program source code. This feature of the PO format prevents needless duplication of work, by assuring that any duplicate text in the source is translated only once. This efficiency optimization can sometimes be a double-edged sword, but with an elegant solution for the problem that can arise, as you will see shortly.</p>
<p>The third, so to say, consequence, though more of a remark for clarity, is this: you should never modify the <code class="varname">msgid</code> string. Not only that doing so would have no purpose, but if the <code class="varname">msgid</code> is modified, the consumer of the translated PO file will not see the message as translated, since it will fetch messages by matching their <code class="varname">msgid</code> strings.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-pocontext" id="sec-pocontext"></a>2.2.&nbsp;Message Context</h2>
</div>
</div>
</div>
<p>Depending on the language of translation, sometimes it may be hard to translate a message properly by considering it in isolation, without any additional context. Naive translation may break style guidelines, or worse, misinterpret the meaning of the original text. To avoid this, there are several ways in which you can infer the context in which the message is used.</p>
<p>One way you have seen already: looking into the source file of the message, as pointed to by the source reference comment. But, this way can be tedious. Not only because the source code may look menacing to a translator, but also, while readily available for free software, it is usually not very comfortable to keep all that source code around just for the sake of context checking. This is a well understood difficulty, so additional context indicators have been devised.</p>
<p>One simple way to keep track of the context is to, when translating a given message, keep in sight several messages that precede and follow it. As a trivial example, the following four messages:</p>
<pre class="programlisting">
#: locationdialog.cpp:228
msgid "Really override original data for this city?"
msgstr ""
⁠
#: locationdialog.cpp:229
msgid "Override Existing Data?"
msgstr ""
⁠
#: locationdialog.cpp:229
msgid "Override Data"
msgstr ""
⁠
#: locationdialog.cpp:229
msgid "Do Not Override"
msgstr ""
</pre>
<p>are rather obviously a question in some kind of a message dialog, the title of that dialog, and the two answer buttons, so that you know exactly how the messages are related. Aside from the pure meaning, conclusions such as this may be further supported by the style conventions of original text (for English, title word case for dialog titles, but also for push buttons), and the source reference comments (here they reveal that all four messages are in two adjacent lines of the same source file). With time you will start to pick up patterns of this kind which are typical for the source which you translate, and be more confident in your estimates.</p>
<p>Up to this point, all the context gathering rested on the shoulders of the translator. However, when authors of the original text, for example programmers, are themselves sufficiently aware of the translation issues, they can explicitly provide some context for translators. This is particularly warranted when a message is quite strange, when it puts technical limitations on the translation, when it is used in an unexpected way, and so on.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-poautocmnt" id="sec-poautocmnt"></a>2.2.1.&nbsp;Extracted Comments</h3>
</div>
</div>
</div>
<p>One place where explicit context provided by the authors can be found in a message, is within <span class="emphasis"><em>extracted comments</em></span>, which start with <code class="literal">#.</code>. For example, the message:</p>
<pre class="programlisting">
#. TRANSLATORS: A test phrase with all letters of the English alphabet.
#. Replace it with a sample text in your language, such that it is
#. representative of language's writing system.
#: kdeui/fonts/kfontchooser.cpp:382
msgid "The Quick Brown Fox Jumps Over The Lazy Dog"
msgstr ""
</pre>
<p>has an extracted comment which tells you to avoid translating the English phrase for what it is, but to instead construct a phrase with the described property in your language.</p>
<p>This kind of context usually begins with an agreed-upon keyword, which in the above case is <code class="literal">TRANSLATORS:</code>, which is recommended by Gettext, but in principle depends on the source environment. It could be, for example, <code class="literal">i18n:</code> (short for "internationalization").</p>
<p>Extracted comments can sometimes be added not by a human author, but by a tool used to create or process PO files. For example, when markup-text documents are translated, such as HTML, or Docbook for documentation, the extracted comment frequently states the tag which wraps the text in the original document:</p>
<pre class="programlisting">
#. Tag: title
#: skycoords.docbook:73
msgid "The Horizontal Coordinate System"
msgstr ""
</pre>
<p>In this example, the <code class="literal">#. Tag: title</code> comment informs you that the message is a title, so that you can adjust the translation accordingly.</p>
<p>Another frequent example where processing tools provide extracted comments is when the PO file is created in a slightly roundabout way, such that source references do not really point to the source file, but to a temporary source file which existed only during the creation of the PO file. To make this less misleading, the extracted comment may state the true source:</p>
<pre class="programlisting">
#. i18n: file: tools/observinglist.ui:263
#. i18n: ectx: property (toolTip), widget (KPushButton, ScopeButton)
#: rc.cpp:5865
msgid "Point telescope at highlighted object"
msgstr ""
</pre>
<p>Here <code class="literal">rc.cpp:5865</code> is the reference to the temporary source file, whereas the true source file is given as <code class="literal">file: tools/observinglist.ui:263</code>. (The other automatically extracted comment, <code class="literal">ectx: ...</code>, may look a bit cryptic, but you can still easily conclude from it that this message is a tooltip for a push button.)</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-podisamb" id="sec-podisamb"></a>2.2.2.&nbsp;Disambiguating Contexts</h3>
</div>
</div>
</div>
<p>Consider the following two messages from an program user interface:</p>
<pre class="programlisting">
#. TRANSLATORS: First letter in 'Scope'
#: tools/observinglist.cpp:700
msgid "S"
msgstr ""
⁠
#. TRANSLATORS: South
#: skycomponents/horizoncomponent.cpp:429
msgid "S"
msgstr ""
</pre>
<p>At first sight, you could think that it was nice of the programmer to add the explicit context (<code class="literal">#. TRANSLATORS: ...</code> lines), informing that the "S" of the first message is short for "Scope", and the "S" of the second message short for "South", so that translators know that they should use the letters corresponding to these words in their languages. But, can you spot the problem?</p>
<p>The problem is that these messages cannot be part of a valid PO file, since, as it was <a class="link" href="#sec-pomsguniq" title="2.1.3.&nbsp;Uniqueness of Messages">mentioned earlier</a>, all messages must have unique <code class="varname">msgid</code> strings. Instead, in a real PO file, these two messages would be collapsed into one:</p>
<pre class="programlisting">
#. TRANSLATORS: First letter in 'Scope'
#. TRANSLATORS: South
#: tools/observinglist.cpp:700 skycomponents/horizoncomponent.cpp:429
msgid "S"
msgstr ""
</pre>
<p>Both contexts are still present, translators are still well informed, but it is now required that the words "Scope" and "South" also begin with the same letter in the target language--an extremely unlikely proposal.</p>
<p>In situations such as this, the programmer can equip messages with a different type of context, the <span class="emphasis"><em>disambiguating context</em></span>. These contexts are no longer presented as extracted comments, but through another keyword string, the <code class="varname">msgctxt</code>:</p>
<pre class="programlisting">
#: tools/observinglist.cpp:700
msgctxt "First letter in 'Scope'"
msgid "S"
msgstr ""
⁠
#: skycomponents/horizoncomponent.cpp:429
msgctxt "South"
msgid "S"
msgstr ""
</pre>
<p>This is now a valid PO file, and you can translate each "S" on its own.</p>
<p>This updates the earlier approximation that messages must be unique by <code class="varname">msgid</code> strings to the real requirement: messages must be unique by the combination of <code class="varname">msgctxt</code> and <code class="varname">msgid</code> strings. If the <code class="varname">msgctxt</code> string is missing, as it usually is, you can think of it as being present but null-valued.<sup>[<a name="id585926" href="#ftn.id585926" class="footnote" id="id585926">4</a>]</sup></p>
<p>A rather frequent example of need for disambiguating contexts is when the original text is a single adjective in English, and used at several places in the source:</p>
<pre class="programlisting">
#: utils/kateautoindent.cpp:78 utils/katestyletreewidget.cpp:132
msgid "Normal"
msgstr ""
</pre>
<p>In many languages the adjective form must match the gender of the noun to which it refers, so if the "Normal" above refers both to indentation mode and text style, it is almost certainly necessary to provide disambiguating contexts:</p>
<pre class="programlisting">
#: utils/katestyletreewidget.cpp:132
msgctxt "Text style"
msgid "Normal"
msgstr "običan"
⁠
#: utils/kateautoindent.cpp:78
msgctxt "Autoindent mode"
msgid "Normal"
msgstr "obično"
</pre>
<p>You can imagine that programmers in general cannot know when a certain phrase, same in English when used in two contexts, needs different translations in some other language. This means that you, the translator, should inform them to add a disambiguating context when you determine that you need one.<sup>[<a name="id585972" href="#ftn.id585972" class="footnote" id="id585972">5</a>]</sup></p>
<p><a name="p-embctxt" id="p-embctxt"></a>At the moment of this writing, the <code class="varname">msgctxt</code> string is one of the younger additions to the PO format. But the need for disambiguating contexts was observed much earlier, and different translation environments have historically used different custom solutions to provide them. Such older PO files can still be encountered, so it is useful to present a few examples of custom disambiguating contexts. Before the <code class="varname">msgctxt</code> was introduced, messages indeed had to be unique by <code class="varname">msgid</code> alone, so disambiguating context had to be a part of the <code class="varname">msgid</code>, embedded with some special syntax. Here is how the first message from the previous example would look like in a PO file comming from a KDE program of circa 2006:</p>
<pre class="programlisting">
#: utils/katestyletreewidget.cpp:132
msgid ""
"_⁠: Text style\n"
"Normal"
msgstr "običan"
</pre>
<p>The disambiguating context has been embedded at the beginning of the <code class="varname">msgid</code>, surrounded by <code class="literal">_⁠: ...\n</code>. In a contemporary Gnome program, the same message would look something like this:</p>
<pre class="programlisting">
#: utils/gatestyletreewidget.c:132
msgid "Text style|Normal"
msgstr "običan"
</pre>
<p>Here the context is again at the beginning of <code class="varname">msgid</code>, but it is separated from the text only by the pipe character (<code class="literal">|</code>).</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-pomancmnt" id="sec-pomancmnt"></a>2.2.3.&nbsp;Translator Comments</h3>
</div>
</div>
</div>
<p>Sometimes you will need to translate a message without explicit context in a non-obvious way, after you have determined that such translation is needed by looking into the source or seeing the message in user interface at runtime. This may present a difficulty when the message is revisited, for example, by a proof-reader in the review process, or by another translator if the message got modified later on. This other person may conclude that the translation is wrong and "fix" it, or at the very least waste time by asking around why it was translated in that way.</p>
<p>Conversely, sometimes you may be unsure if your translation is exactly correct, for example if you have correctly guessed the context, or whether you have used correct terminology. In that case you can, of course, consult with fellow translators, but this would break you out of the "flow" state while working. It is better if such communication is delayed to the moment when the translation of the PO file is otherwise complete.</p>
<p>For these situations, you can write down your own inferred context, doubts or notes, in another type of comment, the <span class="emphasis"><em>translator comment</em></span>. These comments start simply with <code class="literal">#</code> (hash and space), followed by any text whatsoever. As with other comments, there may be any number of them. A hypothetical example:</p>
<pre class="programlisting">
# Wikipedia says that ‘etrurski’ is our name for this script.
#: viewpart/UnicodeBlocks.h:151
msgid "Old Italic"
msgstr "etrurski"
</pre>
<p>In reality, a translator comment such as the one above would probably be written in the language of translation, as there is no reason for it to be in English. This is not to say that translator comments should never be in English, there may be situations when that could be advantageous.</p>
<p>It is particularly important to know that translator comments are the <span class="emphasis"><em>only</em></span> type of comment that all well-behaved PO processing tools are guaranteed to preserve in the same way as translation. For example, if you would write something into an extracted comment (<code class="literal">#.</code>), it would very soon dissapear in one of the standard maintenance procedures. So make sure you add any personal remarks into translator comments, and nowhere else.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-poconssub" id="sec-poconssub"></a>2.3.&nbsp;Constructive Substrings</h2>
</div>
</div>
</div>
<p>Message text sometimes contains substrings which are not visible to the user of the program or to the reader of the manual, but are used by the program or the rendering engine to construct the final visible text. Translators should reproduce such substrings in the translation as well, most of the time exactly as they are in the original, but sometimes also with some modifications.</p>
<p>For better or worse, constructive substrings tend to be tightly linked to the source environment of the text, for example the particular programming language in which the program is written, or the particular markup language for static content like documentation. To produce high quality translations, you will benefit from having basic understanding of the constructive substrings possible in the source environment, of their function and behavior. The prerequisite to this, as mentioned in the opening of this chapter, is that you are aware of what is the source of the text in the PO file.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-poformdir" id="sec-poformdir"></a>2.3.1.&nbsp;Format Directives</h3>
</div>
</div>
</div>
<p>When a file manager shows a message like "Really delete file tmp10.txt?" or "Open with Froobaz", the "tmp10.txt" and "Froobaz" parts had to be added to the rest of the text at runtime. In such cases, the original text as seen by the translator will contain <span class="emphasis"><em>format directives</em></span>, substrings which the program will replace with dynamically determined arguments to complete the message to be shown to the user.</p>
<p>For example, in the PO file comming from a KDE program, there will be messages like this one:</p>
<pre class="programlisting">
#: skycomponents/constellationlines.cpp:106
#, kde-format
msgid "No star named %1 found."
msgstr "Nema zvezde po imenu %1."
</pre>
<p>The format directive in this message is <code class="literal">%1</code>, and it will be substituted at runtime with the text provided by the user as the name to search for. If several arguments need to be substituted in the text, there can be more format directives with increasing numbers: <code class="literal">%1</code>, <code class="literal">%2</code>, <code class="literal">%3</code>...</p>
<p>A new type of comment has appeared as well, the <span class="emphasis"><em>flags comment</em></span>. This comment begins with <code class="literal">#,</code>, followed by the comma-separated list of keywords--the flags--which clarify the state or the type of the message. In this example the flag is <code class="literal">kde-format</code>, indicating that format directives in the message are of KDE type.</p>
<p>Format directives differ across source environments, but they are usually easy to recognize. The previous message, if it would be found in a Gnome program, would look like this:</p>
<pre class="programlisting">
#: skycomponents/constellationlines.c:106
#, c-format
msgid "No star named %s found."
msgstr "Nema zvezde po imenu %s."
</pre>
<p>The format directive changed to <code class="literal">%s</code>, and the format flag to <code class="literal">c-format</code>. This is the format used by most programs written in C, and by many written in C++. In C format, the <code class="literal">%s</code> directive is for substituting string arguments, and another frequent directive is <code class="literal">%d</code> for integer numbers; but there are many more.</p>
<p>For one more example, to illustrate the diversity of format directives, if the program would have been written in Python the message could look like:</p>
<pre class="programlisting">
#: skycomponents/constellationlines.cpp:106
#, python-format
msgid "No star named %(starname)s found."
msgstr "Nema zvezde po imenu %(starname)s."
</pre>
<p>Here the format directive is <code class="literal">%(starname)s</code>, which indicates the argument type similar to C format (<code class="literal">%s</code>), but also its name in parenthesis. Hence the <code class="literal">python-format</code> flag. This name must not be changed in translation, as otherwise the program will not be able to match the directive and make the substitute. This would probably make the program crash when it tries to display the message.</p>
<p>You only need to make sure that each directive from the original string is found in the translation, and very rarely to modify the directives themselves. Format flags, such as <code class="literal">kde-format</code>, <code class="literal">c-format</code>, etc., are there not only as information for translators, but they are also used by tools for validating PO files. For example, if you forget or mistype a format directive in the translation, such tools will report it. Dedicated PO editors may warn on the spot, or when saving the PO file. This provides you with a "safety net", so long as you remember to perform the checks after completing the translation (if the PO editor does not do it automatically).</p>
<p>One situation that may require modification of directives is when there are several of them, and they need to be ordered differently in the translation:</p>
<pre class="programlisting">
#: kxsldbgpart/libxsldbg/xsldbg.cpp:256
#, kde-format
msgid "%1 took %2 ms to complete."
msgstr "Trebalo je %2 ms da se %1 završi."
</pre>
<p>With KDE format directives, which are numbered, reordering is as simple as above. Similarly for the Python format, where directives are named. But for formats where directives are neither numbered nor named by default, like in C format (where they only state argument type), you can sometimes modify directives to the desired effect:</p>
<pre class="programlisting">
#: gxsldbgpart/libxsldbg/xsldbg.c:256
#, c-format
msgid "%s took %d ms to complete."
msgstr "Trebalo je %2$d ms da se %1$s završi."
</pre>
<p>If the directives are numbered or named, and there is more than one same-number or same-name directive, usually any of the duplicates can be dropped in the translation. This may be useful in a longer text, for example when in the translation a pronoun can be safely used instead of repeating the argument:</p>
<pre class="programlisting">
#: hypothetical.cpp:100
#, kde-format
msgid "%1 is the blah, blah, blah. With %1 you can blah, blah."
msgstr "%1 je bla, bla, bla. Pomoću njega možete bla, bla."
</pre>
<p>Here "njega" is a pronoun used instead of repeating the <code class="literal">%1</code>. Conversely, it is possible to repeat the directive where the original text had used a pronoun, if it better fits the translation.</p>
<p>Sometimes, instead of using a format directive, the programmer may try to concatenate the full text out of separate messages:</p>
<pre class="programlisting">
#: hypothetical.cpp:100
msgid "No star named "
msgstr ""
⁠
#: hypothetical.cpp:100
msgid " found."
msgstr ""
</pre>
<p>Here the program will fetch the first message, append to it the argument, and then append the second message. This kind of programming is considered as one of the basic errors when making a translatable program, because it forces translators to "piece the puzzle", which may not even be possible in every language. This is thankfully rare today, but when it does happen, while you can try to work around, it is better that you contact the authors to have the source code fixed.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-pomarkup" id="sec-pomarkup"></a>2.3.2.&nbsp;Text Markup</h3>
</div>
</div>
</div>
<p>Programs sometimes show parts of the text in non-plain text: certain words may be italic or bold, titles in larger font size, list items with graphical bullets, etc. This is frequent, for example, in tooltips and message boxes. Yet richer typographic elements of this kind are usually found in documentation and other static content, which may need to be suitable both for reading on screen and printing on paper. In such messages, the original text will contain <span class="emphasis"><em>markup</em></span>, where words, phrases, and whole paragraphs are wrapped with special <span class="emphasis"><em>tags</em></span>.</p>
<p>The following messages show typical examples of markup in program user interface:</p>
<pre class="programlisting">
#: rc.cpp:1632 rc.cpp:3283
msgid "&lt;b&gt;Name:&lt;/b&gt;"
msgstr ""
⁠
#: kgeography.cpp:375
#, kde-format
msgid "&lt;qt&gt;Current map:&lt;br/&gt;&lt;b&gt;%1&lt;/b&gt;&lt;/qt&gt;"
msgstr ""
⁠
#: rc.cpp:2537 rc.cpp:4188
msgid ""
"&lt;b&gt;Tip&lt;/b&gt;&lt;br/&gt;Some non-Meade telescopes support a subset of the LX200 "
"command set. Select &lt;tt&gt;LX200 Basic&lt;/tt&gt; to control such devices."
msgstr ""
</pre>
<p>The markup in these messages is XML-like, where tags for visual formatting are specified as <code class="literal">&lt;<em class="replaceable"><code>tag</code></em>&gt;...&lt;/<em class="replaceable"><code>tag</code></em>&gt;</code> wrappings around the visible text segments. For example <code class="literal">&lt;b&gt;...&lt;/b&gt;</code> tells that the text inside should be shown in boldface, while <code class="literal">&lt;tt&gt;...&lt;/tt&gt;</code> that a monospace font should be used, and lone <code class="literal">&lt;br/&gt;</code> introduces the line break. A reader knowing some HTML will instantly recognize these tags.</p>
<p>Another frequent XML-like markup is used in documentation PO files, which are in many environments (like KDE or Gnome) mostly written in the Docboox XML format:</p>
<pre class="programlisting">
#. Tag: title
#: blackbody.docbook:13
msgid "&lt;title&gt;Blackbody Radiation&lt;/title&gt;"
msgstr ""
⁠
#. Tag: para
#: geocoords.docbook:28
msgid ""
"The Equator is obviously an important part of this coordinate system; "
"it represents the &lt;emphasis&gt;zeropoint&lt;/emphasis&gt; of the latitude angle, "
"and the halfway point between the poles. The Equator is the "
"&lt;firstterm&gt;Fundamental Plane&lt;/firstterm&gt; of the geographic coordinate "
"system. &lt;link linkend='ai-skycoords'&gt;All Spherical&lt;/link&gt; Coordinate "
"Systems define such a Fundamental Plane."
msgstr ""
</pre>
<p>The Docbook tags are named somewhat differently to the HTML-like tags from the previous example. The describe the meaning of text that they wrap, rather than the visual appearance (the so called <span class="emphasis"><em>semantic</em></span> markup). But it is all the same for translator, except that knowing the meanings of text parts may be benefitial for context. Docbook tags will also sometimes provide one or few <span class="emphasis"><em>attributes</em></span> following the opening tag, such as <code class="literal">&lt;link linkend=...&gt;</code> in the second message above (HTML tags may have this too).</p>
<p>When translating markup text, you should, in general, reproduce the same set of tags in the translation, assigning them to appropriate translated segments. Under no circumstances may the tags themselves be translated (e.g. <code class="literal">&lt;title&gt;</code> or <code class="literal">&lt;emphasis&gt;</code>), since they are processed by the computer to produce the final formatted text. As for tag attributes (<code class="literal">linkend='ai-skycoords'</code> in the example above), attribute names are also never translated, but in rare occasions their values in quotes may be (usually when a value is clearly a human-readable text).</p>
<p>However, this is not to say that you should never modify markup. Especially with HTML-like tags, not so rarely the markup in the original text is sloppy (missing closing tags), and you are free to correct it in translation. Another example would be in CJK languages<sup>[<a name="id586488" href="#ftn.id586488" class="footnote" id="id586488">6</a>]</sup>, where bold text is hard to read at normal font sizes, so CJK translators tend to remove <code class="literal">&lt;b&gt;</code> tags in favor of quotes. In general, the more you are familiar with the particular markup, the more you can think of doing something other than directly copying it from the original text.</p>
<p>Sometimes there are parts in the original text that may look somewhat like XML-like markup, but are actually not. For example:</p>
<pre class="programlisting">
#: utils/katecmds.cpp:180
#, kde-format
msgid "Missing argument. Usage: %1 &lt;value&gt;"
msgstr ""                                                                        
</pre>
<p>The <code class="literal">&lt;value&gt;</code> here is not markup, and is shown verbatim to the user. It is a <span class="emphasis"><em>placeholder</em></span>, an indicator to the user that a real argument should be put in its place. For this reason, in many languages the placeholders are translated, and there is no technical problem with that. You should only exercise caution not to misjudge a tag for a placeholder. After little experience with the particular markup, the difference usually becomes obvious.</p>
<p>There are also non-XML like markups that tend to come up for translation. One could be the wiki markup:</p>
<pre class="programlisting">
#: .txt:191
msgid "=== Overlay Images ==="
msgstr ""
⁠
#: poformat.txt:193
msgid ""
"A special kind of localized image is an ''overlay image'', one which "
"does not simply replace the original, but is combined with it [...]"
msgstr ""
</pre>
<p>Here <code class="literal">===...===</code> is the approximate of <code class="literal">&lt;h2&gt;...&lt;h2&gt;</code> in HTML, while <code class="literal">''...''</code> is the counterpart of <code class="literal">&lt;i&gt;...&lt;i&gt;</code>. Another markup type is the source language for man pages, troff:</p>
<pre class="programlisting">
# type: Plain text
#: ../../doc/man/wesnoth.6:55
msgid ""
"compresses a savefile (B&lt;infile&gt;)  that is in text WML format into "
"binary WML format (B&lt;outfile&gt;)."
msgstr ""
</pre>
<p>where <code class="literal">B&lt;...&gt;</code> is the equivalent of <code class="literal">&lt;b&gt;...&lt;b&gt;</code> in HTML.</p>
<p>When you are faced with a new kind of markup, which you have never translated before, you should at least skim through a tutorial or two about it. This will enable you both to recognize it in the original text, and to modify it in translation if necessary.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-poescapes" id="sec-poescapes"></a>2.3.3.&nbsp;Escape Sequences</h3>
</div>
</div>
</div>
<p>There are a few special characters which cannot appear verbatim in the <code class="varname">msgid</code> or <code class="varname">msgstr</code> strings. Most obviously, think of the plain double quote (<code class="literal">"</code>): since it is used to delimit strings, a raw double quote inside the text would terminate the string prematurely, and invalidate the message syntax. Such characters are therefore written as <span class="emphasis"><em>escape sequences</em></span>, a combination of the backslash (<code class="literal">\</code>) and another character, which is interpreted into the appropriate real character when showing the message to the user. The plain double quote is written as <code class="literal">\"</code>:</p>
<pre class="programlisting">
#: kstars_i18n.cpp:3591
msgid "The \"face\" on Mars"
msgstr "\"Lice\" na Marsu"
</pre>
<p>Another frequent escaped character is the newline, presented as <code class="literal">\n</code>:</p>
<pre class="programlisting">
#: kstarsinit.cpp:699
msgid ""
"The initial position is below the horizon.\n"
"Would you like to reset to the default position?"
msgstr ""
"Početni položaj je ispod horizonta.\n"
"Želite li da vratite na podrazumevani?"
</pre>
<p>Tools that write out PO files usually unconditionally wrap the text at newlines, ignoring the specified wrap column, even when wrapping has been turned off. This is to increase readability for translator editing the PO file. If the text is not composed of markup (e.g. not Docbook), newlines are significant to the program user too, so you should carry them over into the translation. In general, unless you are confident that you can manipulate newlines in a certain way, you should follow the lead of <code class="varname">msgid</code>.</p>
<p>Another two escape sequences, usually of much lower frequency than the double quote and the newline, are the tabulator <code class="literal">\t</code> and the backslash itself <code class="literal">\\</code> (because single backslash always starts an escape sequence). While other escape sequences are possible, they are extremely rare.</p>
<p>Returning to double quotes, keep in mind that while the English original usually uses plain ASCII quotes, translators tend to use "fancy" quotes according to the orthography of the language:</p>
<pre class="programlisting">
#: kstars_i18n.cpp:3591
msgid "The \"face\" on Mars"
msgstr "„Lice“ na Marsu"
</pre>
<p>This holds both for double and single quotes. Do check if some particular quote pairs are prescribed by the ortography of your language, and use them if they are.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-poaccel" id="sec-poaccel"></a>2.3.4.&nbsp;Accelerators</h3>
</div>
</div>
</div>
<p>In user interfaces, short texts on widgets used to perform an action or open a dialog, frequently have one letter in them underlined. This indicates that when the user presses the <span class="keycap"><strong>Alt</strong></span> key (on an IBM PC type keyboard) and the underlined letter together, the corresponding action will be triggered. Such letters are called <span class="emphasis"><em>accelerators</em></span>, and in message strings they are usually specified by preceding them with a special character, the <span class="emphasis"><em>accelerator marker</em></span>:</p>
<pre class="programlisting">
#: kstarsinit.cpp:163
msgid "Set Focus &amp;Manually..."
msgstr "Zadaj fokus &amp;ručno..."
</pre>
<p>Here the accelerator marker is the ampersand (<code class="literal">&amp;</code>). Thus, the accelerator in this message will be the letter 'm' in the original text, and the letter 'r' in the translation. Accelerator markers differ across environments: ampersand is typical KDE and Qt programs, in Gnome programs it is the underscore (<code class="literal">_</code>), in OpenOffice the tilde (<code class="literal">~</code>), etc.</p>
<p>It may be difficult to choose accelerators in the translation (where to put the accelerator marker), because you can easily get into situations where in the same interface context (e.g. within one menu) two items end up having the same accelerator. This will not do anything too bad, e.g. the program may automatically reassign conflicting accelerators, or the user may have to press <span class="keycap"><strong>Alt</strong></span> and the letter several times to go through all such items. Nevertheless, it is good to avoid conflicting accelerators, but there is no definite way to do that; you can only try to track the message context in the PO file, and check the running program. This is not only the problem of translation, as not so rarely the original itself introduces conflicting accelerators.</p>
<p>CJK languages use input methods different to alphabetical ones (keyboard layouts), so instead of assigning an ideogram as the accelerator, they add a single Latin letter for that purpose alone:</p>
<pre class="programlisting">
#: kstarsinit.cpp:163
msgid "Set Focus &amp;Manually..."
msgstr "フォーカスを手動でセット(&amp;M)..."
</pre>
<p>This letter is usually picked to be the same as in the original text, thereby reducing the possibility of accelerator conflicts as much as the programmers were able to avoid conflicts themselves.</p>
<p>Accelerator does not have to be positioned at the start of a word, it can be put next to any letter or number. A reasonable order of choices would be: at the start of the most significant word in the message by default, then if it conflicts another message, at the start of another word, and if it still conflicts, inside one of the words.</p>
<p>The accelerator marker is usually chosen as one of the rarely used characters in normal text, but it may still appear in contexts in which it does not mark an accelerator. For example:</p>
<pre class="programlisting">
#: kspopupmenu.cpp:203
msgid "Center &amp;&amp; Track"
msgstr ""
⁠
#. Tag: phrase
#: config.docbook:137
msgid "&lt;phrase&gt;Configure &amp;kstars; Window&lt;/phrase&gt;"
msgstr ""
</pre>
<p>In the first message, the accelerator marker has been used to escape itself, to produce a verbatim ampersand in output (similar as with escape sequences where double-backslash was used to represent a verbatim backslash). In the second message, the ampersand is used to insert an XML <span class="emphasis"><em>entity</em></span> <code class="literal">&amp;kstars;</code>. Only by context can it be concluded that the character is not used as accelerator marker, but after gaining little experience, the distinction will almost always be obvious to you.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-poplurals" id="sec-poplurals"></a>2.4.&nbsp;Plural Forms</h2>
</div>
</div>
</div>
<p>Programs frequently need to report to the user the number of objects in a given context: "10 files found", "Do you really want to delete 5 messages?" etc. Of, course, in English such messages should also have singular counterparts, like "1 file found", "...delete 1 message?". This means that two separate English texts are needed in the PO file, one for the singular and another the plural case. You could assume that these would then be two messages, like in this hypothetical example:</p>
<pre class="programlisting">
#: hypothetical.cpp:100
#, kde-format
msgid "Time: %1 second"
msgstr ""
⁠
#: hypothetical.cpp:101
#, kde-format
msgid "Time: %1 seconds"
msgstr ""
</pre>
<p>Here the program would use the first message when the number of objects is 1, and the second message for any other number.</p>
<p>However, while this also works for some languages other than English (e.g. Spanish, German, French), it does not work for all languages. The reason is that, while English needs one text for unity and another text for any other number, in many languages it is more complicated than that. For example, in some languages the singular form is used for all numbers <span class="emphasis"><em>ending</em></span> with the digit 1, so it would be wrong to use the singular form only for exactly 1. Furthermore, in some languages more than two texts are needed, for example three: one for all numbers ending in 1, the second for all numbers ending in 2, 3, 4, and the third for all other numbers.</p>
<p>To handle this diversity of plural forms, the PO format implements <span class="emphasis"><em>plural messages</em></span>. The example above in reality looks like this:</p>
<pre class="programlisting">
#: mainwindow.cpp:127
#, kde-format
msgid "Time: %1 second"
msgid_plural "Time: %1 seconds"
msgstr[0] ""
msgstr[1] ""
</pre>
<p>The English singular form is given by the <code class="varname">msgid</code> string, and the plural form by the <code class="varname">msgid_plural</code> string. There are now several <code class="varname">msgstr</code> strings, with zero-based indices in square brackets, so that you can write as many translations as there are plural forms in your language. By default two <code class="varname">msgstr</code> strings will be given, but you may insert the line with the third one (index 2), and so on. For example, the Spanish language has same plural forms as English, and translation to it looks like this:</p>
<pre class="programlisting">
#: mainwindow.cpp:127
#, kde-format
msgid "Time: %1 second"
msgid_plural "Time: %1 seconds"
msgstr[0] "Tiempo: %1 segundo"
msgstr[1] "Tiempo: %1 segundos"
</pre>
<p>while the Polish translation, which needs three plural forms, is:</p>
<pre class="programlisting">
#: mainwindow.cpp:127
#, kde-format
msgid "Time: %1 second"
msgid_plural "Time: %1 seconds"
msgstr[0] "Czas: %1 sekunda"
msgstr[1] "Czas: %1 sekundy"
msgstr[2] "Czas: %1 sekund"
</pre>
<p>But, how will the program know which plural form corresponds to which numbers? The specification for this is written within the PO file itself, in the file <span class="emphasis"><em>header</em></span> (PO headers will be <a class="link" href="#sec-poheader" title="2.6.&nbsp;PO Header">explained later</a>). The specifiction consists of the number of plural forms which every plural message in the given PO file should have, and the computable logical expression which for any given number computes the index of the required plural form. This expression is quite cryptic to untrained eye, but you do not have to really understand how it works. Since it is constant for a given language, you can just copy it from any other translated PO file with plural forms, and by observing the plural messages in that other file, you will clearly see which form (by index of <code class="varname">msgstr</code>) is used in which situation. Bearing this in mind, just to complete the examples, here is the plural specification for Spanish:</p>
<pre class="programlisting">
nplurals=2; plural=n != 1;
</pre>
<p>and for the more complicated Polish plural:</p>
<pre class="programlisting">
nplurals=3; plural=(n==1 ? 0 : n%10&gt;=2 &amp;&amp; n%10&lt;=4 &amp;&amp; (n%100&lt;10 || n%100&gt;=20) ? 1 : 2);
</pre>
<p>The <code class="varname">nplurals</code> variable tells how many forms there are, and <code class="varname">plural</code> is the expression which computes the index of the <code class="varname">msgstr</code> string for the given number <code class="varname">n</code>. (If the syntax of the expression is familiar to you, that is because you know some C programming language).</p>
<p>Sometimes you will come upon a message, or a pair of messages, which are just like the hypothetical example above: having a number in it, but not presented as plural message, when you clearly see it should be. In most programming environments today, this simply means that the programmer forgot to use the plural message. Since this is considered a bug, you should inform the authors to replace the ordinary message with the plural message. In some environments, however, programs are not capable of using plurals, mostly when the PO format is used as intermediate (e.g. for OpenOffice programs). If that is the case, you can only try to translate the message in the "least bad" way.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-pononum" id="sec-pononum"></a>2.4.1.&nbsp;Omitting The Number</h3>
</div>
</div>
</div>
<p>Quite frequently English singular form will omit the number, that is, only the plural form will contain the format directive for the number:</p>
<pre class="programlisting">
#: modes/typesdialog.cpp:425
#, kde-format
msgid "Are you sure you want to delete this type?"
msgid_plural "Are you sure you want to delete these %1 types?"
msgstr[0] ""
msgstr[1] ""
</pre>
<p>It depends on the programming environment whether it is allowed to omit the number like this. For example, in KDE programs (<code class="literal">kde-format</code> flag) this is always possible, also in Gnome programs (<code class="literal">c-format</code>), but not in pure Qt programs (<code class="literal">qt-format</code>). If number omission is supported, in the translation you can either omit or retain the number in singular according to what is better for you language, and regardless of whether or not the number was omitted in the original. More precisely, you can omit the number in any plural form that is used for exactly one number. Conversely, if all forms are used for more than one number (e.g. the singular form is used for all numbers ending in digit 1), you cannot omit the number at all.</p>
<p>On rare occasions the plural message will have no number in the original, in either singular or plural. This happens when the programmer merely wanted to choose between the forms for "one" and "several", like this:</p>
<pre class="programlisting">
#: kgpg.cpp:498
msgid "Decryption of this file failed:"
msgid_plural "Decryption of these files failed:"
msgstr[0] ""
msgstr[1] ""
</pre>
<p>In such cases, in translation you should just use the same plural text for all forms but the one which is used for unity (if there is any such).</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-pomerge" id="sec-pomerge"></a>2.5.&nbsp;Merging With Templates</h2>
</div>
</div>
</div>
<p>At one point you will have translated the complete PO file, every message in it, and sent it back to the source where it is used. As time passes, the original text at the source is going to change. Programs will get bugs fixed and new features implemented, which will require both new strings in the user interface, and modifications to some of the existing. Documentation will get new chapters, old chapters expanded, old paragraphs modified to better style. At some point, you will want to update your translation so that the source is again fully translated into your language.</p>
<p>This is done in the following way. On the one side, there is your last translated version of the PO file. On the other side, there is the latest pristine PO, with non-translated messages corresponding to the current state of the source. Pristine PO files are called <span class="emphasis"><em>templates</em></span>, and have the <code class="filename">.pot</code> extension instead of <code class="filename">.po</code>. The translated PO file and the template are then <span class="emphasis"><em>merged</em></span> in a special way, producing a new, partially translated PO for you to work on. The technicalities of merging are not so important at first, as in any established translation project you can just fetch the latest merged PO files. More important is what you can expect to see in a merged PO file.</p>
<p>In general, merged PO files contain four categories of messages. First are those messages which were present in the PO file when you last worked on it, in the sense of having unchanged <code class="varname">msgctxt</code> and <code class="varname">msgid</code> strings since then. As expected, their translations (<code class="varname">msgstr</code> strings) are as you made them, so there is nothing new for you to do about these messages. The second category are entirely new messages, added to the source in the meantime, which you should now translate. New messages are not added in an arbitrary way, for example simply appended to the end of the PO file. Instead they are be interspersed with translated messages, following the order of appearance of messages in the current source. This allows you to continue to infer contexts by preceding and following messages, same as you did when you were translating the PO from scratch. For example:</p>
<pre class="programlisting">
#: fitshistogram.cpp:347
msgid "Auto Scale"
msgstr ""
⁠
#: fitshistogram.cpp:350
msgid "Linear Scale"
msgstr "linearna skala"
⁠
#: fitshistogram.cpp:353
msgid "Logarithmic Scale"
msgstr "logaritamska skala"
</pre>
<p>The first message is a new one, untranslated, and the two other messages are old, translated earlier. From the old messages you can see that the new message is a new choice of scale (possibly for a diagram axis), and not, say, a command or option to change the size of something (as in "scale automatically").</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-pofuzzy" id="sec-pofuzzy"></a>2.5.1.&nbsp;Fuzzy Messages</h3>
</div>
</div>
</div>
<p>The most interesting is the third category of messages in a merged PO file. These are the old messages which were somewhat modified in the meantime, i.e. one or both of their <code class="varname">msgctxt</code> and <code class="varname">msgid</code> strings have changed. Or, this can also be a new message, but very similar to one of the old messages. There is actually no way to tell between the two, it is only by similarity to one of the old messages that a modified or new message falls into this category. Either way, such a message is called <span class="emphasis"><em>fuzzy</em></span>, and looks like this:</p>
<pre class="programlisting">
#: src/somwidget_impl.cpp:120
#, fuzzy
#| msgid "Elements with boiling point around this temperature:"
msgid "Elements with melting point around this temperature:"
msgstr "Elementi s tačkom ključanja u blizini ove temperature:"
</pre>
<p>The <code class="literal">fuzzy</code> flag indicates that the message is fuzzy. The comment starting with <code class="literal">#|</code> is called the <span class="emphasis"><em>previous-string comment</em></span>. It contains the previous value of the <code class="varname">msgid</code> string, for which the translation in <code class="varname">msgstr</code> was made. This translation is, however, not valid for the <span class="emphasis"><em>current</em></span> (non-commented) <code class="varname">msgid</code> string. By comparing the previous and current <code class="varname">msgid</code>, you can see that the word "boiling" was replaced with "melting", and you can adjust the translation accordingly. Once you did that, to <span class="emphasis"><em>unfuzzy</em></span> the message you should remove the <code class="literal">fuzzy</code> flag and previous string comments (<code class="literal">#|</code>), so that the final updated message is:</p>
<pre class="programlisting">
#: src/somwidget_impl.cpp:120
msgid "Elements with melting point around this temperature:"
msgstr "Elementi s tačkom topljenja u blizini ove temperature:"
</pre>
<p>Previous-string comments are still somewhat fresh addition to the PO format, which means that in some translation environments you will not have them in merged POs. The fuzzy message is then presented only with the <code class="literal">fuzzy</code> flag:</p>
<pre class="programlisting">
#: src/somwidget_impl.cpp:120
#, fuzzy
msgid "Elements with melting point around this temperature:"
msgstr "Elementi s tačkom ključanja u blizini ove temperature:"
</pre>
<p>It may seem that this is no great loss: so long as you are visually comparing texts, instead of comparing the previous (here missing) and current <code class="varname">msgid</code>, you might as well compare the current <code class="varname">msgid</code> and the old translation in <code class="varname">msgstr</code>, and adjust translation based on that. However, there are two disadvantages to this. Less importantly, it may not always be easy to spot a difference by comparing the new original and the old translation. For example, only a typo or some punctuation may have been fixed in the original, leaving you to wonder if you are missing something. More importantly, a dedicated PO editor can use the previous and current <code class="varname">msgid</code> to highlight differences between them, which makes it that much easier to see what has changed. Even if you are working with an ordinary text editor, there are command-line tools which can embed differences into previous <code class="varname">msgid</code>, again making them easier to spot. And the bigger the message, the more important to have automatic highlighting--think of a long paragraph where only one word has been changed. For these reasons, if the merged PO files you work on do not have previous-string comments, do inquire with authors if they can enable them (they may simply not know about this possibility, as it is not the default behavior on merging).</p>
<p>Other than <code class="varname">msgid</code>, the <code class="varname">msgctxt</code> string can also have the corresponding previous-string comment. Regardless of whether one or both of the <code class="varname">msgctxt</code> and <code class="varname">msgid</code> have been changed, both will be given in previous-string comments:</p>
<pre class="programlisting">
#: kstarsinit.cpp:451
#, fuzzy
#| msgctxt "Constellation Line"
#| msgid "Constell. Line"
msgctxt "Toggle Constellation Lines in the display"
msgid "Const. Lines"
msgstr "Linija sazvežđa"
</pre>
<p>In particular, a message will be fuzzied if it previously had no <code class="varname">msgctxt</code> and got one after merging, or had one and lost it. In the first case, the previous-string comments will contain only the <code class="varname">msgid</code>, although it may be the same as the current one; by this you will know that the change was only the adding of context. In the second case, the previous-string comments will contain both the <code class="varname">msgctxt</code> and the <code class="varname">msgid</code> strings, while there will be no current <code class="varname">msgctxt</code>. Here are two examples:</p>
<pre class="programlisting">
#: kstarsinit.cpp:444
#, fuzzy
#| msgid "Solar System"
msgctxt "Toggle Solar System objects in the display"
msgid "Solar System"
msgstr "Sunčev sistem"
⁠
#: finddialog.cpp:102
#, fuzzy
#| msgctxt "object name (optional)"
#| msgid "Andromeda Galaxy"
msgid "Andromeda Galaxy"
msgstr "Andromeda, galaksija"
</pre>
<p>It is important for a message to become fuzzy when only the disambiguating context is added or removed, because this has been done precisely to shed some light on the original text, which may require modifying the translation.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-pofuzztr" id="sec-pofuzztr"></a>2.5.2.&nbsp;Treatment of Fuzzy Messages</h3>
</div>
</div>
</div>
<p>Fuzzy messages are a special category only from translator's viewpoint. Consumers of PO files (programs, etc.) will treat them as ordinary untranslated messages, i.e. they will use the original instead of the old translation. This is necessary, as there is no telling how inappropriate the old translation may be for the current original. The algorithm that produces fuzzy messages will sometimes turn out rather strange pairings, which to you or to the user may not look similar at all.</p>
<p>It is important to keep in mind that fuzzy messages are treated as untranslated. Fresh translators will sometimes manually add the <code class="literal">fuzzy</code> flag to a message to mark they are not entirely sure that the translation is proper, not knowing that this will totally exclude the translation from being used. Thus, you should manually add the <code class="literal">fuzzy</code> flag only when you are so unsure of the meaning of the message, that you explicitly want to prevent the translation from being used. This is fairly rarely needed. Instead, when you just want to mark the message so that you or someone else can check it later, you should write your doubts in a <a class="link" href="#sec-pomancmnt" title="2.2.3.&nbsp;Translator Comments">translator comment</a>.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-poobsol" id="sec-poobsol"></a>2.5.3.&nbsp;Obsolete Messages</h3>
</div>
</div>
</div>
<p>The last, fourth category are <span class="emphasis"><em>obsolete</em></span> messages, the messages which are not present in the source any more. All obsolete messages are grouped at the end of the merged PO file, and fully commented out by the <code class="literal">#~</code> comment:</p>
<pre class="programlisting">
#~ msgid "Set the telescope longitude and latitude."
#~ msgstr "Postavi geo. dužinu i širinu teleskopa."
</pre>
<p>Obsolete messages have no extracted comments or source references, as they are no longer present in the source. Translator comments and flags are retained, as they don't depend on the presence in the source.</p>
<p>It could be said that obsolete messages are in fact no messages at all, given that they do not exist from the point of consumers of the PO file, and there is nothing for translators to do with them. PO tools in general will ignore them, except to preserve them when the PO file is modified. Dedicated PO editors will invariably not show obsolete messages to the translator, and may provide an option to automatically remove them from the file on saving.</p>
<p>What is then the purpose of obsolete messages? It frequently happens that a section of the source content, e.g. the code around a certain feature of a program, is <span class="emphasis"><em>temporarily</em></span> removed. Authors sometimes want to improve a section of the text separately, outside of the main content which is being translated, and sometimes a section is even briefly omitted by mistake when there are moves and renames in the source. When this happens, the affected messages will become obsolete in the merged PO; but, when the missing section is put back into the source, the merging algorithm will take obsolete messages into account, and promote them to real messages (either translated or fuzzy) where possible. Thus, some previous translation work may be saved.</p>
<p>What you should do with obsolete messages depends on the tools with which you work on PO files. For example, if you and other translators working on the given PO all use dedicated PO editors with internal storage of all previously encountered translations, the <span class="emphasis"><em>translation memory</em></span><sup>[<a name="id587416" href="#ftn.id587416" class="footnote" id="id587416">7</a>]</sup>, there is less need for keeping obsolete messages around, as the editor will be able to fill new messages from the memory; but there are some difficulties, as the need for translators to share the same memory. In practice, many translators choose to keep obsolete messages around for some time, and periodically (e.g. months apart) remove them from PO files. By this they achieve that accidental removals of source content, which are quickly corrected, do not bother them, while avoiding accretion of far too much obsolete material.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-ponewfile" id="sec-ponewfile"></a>2.5.4.&nbsp;Starting a New PO file</h3>
</div>
</div>
</div>
<p>In light of the translation maintenance through the process of merging with templates, you can think of starting to work on a never-before translated PO file as just the "initial merging": you will have to take the template and rename it to something with the <code class="varname">.po</code> extension, and work from there on. What you rename it to depends on the environment, but it is usually one of two things: either the same name as that of the template but with the <code class="varname">.po</code> extension (like in KDE), or your language code with the <code class="varname">.po</code> extension (like in Gnome). This basically depends on the organization of the particular translation project.</p>
<p>On the other hand, sometimes for each template in the project an empty PO for your language will have been created and put in a proper place in the source tree, so that you can just start translating it when you get to it.</p>
<p>At any rate, when you start working on a PO file from scratch, the first thing you should do is fill out its <a class="link" href="#sec-poheader" title="2.6.&nbsp;PO Header">header</a>.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-poheader" id="sec-poheader"></a>2.6.&nbsp;PO Header</h2>
</div>
</div>
</div>
<p>The very first message in each PO file is not a real message, but the <span class="emphasis"><em>header</em></span>, which provides administrative and technical pieces of information about the PO file. Here is one pristine header, before any translation on the PO file has been done:</p>
<pre class="programlisting">
# SOME DESCRIPTIVE TITLE.
# Copyright (C) YEAR This_file_is_part_of_KDE
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR &lt;EMAIL@ADDRESS&gt;, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"Report-Msgid-Bugs-To: http://bugs.kde.org\n"
"POT-Creation-Date: 2008-09-03 10:09+0200\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME &lt;EMAIL@ADDRESS&gt;\n"
"Language-Team: LANGUAGE &lt;kde-i18n-doc@kde.org&gt;\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=INTEGER; plural=EXPRESSION;\n"
</pre>
<p>The header consists of introductory comments, followed by the empty <code class="varname">msgid</code>, and by the <code class="varname">msgstr</code> which contains <span class="emphasis"><em>header fields</em></span>. The header comments, similar to those of normal messages, are not entirely free form, but have some structure to them. The <code class="varname">msgstr</code> is divided by newlines (<code class="literal">\n</code>) into fields of <code class="literal"><em class="replaceable"><code>name</code></em>: <em class="replaceable"><code>value</code></em></code> form (the name of the piece of information and the information itself). Although the header is pristine, some of the environment-dependent values are typically already supplied, e.g. wherever the KDE is mentioned in this example. The <code class="literal">fuzzy</code> flag indicates that the PO file has not been translated earlier. All-uppercase text segments are placeholders which you should replace with real values.</p>
<p>The header updated to reflect the translation state could look like this:</p>
<pre class="programlisting">
# Translation of kstars.po into Spanish.
# This file is distributed under the same license as the kdeedu package.
# Pablo de Vicente &lt;pablo@foo.com&gt;, 2005, 2006, 2007, 2008.
# Eloy Cuadra &lt;eloy@bar.net&gt;, 2007, 2008.
msgid ""
msgstr ""
"Project-Id-Version: kstars\n"
"Report-Msgid-Bugs-To: http://bugs.kde.org\n"
"POT-Creation-Date: 2008-09-01 09:37+0200\n"
"PO-Revision-Date: 2008-07-22 18:13+0200\n"
"Last-Translator: Eloy Cuadra &lt;eloy@bar.net&gt;\n"
"Language-Team: Spanish &lt;kde-l10n-es@kde.org&gt;\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=2; plural=n != 1;\n"
</pre>
<p>Even if this particular header has been slightly abridged for clarity, it probably still looks menacing, with a lot of data. Are you supposed to manually get <span class="emphasis"><em>all</em></span> that correct? Not really. If you are using a dedicated PO editor, it will have a comfortable configuration dialog where you can enter data about yourself, your language, and so on, and whenever you save a PO file, the editor will automatically fill out the header. If you are using a plain text editor, there are command line tools to similarly fill out the header automatically. But even with such aids, it is useful to give a few general directions about header comments and fields.</p>
<p>The first comment line usually has the title role, saying something about what is translated and into which language. The second comment tells something about licensing. The following comments each list a translator who at one time worked on this particular PO file, his name, email address, and years of contribution. After that, any freeform comments may be added. The <code class="literal">fuzzy</code> flag is removed once the work on the PO file is started.</p>
<p>The <code class="literal">Project-Id-Version</code> header field states the name and possibly version of what is translated, <code class="literal">Report-Msgid-Bugs-To</code> gives address to write to when you discover problems in original text, <code class="literal">POT-Creation-Date</code> the time when the PO template was created, <code class="literal">PO-Revision-Date</code> the time when the PO file was last edited by a translator, <code class="literal">Last-Translator</code> the name and address of last translator who worked on the file, and <code class="literal">Language-Team</code> the name and address of the translation team (if any) which the last translator is part of. The fields <code class="literal">MIME-Version</code>, <code class="literal">Content-Type</code>, and <code class="literal">Content-Transfer-Encoding</code>, are pretty much always and for any language as given above, so they are not interesting (though you could change encoding to something else than UTF-8, in this day and age really think thrice before doing that). The final field, <code class="literal">Plural-Forms</code>, is where you write the plural specification for your language (as explained in the section on <a class="link" href="#sec-poplurals" title="2.4.&nbsp;Plural Forms">plural forms</a>).</p>
<p>Of the presented comments and fields, almost all of them are set when the PO file is translated for the first time. When you come back to a certain PO to update the translation, if no one else worked on that PO in the meantime, you should only update the <code class="literal">PO-Revision-Date</code> field. If someone has worked on it, you will also have to put your data in <code class="literal">Last-Translator</code> field. If you get to work on a PO file for the first time after someone else has already worked on it, you should add yourself in the translator list in comments. If you are using a dedicated PO editor, it will perform all these updates for you whenever you save the file.</p>
<p>Note that everything in the header is supposed to be in English, to be understandable to people who do not speak your language. Aside from comments in English, this also means that the name of the language and the language team should be in English, and your own name and names of other translators in their romanized equivalents. This is because, for example, people speaking other languages may need to contact you or your team about any technical problems in the translation (e.g. program maintainers). Keep this in mind also when you are setting up your data in a dedicated PO editor.</p>
<p>Other than the standard header fields, you may encounter some custom fields, whose names begin with <code class="literal">X-</code>. These fields are added by various PO processing tools. One typical custom field is <code class="literal">X-Generator</code>, where the dedicated PO editor which you use will write its name and version. Another custom field sometimes seen is <code class="literal">X-Accelerator-Marker</code>, which states the character used as the <a class="link" href="#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator marker</a> (recognized by some tools e.g. for searching through PO files, when otherwise the accelerator marker could "mask" a word by being in the middle of it). Different translation environments may add various environment-specific fields for their internal use.</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-poedrepr" id="sec-poedrepr"></a>2.7.&nbsp;Representation in Editors</h2>
</div>
</div>
</div>
<p>When you translate PO files using a plain text editor, all the message elements will be displayed in it as we have seen in the examples so far. You can edit them at will, including invalidating the syntax if you are not careful. Most capable text editors nowdays have syntax highlighting for the PO format, albeit with different levels of specificity. If you are working with a plain text editor, you should definitely use a command line tool to check the basic correctness of the PO file. <span class="command"><strong>msgfmt</strong></span> from the Gettext package is one such tool (use it with the <code class="option">-c</code>).</p>
<p>Dedicated PO editors will provide you with much more automation, but each will have its own ways of presenting and means of editing different elements of a message. As this text has tried to convince you, every element of the PO message is potentially important, so you should take time to find out how and where the given PO editor shows them. Some editors may even not show all elements of the messages, which in the opinion of the author of this text reflects poorly on them. At the extreme end, immediatelly discard an editor which shows you only the original text (the <code class="varname">msgid</code> string), regardless of any other qualities it may have (this is typical of translation editors not developed around the PO format, but later upgraded to "support" it).</p>
<p>Here is the summary of PO message elements, as a checklist of what to look for in a PO editor:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="varname">msgid</code> string (original text)</p>
</li>
<li class="listitem">
<p><code class="varname">msgstr</code> string (translated text)</p>
</li>
<li class="listitem">
<p><code class="varname">msgctxt</code> string (disambiguating context)</p>
</li>
<li class="listitem">
<p>extracted comments (context in comment)</p>
</li>
<li class="listitem">
<p>source references (source file and line of the message)</p>
</li>
<li class="listitem">
<p>flags (<code class="literal">fuzzy</code>, <code class="literal">*-format</code>, etc.)</p>
</li>
<li class="listitem">
<p>fuzzy state (although among flags, requires special attention)</p>
</li>
<li class="listitem">
<p>previous strings (previous <code class="varname">msgctxt</code> and <code class="varname">msgid</code> strings in fuzzy messages)</p>
</li>
<li class="listitem">
<p>translator comments (added by translators, therefore they should be editable as well)</p>
</li>
<li class="listitem">
<p>positional context (good view of preceding and following messages)</p>
</li>
</ul>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-poedlist" id="sec-poedlist"></a>2.7.1.&nbsp;List of PO Editors</h3>
</div>
</div>
</div>
<p>There is a number of dedicated PO editors available. They all have the same good basic support for the PO format, but each has some specialities and quirks that reflect the background of their authors. Namely, dedicated PO editors are normally written and maintained by people who are themselves engaged in certain translation projects. You should therefore try out the available editors and choose the one which is best suited to you, and possibly to the translation project within which you translate. Here is the list of some dedicated PO editors:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><a class="ulink" href="http://projects.gnome.org/gtranslator/" target="_top">Gtranslator</a></span></dt>
<dd>
<p>PO editor developed within the Gnome translation project.</p>
</dd>
<dt><span class="term"><a class="ulink" href="http://userbase.kde.org/Lokalize" target="_top">Lokalize</a></span></dt>
<dd>
<p>Computer-aided translation tool developed within the KDE translation project.</p>
</dd>
<dt><span class="term"><a class="ulink" href="http://www.poedit.net/" target="_top">Poedit</a></span></dt>
<dd>
<p>Cross-platform, lightweight PO editor.</p>
</dd>
<dt><span class="term"><a class="ulink" href="http://translate.sourceforge.net/wiki/virtaal/index" target="_top">Virtaal</a></span></dt>
<dd>
<p>Translation editor designed to be visually compact and easy to use, yet powerfull.</p>
</dd>
</dl>
</div>
<p>Some plain text editors can operate in <span class="emphasis"><em>modes</em></span>, where additional editing commands became available to the user when a file of certain type is opened. Such mode for PO files is available for the following text editors: <a class="ulink" href="http://www.gnu.org/software/emacs/" target="_top">Emacs</a>, <a class="ulink" href="http://projects.gnome.org/gedit/" target="_top">Gedit</a>, <a class="ulink" href="http://www.vim.org/" target="_top">Vim</a>.</p>
</div>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id529664" href="#id529664" class="para" id="ftn.id529664">3</a>]</sup> You may want to point to a message when consulting with fellow translators, or when reporting a typo or another problem in the original text to the authors.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id585926" href="#id585926" class="para" id="ftn.id585926">4</a>]</sup> If the <code class="varname">msgctxt</code> is present but empty, i.e. <code class="literal">msgctxt ""</code>, this is actually different than the <code class="varname">msgctxt</code> not being present at all. Hence the term "null-valued" as opposed to simply "empty".</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id585972" href="#id585972" class="para" id="ftn.id585972">5</a>]</sup> Programmers of free software are frequently aware of this latent necessity, and readily reachable, so you should be able to make the request with little communication overhead.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id586488" href="#id586488" class="para" id="ftn.id586488">6</a>]</sup> CJK is the usual acronym for ideographical east-Asian languages, the Chinese, Japanese, and Korean.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id587416" href="#id587416" class="para" id="ftn.id587416">7</a>]</sup> Translation memory is an extremely important topic on its own when the translation is not done using the PO format. With PO files and the concept of merging with templates, translation memories are not of such great importance, but can come in handy.</p>
</div>
</div>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-sieve" id="ch-sieve"></a>Chapter&nbsp;3.&nbsp;Sieving</h2>
</div>
</div>
</div>
<p>Translator may want to apply batch-type operations to every message in a single PO file or in collection of PO files, such as searching and replacing text, computing statistics, or validating. However, batch-processing tools for general plain text (<span class="command"><strong>grep</strong></span>, <span class="command"><strong>sed</strong></span>, <span class="command"><strong>awk</strong></span>, etc.) are not very well suited to processing PO files. For example, when looking for a particular word, a generic search tool will not see it if it contains an <a class="link" href="#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator marker</a>; or, if looking for a two-word phrase, a generic tool will miss it if it is <a class="link" href="#sec-powrap" title="2.1.2.&nbsp;String Wrapping">wrapped</a>. Therefore many tools tailored specifically for batch-processing messages in PO files have been developed, such as those bundled with <a class="ulink" href="http://www.gnu.org/software/gettext/" target="_top">Gettext</a> (<span class="command"><strong>msggrep</strong></span>, <span class="command"><strong>msgfilter</strong></span>, <span class="command"><strong>msgattrib</strong></span>...), or from <a class="ulink" href="http://translate.sourceforge.net/wiki/toolkit/index" target="_top">Translate Toolkit</a> (<span class="command"><strong>pocount</strong></span>, <span class="command"><strong>pogrep</strong></span>, <span class="command"><strong>pofilter</strong></span>...).</p>
<p>Pology also provides a per-message batch-processing tool, the <span class="command"><strong>posieve</strong></span>. What was the need for it, given the myriad of other previously available and powerful tools? In accordance with philosophy of Pology, <span class="command"><strong>posieve</strong></span> goes deeper than these other tools. <span class="command"><strong>posieve</strong></span> makes easy that which is possible but awkward by combining generic command line tools. <span class="command"><strong>posieve</strong></span> is modular from the ground up, such that it is never a design problem to add new functionality to it, even when it is of narrow applicability. Users who know some Python can even write own "plugins" for it. Several processing modules can be applied in a single run of <span class="command"><strong>posieve</strong></span>, possibly affecting each other, in ways not possible by generic shell piping and not requiring temporary intermediate files.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svbasics" id="sec-svbasics"></a>3.1.&nbsp;Basic Usage of <span class="command"><strong>posieve</strong></span></h2>
</div>
</div>
</div>
<p>The <span class="command"><strong>posieve</strong></span> script itself is actually a simple shell which applies various processing modules, called <span class="emphasis"><em>sieves</em></span>, to every message in one or more PO files. Some sieves can also request to operate on the header of the PO file, which <span class="command"><strong>posieve</strong></span> will then feed to them. A sieve can only examine but also modify messages; if any message is modified, by default the modified PO file will be written out in place. Naturally, <span class="command"><strong>posieve</strong></span> has a number of options, but more interestingly, each sieve can define some parameters which determine its behavior. Pology comes with many internal sieves, which do things from general to obscure (possibly language or project specific), and users can define their own sieves.</p>
<p>Here is how you would run the <a class="link" href="#sv-stats" title="3.5.30.&nbsp;stats"><span class="command"><strong>stats</strong></span></a> sieve to collect statistics on all PO files in <code class="filename">frobaz/</code> directory:</p>
<pre class="programlisting">
$ posieve stats frobaz/
</pre>
<p>While PO files in <code class="filename">frobaz/</code> are being processed, you will see a progress bar with the current file and the number of files to process, and after some time the <span class="command"><strong>stats</strong></span> sive will present its findings in a table.</p>
<p>The first non-option argument in the <span class="command"><strong>posieve</strong></span> command line is the sieve name, and then any number of directory or file paths can be specified. <span class="command"><strong>posieve</strong></span> will consider file path arguments to be PO files, and recursively search directory paths to collect all files ending with <code class="filename">.po</code> or <code class="filename">.pot</code>. If no paths are specified, PO files to process will be collected from the current working directory.</p>
<p>If the sieve modifies a message and the new PO file is written out in place of the old, the user will be informed by an exclamation mark followed by the file path. An example of a sieve which modifies messages is the <a class="link" href="#sv-tag-untranslated" title="3.5.31.&nbsp;tag-untranslated"><span class="command"><strong>tag-untranslated</strong></span></a> sieve; it adds the <code class="literal">untranslated</code> flag to every untranslated message, so that you can look them up in a plain text editor (as opposed to <a class="link" href="#sec-poedlist" title="2.7.1.&nbsp;List of PO Editors">dedicated PO editor</a>):</p>
<pre class="programlisting">
$ posieve tag-untranslated frobaz/
! frobaz/alfa.po
! frobaz/bravo.po
! frobaz/charlie.po
Tagged 42 untranslated messages.
</pre>
<p><span class="command"><strong>posieve</strong></span> itself tracks message modifications and informs about modified PO files, whereas the final line in this example has been output by the <span class="command"><strong>tag-untranslated</strong></span> sieve. Sieves will frequently issue such final reports of their actions.</p>
<p>If a sieve defines some parameters to control its behavior, these can be issued using the <code class="option">-s</code>. This option takes the parameter specification as the argument, which is of the form <code class="literal"><em class="replaceable"><code>name</code></em>:<em class="replaceable"><code>value</code></em></code> or just <code class="literal"><em class="replaceable"><code>name</code></em></code> for switch-type parameters. More than one parameter can be issued by repeating the <code class="option">-s</code>. For example, the <span class="command"><strong>stats</strong></span> sieve can be instructed to take into account only messages with at most 5 words:</p>
<pre class="programlisting">
$ posieve stats -s maxwords:5 frobaz/
</pre>
<p>to show statistics in greater detail:</p>
<pre class="programlisting">
$ posieve stats -s detail frobaz/
</pre>
<p>or to ignore a certain accelerator marker and show bar-type statistics instead of tabular:</p>
<pre class="programlisting">
$ posieve stats -s accel:_ -s msgbar frobaz/
</pre>
<p><span class="command"><strong>posieve</strong></span> lists and shows descriptions of its options by the usual <code class="option">-h</code>/<code class="option">--help</code> option. Help for a sieve can be requested by issuing the <code class="option">-H</code>/<code class="option">--help-sieves</code> while a sieve name is present in the command line. All available internal sieves with short descriptions are listed using <code class="option">-l</code>/<code class="option">--list-sieves</code>.</p>
<p>Some sieves are language-specific, which can be seen by their names being of the form <span class="command"><strong><em class="replaceable"><code>langcode</code></em>:<em class="replaceable"><code>name</code></em></strong></span>. These sieves are primarily intendedfor use on PO files translated to indicated language, but depending on particularities, may be applicable to several more closely related languages. (A sieve which is doing language-specific things, but which is applicable to many languages, is more likely to be named as a general sieve.)</p>
<p>If <a class="link" href="#sec-cmshellcomp" title="9.1.&nbsp;Shell Completion">shell completion</a> is active, it can be used to complete sieve names and their parameters.</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svchains" id="sec-svchains"></a>3.2.&nbsp;Sieve Chains</h2>
</div>
</div>
</div>
<p>It is possible to issue several sieves at once, by passing a comma-separated list of sieve names to <span class="command"><strong>posieve</strong></span> in place of single sieve name. This is called a <span class="emphasis"><em>sieve chain</em></span>.</p>
<p>At minimum, chaining sieves is a performance improving measure, since each PO file is opened (and possibly written out) only once, instead of on each sieve run. For example, you can in one run compute the statistics to see how many messages need to be update and tag all untranslated messages:</p>
<pre class="programlisting">
$ posieve stats,tag-untranslated frobaz/
! frobaz/alfa.po
! frobaz/bravo.po
! frobaz/charlie.po
... (table with statistics) ...
Tagged 42 untranslated messages.
</pre>
<p>A message in the PO file is passed through each sieve in turn, in the order in which they are issued, before proceding to the next message. If a sieve modifies the message, the next sieve in the chain will operate on that modified version of the message. This means that the ordering of sieves in the command line is significant in general, and that it is interchangable only if the sieves in the chain are independent of each other (as in this example). Chain order also determines the order in which sieve reports are shown; if in this example the order had been <code class="literal">tag-untranslated,stats</code>, then first the tagged messages line would be written out, followed by the statistics table.</p>
<p>Other than for performance, sieve chains are useful when messages should be modified in a particular way before a sieve gets to operate on it. A good example is when statistics is to be computed on PO files which contain old <a class="link" href="#p-embctxt">embedded contexts</a>, where if nothing would be done, contexts would add to the word count of the original text. To avoid this, a <a class="link" href="#sv-normctxt-sep" title="3.5.22.&nbsp;normctxt-sep">context normalization</a> sieve (which converts embedded contexts to <code class="varname">msgctxt</code>) can be chained with statistics sieve, and the <span class="command"><strong>posieve</strong></span> instructed not to write modifications to the PO file. If the embedded context is of the single-separator type, with separator character <code class="literal">|</code>, the sieve chain is:</p>
<pre class="programlisting">
$ posieve --no-sync normctxt-sep,stats -s sep:'|' frobaz/
Converted 21 separator-embedded contexts.
... (table with statistics) ...
</pre>
<p>The <code class="option">--no-sync</code> option prevents writing modified messages in the PO file on disk. Note that <code class="literal">|</code> as parameter value is quoted, because it would be interpreted as a shell pipe otherwise.</p>
<p>Finally, some sieves can stop messages from being pushed further through the sieve chain, so they can be used as a prefilter to other sieves. The archetypal example of this the <a class="link" href="#sv-find-messages" title="3.5.17.&nbsp;find-messages"><span class="command"><strong>find-messages</strong></span></a>, which stops non-matched messages from further sieving. For example, to include into statistics only the messages containing the word "quasar", this would be executed:</p>
<pre class="programlisting">
$ posieve find-messages,stats -s msgid:quasar -s nomsg
Found 12 messages satisfying the conditions.
... (table with statistics) ...
</pre>
<p>The <code class="option">msgid:</code> parameter specifies the word (actually, a regular expression) to be looked up in the original text, while <code class="option">nomsg</code> parameter tells <span class="command"><strong>find-messages</strong></span> not to write out matched messages to standard output, which it would by default do. Note that no path was specified, meaning that all PO files in current working directory and below will be sieved.</p>
<p>Examples of sieve chaining so far should have raised the following question: when several sieves are issued, to which of them are the parameters specified by <code class="option">-s</code> options passed? The answer is that a parameter is sent to all sieves which accept parameter of that name. Continuing the previous example, if message texts can contain accelerator marker <code class="literal">&amp;</code>, this would be specified like this:</p>
<pre class="programlisting">
$ posieve find-messages,stats -s msgid:quasar -s nomsg -s accel:'&amp;'
</pre>
<p><span class="command"><strong>find-messages</strong></span> will accept <code class="option">accel</code> in order to also match messages like <code class="literal">"Charybdis Q&amp;uasar"</code>, while <span class="command"><strong>stats</strong></span> will use it to properly split text into words for counting them.</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svoptions" id="sec-svoptions"></a>3.3.&nbsp;Command Line Options</h2>
</div>
</div>
</div>
<p>Options specific to <span class="command"><strong>posieve</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-a</code>, <code class="option">--announce-entry</code></span></dt>
<dd>
<p>A sieve may be buggy and crash or keep <span class="command"><strong>posieve</strong></span> in infinite loop on a particular PO entry (header or message). When this option is given, each PO entry will be announced before sieving it, so that you can see exactly where the problem occurs.</p>
</dd>
<dt><span class="term"><code class="option">-b</code>, <code class="option">--skip-obsolete</code></span></dt>
<dd>
<p>By default <span class="command"><strong>posieve</strong></span> will process all messages in the PO file, including the obsolete. Sometimes sieving obsolete messages is not desired, for example when running translation validation sieves. This option can then be used to skip obsolete messages.</p>
</dd>
<dt><span class="term"><code class="option">-c</code>, <code class="option">--msgfmt-check</code></span></dt>
<dd>
<p>For <span class="command"><strong>posieve</strong></span> to process the PO file, it is only necessary that basic PO syntax is valid, i.e. that <span class="command"><strong>msgfmt</strong></span> can compile the file. <span class="command"><strong>msgfmt</strong></span> also offers stricter validation mode: to have <span class="command"><strong>posieve</strong></span> run this stricter validation on the PO file, issue this option. Invalid files will be reported and will not be sieved.</p>
</dd>
<dt><span class="term"><code class="option">--force-sync</code></span></dt>
<dd>
<p>When some messages in the PO file are modified, by default only those messages will be reformatted (e.g. strings wrapped as selected) when the PO file is modified on disk. This makes <span class="command"><strong>posieve</strong></span> friendly to version control systems. Sometimes, however, you may want that all messages are reformatted, modified or not, and then you can issue this option.</p>
</dd>
<dt><span class="term"><code class="option">-h</code>, <code class="option">--help</code></span></dt>
<dd>
<p>General help on <span class="command"><strong>posieve</strong></span>.</p>
</dd>
<dt><span class="term"><code class="option">-H</code>, <code class="option">--help-sieves</code></span></dt>
<dd>
<p><code class="option">-h</code>/<code class="option">--help</code> shows only description of <span class="command"><strong>posieve</strong></span> and its options, while this option shows the descriptions and available parameters of issued sieves. For example:</p>
<pre class="programlisting">
$ posieve find-messages,stats -H
</pre>
<p>would output help for <span class="command"><strong>find-messages</strong></span> and <span class="command"><strong>stats</strong></span> sieves.</p>
</dd>
<dt><span class="term"><code class="option">--issued-params</code></span></dt>
<dd>
<p>List of all sieve parameters and their values that would be issued. Used to check <a class="link" href="#p-svparconfcmd">the interplay of command line and configuration</a> on sieve parameters.</p>
</dd>
<dt><span class="term"><code class="option">-l</code>, <code class="option">--list-sieves</code></span></dt>
<dd>
<p>List of all internal sieves, with short descriptions.</p>
</dd>
<dt><span class="term"><code class="option">--list-options</code>; <code class="option">--list-sieve-names</code>; <code class="option">--list-sieve-params</code></span></dt>
<dd>
<p>Simple listings of global options, internal sieve names, and parameters of issued sieves. Intended mainly for writting shell completion definitions.</p>
</dd>
<dt><span class="term"><code class="option">-m <em class="replaceable"><code>OUTFILE</code></em></code>, <code class="option">--output-modified=<em class="replaceable"><code>OUTFILE</code></em></code></span></dt>
<dd>
<p>If some PO files were modified by sieving, you may want to follow up with a command to process only those files. <span class="command"><strong>posieve</strong></span> will by default output the paths of modified PO files, but also other information, which makes parsing this output for modified paths ungainly. Instead, this option can be used to specify a file to which path of all modified PO files will be written to, one per line.</p>
</dd>
<dt><span class="term"><code class="option">--no-skip</code></span></dt>
<dd>
<p>If a sieve reports an error, <span class="command"><strong>posieve</strong></span> normally skips the problematic message and continues sieving the rest of the PO file, if possible. This is sometimes not desired, when this option will tell <span class="command"><strong>posieve</strong></span> to abort with an error message in such cases.</p>
</dd>
<dt><span class="term"><code class="option">--no-sync</code></span></dt>
<dd>
<p>All messages modified by sieves are by default written back to disk, i.e. their PO files modifed. This option prevents modification of PO files. This comes handy in two cases. One is when you want to check what effect a modifying sieve will have before actually accepting it (a "dry" run). The other case is when you use a modifying sieve as a filter for the next sieve in chain, which only needs to examine messages.</p>
</dd>
<dt><span class="term"><code class="option">-q</code>, <code class="option">--quiet</code></span></dt>
<dd>
<p><span class="command"><strong>posieve</strong></span> normally shows the progress of sieving, which can be cancelled by this option. (Sieves will still output their own lines.)</p>
</dd>
<dt><span class="term"><code class="option">-s <em class="replaceable"><code>PARAM</code></em>[:<em class="replaceable"><code>VALUE</code></em>]</code></span></dt>
<dd>
<p>The central option of <span class="command"><strong>posieve</strong></span>, which is used to issue parameters to sieves.</p>
</dd>
<dt><span class="term"><code class="option">-S <em class="replaceable"><code>PARAM</code></em></code></span></dt>
<dd>
<p>When a sieve parameter is issued <a class="link" href="#p-confsvpar">through user configuration</a>, this option can be used to cancel it for one particular run.</p>
</dd>
<dt><span class="term"><code class="option">--version</code></span></dt>
<dd>
<p>Release and copyright information on <span class="command"><strong>posieve</strong></span>.</p>
</dd>
<dt><span class="term"><code class="option">-v</code>, <code class="option">--verbose</code></span></dt>
<dd>
<p>More verbose output, where <span class="command"><strong>posieve</strong></span> shows the sieving modes, lists files which are being sieved, etc.</p>
</dd>
</dl>
</div>
<p>Options common with other Pology tools:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-F FILE</code>, <code class="option">--files-from=FILE</code></span></dt>
<dd>
<p>See <a class="xref" href="#sec-cmffrom" title="9.5.&nbsp;Reading Paths From a File">Section&nbsp;9.5, “Reading Paths From a File”</a>.</p>
</dd>
<dt><span class="term"><code class="option">-e REGEX</code>, <code class="option">--exclude-name=REGEX</code>; <code class="option">-E REGEX</code>, <code class="option">--exclude-path=REGEX</code>; <code class="option">-i REGEX</code>, <code class="option">--include-name=REGEX</code>; <code class="option">-I REGEX</code>, <code class="option">--include-path=REGEX</code></span></dt>
<dd>
<p>See <a class="xref" href="#sec-cmincexc" title="9.4.&nbsp;Path Inclusion and Exclusion">Section&nbsp;9.4, “Path Inclusion and Exclusion”</a>.</p>
</dd>
<dt><span class="term"><code class="option">-R</code>, <code class="option">--raw-colors</code>; <code class="option">--coloring-type</code></span></dt>
<dd>
<p>See <a class="xref" href="#sec-cmcolors" title="9.6.&nbsp;Output Coloring">Section&nbsp;9.6, “Output Coloring”</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svconfig" id="sec-svconfig"></a>3.4.&nbsp;User Configuration</h2>
</div>
</div>
</div>
<p>The following <a class="link" href="#sec-cmconfig" title="9.2.&nbsp;User Configuration">configuration</a> fields can be used to modify general behavior of <span class="command"><strong>posieve</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[posieve]/skip-on-error=[*yes|no]</code></span></dt>
<dd>
<p>Setting to <code class="literal">no</code> is counterpart to <code class="option">--no-skip</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[posieve]/msgfmt-check=[yes|*no]</code></span></dt>
<dd>
<p>Setting to <code class="literal">yes</code> is counterpart to <code class="option">-c</code>/<code class="option">--msgfmt-check</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[posieve]/skip-obsolete=[yes|*no]</code></span></dt>
<dd>
<p>Setting to <code class="literal">yes</code> is counterpart to <code class="option">-b</code>/<code class="option">--skip-obsolete</code> command line option.</p>
</dd>
</dl>
</div>
<p>For configuration fields that have counterpart command line options, the command line option always takes precedence if issued.</p>
<p><a name="p-confsvpar" id="p-confsvpar"></a>Configuration can also be used to issue sieve parameters, by specifying <code class="literal">[posieve]/param-<em class="replaceable"><code>name</code></em></code> fields. For example, parameters <code class="option">transl</code> (a switch) and <code class="option">accel</code> (with value <code class="literal">&amp;</code>) are issued to all sieves that accept them by writing:</p>
<pre class="programlisting">
[posieve]
param-transl = yes
param-accel = &amp;
</pre>
<p>To issue parameters only to certain sieves, parameter name can be followed by a sieve list of the form <code class="literal">/<em class="replaceable"><code>sieve1</code></em>,<em class="replaceable"><code>sieve2</code></em>,...</code>; to <span class="emphasis"><em>prevent</em></span> the parameter from being issued only to certain sieves, prepend <code class="literal">~</code> to the sieve list. For example:</p>
<pre class="programlisting">
[posieve]
param-transl/find-messages = yes  # only for find-messages
param-accel/~stats = &amp;            # not for stats
</pre>
<p>Same parameters can sometimes be repeated in the command line, when it is logically meaningfull to provide several values of that type to a sieve. However, same-name fields cannot be used in configuration to supply several values, because they override each other. Instead, a dot and a unique string (within the sequence) can be appended to the parameter name to make it a unique configuration field:</p>
<pre class="programlisting">
[posieve]
param-accel.0 = &amp;
param-accel.1 = _
</pre>
<p>Strings after the dot can be anything, but a sequence of numbers or letters in alphabetical order is the least confusing choice.</p>
<p><a name="p-svparconfcmd" id="p-svparconfcmd"></a>Sieve parameters should be issued from the configuration only as a matter of convenience, when they are almost always used in sieve runs. But occasionaly the parameter issued from the configuration is not appropriate for the given run. Instead of going to configuration and commenting the parameter out temporarily, it can be cancelled in the command line using the <code class="option">-S</code> option (note capital S) followed by the parameter name. You can use <code class="option">--issued-params</code> option to confirm which parameters will be issued after both the command line and the configuration have been taken into account.</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svinternal" id="sec-svinternal"></a>3.5.&nbsp;Internal Sieves</h2>
</div>
</div>
</div>
<p>This section describes the sieves which are contained in Pology distribution and provides instruction for their use.</p>
<p>Parameters which take a value (which are not switches) may or may not have a default value, and when they do, it will be given in square brackets (<code class="literal">[...]</code>) in the header.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-apply-filter" id="sv-apply-filter"></a>3.5.1.&nbsp;<span class="command"><strong>apply-filter</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>apply-filter</strong></span> is used to pipe translation through one or several <span class="emphasis"><em>hooks</em></span> (see <a class="xref" href="#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">Section&nbsp;9.10, “Processing Hooks”</a>). The hooks may modify the translation, validate it, or do something else. More precisely, the following hook types are applicable:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>F1A, F3A, F3C, to modify the translation and write changes back to the PO file;</p>
</li>
<li class="listitem">
<p>V1A, V3A, V3C, to validate the translation, with standard validation output (highlighted spans and problem messages);</p>
</li>
<li class="listitem">
<p>S1A, S3A, S3C, for any side-effect processing on translation (but no modification).</p>
</li>
</ul>
</div>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">filter:<em class="replaceable"><code>hookspec</code></em></code></span></dt>
<dd>
<p>The hook specification. Can be repeated to add several hooks, which are then applied in the order of specification.</p>
</dd>
<dt><span class="term"><code class="option">showmsg</code></span></dt>
<dd>
<p>Report every modified message to standard output. (For validation hooks, message is automatically reported if not valid.)</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-apply-header-filter" id="sv-apply-header-filter"></a>3.5.2.&nbsp;<span class="command"><strong>apply-header-filter</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>apply-header-filter</strong></span> is the counterpart to <span class="command"><strong>apply-filter</strong></span> to operate on headers instead of messages. Here the applicable hook types are accordingly F4B, V4B, S4B.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">filter:<em class="replaceable"><code>hookspec</code></em></code></span></dt>
<dd>
<p>The hook specification. Can be repeated to add several hooks, which are then applied in the order of specification.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-bad-patterns" id="sv-bad-patterns"></a>3.5.3.&nbsp;<span class="command"><strong>bad-patterns</strong></span></h3>
</div>
</div>
</div>
<p>Sometimes it is possible to use simple pattern matching to discover things that should never appear in the text, such as common grammar or orthographical errors. <span class="command"><strong>bad-patterns</strong></span> can apply such patterns to translation, either as plain substring matching or <a class="link" href="#sec-cmregex" title="9.3.&nbsp;Regular Expressions">regular expressions</a>. Patterns can be given as parameters, or more conveniently, read from files.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">pattern:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>The pattern to search for. Can be repeated to search for several patterns.</p>
</dd>
<dt><span class="term"><code class="option">fromfile:<em class="replaceable"><code>path</code></em></code></span></dt>
<dd>
<p>Read patterns to search for from the file. Each line contains one pattern. If line starts with <code class="literal">#</code>, it is treated as comment. Empty lines are ignored. Trailing and leading whitespace is removed from patterns; if it is significant, it can be given inside <code class="literal">[...]</code> regex operator. This parameter can be repeated to read patterns from several files.</p>
</dd>
<dt><span class="term"><code class="option">rxmatch</code></span></dt>
<dd>
<p>By default patterns are treated as plain substrings. This parameter requests to treat patterns as regular expressions.</p>
</dd>
<dt><span class="term"><code class="option">casesens</code></span></dt>
<dd>
<p>By default patterns are case-sensitive. This parameter make them case-insensitive.</p>
</dd>
</dl>
</div>
<div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Caution</h3>
<p>This sieve is deprecated. Use <a class="link" href="#sv-check-rules" title="3.5.7.&nbsp;check-rules"><span class="command"><strong>check-rules</strong></span></a> instead, which applies Pology's <a class="link" href="#sec-lgrules" title="8.5.&nbsp;Validation Rules">validation rules</a>.</p>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-docbook4" id="sv-check-docbook4"></a>3.5.4.&nbsp;<span class="command"><strong>check-docbook4</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-docbook4</strong></span> checks PO files extracted from Docbook 4.x files. Docbook is an XML format, typically used for documenting software.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">showmsg</code></span></dt>
<dd>
<p>Instead of just showing the message location and problem description, also show the complete message with problematic segments higlighted.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
</dl>
</div>
<p>Currently performed checks:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Markup validity. Docbook is a complex XML format, and nothing short of full validation of XML files generated from translated PO files can show if the translation is technically valid. Therefore <span class="command"><strong>check-docbook4</strong></span> checks only well-formedness, whether tags are defined by Docbook, and some nesting constraints, and that on the level of single message. But this is already enough to catch great majority of usual translation errors.</p>
<p>This check can be skipped on a message by adding to it the <code class="literal">no-check-markup</code> <a class="link" href="#p-trflag">translator flag</a>.</p>
</li>
<li class="listitem">
<p>Message insertion placeholders. Some extractors of Docbook split out into standalone messages contextually separate units that are found in the middle of flowing paragraphs (e.g. footnotes). When that happens, a special placeholder is left in the originating message, so that the markup can be reconstructed when the translated Docbook file is built. Such placeholders must be carried into translation.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-grammar" id="sv-check-grammar"></a>3.5.5.&nbsp;<span class="command"><strong>check-grammar</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-grammar</strong></span> checks translation with LanguageTool, an open source grammar and style checker (<a class="ulink" href="http://www.languagetool.org/" target="_top">http://www.languagetool.org/</a>). LanguageTool supports a number of languages to greater or smaller extent, which you can check on <a class="ulink" href="http://www.languagetool.org/languages/" target="_top">its web site</a>.</p>
<p>LanguageTool can be run as standalone program or in client-server mode, and this sieve expects the latter. This means that LanguageTool has to be up and running before this sieve is run. Messages in which problems are discovered are reported to standard output.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">lang:<em class="replaceable"><code>code</code></em></code></span></dt>
<dd>
<p>The language code for which to apply the rules. If not given, it will be read from each PO file in turn, and if not found there either, an error will be signaled.</p>
</dd>
<dt><span class="term"><code class="option">host:<em class="replaceable"><code>hostname</code></em></code> [<code class="literal">localhost</code>]</span></dt>
<dd>
<p>Name of the host where the LanguageTool server is running. The default value of <code class="literal">localhost</code> means that it is running on the same computer where the sieve is run.</p>
</dd>
<dt><span class="term"><code class="option">port:<em class="replaceable"><code>number</code></em></code> [<code class="literal">8081</code>]</span></dt>
<dd>
<p>TCP port of the host on which the LanguageTool server listens for queries.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-kde4" id="sv-check-kde4"></a>3.5.6.&nbsp;<span class="command"><strong>check-kde4</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-kde4</strong></span> checks PO files extracted from program code based on KDE4 library and its translation system. Note that this really means what it says; this sieve should <span class="emphasis"><em>not</em></span> be used to check just any PO file which happens to be part of the KDE project (e.g. PO files covering .desktop files, pure Qt code, etc.).</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">strict</code></span></dt>
<dd>
<p>Partly due to historical reasons, and partly due to programmers being sloppy, the original text itself is sometimes not valid by some checks. By default, when the original is not valid, the translation is not expected to be valid either, i.e. it is not checked. This parameter requires that the translation is always checked, regardless of the validity of the original (problems can almost always be avoided in the translation).</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
</dl>
</div>
<p>Currently performed checks:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Markup validity. KDE4 messages can contain a mix of <a class="ulink" href="http://techbase.kde.org/Development/Tutorials/Localization/i18n_Semantics" target="_top">KUIT</a> and <a class="ulink" href="http://doc.qt.nokia.com/4.6/richtext-html-subset.html" target="_top">Qt rich text</a> markup. Although Qt rich text does not have to be well-formed in XML sense, this check expects well-formedness to be preserved in translation if the original is such (also see the <code class="option">strict</code> parameter).</p>
<p>This check can be skipped on a message by adding to it the <code class="literal">no-check-markup</code> <a class="link" href="#p-trflag">translator flag</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-rules" id="sv-check-rules"></a>3.5.7.&nbsp;<span class="command"><strong>check-rules</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-rules</strong></span> applies language- and project-dependent Pology <span class="emphasis"><em>validation rules</em></span> to translation. See <a class="xref" href="#sec-lgrules" title="8.5.&nbsp;Validation Rules">Section&nbsp;8.5, “Validation Rules”</a> for detailed discussion on writing and applying rules.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">lang:<em class="replaceable"><code>code</code></em></code></span></dt>
<dd>
<p>The language code for which to apply the rules. If not given, it will be each PO file in turn, and if not found there either, an will be signaled.</p>
</dd>
<dt><span class="term"><code class="option">env:<em class="replaceable"><code>environment&gt;</code></em></code></span></dt>
<dd>
<p>The language environment for which to apply the rules (see <a class="xref" href="#sec-lglangenv" title="8.1.&nbsp;The Notion of Language in Pology">Section&nbsp;8.1, “The Notion of Language in Pology”</a>). Several environments can be given as comma-separated list, in which case the later environment in the list takes precedence on conflicted rules. If not given, it may also be read from PO files (see <a class="link" href="#hdr-x-environment"><code class="literal">X-Environment</code></a> in <a class="xref" href="#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>).</p>
</dd>
<dt><span class="term"><code class="option">envonly</code></span></dt>
<dd>
<p>When language environment is given, only the rules explicitly belonging to it are applied, while general rules for the selected language are ignored.</p>
</dd>
<dt><span class="term"><code class="option">rule:<em class="replaceable"><code>identifiers</code></em></code></span></dt>
<dd>
<p>Comma-separated list of rule identifiers, to apply only those rules. If a rule selected in this way is disabled in its definition, this enables it.</p>
</dd>
<dt><span class="term"><code class="option">rulerx:<em class="replaceable"><code>regexes</code></em></code></span></dt>
<dd>
<p>Like <code class="option">rule</code>, but the values are interpreted as regular expressions by which to match rule identifiers.</p>
</dd>
<dt><span class="term"><code class="option">norule:<em class="replaceable"><code>identifiers</code></em></code></span></dt>
<dd>
<p>Inverse of the <code class="option">rule</code> parameter: selected rules are not applied, and all other are applied.</p>
</dd>
<dt><span class="term"><code class="option">norulerx:<em class="replaceable"><code>regexes</code></em></code></span></dt>
<dd>
<p>Inverse of the <code class="option">rulerx</code> parameter: selected rules are not applied, and all other are applied.</p>
</dd>
<dt><span class="term"><code class="option">stat</code></span></dt>
<dd>
<p>Rules can take time to apply to all sieved PO files, and this parameter requests to write out some statistics of rule application at the end of sieving.</p>
</dd>
<dt><span class="term"><code class="option">accel:<em class="replaceable"><code>characters</code></em></code></span></dt>
<dd>
<p>Characters to consider as <a class="link" href="#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator markers</a>. If not given, they may be read from sieved PO files. Note that this parameter in itself does nothing: it only makes it possible for a particular rule or group of rules to remove the accelerator before matching.</p>
</dd>
<dt><span class="term"><code class="option">markup:<em class="replaceable"><code>types</code></em></code></span></dt>
<dd>
<p>The type of text markup used in messages, by keyword. It can also be a comma-separated list of keywords. If not given, it may be read from sieved PO files. See description of <a class="link" href="#hdr-x-text-markup"><code class="literal">X-Text-Markup</code></a> in <a class="xref" href="#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a> for the list of markup keywords currently known to Pology. Similarly to <code class="option">accel</code> parameter, this parameter only enables rules to remove the markup (or do something else) before matching.</p>
</dd>
<dt><span class="term"><code class="option">xml:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>By default, messages failed by rules are reported to standard output, and this parameter requests that they be written into a custom (but simple) XML format. This also causes results to be cached: on subsequent runs of <span class="command"><strong>check-rules</strong></span> only modified PO files will be checked again, and results for non-modified files will be pulled from the cache. The cache can be found in <code class="filename">$HOME/.pology-check_rules-cache/</code> directory.</p>
</dd>
<dt><span class="term"><code class="option">rfile:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>By default internal Pology rules are applied, and this parameter can be used to apply external rules instead, defined in the given rule file.</p>
</dd>
<dt><span class="term"><code class="option">rdir:<em class="replaceable"><code>directory</code></em></code></span></dt>
<dd>
<p>Like <code class="option">rfile</code>, but external rules are read from a directory containing any number of rule files.</p>
</dd>
<dt><span class="term"><code class="option">branch:<em class="replaceable"><code>branch</code></em></code></span></dt>
<dd>
<p>Apply rules only to messages from given branch (<a class="link" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">summit</a>). Several branches may be given as comma-separated list.</p>
</dd>
<dt><span class="term"><code class="option">showfmsg</code></span></dt>
<dd>
<p>Rules are sometimes applied to the filtered instead of the original message, and when such message is failed, it may not be obvious what triggered the rule. This parameter requests that the filtered message is written out too when the original message is reported.</p>
</dd>
<dt><span class="term"><code class="option">nomsg</code></span></dt>
<dd>
<p>When a message is failed, by default it is output in full together with the problem description. This parameter requests that only the problem description is output.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
<dt><span class="term"><code class="option">mark</code></span></dt>
<dd>
<p>To each failed message a <code class="literal">failed-rule</code> flag is added, modifying the PO file. Modified files can then be opened in the editor, and failed messages looked up by this flag.</p>
</dd>
</dl>
</div>
<p>One or more rules can be disabled on a particular message in the PO file itself, by adding a special translator comment that starts with <code class="literal">skip-rule:</code> and continues with comma-separated list of rule identifiers:</p>
<pre class="programlisting">
# skip-rule: <em class="replaceable"><code>ruleid1</code></em>, <em class="replaceable"><code>ruleid2</code></em>, ...
</pre></div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-spell" id="sv-check-spell"></a>3.5.8.&nbsp;<span class="command"><strong>check-spell</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-spell</strong></span> checks spelling of translation by splitting it into words and passing them through GNU Aspell (<a class="ulink" href="http://aspell.net/" target="_top">http://aspell.net/</a>). This sieve is a more specific counterpart to <a class="link" href="#sv-check-spell-ec" title="3.5.9.&nbsp;check-spell-ec"><span class="command"><strong>check-spell-ec</strong></span></a>, which exposes some options specific to Aspell and requires no external Python modules, only the Aspell installation. Also read <a class="xref" href="#sec-lgspell" title="8.2.&nbsp;Spell Checking">Section&nbsp;8.2, “Spell Checking”</a> for details on spell-checking in Pology.</p>
<p><span class="command"><strong>check-spell</strong></span> behaves mostly the same as <span class="command"><strong>check-spell-ec</strong></span>, and accepts all the same parameters with same meanings; the exception is the <code class="option">provider</code> parameter, which is not present here since Aspell is the fixed provider. Only the parameters specific to this sieve are described in the following:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">enc:<em class="replaceable"><code>encoding</code></em></code></span></dt>
<dd>
<p>The encoding in which the text should be sent to Aspell.</p>
</dd>
<dt><span class="term"><code class="option">var:<em class="replaceable"><code>variety</code></em></code></span></dt>
<dd>
<p>The variety of the Aspell dictionary, if any.</p>
</dd>
<dt><span class="term"><code class="option">xml:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>By default, messages with unknown words are reported to standard output, and this parameter requests that they be written into a custom (but simple) XML format.</p>
</dd>
</dl>
</div>
<p>Aspell can be configured for use in Pology through user configuration, so that it is not necessary to issue some parameters on every run. See <a class="xref" href="#sec-cmcfgaspell" title="9.2.3.&nbsp;The [aspell] section">Section&nbsp;9.2.3, “The <code class="literal">[aspell]</code> section”</a>.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-spell-ec" id="sv-check-spell-ec"></a>3.5.9.&nbsp;<span class="command"><strong>check-spell-ec</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>check-spell-ec</strong></span> uses the Enchant library (<a class="ulink" href="http://www.abisource.com/projects/enchant/" target="_top">http://www.abisource.com/projects/enchant/</a>) through PyEnchant Python module (<a class="ulink" href="http://pyenchant.sourceforge.net" target="_top">http://pyenchant.sourceforge.net</a>) to provide uniform access to different spell-checkers, such as Aspell, Ispell, Hunspell, etc. Translation is first split into words, possibly eliminating markup and other literal content, and the words are then fed to spell-checker. Messages containing unknown words are reported to standard output, with list of replacement suggestions.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">provider:<em class="replaceable"><code>keyword</code></em></code></span></dt>
<dd>
<p>The spell-checker that Enchant should use. The value is one of keywords defined by Enchant (e.g. <code class="literal">aspell</code>, <code class="literal">hunspell</code>...), and can be seen by running <span class="command"><strong>enchant-lsmod</strong></span> command (only providers available on the system are shown). If not given either by this parameter or in user configuration, Enchant will try to select a provider on its own.</p>
</dd>
<dt><span class="term"><code class="option">lang:<em class="replaceable"><code>code</code></em></code></span></dt>
<dd>
<p>The language code for which the spelling is checked. If not given, it will be read from each PO file in turn, and if not found there either, an error will be signaled.</p>
</dd>
<dt><span class="term"><code class="option">env:<em class="replaceable"><code>environment&gt;</code></em></code></span></dt>
<dd>
<p>The language environment for which to include supplemental dictionaries (see <a class="xref" href="#sec-lglangenv" title="8.1.&nbsp;The Notion of Language in Pology">Section&nbsp;8.1, “The Notion of Language in Pology”</a>). Several environments can be given as comma-separated list, in which case the union of their dictionaries is used. If not given, environments may be read from PO files (see <a class="link" href="#hdr-x-environment"><code class="literal">X-Environment</code></a> in <a class="xref" href="#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>) or from user configuration.</p>
</dd>
<dt><span class="term"><code class="option">accel:<em class="replaceable"><code>characters</code></em></code></span></dt>
<dd>
<p>Characters to consider as <a class="link" href="#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator markers</a>, to remove them before splitting text into words. If not given, they may be read from PO files (see <a class="link" href="#hdr-x-accelerator-marker"><code class="literal">X-Acclerator-Marker</code></a> in <a class="xref" href="#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>).</p>
</dd>
<dt><span class="term"><code class="option">markup:<em class="replaceable"><code>types</code></em></code></span></dt>
<dd>
<p>The type of text markup used in messages, by keyword. It can also be a comma-separated list of keywords. If not given, it may be read from PO files (see <a class="link" href="#hdr-x-text-markup"><code class="literal">X-Text-Markup</code></a> in <a class="xref" href="#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>; there the list of markup keywords currently known to Pology is given as well).</p>
</dd>
<dt><span class="term"><code class="option">skip:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Words matched by this regular expression are not sent to spell-checker.</p>
</dd>
<dt><span class="term"><code class="option">filter:<em class="replaceable"><code>hookspec</code></em></code></span></dt>
<dd>
<p>The hook to modify the text before splitting into words and spell-checking them (see <a class="xref" href="#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">Section&nbsp;9.10, “Processing Hooks”</a>). The hook type must be F1A, F3A, or F3C. The parameter can be repeated to add several hooks, which are then applied in the order of specification.</p>
</dd>
<dt><span class="term"><code class="option">suponly</code></span></dt>
<dd>
<p>By default, internal supplemental spelling dictionaries are added to the system dictionary of the selected spell-checker. This parameter can be issued to instead use only internal dictionaries and not the system dictionary.</p>
</dd>
<dt><span class="term"><code class="option">list</code></span></dt>
<dd>
<p>By default, when an unknown word is found, the complete message is output, with the problematic word highlighted and possibly the replacement suggestions. With this parameter, only a plain sorted list of unknown words, one per line, is output at the end of sieving. This is useful when a lot of false positives are expected, to quickly add them to the supplemental dictionary.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on messages containing unknown words in Lokalize.</p>
</dd>
</dl>
</div>
<p><span class="command"><strong>check-spell-ec</strong></span> may be told to skip checking specific messages and words, and it may use internal supplemental spelling dictionaries. See <a class="xref" href="#sec-lgspell" title="8.2.&nbsp;Spell Checking">Section&nbsp;8.2, “Spell Checking”</a> for these and other details on spell-checking in Pology.</p>
<p>Enchant can be configured for use in Pology through user configuration, so that it is not necessary to issue some parameters on every run. See <a class="xref" href="#sec-cmcfgenchant" title="9.2.2.&nbsp;The [enchant] section">Section&nbsp;9.2.2, “The <code class="literal">[enchant]</code> section”</a>.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-tp-kde" id="sv-check-tp-kde"></a>3.5.10.&nbsp;<span class="command"><strong>check-tp-kde</strong></span></h3>
</div>
</div>
</div>
<p>The <a class="ulink" href="http://l10n.kde.org/" target="_top">KDE Translation Project</a> contains a great number of PO files extracted from various types of sources. This results in that for each message, there are things that the translation can, must or must not contain, for the translation to be technically valid. When run over PO files within the KDE TP, <span class="command"><strong>check-tp-kde</strong></span> will first try to determine the type of each message and then apply appropriate technical checks to it. Message type is determined based on file location, file header, message flags and contexts; even a particular message in a particular file may be checked for some very specific issue.</p>
<p><a name="p-techprob" id="p-techprob"></a>"Technical" issues are those which should be fixed regardless of the language and style of translation, because they can lead to loss of functionality, information or presentation to the user. For example, a technical issue would be badly paired XML tags in translation, when in the original they were well paired; a non-technical issue (and thus not checked) would be when the original ends with a certain punctuation, but translation does not -- whether such details are errors or not, depends on the target language and translation style.</p>
<p>For the sieve to function properly, it needs to detect the project subdirectory of each PO file up to topmost division within the branch, e.g. <code class="filename">messages/kdebase</code> <code class="filename">docmessages/kdegames</code>. This means that the local copy of the repository tree needs to follow the repository layout up to that point, e.g. <code class="filename">kde-trunk-ui/kdebase</code> and <code class="filename">kde-trunk-doc/kdegames</code> would not be valid local paths.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">strict</code></span></dt>
<dd>
<p>Sometimes the original text itself may not be valid against a certain check. When this is the case, by default the translation is not expected to be valid either, and the check is skipped. Issuing this parameter will force all checks on translation, regardless of whether the original is valid or not. It may still be possible to avoid some checks on those messages that just cannot be repared through translation, if those checks define their own mechanism of cancelation (like adding a special translator comment).</p>
</dd>
<dt><span class="term"><code class="option">check:<em class="replaceable"><code>keywords</code></em></code></span></dt>
<dd>
<p>Comma-separated list of checks to apply, by keyword, instead of all. Available checks are listed below.</p>
</dd>
<dt><span class="term"><code class="option">showmsg</code></span></dt>
<dd>
<p>By default, when the message does not pass a check, only its location and the problem are reported. This parameter requests that message is reported in total, possibly with problematic segments of translation highlighted.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
</dl>
</div>
<p>Currently available checks (keyword in parenthesis):</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>KDE4 markup checking (<code class="literal">kde4markup</code>).</p>
</li>
<li class="listitem">
<p>Qt markup checking (<code class="literal">qtmarkup</code>).</p>
</li>
<li class="listitem">
<p>Docbook markup checking (<code class="literal">dbmarkup</code>)</p>
</li>
<li class="listitem">
<p>HTML markup checking (<code class="literal">htmlmarkup</code>).</p>
</li>
<li class="listitem">
<p>No translation scripting in "dumb" messages (<code class="literal">nots</code>). Translations fetched at runtime by KDE4 translation system may use <a class="ulink" href="http://techbase.kde.org/Localization/Concepts/Transcript" target="_top">translation scripting</a>. This check will make sure that scripting is not attempted for other types of messages (used by Qt-only code, for .desktop files, etc.).</p>
</li>
<li class="listitem">
<p>Qt datetime format messages (<code class="literal">qtdt</code>). A message is considered to be in this format if it contains the string <code class="literal">qtdt-format</code> in its <code class="varname">msgctxt</code> string or among flags.</p>
</li>
<li class="listitem">
<p>Validity of translator credits (<code class="literal">trcredits</code>). PO files may contain meta-messages to input translator credits, which should have both valid translations on their own and some congruence between them.</p>
</li>
<li class="listitem">
<p>Query placeholders in Plasma runners (<code class="literal">plrunq</code>). Messages in Plasma runners may contain special query placeholder <code class="literal">:q:</code>, which should be present in translation too.</p>
</li>
<li class="listitem">
<p>File-specific checking (<code class="literal">catspec</code>). Certain messages in certain PO files have special validity requirements, and this check activates all such file-specific checks.</p>
</li>
</ul>
</div>
<p>All markup checks can be skipped on a message by adding the <code class="literal">no-check-markup</code> <a class="link" href="#p-trflag">translator flag</a>.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-check-tp-wesnoth" id="sv-check-tp-wesnoth"></a>3.5.11.&nbsp;<span class="command"><strong>check-tp-wesnoth</strong></span></h3>
</div>
</div>
</div>
<p>PO files of <a class="ulink" href="http://www.wesnoth.org/" target="_top">The Battle of Wesnoth</a> contain a mix of well-known and custom markup and format directives. <span class="command"><strong>check-tp-wesnoth</strong></span> heuristically determines the type of each message in a Wesnoth PO file and applies appropriate technical checks to it (where "technical" has the same meaning as in <a class="link" href="#p-techprob">the <span class="command"><strong>check-tp-kde</strong></span> sieve</a>).</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">check:<em class="replaceable"><code>keywords</code></em></code></span></dt>
<dd>
<p>Comma-separated list of checks to apply, by keyword, instead of all. Available checks are listed below.</p>
</dd>
<dt><span class="term"><code class="option">showmsg</code></span></dt>
<dd>
<p>Instead of just showing the message location and problem description, also show the complete message, possibly with higlighted problematic segments.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
</dl>
</div>
<p>Currently available checks (keyword in parenthesis):</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>().</p>
</li>
<li class="listitem">
<p>Stray context separators in translation (<code class="literal">ctxtsep</code>). Wesnoth is still embedding disambiguating context into <code class="varname">msgid</code>, by putting it in front of the actual text and separated by <code class="literal">^</code>. An unwary translator will sometimes mistakes such context for part of the original text, and translate it too.</p>
</li>
<li class="listitem">
<p>Congruence of WML interpolations (<code class="literal">interp</code>). WML interpolations look like <code class="literal">"...side $side_number is..."</code> and normally must match between the original and translation, or else the player would loose information. Only in very rare cases (e.g. some plurals and Markov chain generators) some interpolations may be missing in translation, and then they can be listed space-separated in a translator comment to silence the check:</p>
<pre class="programlisting">
# ignore-interpolations: <em class="replaceable"><code>interp1</code></em> <em class="replaceable"><code>interp2</code></em> ...
</pre>
<p>(the <code class="literal">$</code> character is not necessary in the list).</p>
</li>
<li class="listitem">
<p>WML markup checking (<code class="literal">wml</code>). If WML in translation is not valid, player may see some visual artifacts. Also, links in WML must match between original and translation, to avoid loss of information.</p>
</li>
<li class="listitem">
<p>Pango markup checking (<code class="literal">pango</code>). Pango is used in some places for visual text markup instead of WML.</p>
</li>
<li class="listitem">
<p>Congruence of leading and trailing space (<code class="literal">space</code>). For many languages, significant leading and trailing space from the original should be preserved. A heuristic is used to determine when leading or trailing space is significant. Only languages explicitly specified internally are checked for this.</p>
</li>
<li class="listitem">
<p>Docbook validity (<code class="literal">docbook</code>). Docbook is actually not used as a source format anywhere in Wesnoth, but the Wesnoth manual is converted into Docbook specifically to facilitate translation (weird as it may sound).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-collect-pmap" id="sv-collect-pmap"></a>3.5.12.&nbsp;<span class="command"><strong>collect-pmap</strong></span></h3>
</div>
</div>
</div>
<p><span class="emphasis"><em>Property maps</em></span> (or <span class="emphasis"><em>pmaps</em></span> for short) are one way in which arbitrary properties of language phrases can be defined for use in scripted translations, such as provided by <a class="ulink" href="http://techbase.kde.org/Localization/Concepts/Transcript" target="_top">Transcript</a>, the translation scripting system in KDE 4.</p>
<p>A property map is a text file with a number of entries, each defining the properties of a certain phrase. A pmap entry starts with one or more keys and continues with arbitrary number of key-value properties. An example entry would be grammar declinations of a noun:</p>
<pre class="programlisting">
=/Athens/Atina/nom=Atina/gen=Atine/dat=Atini/acc=Atinu//
</pre>
<p>The first two characters define, in order, the key-value separator (here <code class="literal">=</code>) and the property separator (here <code class="literal">/</code>) for the current entry. The two separators can be any non-alphanumeric characters, and must be different. Then follows a number of entry keys, delimited by property separators, and then a number of key-value properties, each internaly delimited by the key-value separator. The entry is terminated by double property separator. Properties of an entry can be fetched in the translation scripting system by any of the entry keys; keys are case- and whitespace-insensitive.</p>
<p><span class="command"><strong>collect-pmap</strong></span> will parse pmap entries from manual comments in messages, collect them, and write out a property map file. It is not necessary to explicitly specify entry keys, since the contents of <code class="varname">msgid</code> and <code class="varname">msgstr</code> are automatically added as keys. Since each manual comment is one line, it is also allowed to drop the final double separator which would normally terminate the entry. The above example would thus look like this in a PO message:</p>
<pre class="programlisting">
# pmap: =/nom=Atina/gen=Atine/dat=Atini/acc=Atinu/
msgctxt "Greece/city"
msgid "Athens"
msgstr "Atina"
</pre>
<p>The manual comment starts with <code class="literal">pmap:</code> keyword, which is followed by a normal pmap entry, except for missing keys (but additional keys can be specified when <code class="varname">msgid</code> and <code class="varname">msgstr</code> are not sufficient). It is also possible to split the entry into several comments, with only condition that all share the same set of separators:</p>
<pre class="programlisting">
# pmap: =/nom=Atina/gen=Atine/
# pmap: =/dat=Atini/acc=Atinu/
</pre>
<p>After collecting pmap entries from all processed PO files, if two or more entries end up having same keys, they are all removed from the collection and a warning is reported.</p>
<p>Pmap entries are collected only from translated, non-plural messages.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">outfile:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>File path into which the property map should be written. If not given, nothing is written out; this is useful for validating entries.</p>
</dd>
<dt><span class="term"><code class="option">propcons:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>Path to the file which defines constraints on property keys and values, used to validate parsed entries (see <a class="xref" href="#sec-svvalpmap" title="3.5.12.2.&nbsp;Validating Entries">Section&nbsp;3.5.12.2, “Validating Entries”</a>).</p>
</dd>
<dt><span class="term"><code class="option">extrakeys</code></span></dt>
<dd>
<p>By default, it is actually not possible to add any aditional entry keys besides the automatically added <code class="varname">msgid</code> and <code class="varname">msgstr</code>. This gives extra safety against errors, such as translator mistyping the key-value pair. If additional keys are actually needed, this parameter can be issued to accept them.</p>
</dd>
<dt><span class="term"><code class="option">derivs:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>Path to the file which defines derivators for synder entries (see <a class="xref" href="#sec-svsynder" title="3.5.12.1.&nbsp;Derivating Entries">Section&nbsp;3.5.12.1, “Derivating Entries”</a>).</p>
</dd>
<dt><span class="term"><code class="option">pmhead:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>Default <code class="literal">pmap:</code> as entry prefix may not be the most convenient; for example, when the language of translation is not written with Latin script. This parameter makes makes it possibly to use an arbitrary string for the entry prefix.</p>
</dd>
<dt><span class="term"><code class="option">sdhead:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>Like <code class="option">pmhead</code>, but for prefix to synder entries, instead of the default <code class="literal">synder:</code> (see <a class="xref" href="#sec-svsynder" title="3.5.12.1.&nbsp;Derivating Entries">Section&nbsp;3.5.12.1, “Derivating Entries”</a>).</p>
</dd>
</dl>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svsynder" id="sec-svsynder"></a>3.5.12.1.&nbsp;Derivating Entries</h4>
</div>
</div>
</div>
<p>There is another, more succint way to define pmap entries in comments. Instead of writting out all key-value combinations, it is possible instead to generate them by using <span class="emphasis"><em>syntagma derivators</em></span> (or <span class="emphasis"><em>synders</em></span>) for short. From the earlier example:</p>
<pre class="programlisting">
# pmap: =/nom=Atina/gen=Atine/dat=Atini/acc=Atinu/
</pre>
<p>it can be observed that each form has the same root, <code class="literal">Atin</code>, followed by the appropriate ending for that form type. This makes it convenient to reformulate it as a syntagma derivation:</p>
<pre class="programlisting">
# synder: Atin|a
</pre>
<p>Here <code class="literal">|a</code> is a <span class="emphasis"><em>derivator</em></span>; all derivators are defined in a separate synder file (with <code class="filename">.sd</code> extension by convention) and made known to the sieve through the <code class="option">derivs</code> parameter. The derivator in this example would be defined like this:</p>
<pre class="programlisting">
|a: nom=a, gen=e, dat=i, acc=u
</pre>
<p>First comes the derivator name, starting with <code class="literal">|</code> and ending with <code class="literal">:</code>, and then the comma-separated list of key-value pairs similar as in the pmap entry, except that now only the endings for the given form are specified. Synders are actually a standalone subsystem of Pology, see <a class="xref" href="#sec-lgsynder" title="8.6.&nbsp;Syntagma Derivation">Section&nbsp;8.6, “Syntagma Derivation”</a> for all details.</p>
<p>It is possible to mix pmap (<code class="literal"># pmap: ...</code>) and synder (<code class="literal"># synder: ...</code>) entries in translator comments. For example, synder entries may be used to cover majority of cases, which follow the general language rules, while pmap entries can be used for exceptions.</p>
<p>On the other hand, every pmap entry can be reformulated as a synder entry which does not refer to an external derivator:</p>
<pre class="programlisting">
# synder: nom=Atina, gen=Atine, dat=Atini, acc=Atinu
</pre>
<p>This begs the question of what is the need for pmap entries at all, if synder entries can be used in the same capacity and beyond? Pmap entries are still useful because synders have a lot of special syntax and rules to keep in mind (e.g. what if the phrase itself contains a comma?), while raw pmaps have none past what was described above.</p>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svvalpmap" id="sec-svvalpmap"></a>3.5.12.2.&nbsp;Validating Entries</h4>
</div>
</div>
</div>
<p>The <code class="literal">propcons</code> parameter can be used to specify a file which defines constraints on acceptable property keys, and on values by each key. Its format is the following:</p>
<pre class="programlisting">
# Full-line comment.
/key_regex_1/value_regex_1/flags # a trailing comment
/key_regex_2/value_regex_2/flags
:key_regex_3:value_regex_3:flags # different separator
# etc.
</pre>
<p>Regular expressions for keys and values are delimited by a separator defined by first non-whitespace character in the line, which must also be non-alphanumeric. Before being compiled, regular expressions are automatically wrapped as <code class="literal">^(<em class="replaceable"><code>regex</code></em>)$</code>, so that an expression to require a certain prefix is given as <code class="literal"><em class="replaceable"><code>prefix</code></em>.*</code> and a suffix as <code class="literal">.*<em class="replaceable"><code>suffix</code></em></code>. A property key must match one of the key regexs, or else it is considered invalid. Value to that property must then match the value regexes attached to all matched key regexes.</p>
<p>For example, a constraint file defining no constraints on either property keys or values is:</p>
<pre class="programlisting">
/.*/.*/
</pre>
<p>while a file explicitly listing all allowed property keys, and constraining values to some of them, would be:</p>
<pre class="programlisting">
/nom|gen|dat|acc/.*/
/gender/m|f|n/
/number/s|p/
</pre>
<p>The last separator in the constraint can be followed by a string of single-character flags. These flags are currently defined:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">i</code>: case-insensitive matching for the value.</p>
</li>
<li class="listitem">
<p><code class="literal">I</code>: case-insensitive matching for the key.</p>
</li>
<li class="listitem">
<p><code class="literal">t</code>: the value must both match the regular expression and be equal to <code class="varname">msgstr</code>. If <code class="literal">i</code> flag is added too, equality check is also case-insensitive.</p>
</li>
<li class="listitem">
<p><code class="literal">r</code>: regular expression for the key must match at least one key among all defined properties.</p>
</li>
</ul>
</div>
<p>Constraint definition file must be encoded with UTF-8.</p>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-diff-previous" id="sv-diff-previous"></a>3.5.13.&nbsp;<span class="command"><strong>diff-previous</strong></span></h3>
</div>
</div>
</div>
<p>When PO files are merged with <code class="option">--previous</code> option to <span class="command"><strong>msgmerge</strong></span>, fuzzy messages will retain the previous version of original text (<code class="varname">msgctxt</code>, <code class="varname">msgid</code> and <code class="varname">msgid_plural</code>) under <code class="literal">#|</code> comments. Then <span class="command"><strong>diff-previous</strong></span> can be used to embedded differences from previous to current original into previous original strings. For example, the message:</p>
<pre class="programlisting">
#: main.c:110
#, fuzzy
#| msgid "The Record of The Witch River"
msgid "Records of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre>
<p>will become after sieving:</p>
<pre class="programlisting">
#: main.c:110
#, fuzzy
#| msgid "{-The Record-}{+Records+} of The Witch River"
msgid "Records of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre>
<p>Text editors may even provide highlighting for the wrapped difference segments (e.g. Kwrite/Kate).</p>
<p>This sieve is very useful if your PO editor does not show differences in the original by itself. To be able to easily see exactly what was changed in the original is important both for efficiency and for quality. Think of a long paragraph in which only one word was changed: without a diff it will take you time to reread it, and you may even miss that changed word.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">strip</code></span></dt>
<dd>
<p>Instead of embedding diffs, remove them from messages, recovering the original form of previous strings. This is useful if you did not update all fuzzy messages but you anyway want to send the PO file away (commit it to the repository, etc.).</p>
</dd>
<dt><span class="term"><code class="option">branch:<em class="replaceable"><code>branch</code></em></code></span></dt>
<dd>
<p>Embed diffs only into messages from given branch (<a class="link" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">summit</a>). Several branches may be given as comma-separated list.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-empty-fuzzies" id="sv-empty-fuzzies"></a>3.5.14.&nbsp;<span class="command"><strong>empty-fuzzies</strong></span></h3>
</div>
</div>
</div>
<p>For every fuzzy message, <span class="command"><strong>empty-fuzzies</strong></span> removes the translation and fuzzy data (the <code class="literal">fuzzy</code> flag, previous strings). Translator comments are kept by default, but they can be removed as well. Obsolete fuzzy messages are completely removed.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">rmcomments</code></span></dt>
<dd>
<p>Also remove translator comments from fuzzy messages.</p>
</dd>
<dt><span class="term"><code class="option">noprev</code></span></dt>
<dd>
<p>Empty only those fuzzy messages which do not have previous strings (i.e. when the PO file was merged without <code class="option">--previous</code> option to <span class="command"><strong>msgmerge</strong></span>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-equip-header-tp-kde" id="sv-equip-header-tp-kde"></a>3.5.15.&nbsp;<span class="command"><strong>equip-header-tp-kde</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>equip-header-tp-kde</strong></span> applies <a class="link" href="#hk-proj-kde-header-equip-header">the <code class="literal">kde%header/equip-header</code> hook</a> to headers of PO files within the KDE Translation Project.</p>
<p>There are no parameters.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-fancy-quote" id="sv-fancy-quote"></a>3.5.16.&nbsp;<span class="command"><strong>fancy-quote</strong></span></h3>
</div>
</div>
</div>
<p>Ordinary ASCII quotes are easy to type on most keyboard layouts, and these quotes are frequently encountered in non-typeset English texts, rather than proper English quotes. These proper quotes are sometimes called "fancy" quotes. When translating from English, translators can thus be easily moved to use ASCII quotes themselves, instead of the fancy quotes appropriate for their language. To somewhat correct this, <span class="command"><strong>fancy-quote</strong></span> can be used to replace ASCII quotes in the translation with selected pairs of fancy quotes.</p>
<p>ASCII quotes that are part of text markup (e.g. attribute values in XML-like tags) must not be replaced, and this sieve will use heuristics to determine such places. In fact, it will replace quotes rather conservatively. Nevertheless, unless some sort of automatic validation is available, converted text should be manually inspected for correctness.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">single:<em class="replaceable"><code>quotes</code></em></code></span></dt>
<dd>
<p>Opening and closing quote to replace ASCII single quotes (i.e. <em class="replaceable"><code>quotes</code></em> is a two-character string). If not given, single quotes are not replaced (but see the <code class="option">longsingle</code> parameter).</p>
</dd>
<dt><span class="term"><code class="option">single:<em class="replaceable"><code>quotes</code></em></code></span></dt>
<dd>
<p>Opening and closing quote to replace ASCII double quotes. If not given, double quotes are not replaced (but see the <code class="option">longdouble</code> parameter).</p>
</dd>
<dt><span class="term"><code class="option">longsingle:<em class="replaceable"><code>open</code></em>,<em class="replaceable"><code>close</code></em></code></span></dt>
<dd>
<p>Alternative to <code class="option">single</code>, if opening and closing quotes are not single characters. The value are the opening quote string and the closing quote string, separated by comma.</p>
</dd>
<dt><span class="term"><code class="option">longdouble:<em class="replaceable"><code>open</code></em>,<em class="replaceable"><code>close</code></em></code></span></dt>
<dd>
<p>Alternative to <code class="option">double</code>, if opening and closing quotes are not single characters.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-find-messages" id="sv-find-messages"></a>3.5.17.&nbsp;<span class="command"><strong>find-messages</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>find-messages</strong></span> is the search and replace workhorse of Pology. It applies one or several conditions to different parts of the PO message, with selectable boolean linking between them. If the message is matched as whole, it is reported and possibly some replacements are done. Messages are by default reported to standard output, with full location reference (PO file path, line and entry number), but can also be opened directly in one of supported PO editors (see <a class="xref" href="#sec-cmsupped" title="9.7.1.&nbsp;PO Editors">Section&nbsp;9.7.1, “PO Editors”</a>).</p>
<p>When used in a sieve chain, <span class="command"><strong>find-messages</strong></span> will stop further sieving of messages which did not satisfy the conditions. This makes it useful as a filter for selecting subsets of messages on which other sieves should operate.</p>
<p>There are three logical groups of parameters: matching parameters, replacement parameters, and general parameters. Matching and replacement parameters have certain relationships between themselves, while general parameters have mutually independent effects (i.e. as usual for sieve parameters).</p>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svfmmpar" id="sec-svfmmpar"></a>3.5.17.1.&nbsp;Matching Parameters</h4>
</div>
</div>
</div>
<p>Matching parameters specify patterns for matching by parts of the message, or represent binary conditions (whether the message is translated, etc.). For example:</p>
<pre class="programlisting">
$ posieve find-messages -s msgid:'foo bar'
</pre>
<p>will report all messages which contain the phrase "foo bar" in their <code class="varname">msgid</code> (or <code class="varname">msgid_plural</code>) string. When several matching parameters are given, by default the message is matched if all patterns match; that is, boolean linking of conditions is AND. This:</p>
<pre class="programlisting">
$ posieve find-messages -s msgid:'foo bar' -s transl
</pre>
<p>will report all messages that contain "foo bar" in original <span class="emphasis"><em>and</em></span> are translated. Boolean linking can be switched to OR by issuing the <code class="option">or</code> parameter. To find all messages that contain the word "tooltip" in <span class="emphasis"><em>either</em></span> context or comments:</p>
<pre class="programlisting">
$ posieve find-messages -s msgctxt:tooltip -s comment:tooltip -s or
</pre>
<p>(Actually, the effect of <code class="option">or</code> is somewhat more specific, see its description below.) String matching is by default case insensitive, which can be changed globally by issuing the <code class="option">case</code> parameter.</p>
<p>Every matching parameter has a negative counterpart, named by prepending <code class="literal">n</code> to the original parameter, which matches when the original parameter does not. Running:</p>
<pre class="programlisting">
$ posieve find-messages -s msgid:'hello' -s nmsgstr:'zdravo'
</pre>
<p>would find all messages that contain "hello" in the original and do <span class="emphasis"><em>not</em></span> contain "zdravo" in the translation (a typical usage pattern in quick terminology checks).</p>
<p>To find all messages not matching a set of conditions, in principle it would be possible to negate the whole condition set by switching between positive/negative parameters and AND/OR-linking, but this can be cumbersome. Instead, the <code class="option">invert</code> parameter can be issued to report messages that are not matched by the condition set.</p>
<p>Sometimes neither simple AND nor simple OR boolean linking is sufficient to form the search. Therefore the <code class="option">fexpr</code> parameter is provided, which can be used to specify a search expression with explicit boolean operators and parentheses for controlling the evaluation order. With <code class="option">fexpr</code>, the previous example could be reformulated as:</p>
<pre class="programlisting">
$ posieve find-messages -s fexpr:'msgid/hello/ and not msgstr/zdravo/'
</pre>
<p>For details, see the description of <code class="option">fexpr</code> below.</p>
<p>Currently defined matching parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">(n)msgctxt:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Regular expression to match the <code class="varname">msgctxt</code> string.</p>
</dd>
<dt><span class="term"><code class="option">(n)msgid:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Regular expression to match the <code class="varname">msgid</code> and <code class="varname">msgid_plural</code> strings. The condition is satisfed as whole if <span class="emphasis"><em>either</em></span> of these strings matches.</p>
</dd>
<dt><span class="term"><code class="option">(n)msgstr:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Regular expression to match <code class="varname">msgstr</code> strings. The condition is satisfed as whole if any of the <code class="varname">msgstr</code> strings matches.</p>
</dd>
<dt><span class="term"><code class="option">(n)comment:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Regular expression to match extracted and translator comments and source reference comments. The condition is satisfed as whole if any of these comments matches.</p>
</dd>
<dt><span class="term"><code class="option">(n)flag:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Regular expression to match flags. This matches each flag in turn, and not the flag comment as a monolithic string. The condition is satisfed as whole if any flag matches.</p>
</dd>
<dt><span class="term"><code class="option">(n)transl</code></span></dt>
<dd>
<p>The message must be translated.</p>
</dd>
<dt><span class="term"><code class="option">(n)obsol</code></span></dt>
<dd>
<p>The message must be obsolete.</p>
</dd>
<dt><span class="term"><code class="option">(n)active</code></span></dt>
<dd>
<p>The message must be active, i.e. translated and not obsolete.</p>
</dd>
<dt><span class="term"><code class="option">(n)plural</code></span></dt>
<dd>
<p>The message must be a plural message.</p>
</dd>
<dt><span class="term"><code class="option">(n)maxchar:<em class="replaceable"><code>number</code></em></code></span></dt>
<dd>
<p>Original and translation can have at most this many characters. The condition is satisfied as whole if all these strings satisfy it.</p>
</dd>
<dt><span class="term"><code class="option">(n)lspan:<em class="replaceable"><code>start</code></em>:<em class="replaceable"><code>end</code></em></code></span></dt>
<dd>
<p>The referent line number of the message (the line in which its <code class="varname">msgid</code> string starts) must fall within given range. The starting number is included in the range, the ending number is not.</p>
</dd>
<dt><span class="term"><code class="option">(n)espan:<em class="replaceable"><code>start</code></em>:<em class="replaceable"><code>end</code></em></code></span></dt>
<dd>
<p>Like <code class="option">lspan</code>, but instead of line numbers it applies to entry numbers. These are the numbers that dedicated PO editors usually report in their user interfaces.</p>
</dd>
<dt><span class="term"><code class="option">(n)branch:<em class="replaceable"><code>branch</code></em></code></span></dt>
<dd>
<p>The message must belong to this branch (<a class="link" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">summit</a>). Several branches may be given as comma-separated list.</p>
</dd>
<dt><a name="p-fexprdesc" id="p-fexprdesc"></a><span class="term"><code class="option">(n)fexpr:<em class="replaceable"><code>expression</code></em></code></span></dt>
<dd>
<p>Boolean expression with explict boolean operators and parenthesis for priority, constructed out of any of the other matching parameters. If a match parameter needs a value (like a regular expression), in the expression it is given as <code class="literal"><em class="replaceable"><code>match</code></em>/<em class="replaceable"><code>value</code></em>/</code>, where any nonalphanumeric character can be used consistently instead of <code class="literal">/</code> (in case the value itself contains <code class="literal">/</code>). For example, the expression:</p>
<pre class="programlisting">
fexpr:'(msgctxt/foo/ or comment/foo/) and msgid/bar/'
</pre>
<p>is satisfied if either the context or comments contain "foo", and the original text contains "bar".</p>
<p>If matching is influenced by a general parameter (e.g. case sensitivity), in the expression it may be able to take overriding modifiers in form of single characters after the value, i.e. <code class="literal"><em class="replaceable"><code>match</code></em>/<em class="replaceable"><code>value</code></em>/<em class="replaceable"><code>modifiers</code></em></code>. Assuming that <code class="option">case</code> parameter has not been issued, the expression:</p>
<pre class="programlisting">
fexpr:'msgid/quuk/ and msgstr/Qaak/c'
</pre>
<p>will be satisfied if the original text contains "quuk" in any casing, and translation contains exactly "Qaak". Currently available modifiers are:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">c</code>: matching is case-sensitive.</p>
</li>
<li class="listitem">
<p><code class="literal">i</code>: matching is case-insensitive. May be needed when string matching is globally case-sensitive due to <code class="option">case</code> being issued.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svfmrpar" id="sec-svfmrpar"></a>3.5.17.2.&nbsp;Replacement Parameters</h4>
</div>
</div>
</div>
<p>Replacement is done in pair with matching the appropriate string in the message. For example, to replace each appearance of "foobar" with "fumbar" in translation, this would be run:</p>
<pre class="programlisting">
$ posieve find-messages -s msgstr:foobar -s replace:fumbar
</pre>
<p>The <code class="option">replace</code> parameter works in pair with <code class="option">msgstr</code>, i.e. <code class="option">replace</code> cannot be issued without issuing <code class="option">msgstr</code> as well. There are two possible problems with replacement as straightforward as this. The first is that if "foobar" was a whole word (or start of a word), and this word in the text started with upper-case letter, the replacement would make it lower-case. This can be avoided by executing replacement twice with case sensitivity:</p>
<pre class="programlisting">
$ posieve find-messages -s msgstr:foobar -s replace:fumbar -scase
$ posieve find-messages -s msgstr:Foobar -s replace:Fumbar -scase
</pre>
<p>The other problem is if the word is split by an accelerator marker, for example:</p>
<pre class="programlisting">
msgstr "... f_oobar ..."
</pre>
<p>The search may still find the word (see the <code class="option">accel</code> parameter below), but direct replacement would cause the loss of accelerator marker, and therefore it is not done.<sup>[<a name="id644715" href="#ftn.id644715" class="footnote" id="id644715">8</a>]</sup> To see such cases, you should monitor the output of <span class="command"><strong>find-messages</strong></span> (always a good idea when doing batch replacement), where matched and replaced parts of the text will be highlighted.</p>
<p>As usual for replacement based on regular expression, the replacement string may contain <code class="literal">\<em class="replaceable"><code>number</code></em></code> references to groups defined in the matching pattern. For example, the previous example of case-aware replacement could be more efficiently and more elegantly performed with:</p>
<pre class="programlisting">
$ posieve find-messages -s msgstr:'(f)oobar' -s replace:'\1umbar'
</pre>
<p>(Though this is possible only if the original and the replacement start with the same letter.)</p>
<p>Currently defined replacement parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">replace:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>The string to replace the match by <code class="option">msgstr</code> parameter. Can contain regular expression group references.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svfmgpar" id="sec-svfmgpar"></a>3.5.17.3.&nbsp;General Parameters</h4>
</div>
</div>
</div>
<p>Parameters influencing general behavior of <span class="command"><strong>find-messages</strong></span> are as follows:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">or</code></span></dt>
<dd>
<p>Boolean OR instead of AND linking of conditions, but only for string matchers: <code class="option">msgctxt</code>, <code class="option">msgid</code>, <code class="option">msgstr</code>, <code class="option">comment</code>. This restriction may seem odd, but it is what is mostly needed in practice. For example, the set of conditions:</p>
<pre class="programlisting">
-s msgctxt:tooltip -s comment:tooltip -s transl -s or
</pre>
<p>would match all translated messages which have "tooltip" in context or in comments, and not messages which are either translated or have "tooltip" in context or in comments. For full control over the expression, use the <code class="option">fexpr</code> parameter.</p>
</dd>
<dt><span class="term"><code class="option">invert</code></span></dt>
<dd>
<p>Inverts the selection: messages satisfying the condition set are <span class="emphasis"><em>not</em></span> selected.</p>
</dd>
<dt><span class="term"><code class="option">accel:<em class="replaceable"><code>characters</code></em></code></span></dt>
<dd>
<p>Characters to consider as <a class="link" href="#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator markers</a>, to remove before applying matching patterns. If not given, they may be read from PO files (see <a class="link" href="#hdr-x-accelerator-marker"><code class="literal">X-Acclerator-Marker</code></a> in <a class="xref" href="#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>).</p>
</dd>
<dt><span class="term"><code class="option">case</code></span></dt>
<dd>
<p>Matching patterns for strings and comments are by default case-insensitive, and this parameter switches them to case-sensitive.</p>
</dd>
<dt><span class="term"><code class="option">mark</code></span></dt>
<dd>
<p>To each selected message a <code class="literal">match</code> flag is added, modifying the PO file. Modified files can then be opened in the editor, and selected messages looked up by this flag. This is typically done when something should be modified in selected messages, but doing that automatically (using <code class="option">replace</code> parameter) is not possible or safe enough. Also useful here is the option <code class="option">-m</code>/<code class="option">--output-modified</code> of <span class="command"><strong>posieve</strong></span>, to write out the paths of modified PO files into a separate file, which can then be fed to the editor.</p>
</dd>
<dt><span class="term"><code class="option">filter:<em class="replaceable"><code>hookspec</code></em></code></span></dt>
<dd>
<p>The hook to modify the translation before applying the <code class="option">msgstr</code> matcher to it. The hook type must be F1A. The parameter can be repeated to add several hooks.</p>
</dd>
<dt><span class="term"><code class="option">nomsg</code></span></dt>
<dd>
<p>Do not report selected messages, either to standard output or to PO editors. Useful when <span class="command"><strong>find-messages</strong></span> is a pre-filter in the sieve chain.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on selected messages in Lokalize (unless <code class="option">nomsg</code> is in effect).</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-generate-xml" id="sv-generate-xml"></a>3.5.18.&nbsp;<span class="command"><strong>generate-xml</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>generate-xml</strong></span> creates a partial XML representation of a group of PO files.</p>
<p>The output XML format is as follows. Each PO file in the group is represented by a <code class="literal">&lt;po&gt;</code> element, which contains a list of <code class="literal">&lt;msg&gt;</code> elements, one for each message. The C<code class="literal">&lt;msg&gt;</code> element contains the usual parts of a PO message:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">&lt;line&gt;</code>: referent line number of the message</p>
</li>
<li class="listitem">
<p><code class="literal">&lt;refentry&gt;</code>: referent entry number of the message</p>
</li>
<li class="listitem">
<p><code class="literal">&lt;status&gt;</code>: current status of the message (obsolete, translated, untranslated, fuzzy)</p>
</li>
<li class="listitem">
<p><code class="literal">&lt;msgid&gt;</code>: the original text</p>
</li>
<li class="listitem">
<p><code class="literal">&lt;msgstr&gt;</code>: the translation</p>
</li>
<li class="listitem">
<p><code class="literal">&lt;msgctxt&gt;</code>: disambiguating context</p>
</li>
</ul>
</div>
<p>If the PO message contains plural forms, they will be represented with <code class="literal">&lt;plural&gt;</code> subelements of <code class="literal">&lt;msgstr&gt;</code>.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">xml:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>By default the XML content is written to standard output, and this parameter can be used to send it to a file instead</p>
</dd>
<dt><span class="term"><code class="option">translatedOnly</code></span></dt>
<dd>
<p>Only translated messages are exported to XML (i.e. fuzzy, untranslated and obsolete are ignored).</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-merge-corr-tree" id="sv-merge-corr-tree"></a>3.5.19.&nbsp;<span class="command"><strong>merge-corr-tree</strong></span></h3>
</div>
</div>
</div>
<p>When doing corrections on a copy of PO files tree, it is not possible to easily merge back just the updated translations, because word wrapping in PO file can be different, generating much more difference than it should.</p>
<p>Additionally, tools like <span class="command"><strong>pogrep</strong></span> from <a class="ulink" href="http://translate.sourceforge.net/wiki/toolkit/index" target="_top">Translate Toolkit</a> will create new partial tree as output, containing matched messages only. <span class="command"><strong>merge-corr-tree</strong></span> will help you to merge changes made in that partial tree back into the main tree.</p>
<p>The main PO files tree is the input, and the <code class="option">pathdelta</code> parameter is used to provide the path difference to where the partial correction tree is located.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">pathdelta:<em class="replaceable"><code>search</code></em>:<em class="replaceable"><code>replace</code></em></code></span></dt>
<dd>
<p>Specifies that the partial tree is located at path obtained when <code class="literal"><em class="replaceable"><code>search</code></em></code> is replaced with <code class="literal"><em class="replaceable"><code>replace</code></em></code> in the input path.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-normalize-header" id="sv-normalize-header"></a>3.5.20.&nbsp;<span class="command"><strong>normalize-header</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>normalize-header</strong></span> applies <a class="link" href="#hk-normalize-canonical-header">the <code class="literal">normalize/canonical-header</code> hook</a> to PO file headers.</p>
<p>There are no parameters.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-normctxt-delim" id="sv-normctxt-delim"></a>3.5.21.&nbsp;<span class="command"><strong>normctxt-delim</strong></span></h3>
</div>
</div>
</div>
<p>In older PO files, disambiguating contexts may be embedded into <code class="varname">msgid</code> strings, as the initial part of the string delimited from the actual text with predefined substrings, here called the "head" and the "tail". For example, in:</p>
<pre class="programlisting">
msgid ""
"_:this-is-context\n"
"This is original text"
msgstr "This is translated text"
</pre>
<p>the head is the underscore-colon sequence (<code class="literal">_:</code>), and the tail the newline (<code class="literal">\n</code>). <span class="command"><strong>normctxt-delim</strong></span> will convert embedded contexts of the delimiter-type to proper <code class="varname">msgctxt</code> strings.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">head:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>The head of the delimiter-type embedded context.</p>
</dd>
<dt><span class="term"><code class="option">tail:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>The tail of the delimiter-type embedded context.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-normctxt-sep" id="sv-normctxt-sep"></a>3.5.22.&nbsp;<span class="command"><strong>normctxt-sep</strong></span></h3>
</div>
</div>
</div>
<p>In older PO files, disambiguating contexts may be embedded into <code class="varname">msgid</code> strings, as the initial part of the string separated from the actual text by a predefined substring. For example, in:</p>
<pre class="programlisting">
msgid "this-is-context|This is original text"
msgstr "This is translated text"
</pre>
<p>the separator string is the pipe character (<code class="literal">|</code>). <span class="command"><strong>normctxt-sep</strong></span> will convert embedded contexts of the separator-type to proper <code class="varname">msgctxt</code> strings.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">sep:<em class="replaceable"><code>string</code></em></code></span></dt>
<dd>
<p>The string that separates the context and the text in separator-type embedded context.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-remove-fuzzy-comments" id="sv-remove-fuzzy-comments"></a>3.5.23.&nbsp;<span class="command"><strong>remove-fuzzy-comments</strong></span></h3>
</div>
</div>
</div>
<p>Being translator's input, translator comments are copied verbatim to fuzzy messages created on merging with template. Depending on the purpose of translator comments (e.g. see <a class="xref" href="#sec-cmskipcheck" title="9.11.&nbsp;Skipping and Selecting Checks">Section&nbsp;9.11, “Skipping and Selecting Checks”</a> for some special types), it may be better to automatically remove some of them from fuzzy messages (and then possibly add them back manually when updating the translation). If run without any parameters <span class="command"><strong>remove-fuzzy-comments</strong></span> will do nothing, so one or more parameters need to be given to actually remove any comment.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">all</code></span></dt>
<dd>
<p>Simply all translator comments in fuzzy messages are removed.</p>
</dd>
<dt><span class="term"><code class="option">nopipe</code></span></dt>
<dd>
<p>Translator comments containing <a class="link" href="#p-trflag">translator flags</a> (see <a class="xref" href="#sec-cmskipcheck" title="9.11.&nbsp;Skipping and Selecting Checks">Section&nbsp;9.11, “Skipping and Selecting Checks”</a>) are removed.</p>
</dd>
<dt><span class="term"><code class="option">pattern:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Translator comment must match the given regular expression to be removed.</p>
</dd>
<dt><span class="term"><code class="option">exclude:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Translator comment is removed if it does not match the given regular expression.</p>
</dd>
<dt><span class="term"><code class="option">case</code></span></dt>
<dd>
<p>Matching patterns are by default case-insensitive, and this parameter switches to case-sensitivity.</p>
</dd>
</dl>
</div>
<p>When several removal criteria are specified, first those other than <code class="option">pattern</code> and <code class="option">exclude</code> are applied in unspecified order, then the <code class="option">pattern</code> match, and finally the <code class="option">exclude</code> match.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-remove-obsolete" id="sv-remove-obsolete"></a>3.5.24.&nbsp;<span class="command"><strong>remove-obsolete</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>remove-obsolete</strong></span> simply removes all obsolete messages, whether fuzzy or translated, from the PO file.</p>
<p>There are no parameters.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-remove-previous" id="sv-remove-previous"></a>3.5.25.&nbsp;<span class="command"><strong>remove-previous</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>remove-previous</strong></span> removes previous strings, i.e. <code class="literal">#| ...</code> comments, from messages.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">all</code></span></dt>
<dd>
<p>Previous strings are by default removed only from non-fuzzy messages. This parameter specifies to remove previous strings from all messages, including fuzzy.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-resolve-aggregates" id="sv-resolve-aggregates"></a>3.5.26.&nbsp;<span class="command"><strong>resolve-aggregates</strong></span></h3>
</div>
</div>
</div>
<p>In its default mode of operation, <span class="command"><strong>msgcat(1)</strong></span> produces an aggregate message when in different catalogs it encounters a message with the same key but different translation or translator or extracted comments. A general aggregate message looks like this:</p>
<pre class="programlisting">
# #-#-#-#-#  po-file-name-1 (project-version-id-1)  #-#-#-#-#
# manual-comments-1
# #-#-#-#-#  po-file-name-2 (project-version-id-2)  #-#-#-#-#
# manual-comments-2
# ...
# #-#-#-#-#  po-file-name-n (project-version-id-n)  #-#-#-#-#
# manual-comments-n
#. #-#-#-#-#  po-file-name-1 (project-version-id-1)  #-#-#-#-#
#. automatic-comments-1
#. #-#-#-#-#  po-file-name-2 (project-version-id-2)  #-#-#-#-#
#. automatic-comments-2
#. ...
#. #-#-#-#-#  po-file-name-n (project-version-id-n)  #-#-#-#-#
#. automatic-comments-n
#: source-refs-1 source-refs-2 ... source-refs-n
#, fuzzy, other-flags
msgctxt "context"
msgid "original-text"
msgstr ""
"#-#-#-#-#  po-file-name-1 (project-version-id-1)  #-#-#-#-#\n"
"translated-text-1\n"
"#-#-#-#-#  po-file-name-2 (project-version-id-2)  #-#-#-#-#\n"
"translated-text-2\n"
"..."
"#-#-#-#-#  po-file-name-n (project-version-id-n)  #-#-#-#-#\n"
"translated-text-n"
</pre>
<p>Each message part is aggregated only if different in at least one message in the group. For example, extracted comments may be aggregated while translations not.</p>
<p><span class="command"><strong>resolve-aggregates</strong></span> is used to resolve aggregate messages of this kind into normal messages, by picking one variant from each aggregated part.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">first</code></span></dt>
<dd>
<p>By default, the picked variant is the one with most occurences, or the first of the several with same number of occurences. If this parameter is issued, the first variant is picked unconditionally.</p>
</dd>
<dt><span class="term"><code class="option">unfuzzy</code></span></dt>
<dd>
<p>Aggregated messages are always made fuzzy, leaving no way to determine if and which of the original messages were fuzzy. Therefore, by default, the resolved message is left fuzzy too. If, however, it is known beforehand that none of the original messages were fuzzy, resolved messages can be unfuzzied by issuing this parameter.</p>
</dd>
<dt><span class="term"><code class="option">keepsrc</code></span></dt>
<dd>
<p>Since there is no information based on which the aggregated source references can be split into originating groups, they are entirely removed unless this parameter is issued.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-resolve-alternatives" id="sv-resolve-alternatives"></a>3.5.27.&nbsp;<span class="command"><strong>resolve-alternatives</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>resolve-alternatives</strong></span> resolves <span class="emphasis"><em>alternatives directives</em></span> found in the translation into one of the alternatives.</p>
<p>An alternative directive is a substring of the form <code class="literal">~@/.../.../...</code>, for example:</p>
<pre class="programlisting">
msgstr "I see a ~@/pink/white/ elephant."
</pre>
<p><code class="literal">~@</code> is the directive head, which is followed by a character that defines the delimiter of alternatives (can be arbitrary), and then by alternatives themselves. The number of alternatives per directive is not defined by the directive itself, but it is provided as the sieve parameter (i.e. all alternative directives must have some number of alternatives).</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">alt:<em class="replaceable"><code>N</code></em>,<em class="replaceable"><code>M</code></em>t</code></span></dt>
<dd>
<p>Specifies how to resolve alternatives. <code class="literal"><em class="replaceable"><code>N</code></em></code> is the index (starting from 1) of the alternative to take from each directive, and <code class="literal"><em class="replaceable"><code>M</code></em></code> is the number of alternatives per directive. Example: <code class="literal">alt:1,2t</code>.</p>
</dd>
</dl>
</div>
<p>If an alternatives directive is invalid (e.g. too little alternatives), it is reported to standard output. If at least one alternatives directive in the text is not valid, the text is not modifed.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-resolve-entities" id="sv-resolve-entities"></a>3.5.28.&nbsp;<span class="command"><strong>resolve-entities</strong></span></h3>
</div>
</div>
</div>
<p>XML entities are substrings of the form <code class="literal">&lt;<em class="replaceable"><code>entityname</code></em>&gt;</code>, typically encountered in XML-like text markups, but elsewhere too. They are resolved into underlying, human-readable values at build time (when translated text documents are created) or at run time (in translated user interfaces). Sometimes it may be better to have them resolved already in the PO file itself, and that is what <span class="command"><strong>resolve-entities</strong></span> does.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">entdef:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>Path to the file which contains entitiy definitions. It can be repeated to add several files.</p>
<p>Entity definition files are plain text files of the following format:</p>
<pre class="programlisting">
&lt;!-- This is a commment. --&gt;
&lt;!ENTITY name1 'value1'&gt;
&lt;!ENTITY name2 'value2'&gt;
&lt;!ENTITY name3 'value3'&gt;
...
</pre></dd>
<dt><span class="term"><code class="option">ignore:<em class="replaceable"><code>entitynames</code></em></code></span></dt>
<dd>
<p>Entities which should be ignored during resolution. Standard XML entities (<code class="literal">&amp;lt;</code>, <code class="literal">&amp;gt;</code>, <code class="literal">&amp;apos;</code>, <code class="literal">&amp;quot;</code>, <code class="literal">&amp;amp;</code>) are ignored by default.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-set-header" id="sv-set-header"></a>3.5.29.&nbsp;<span class="command"><strong>set-header</strong></span></h3>
</div>
</div>
</div>
<p>Sometimes a PO header field or comment needs to be updated in many PO files at once, and <span class="command"><strong>set-header</strong></span> serves that purpose.</p>
<p>Parameters for setting and removing header fields:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">field:<em class="replaceable"><code>name</code></em>:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the field with given name to given value. This parameter can be repeated to set several fields in one run.</p>
<p>By default, <code class="option">field</code> will actually set the field only if it is already present in the header. To add the field if not present, the <code class="option">create</code> parameter must be issued as well. If the field is being added, parameters <code class="option">after</code> and <code class="option">before</code> can be used to specify where to insert it, or else the new field is appended at the end of the header. If the field is present but not positioned according to <code class="option">after</code> and <code class="option">before</code>, the <code class="option">reorder</code> parameter can be issued to move the field within the header.</p>
</dd>
<dt><span class="term"><code class="option">create</code></span></dt>
<dd>
<p>The field should be added if it is not present in the header.</p>
</dd>
<dt><span class="term"><code class="option">after</code></span></dt>
<dd>
<p>When a field is added, it should be inserted after this field.</p>
</dd>
<dt><span class="term"><code class="option">before</code></span></dt>
<dd>
<p>When a field is added, it should be inserted before this field.</p>
</dd>
<dt><span class="term"><code class="option">reorder</code></span></dt>
<dd>
<p>If the field is present, but it is in the wrong place according to <code class="option">after</code> and <code class="option">before</code>, this parameter will cause it to be reinserted in proper place.</p>
</dd>
<dt><span class="term"><code class="option">remove:<em class="replaceable"><code>field</code></em></code></span></dt>
<dd>
<p>Remove the field with this name. If there are several fileds of that name, all are removed.</p>
</dd>
<dt><span class="term"><code class="option">removerx:<em class="replaceable"><code>regex</code></em></code></span></dt>
<dd>
<p>Remove all fields matched by the given regular expression.</p>
</dd>
</dl>
</div>
<p>Parameters for setting and removing header comments:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">title:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the title comment to the given value. It can be repeated, since the title can be composed of multiple comment lines.</p>
</dd>
<dt><span class="term"><code class="option">rmtitle</code></span></dt>
<dd>
<p>Remove title comments.</p>
</dd>
<dt><span class="term"><code class="option">copyright:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the copyright comment to the given value.</p>
</dd>
<dt><span class="term"><code class="option">rmcopyright</code></span></dt>
<dd>
<p>Remove the copyright comment.</p>
</dd>
<dt><span class="term"><code class="option">license:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the license comment to the given value.</p>
</dd>
<dt><span class="term"><code class="option">rmlicense</code></span></dt>
<dd>
<p>Remove the license comment.</p>
</dd>
<dt><span class="term"><code class="option">author:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the author comment to the given value. It can be repeated, since there may be more authors (i.e. translators).</p>
</dd>
<dt><span class="term"><code class="option">rmauthor</code></span></dt>
<dd>
<p>Remove author comments.</p>
</dd>
<dt><span class="term"><code class="option">comment:<em class="replaceable"><code>value</code></em></code></span></dt>
<dd>
<p>Set the free comment to the given value. It can be repeated, since there can be any number of free comment lines.</p>
</dd>
<dt><span class="term"><code class="option">rmcomment</code></span></dt>
<dd>
<p>Remove free comments.</p>
</dd>
<dt><span class="term"><code class="option">rmallcomm</code></span></dt>
<dd>
<p>Remove all header comments.</p>
</dd>
</dl>
</div>
<p>Note that all existing comments of given type are removed before setting the new ones, i.e. the new comments are <span class="emphasis"><em>not</em></span> appended to the existing. For example, if single <code class="option">author</code> parameter is issued, with a translator name and email address as value, this one translator will replace all existing translators in the header comments.</p>
<p>Comment values are checked for some minimal consistency, e.g. author comments must contain email addresses, licence comments the word "licence", etc.</p>
<p>Value strings (both of fields and comments) may contain %-directives, which are expanded to catalog-dependent substrings prior to setting the value. Currently available directive are:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">%poname</code>: PO domain name (equal to file name without <code class="filename">.po</code> extension)</p>
</li>
</ul>
</div>
<p>If literal % character is needed (e.g. when setting the <code class="literal">Plural-Forms</code> field), it can be escaped by doubling it, <code class="literal">%%</code>. The directive can also be given inside braces, as <code class="literal">%{...}</code> when it would be ambiguous otherwise.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-stats" id="sv-stats"></a>3.5.30.&nbsp;<span class="command"><strong>stats</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>stats</strong></span> collects statistics on PO files, such as message and word counts, and more. Statistics can be presented in several ways and on several levels.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">accel:<em class="replaceable"><code>characters</code></em></code></span></dt>
<dd>
<p>Characters to consider as <a class="link" href="#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator markers</a>, to remove them when splitting text to count words. If not given, they may be read from PO files (see <a class="link" href="#hdr-x-accelerator-marker"><code class="literal">X-Acclerator-Marker</code></a> in <a class="xref" href="#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>), or else some usual accelerator marker characters are removed.</p>
</dd>
<dt><span class="term"><code class="option">detail</code></span></dt>
<dd>
<p>In table views, by default only message, word, and character counts are given. This parameter requests additional derived data, such as expansion factors (ratio of words in translation to words in original), number of words per message, etc.</p>
</dd>
<dt><span class="term"><code class="option">incomplete</code></span></dt>
<dd>
<p>When run over a collection of PO files, all non-fully translated PO files are listed separately, with very brief statistics of incompleteness.</p>
</dd>
<dt><span class="term"><code class="option">incompfile:<em class="replaceable"><code>file</code></em></code></span></dt>
<dd>
<p>Write a file with paths of all non-fully translated PO files, one per line. This file can then be fed with <code class="option">-f</code>/<code class="option">--from-files</code> back to <span class="command"><strong>posieve</strong></span> or another script, to process only incomplete PO files.</p>
</dd>
<dt><span class="term"><code class="option">templates:<em class="replaceable"><code>search</code></em>:<em class="replaceable"><code>replace</code></em></code></span></dt>
<dd>
<p>If there exists both a directory with translated PO files and with POT (template) files, and not every POT file has the corresponding PO file, this parameter can be used to count POT files without PO counterpart as fully untranslated in statistics. Value to the parameter are two strings separated by colon: the first string will be searched for in directory paths of processed PO files, and replaced with the second string to construct corresponding directory paths of POT files. For example:</p>
<pre class="programlisting">
$ cd $MYTRANSLATIONS
$ ls
my_lang  templates
$ posieve stats -s templates:my_lang:templates my_lang/
</pre></dd>
<dt><span class="term"><code class="option">minwords:<em class="replaceable"><code>number</code></em></code></span></dt>
<dd>
<p>Only messages with at least this many words (in any of original or translation strings) are counted into statistics.</p>
</dd>
<dt><span class="term"><code class="option">maxwords:<em class="replaceable"><code>number</code></em></code></span></dt>
<dd>
<p>Only messages with at most this many words (in any of original or translation strings) are counted into statistics.</p>
</dd>
<dt><span class="term"><code class="option">lspan:<em class="replaceable"><code>start</code></em>:<em class="replaceable"><code>end</code></em></code></span></dt>
<dd>
<p>Only messages with referent line numbers (line number of <code class="varname">msgid</code>) in this range are counted into statistics. The starting line is included in the range, the ending line is not. If start is omitted (e.g. <code class="option">lspan::500</code>) it is assumed 0, and if end is omitted (e.g. <code class="option">lspan:300</code> or <code class="option">lspan:300:</code>) it is assumed the total number of lines.</p>
</dd>
<dt><span class="term"><code class="option">espan:<em class="replaceable"><code>start</code></em>:<em class="replaceable"><code>end</code></em></code></span></dt>
<dd>
<p>Only messages with entry numbers (as reported by PO editors) in this range are counted into statistics. Same boundary inclusion and omission rules as for <code class="option">lspan</code> apply; e.g. <code class="option">espan:4:8</code> means to count messages with entry numbers 4, 5, 6, and 7.</p>
</dd>
<dt><span class="term"><code class="option">branch:<em class="replaceable"><code>branch</code></em></code></span></dt>
<dd>
<p>Only messages from given branch are counted into statistics (<a class="link" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">summit</a>). Several branches may be given as comma-separated list.</p>
</dd>
<dt><span class="term"><code class="option">bydir</code></span></dt>
<dd>
<p>Statistics is broken by directories, that is a report is displayed for each group of PO files in the same directory (and not below it). More usually used with bar displays than with tabular displays.</p>
</dd>
<dt><span class="term"><code class="option">byfile</code></span></dt>
<dd>
<p>Statistics is broken by files, that is a report is displayed for each PO file. Usually used with bar displays.</p>
</dd>
<dt><span class="term"><code class="option">msgbar</code></span></dt>
<dd>
<p>Instead of a table with detailed statistics, only message counts are shown, accompanied with a text-art bar. Mostly useful in combination with <code class="option">bydir</code> and <code class="option">byfile</code>.</p>
</dd>
<dt><span class="term"><code class="option">wbar</code></span></dt>
<dd>
<p>Like <code class="option">msgbar</code>, but to have word instead of message counts.</p>
</dd>
<dt><span class="term"><code class="option">absolute</code></span></dt>
<dd>
<p>Bar displays (on <code class="option">msgbar</code> and <code class="option">wbar</code>) are normaly relative, meaning that when <code class="option">byfile</code> or <code class="option">bydir</code> is in effect, each bar is of same length. This parameter makes bars scaled to sizes of PO files or directories. For example, if <code class="option">msgbar</code> and <code class="option">byfile</code> are issued, then the bar of a PO file with twice as many messages as another PO file will be twice as long.</p>
</dd>
<dt><span class="term"><code class="option">ondiff</code></span></dt>
<dd>
<p>Fuzzy messages are often very easy to correct (e.g. a typo fixed), which may make their word count misleading when estimating translation effort. This can be amended by issuing this parameter, to reduce word and character counts of fuzzy messages by the difference ratio between current and previous original text, providing that the previous original is available and that the difference is smaller than some threshold. Removed parts of counts are added to translated category, so that total counts remain the same.</p>
</dd>
<dt><span class="term"><code class="option">mincomp:<em class="replaceable"><code>fraction</code></em></code></span></dt>
<dd>
<p>Only those PO files which have translation completeness (measured by the ratio of translated to all messages, excluding obsolete) equal to or higher than the given fraction are included into statistics. This is especially useful when for each new template an empty PO file is automatically produced (instead of translators having to start work from a template), to include into statistics only those files which have actually seen some translation (using a small non-zero number for the fraction, e.g. <code class="option">fraction:1e-6</code>).</p>
</dd>
<dd>
<p>The hook to modify the translation before splitting it to count words and characters (see <a class="xref" href="#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">Section&nbsp;9.10, “Processing Hooks”</a>). The hook type must be F1A. The parameter can be repeated to add several hooks, which are then applied in the order of specification.</p>
</dd>
</dl>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svstemctxt" id="sec-svstemctxt"></a>3.5.30.1.&nbsp;Handling Embedded Contexts</h4>
</div>
</div>
</div>
<p>Some older PO files will have disambiguating contexts embedded into the <code class="varname">msgid</code> string, instead of using the newer standard <code class="varname">msgctxt</code> string. There are several customary ways in which this is done, but in general it depends on the translation environment where such PO files are used.</p>
<p>Embedded contexts will skew the statistics. Pology contains several sieves for converting embedded contexts into <code class="varname">msgctxt</code> contexts, named <span class="command"><strong>normctxt-*</strong></span>. When statistics on such PO files is computed, a sieve chain should be used in which the <span class="command"><strong>stats</strong></span> sieve is preceeded by the context conversion sieve. For example, if the embedded context starts the <code class="varname">msgid</code> and ends with <code class="literal">|</code>, statistics should be computed with:</p>
<pre class="programlisting">
$ posieve --no-sync normctxt-sep,stats -s sep:'|' ...
</pre>
<p>Note that <span class="command"><strong>normctxt-*</strong></span> sieves, since they modify messages, would by default cause PO files to be modified on disk. Option <code class="option">--no-sync</code> is therefore issued to prevent modifications to sieved files.</p>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svstoutleg" id="sec-svstoutleg"></a>3.5.30.2.&nbsp;Output Legend</h4>
</div>
</div>
</div>
<p>The default output from <span class="command"><strong>stats</strong></span> is a table where rows present statistics for a category of messages, and columns the particular categories of data:</p>
<pre class="programlisting">
$ posieve stats frobaz/
-              msg  msg/tot  w-or  w/tot-or  w-tr  ch-or  ch-tr
translated     ...    ...    ...     ...     ...    ...    ...
fuzzy          ...    ...    ...     ...     ...    ...    ...
untranslated   ...    ...    ...     ...     ...    ...    ...
total          ...    ...    ...     ...     ...    ...    ...
obsolete       ...    ...    ...     ...     ...    ...    ...
</pre>
<p>The <code class="literal">total</code> row is the sum of <code class="literal">translated</code>, <code class="literal">fuzzy</code>, and <code class="literal">untranslated</code> rows, whereas <code class="literal">obsolete</code> row is excluded. The columns are as follows:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">msg</code>: number of messages</p>
</li>
<li class="listitem">
<p><code class="literal">msg/tot</code>: percentage of messages relative to total</p>
</li>
<li class="listitem">
<p><code class="literal">w-or</code>: number of words in the original</p>
</li>
<li class="listitem">
<p><code class="literal">w/tot-or</code>: percentage of words in the original relative to total</p>
</li>
<li class="listitem">
<p><code class="literal">w-tr</code>: number of words in the translation</p>
</li>
<li class="listitem">
<p><code class="literal">ch-or</code>: number of characters in original</p>
</li>
<li class="listitem">
<p><code class="literal">ch-tr</code>: number of characters in the translation</p>
</li>
</ul>
</div>
<p>The output with <code class="option">detail</code> parameter in effect is the same as default, with several columns of derived data appended to the table:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">w-ef</code>: word expansion factor (increase in words from the original to the translation)</p>
</li>
<li class="listitem">
<p><code class="literal">ch-ef</code>: character expansion factor (increase in characters from the original to the translation)</p>
</li>
<li class="listitem">
<p><code class="literal">w/msg-or</code>: average of number words per message in the original</p>
</li>
<li class="listitem">
<p><code class="literal">w/msg-tr</code>: average number of words per message in the translation</p>
</li>
<li class="listitem">
<p><code class="literal">ch/w-or</code>: average number of characters per message in the original</p>
</li>
<li class="listitem">
<p><code class="literal">ch/w-tr</code>: average number of characters per message in the translation</p>
</li>
</ul>
</div>
<p>If any of the sieve parameters that restrict or modify counting (such as <code class="option">ondiff</code>, <code class="option">lspan</code>, etc.) have been issued, this is indicated in the output by a <code class="literal">modifiers: ...</code> line:</p>
<pre class="programlisting">
$ posieve stats -s maxwords:5 -s ondiff frobaz/
(...the statistics table...)
modifiers: at most 5 words and scaled fuzzy counts
</pre>
<p>When the <code class="option">incomplete</code> parameter is given, the statistics table is followed by a table of non-fully translated PO files, with counts of fuzzy and untranslated messages and words:</p>
<pre class="programlisting">
$ posieve stats -s incomplete frobaz/
(...the overall statistics table...)
catalog              msg/f   msg/u   msg/f+u   w/f   w/u   w/f+u
frobaz/foxtrot.po        0      11        11     0   123     123
frobaz/november.po      19      14        33    85    47     132
frobaz/sierra.po        22       0        22   231     0     231
</pre>
<p>In the column names, <code class="literal">msg/*</code> and <code class="literal">w/*</code> stand for messages and words; <code class="literal">*/f</code>, <code class="literal">*/u</code>, and <code class="literal">*/f+u</code> stand for fuzzy, untranslated, and the two summed.</p>
<p>When parameters <code class="option">msgbar</code> or <code class="option">wbar</code> are in effect, statistics is presented in the form of a text-art bar, giving visual relation between numbers of translated, fuzzy, and untranslated messages or words:</p>
<pre class="programlisting">
$ posieve stats -s wbar frobaz/
4572/1829/2533 w-or |¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤×××××××××············|
</pre>
<p>A typical condensed overview of translation state is obtained by:</p>
<pre class="programlisting">
$ posieve stats -s byfile -s msgbar frobaz/
frobaz/foxtrot.po   34/ -/11 msgs |¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤·····|
frobaz/november.po  58/19/14 msgs |¤¤¤¤¤¤¤¤¤¤¤×××××····|
frobaz/sierra.po    65/22/ - msgs |¤¤¤¤¤¤¤¤¤¤¤¤¤¤××××××|
(overall)          147/41/25 msgs |¤¤¤¤¤¤¤¤¤¤¤¤¤××××···|
</pre>
<p>Note that while message counts are the classic for bar overviews (<code class="option">msgbar</code>), you are probably better off looking at word counts (<code class="option">wbar</code>) instead, because word counts represent more closely the amount of work needed to complete the translation. Rounding of fractions for bars is such that as long as there is at least one fuzzy or untranslated message (or word), the bar will show one incomplete cell.</p>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-svstnotes" id="sec-svstnotes"></a>3.5.30.3.&nbsp;Notes on Counting</h4>
</div>
</div>
</div>
<p>Word and character counts for a message string are obtained by processing it in the following order:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Accelerator markers are removed.</p>
</li>
<li class="listitem">
<p>Text markup is eliminated (e.g. XML-like tags).</p>
</li>
<li class="listitem">
<p>Other special substrings, such as format directives, are also eliminated (e.g. <code class="literal">%s</code> in messages with <code class="literal">c-format</code> flag).</p>
</li>
<li class="listitem">
<p>Text is split into words by taking all contiguous sequences of "word characters", which include letters, numbers, and underscore.</p>
</li>
<li class="listitem">
<p>All words not starting with a letter are eliminated.</p>
</li>
<li class="listitem">
<p>Words that remain are counted into statistics. Whitespace is not included in character count.</p>
</li>
</ul>
</div>
<p>In plural messages, counts for the original are the average of <code class="varname">msgid</code> and <code class="varname">msgid_plural</code> strings, and likewise the average of all <code class="varname">msgstr</code> strings for the translation. In this way, the comparative statistics between the original and the translation is not skewed for languages that have more or less than two plural forms.</p>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-tag-untranslated" id="sv-tag-untranslated"></a>3.5.31.&nbsp;<span class="command"><strong>tag-untranslated</strong></span></h3>
</div>
</div>
</div>
<p>Some translators like to edit PO files with a plain text editor, which may provide no special support for editing PO files, other than perhaps PO syntax highlighting. In this scenario, <span class="command"><strong>tag-untranslated</strong></span> can be used to equip untranslated messages with <code class="literal">untranslated</code> flag, so that they can be easily looked up in the editor.</p>
<p>Since <code class="literal">untranslated</code> is not one of defined PO flags, it will be lost if the PO file is merged with the template. This is intentional: the only purpose of this flag is to facilitate immediate editing of the PO file, and you may miss to remove some of them while editing. There is no reason for <code class="literal">untranslated</code> flags to persist in that case. Also, if the flag is not removed after the message has been translated, a subsequent run of this sieve will remove the flag.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">strip</code></span></dt>
<dd>
<p>Instead of being added, <code class="literal">untranslated</code> flags are stripped. This is useful when you had no time to translate all messages but you want to send the PO file away.</p>
</dd>
<dt><span class="term"><code class="option">wfuzzy</code></span></dt>
<dd>
<p><code class="literal">untranslated</code> flags are added to fuzzy messages as well. This can be useful to be able to jump in the text editor through all incomplete message by just giving <strong class="userinput"><code>, untranslated</code></strong><sup>[<a name="id666697" href="#ftn.id666697" class="footnote" id="id666697">9</a>]</sup>, or when the set of messages to be updated has been limited somehow (e.g. by the <code class="option">branch</code> parameter).</p>
</dd>
<dt><span class="term"><code class="option">branch:<em class="replaceable"><code>branch</code></em></code></span></dt>
<dd>
<p>Tag only untranslated messages from given branch (<a class="link" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">summit</a>). Several branches may be given as comma-separated list.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-unfuzzy-context-only" id="sv-unfuzzy-context-only"></a>3.5.32.&nbsp;<span class="command"><strong>unfuzzy-context-only</strong></span></h3>
</div>
</div>
</div>
<p>Sometimes the message is made fuzzy during merging only due to change in the <code class="varname">msgctxt</code> string, or its addition or removal. Some translators and languages may be less dependent on contexts than the other, or they may be in a hurry prior to the release of the translation, and then <span class="command"><strong>unfuzzy-context-only</strong></span> can be used to unfuzzy these messages in which only the context was modified. This state can be detected by comparing the current and the previous strings in the fuzzy message, i.e. the PO file must have been merged with <code class="option">--previous</code> option to <span class="command"><strong>msgmerge</strong></span>.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">noreview</code></span></dt>
<dd>
<p>By default, unfuzzied messages will also be given a translator comment with <code class="literal">unreviewed-context</code> string, so that you may find and review these messages at a later time. This parameter will prevent the addition of such comment, but it is usually safer to review automatically unfuzzied messages when you find the time.</p>
</dd>
<dt><span class="term"><code class="option">eqmsgid</code></span></dt>
<dd>
<p>Sometimes a lot of messages in the code may be semi-automatically equipped with contexts (e.g. to group items by a common property), and then it may be necessary to review only those messages which got split into two or more messages due to newly added contexts. This parameter may be issued to specifically report all translated messages which have the their <code class="varname">msgid</code> string equal to an unfuzzied message, including unfuzzied messages themselves. Depending on exactly what kind of contexts have been added, the <code class="option">noreview</code> parameter may be useful here as well.</p>
</dd>
<dt><span class="term"><code class="option">lokalize</code></span></dt>
<dd>
<p>Open the PO file on reported messages in Lokalize.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-unfuzzy-ctxmark-only" id="sv-unfuzzy-ctxmark-only"></a>3.5.33.&nbsp;<span class="command"><strong>unfuzzy-ctxmark-only</strong></span></h3>
</div>
</div>
</div>
<p><span class="command"><strong>unfuzzy-ctxmark-only</strong></span> has a similar but less wide effect compared to the <span class="command"><strong>unfuzzy-context-only</strong></span> sieve. It unfuzzies a message only if the only change that caused fuzzyness is in a specific part of <code class="varname">msgctxt</code> string, the <span class="emphasis"><em>UI context marker</em></span>.</p>
<p>UI context markers are en element of <a class="ulink" href="http://techbase.kde.org/Development/Tutorials/Localization/i18n_Semantics" target="_top">KUIT markup</a> (KDE user interface text), which state more formally the user interface context in which the text given by the PO message is used. This may be important for translation, since style guidelines will typically somewhat depend on where in the UI the text is seen. For example, there may be two messages in the code which have exactly the same text in English, but one is used as a menu item, and the other as a dialog title; with KUIT, they would be marked as:</p>
<pre class="programlisting">
msgctxt "@action:inmenu File"
msgid "Export as HTML"
msgstr ""

msgctxt "@title:window"
msgid "Export as HTML"
msgstr ""
</pre>
<p>The UI context marker here is the leading part of <code class="varname">msgctxt</code>, starting with <code class="literal">@...</code> and ending with first whitespace. <span class="command"><strong>unfuzzy-ctxmark-only</strong></span> will unfuzzy the message if only this marker has changed (or was added or removed), but not if the change was in the rest of the context (after the first whitespace).</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">noreview</code></span></dt>
<dd>
<p>See the same-name parameter of <span class="command"><strong>unfuzzy-ctxmark-only</strong></span>. Using it here is probably somewhat safer, but this in general it depends on translation style guidelines.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-unfuzzy-inplace-only" id="sv-unfuzzy-inplace-only"></a>3.5.34.&nbsp;<span class="command"><strong>unfuzzy-inplace-only</strong></span></h3>
</div>
</div>
</div>
<p>Some text markups may have a "permissible" or "sloppy" mode, where some tags do not have to be explicitly terminated. The typical example is HTML, where <code class="literal">&lt;br&gt;</code>, <code class="literal">&lt;hr&gt;</code>, etc. do not have to be written as <code class="literal">&lt;br/&gt;</code>. (This is unlike XHTML, which is an XML instance and therefore strict in this respect.) When this permissible markup was used in the code, a programmer revisiting that code at a later time may consider it a poor style, and go about fixing it. This may cause some messages in the PO file to become fuzzy. <span class="command"><strong>unfuzzy-inplace-only</strong></span> will recognize some of these situations in a fuzzy message (by comparing the current and previous strings) and automatically modify the translation accordingly and unfuzzy the message.</p>
<p>There are no parameters.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-update-header" id="sv-update-header"></a>3.5.35.&nbsp;<span class="command"><strong>update-header</strong></span></h3>
</div>
</div>
</div>
<p>When translation on a PO file starts for the first time, or when a previously translated PO file is being updated after merging, <span class="command"><strong>update-header</strong></span> can be used to automatically set and update PO header fields to proper values. The revision date is taken as current, while other pieces of information are read from the user configuration (see <a class="xref" href="#sec-cmconfig" title="9.2.&nbsp;User Configuration">Section&nbsp;9.2, “User Configuration”</a>). Note that this sieve is normally only of use when you are translating with a plain text editor, while dedicated PO editors should do this automatically when the PO file is saved after editing.</p>
<p>Parameters:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">proj:<em class="replaceable"><code>projectid</code></em></code></span></dt>
<dd>
<p>The ID of the project to which the PO files to be updated belong. This ID is used to construct the name of the configuration section as <code class="literal">[project-<em class="replaceable"><code>projectid</code></em>]</code>, which contains the project data fields. Also used are the fields from the <code class="literal">[user]</code>, whenever they are not overriden in project's section. See <a class="xref" href="#sec-cmcfguser" title="9.2.1.&nbsp;The [user] section">Section&nbsp;9.2.1, “The <code class="literal">[user]</code> section”</a> and <a class="xref" href="#sec-cmcfgproj" title="9.2.4.&nbsp;Per-project sections ([project-*])">Section&nbsp;9.2.4, “Per-project sections (<code class="literal">[project-*]</code>)”</a>.</p>
</dd>
<dt><span class="term"><code class="option">init</code></span></dt>
<dd>
<p>By default, the sieve tries to detect if the header has been initialized before or not, because it differs somewhat what should be changed in the header on initialization and on update. This parameter can be issued to unconditionally treat the header as not initialized, i.e. overwrite any existing content.</p>
</dd>
<dt><span class="term"><code class="option">onmod</code></span></dt>
<dd>
<p>The header should be updated only if the PO file was otherwise modified. This parameter makes sense only in a sieve chane, when this sieve is preceded by a potentially modifying sieve.</p>
</dd>
</dl>
</div>
<p>An example of a user configuration appropriate for this sieve would be:</p>
<pre class="programlisting">
[user]
name = Chusslove Illich
original-name = Часлав Илић
email = caslav.ilic@gmx.net
po-editor = Kate

[project-kde]
language = sr
language-team = Serbian
team-email = kde-i18n-sr@kde.org
plural-forms = nplurals=4; plural=n==1 ? 3 : n%%10==1 &amp;&amp; \
               n%%100!=11 ? 0 : n%%10&gt;=2 &amp;&amp; n%%10&lt;=4 &amp;&amp; \
               (n%%100&lt;10 || n%%100&gt;=20) ? 1 : 2;
</pre>
<p>Note that percent characters in the <code class="literal">plural-forms</code> field are escaped by doubling, because single <code class="literal">%</code> in configuration has special meaning. Also note splitting into several lines by trailing <code class="literal">\</code> (only for better looks, since configuration lines can be arbitrarily long).</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-fr:setUbsp" id="sv-fr:setUbsp"></a>3.5.36.&nbsp;<span class="command"><strong>fr:setUbsp</strong></span></h3>
</div>
</div>
</div>
<p>In French language, some punctuation characters are separated with a certain amount of whitespace from the preceding word. This is unlike in English, so unwary French translators sometimes miss to add the required space before such punctuation when translating from English. <span class="command"><strong>fr:setUbsp</strong></span> will heuristically detect such places and insert the space.</p>
<p>There are no parameters.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sv-ru:fill-doc-date-kde" id="sv-ru:fill-doc-date-kde"></a>3.5.37.&nbsp;<span class="command"><strong>ru:fill-doc-date-kde</strong></span></h3>
</div>
</div>
</div>
<p>Each translation file for a docbook in KDE has a string for documentation last update date in the format 'yyyy-mm-dd'. This sieve automatically translated those strings into Russian. The sieve uses <span class="command"><strong>date</strong></span> command in order to change date formatting. But Russian names of months are hardcoded, so that you do not need to set up Russian locale to use the sieve.</p>
<p>There are no parameters.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-svexternal" id="sec-svexternal"></a>3.6.&nbsp;Using External Sieves</h2>
</div>
</div>
</div>
<p>Each internal sieve is a single Python file in <code class="filename">sieve/</code> subdirectory (and in <code class="filename">lang/<em class="replaceable"><code>langcode</code></em>/sieve/</code> for language-specific sieves). The Python file is named like the sieve, only with hyphens replaced with underscores and with <code class="filename">.py</code> extension. <span class="command"><strong>posieve</strong></span> therefore knows how to find which file to execute when an internal sieve name is given as its first argument.</p>
<p>However, instead of an internal sieve name, the first argument to <span class="command"><strong>posieve</strong></span> can also be an explicit path (relative or absolute) to a Python file which implements a sieve. Explicit paths can also be part of a sieve chain, mixed with internal sieve names. This is all there is to running external sieves; see <a class="xref" href="#sec-prsieves" title="11.3.&nbsp;Writing Sieves">Section&nbsp;11.3, “Writing Sieves”</a> for instructions on how to write one.</p>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id644715" href="#id644715" class="para" id="ftn.id644715">8</a>]</sup> Some heuristics for reinsertion of the accelerator marker may be implemented in the future.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id666697" href="#id666697" class="para" id="ftn.id666697">9</a>]</sup> Alternatively, if the editor provides regular expressions for searches, you can search for <strong class="userinput"><code>, fuzzy|, untranslated</code></strong>.</p>
</div>
</div>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-diffpatch" id="ch-diffpatch"></a>Chapter&nbsp;4.&nbsp;Diffing and Patching</h2>
</div>
</div>
</div>
<p><span class="emphasis"><em>Line-level</em></span> diffing of plain text files assumes that the file is chunked into lines as largest well-defined units, that each line has a significant standalone meaning, and that the ordering of lines is not arbitrary. For example, this is typical of programming language code.</p>
<p>Superficially, PO files could also be considered "a programming language of translation", and amenable to same line-level treatment on diffing. However, some of the outlined assumptions, which make line-level diffing viable, are violated in the PO format. Firstly, the minimal unit of PO file is one message, whereas one line has little semantic value. Secondly, ordering of messages can be arbitrary in principle (e.g. dependent on the order of extraction from program code files), such that two line-wise very different PO files are actually equivalent from translator's viewpoint. And thirdly, good number of lines in the PO file are auxiliary, neither original text nor translation, generated either automatically or by the programmer (e.g. source references, extracted comments), all of which are out of translator's scope for modifications.</p>
<p>Due to these difficulties, the common way to use line-level diffing with PO files is only for review, and even that with some preparations. Due to myriad line-wise different but semantically equivalent representations of the PO file, it is almost useless to send line-level diffs as patches. Translators are instead told to always send full PO files to the reviewer or the commiter, no matter what is the amount of modifications. Then, the reviewer merges the received PO file (new version), and possibly the original (old version), with current PO template, without wrapping of message strings (<code class="varname">msgid</code>, <code class="varname">msgstr</code>, etc.). This "normalizes" the old and the new file with respect to all semantically non-significant elements, and only then can line-level diffing be performed. Additionally, since a long non-wrapped line of text may differ only in few words, a dedicated diff viewer which can highlight <span class="emphasis"><em>word-level</em></span> differences should be used. Ordinary diff syntax highlighting (e.g. in shell, or in general text editor) would waste reviewer's time in trying to see those few changed words.</p>
<p>Even with preparations and dedicated diff viewer at hand, there is at least one significant case which is still not reasonably covered: when a fuzzy message with previous strings (i.e. when PO file was merged with <code class="option">--previous</code> option to <span class="command"><strong>msgmerge</strong></span>) has been updated and unfuzzied. For example:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
#: main.c:110
#, fuzzy
#| msgid "The Record of The Witch River"
msgid "Records of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
#: main.c:110
msgid "Records of The Witch River"
msgstr "Beleške o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
⁠  #: main.c:110
- #, fuzzy
- #| msgid "The Record of The Witch River"
  msgid "Records of The Witch River"
- msgstr "Beleška o Veštičjoj reci"
+ msgstr "Beleške o Veštičjoj reci"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>The line-level diff viewer will know to show word-level diff for modified translation, but it cannot know that it should also show word-level diff between the removed previous and current <code class="varname">msgid</code> strings, so that reviewer can see what has changed <span class="emphasis"><em>in the original</em></span> text (i.e. why had the message became fuzzy), and based on that judge whether the translation was properly adapted.</p>
<p>A dedicated PO editor may be able to show the truly proper, <span class="emphasis"><em>message-level</em></span> difference.<sup>[<a name="id601725" href="#ftn.id601725" class="footnote" id="id601725">10</a>]</sup> Even then, however, it remains necessary to send around full PO files, and possibly to normalize them to a lesser extent before comparing. Additionally, the diff format becomes tied to the given PO editor, instead of being self-contained and processable by various tools (such as line-level diffs are).</p>
<p>This chapter therefore introduces the format and semantics for self-contained, message-level diffing of PO files -- the <span class="emphasis"><em>embedded diff</em></span> -- and presents the Pology tools which implement it.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-dpformat" id="sec-dpformat"></a>4.1.&nbsp;The Embedded Diff Format</h2>
</div>
</div>
</div>
<p>Difference between two PO messages should primarily, though not exclusively, consist of differences between its string parts (<code class="varname">msgid</code>, <code class="varname">msgstr</code>, etc.) To be well observable, differences between strings should be as localized as possible -- think of a long paragraph in which only the spelling of a word or some punctuation was changed. Finally, the format of the complete PO message diff should be intuitively comprehensible to translators which are used to the PO format itself, and to some extent compatible with existing PO processing tools.</p>
<p>These considerations lead to making the diff of two PO messages be a PO message itself. In other words, the diff gets <span class="emphasis"><em>embedded</em></span> into the regular parts of a PO message. An embedded diff (<span class="emphasis"><em>ediff</em></span> for short) message should be at least syntactically valid, if not semantically (it should not cause a simple <span class="command"><strong>msgfmt</strong></span> run to fail, though <span class="command"><strong>msgfmt --check</strong></span> could). To be possible to exchange ediffs as patches for PO files, the embedding should be resolvable into the old and the new messages from which the diff was created.</p>
<p>In this way, if ediff messages are packed into a PO file (an <span class="emphasis"><em>ediff PO</em></span>), existing PO tools can be used to review and modify the diff. For example, highlighting in a text editor will need only minimal upgrades to show the embedded differences (more on that below), and otherwise it will already highlight ediff message parts as usual.</p>
<p>To fully define the ediff format, the following questions should be answered:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>How to represent embedded differences in strings?</p>
</li>
<li class="listitem">
<p>Which parts of the PO message should be diffed?</p>
</li>
<li class="listitem">
<p>How to pair for diffing messages from two PO files?</p>
</li>
<li class="listitem">
<p>How to present collection of diffed messages?</p>
</li>
</ul>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dpfrmembstr" id="sec-dpfrmembstr"></a>4.1.1.&nbsp;Embedding Differences into Strings</h3>
</div>
</div>
</div>
<p>Once the word-level difference between the old and the new string has been computed, it should be somehow embedded it into the new string (or, equivalently, the old string). This can be done by wrapping removed and added text segments with <code class="literal">{-...-}</code> and <code class="literal">{+...+}</code>, respectively:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
"Records of The Witch River"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
"Records of The Witch River"
</pre></td>
</tr>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
"{-The Record-}{+Records+} of The Witch River"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>It may happen that an opening or closing wrapper sequence occurs as a literal part of diffed strings<sup>[<a name="id654864" href="#ftn.id654864" class="footnote" id="id654864">11</a>]</sup>, so some method of escaping is necessary. This is done by inserting a <code class="literal">~</code> (tilde) in the middle of the literal sequence:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
"Foo {+ bar"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
"Foo {+ qwyx"
</pre></td>
</tr>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
"Foo {~+ {-bar-}{+qwyx+}"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>If strings instead contain the literal sequence <code class="literal">{~+</code>, then another tilde is inserted, and so on. In this way, ediff can be unambiguously resolved to old and new versions of the string. Escaping by inserting tildes also makes it easier to write a syntax higlighting definition for an editor, as the wrapper pattern is automatically broken by the tilde.</p>
<p>It may happen that a given string is not merely empty in the old or new PO message, but that it does not exist at all (e.g. <code class="literal">msgctxt</code>). For this reason it is possible to make ediff between an existing and non-existing string as well, in which case a tilde is appended to the very end of the ediff:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
 
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
"a-context-note"
</pre></td>
</tr>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
"{+a-context-note+}~"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>Here too escaping is provided, by inserting further tildes if the ediff between two existing strings would result in a trailing tilde (if the old string is <code class="literal">"~"</code> and the new <code class="literal">"foo~"</code>, the ediff is <code class="literal">"{+foo+}~~"</code>).</p>
<p>It is not necessary to prescribe the exact algorithm for computing the difference between two strings. In fact, the diffing tool may allow translator to select between several diffing algorithms, depending on personal taste and situation. For example, the default algorithm of <a class="link" href="#sec-dpdiff" title="4.2.&nbsp;Producing Ediffs with poediff">Pology's <span class="command"><strong>poediff</strong></span></a> does the following: words are diffed as atomic sequences, all non-word segments (punctuation, markup tags, etc.) are diffed character by character, and equal non-word segments in between two different words (e.g. whitespace) are included into the difference segment. Hence the above ediff</p>
<pre class="programlisting">
"{-The Record-}{+Records+} of The Witch River"
</pre>
<p>instead of the smaller</p>
<pre class="programlisting">
"{-The -}Record{+s+} of The Witch River"
</pre>
<p>as the former is (tentatively) easier to comprehend.</p>
<p>Since every difference segment in the ediff message is represented in the described way, it is sufficient to upgrade the PO syntax highlighting of an editor<sup>[<a name="id661782" href="#ftn.id661782" class="footnote" id="id661782">12</a>]</sup> to indiscriminately highlight <code class="literal">{-...-}</code> and <code class="literal">{+...+}</code> segments everywhere in the message.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dpfrmincparts" id="sec-dpfrmincparts"></a>4.1.2.&nbsp;Message Parts Included in Diffing</h3>
</div>
</div>
</div>
<p>A PO message consists of several types of parts: strings, comments, flags, source references, etc. It would not be very constructive to diff all of them; for example, while <code class="varname">msgstr</code> strings should clearly be included into diffing, source references most probably should not. To avoid pondering over the advantages and disadvantages of including each and every message part, there already exists a well-defined splitting of message parts into two groups, one of which will be taken into diffing, and the other not. These two groups are:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><a name="p-msgparts-extinv" id="p-msgparts-extinv"></a><span class="emphasis"><em>Extraction-invariant</em></span> parts are those which do not depend on placement (or even presence) of the message in the source file. These are <code class="varname">msgid</code> string, <code class="varname">msgstr</code> strings, manual comments, etc.</p>
</li>
<li class="listitem">
<p><a name="p-msgparts-extpre" id="p-msgparts-extpre"></a><span class="emphasis"><em>Extraction-prescribed</em></span> parts are those which cannot exist independently of the source file from which the message is extracted, such as format flags or extracted comments.</p>
</li>
</ul>
</div>
<p>Only extraction-invariant parts will be diffed. The working definition of which parts belong to this group is provided by what remains in obsolete messages in PO files:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>current original text: <code class="varname">msgctxt</code>, <code class="varname">msgid</code>, and <code class="varname">msgid_plural</code> strings</p>
</li>
<li class="listitem">
<p>previous original text: <code class="literal">#| msgctxt</code>, <code class="literal">#| msgid</code>, and <code class="literal">#| msgid_plural</code> comments</p>
</li>
<li class="listitem">
<p>translation text: <code class="varname">msgstr</code> strings</p>
</li>
<li class="listitem">
<p>translator comments</p>
</li>
<li class="listitem">
<p>fuzzy state (whether the <code class="literal">fuzzy</code> flag is present)</p>
</li>
<li class="listitem">
<p>obsolete state (whether the message is obsolete)</p>
</li>
</ul>
</div>
<p>Strings and translator comments are presented in the ediff message as embedded word-level differences, as described earlier. Changes in state, fuzzy and obsolete, are represented differently. A special "extracted" comment is added to the ediff message, starting with <code class="literal">#. ediff:</code> and listing any extra information needed to describe the ediff, including the state changes. Here is an example of two messages and the ediff they would produce<sup>[<a name="id637668" href="#ftn.id637668" class="footnote" id="id637668">13</a>]</sup>:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
#, fuzzy
#~| msgid "Accurate subpolar weather cycles"
#~ msgid "Accurate subpolar climate cycles"
#~ msgstr "Tačni ciklusi subpolarnog vremena"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
#. ui: property (text), widget (QCheckBox, accCyclesTrop)
#: config.ui:180
#, fuzzy
#| msgid "Accurate tropical weather cycles"
msgctxt "some-superfluous-context"
msgid "Accurate tropical climate cycles"
msgstr "Tačni ciklusi tropskog vremena"
</pre></td>
</tr>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
#. ediff: state {-obsolete-}
#. ui: property (text), widget (QCheckBox, accCyclesTrop)
#: config.ui:180
#, fuzzy
#| msgid "Accurate {-subpolar-}{+tropical+} weather cycles"
msgctxt "{+some-superfluous-context+}~"
msgid "Accurate {-subpolar-}{+tropical+} climate cycles"
msgstr "Tačni ciklusi {-subpolarnog-}{+tropskog+} vremena"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>The first thing to note is that the ediff message contains not only the extraction-invariant parts, but also verbatim copies of extraction-prescribed parts from the new message. Effectively, the ediff is embedded into the copy of the new message. Extraction-prescribed parts are not simply discarded in order to provide more context when reviewing the diff. Here, for example, the extracted comment states that the text is a checkbox label, which may be important for the style of translation.</p>
<p>The other important element is the <code class="literal">#. ediff:</code> dummy extracted comment, which here indicates that the obsolete state has been "removed", i.e. the message was unobsoleted betwen then old and the new version of the PO file. Aside from state changes, few other indicators may be present in this comment, and they will be mentioned later on. The ediff comment is present only when necessary, if there are any indicators to show.</p>
<p>If diffing of two messages would always be conducted part for part, for all message parts which are taken into diffing, then in some cases the resulting ediff would not be very useful. Consider how the first example in this chapter, the line-level diff of a fuzzy and translated message, would look like as ediff if diffed part for part:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
#: main.c:110
#, fuzzy
#| msgid "The Record of The Witch River"
msgid "Records of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
#: main.c:110
msgid "Records of The Witch River"
msgstr "Beleške o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
#. ediff: state {-fuzzy-}
#: main.c:110
#| msgid "{-The Record of The Witch River-}~"
msgid "Records of The Witch River"
msgstr "{-Beleška-}{+Beleške+} o Veštičjoj reci"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>This ediff suffers from the same problem as the line-level diff: instead of showing the difference from previous to current <code class="varname">msgid</code> string, the current <code class="varname">msgid</code> is left untouched, while the previous <code class="varname">msgid</code> is simply shown to have been removed.</p>
<p>Therefore, instead of diffing directly part for part, a special transformation takes place when <span class="emphasis"><em>exactly one</em></span> of the two diffed messages is fuzzy and contains previous original strings. This splits into two directions: from fuzzy to non-fuzzy, and from non-fuzzy to fuzzy.</p>
<p>Diffing from a fuzzy to a non-fuzzy message is the more usual of the two directions. It typically appears when the translation has been updated after merging with template. In this case, the old and the new message are shuffled prior to diffing in the following way (<code class="literal">*-rest</code> denotes all diffed parts that are neither original text nor fuzzy state):</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
fuzzy                   --&gt;     fuzzy
old-previous-strings    --&gt;     old-previous-strings
old-current-strings     --&gt;     old-previous-strings
old-rest                --&gt;     old-rest
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
-                       --&gt;     -
-                       --&gt;     old-current-strings
new-current-strings     --&gt;     new-current-strings
new-rest                --&gt;     new-rest
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>When these shuffled messages are diffed, the resulting ediff message's current strings will show the important difference, that between the previous original text of the old (fuzzy) message and the current original text of the new (non-fuzzy) message. Ediff message's previous strings will show the less important difference between the old message's previous and current strings, but <span class="emphasis"><em>only</em></span> if it is not the same as the difference between current strings. This may sound confusing, but the actual ediff produced in this way is quite intuitive:</p>
<div class="informaltable"><a name="t-ediff-f-to-nf" id="t-ediff-f-to-nf"></a>
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
#: main.c:110
#, fuzzy
#| msgid "The Record of The Witch River"
msgid "Records of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
#: main.c:110
msgid "Records of The Witch River"
msgstr "Beleške o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
#. ediff: state {-fuzzy-}
#: main.c:110
msgid "{-The Record-}{+Records+} of The Witch River"
msgstr "{-Beleška-}{+Beleške+} o Veštičjoj reci"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>From this the reviewer can see that the message was unfuzzied, the change in the original text that caused the message to become fuzzy, and what was changed in the translation to unfuzzy it. The old version of the text (in removed and equal segments) is that from the message <span class="emphasis"><em>before</em></span> it got fuzzied, and the new version (in added and equal segments) is that from the message after it was unfuzzied.</p>
<p>The other special direction, from a non-fuzzy to a fuzzy message, should be less frequent. It appears, for example, when the diff is taken from the old, completely translated PO file, to the new PO file which has been merged with the latest template. In this case, the shuffling is as follows:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
-                       --&gt;     -
-                       --&gt;     new-previous-strings
old-current-strings     --&gt;     old-current-strings
old-rest                --&gt;     old-rest
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
fuzzy                   --&gt;     fuzzy
new-previous-strings    --&gt;     new-current-strings
new-current-strings     --&gt;     new-current-strings
new-rest                --&gt;     new-rest
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>The difference in ediff messages's current strings will again be the most important one, and in previous strings the less important one and shown only if not equal to the difference in current strings. Here is what this will result in when applied one step earlier, just after merging with template:</p>
<div class="informaltable"><a name="t-ediff-nf-to-f" id="t-ediff-nf-to-f"></a>
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
#: main.c:89
msgid "The Record of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
#: main.c:110
#, fuzzy
#| msgid "The Record of The Witch River"
msgid "Records of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
#. ediff: state {+fuzzy+}
#: main.c:110
#, fuzzy
msgid "{-The Record-}{+Records+} of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>The reviewer can see that the message became fuzzy, and the change in the original text that caused that.</p>
<p>The diffing tool may add custom additional information at the end of any strings in the ediff message (<code class="varname">msgid</code>, <code class="varname">msgstr</code>, etc.), separated with a newline, a repeated block of one or more characters, and a newline. When this is done, the <code class="literal">#. ediff:</code> comment will have the <code class="literal">infsep</code> indicator, which states the character block used and the number of repetitions in the separator:</p>
<pre class="programlisting">
#. ediff: state {+fuzzy+}, infsep +- 20
#: main.c:110
#, fuzzy
msgid "{-The Record-}{+Records+} of The Witch River"
msgstr ""
"Beleška o Veštičjoj reci\n"
"+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-\n"
"<em class="replaceable"><code>additional-information&gt;</code></em>"
</pre>
<p>Of course, the diffing tool should compute the appropriate separator such that it does not conflict with a part of the text in one of the strings. What could be this additional information? For example, it could be a filtered version of the text, to ease some special review type.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dpfrmpairing" id="sec-dpfrmpairing"></a>4.1.3.&nbsp;Pairing Messages From Two PO Files</h3>
</div>
</div>
</div>
<p>By now it was described how to make an embedded diff out of two messages, once it has been decided that those messages should be diffed. However, the translator is not expected to decide which messages to diff, but which PO files to diff. The diffing tools should then automatically <span class="emphasis"><em>pair</em></span> for diffing the messages from the two PO files, and this section describes the several pairing criteria.</p>
<p>Most obviously, messages should be <span class="emphasis"><em>paired by key</em></span>, which can be called primary pairing. The PO message key is the unique combination of <code class="varname">msgctxt</code> and <code class="varname">msgid</code> strings. In the most usual case -- reviewing an ediff from incomplete PO file with fuzzy and untranslated messages, to an updated PO file with those messages translated -- pairing by key will be fully sufficient, as both PO files will contain exactly the same set of messages. These two messages will be paired by key:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
#: main.c:110
#, fuzzy
#| msgid "The Record of The Witch River"
msgid "Records of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
#: main.c:110
msgid "Records of The Witch River"
msgstr "Beleške o Veštičjoj reci"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>But what should happen if some messages are left unpaired after pairing by key? Consider the earlier example where the diff was taken from the older fully translated to the newer merged PO file:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
#: main.c:89
msgid "The Record of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
#: main.c:110
#, fuzzy
#| msgid "The Record of The Witch River"
msgid "Records of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>The keys, here just current <code class="varname">msgid</code> strings, of the two messages do not match, so they cannot be paired by key. Yet it would be ungainly to represent the old message as fully removed, and the new message as fully added, in the resulting ediff:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
#: main.c:89
msgid "{-The Record of The Witch River-}~"
msgstr "{-Beleška o Veštičjoj reci-}~"
⁠
#. ediff: state {+fuzzy+}
#: main.c:110
#, fuzzy
#| msgid "{+The Record of The Witch River+}~"
msgid "{+Records of The Witch River+}~"
msgstr "{+Beleška o Veštičjoj reci+}~"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>(That the message has been fully added or removed can be seen by trailing tilde in the <code class="varname">msgid</code> string, which indicates that the old or new <code class="varname">msgid</code> does not exist at all, and so neither the message with it.)</p>
<p><a name="p-pairing-pivoting" id="p-pairing-pivoting"></a>Instead, messages left unpaired by key should be tested for <span class="emphasis"><em>pairing by pivoting</em></span> around previous strings (secondary pairing). The two messages above will thus be paired due to the fact that the current <code class="varname">msgid</code> of the old message is equal to the previous <code class="varname">msgid</code> of the new message, and will produce a single ediff message <a class="link" href="#t-ediff-nf-to-f">as shown earlier</a>.</p>
<p><a name="p-pairing-merging" id="p-pairing-merging"></a>Finally, consider the third related combination, when the old PO file has not yet been merged with the template, while the new PO file has both been merged and its translation updated:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
#: main.c:89
msgid "The Record of The Witch River"
msgstr "Beleška o Veštičjoj reci"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
#: main.c:110
msgid "Records of The Witch River"
msgstr "Beleške o Veštičjoj reci"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>Once again it would be a waste to present the old message as fully removed and the new message as fully added in the resulting ediff. When a message is left unpaired after both pairing by key and pairing by pivoting, then the two PO files can be merged in the background -- as if the new is the template for the old, and vice versa -- and then tested for chained pairing by pivoting and by key with the merged PO file as intermediary. This <span class="emphasis"><em>pairing by merging</em></span> (tertiary pairing) will then produce another natural ediff:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
#: main.c:110
msgid "{-The Record-}{+Records+} of The Witch River"
msgstr "{-Beleška-}{+Beleške+} o Veštičjoj reci"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>It can be left to the diffing tool to decide which pairing methods beyond the primary pairing, by key, to use. There should not be much reason not to perform secondary pairing, by pivoting, as well. If tertiary pairing, by merging, is done, the user should be allowed to disable it, as it can sometimes produce strange results (subject to the fuzzy matching algorithm).</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dpfrmcollect" id="sec-dpfrmcollect"></a>4.1.4.&nbsp;Collecting Diffed Messages</h3>
</div>
</div>
</div>
<p>For the ediff of two PO files to also be a syntactically valid PO file, constructed ediff messages should be preceded by a PO header in output. At first glance, this PO header could be itself the ediff of headers of the PO files which were diffed. However, there are several issues with this approach:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The reviewer of the ediff PO file would not be informed at once if there was any difference between the headers. Headers tend to be long, and a small change in one of header fields may go visually unnoticed.</p>
</li>
<li class="listitem">
<p>Depending on the amount of changes between the two headers, the resulting ediff message of the header could be too badly formed to represent the header as such. For example, if some header fields in <code class="varname">msgstr</code> were added or removed, embedded difference wrappers would invalidate the MIME-header format of <code class="varname">msgstr</code>, which could confuse PO processing tools.</p>
</li>
<li class="listitem">
<p>How would the diff of two <span class="emphasis"><em>collections</em></span> of PO files (e.g. directories) be packed into a single ediff PO? To pack diffs of several file pairs into one diff file is an expected feature of diffing tools.</p>
</li>
</ul>
</div>
<p>To avert these difficulties, the following is done instead. First, a minimal valid header is constructed for the ediff PO file, <span class="emphasis"><em>independently</em></span> of the headers in diffed PO files. The precise content can be left to the diffing tool, with <a class="link" href="#sec-dpdiff" title="4.2.&nbsp;Producing Ediffs with poediff">Pology's <span class="command"><strong>poediff</strong></span></a> producing something like:</p>
<pre class="programlisting">
# +- ediff -+
msgid ""
msgstr ""
"Project-Id-Version: ediff\n"
"PO-Revision-Date: 2009-02-08 01:20+0100\n"
"Last-Translator: J. Random Translator\n"
"Language-Team: Differs\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"X-Ediff-Header-Context: ~\n"
</pre>
<p>The <code class="literal">PO-Revision-Date</code> header field is naturally set to the date when the ediff was made. Values for the <code class="literal">Last-Translator</code> and <code class="literal">Language-Team</code> fields can be somehow pulled from the environment (<span class="command"><strong>poediff</strong></span> will fetch them from <a class="link" href="#sec-cmcfguser" title="9.2.1.&nbsp;The [user] section">Pology user configuration</a>, or set some dummy values). Encoding of the ediff PO can be chosen at will, so long as all constructed ediff messages can be encoded with it (<span class="command"><strong>poediff</strong></span> will always use UTF-8). The purpose of the final, <code class="literal">X-Ediff-Header-Context</code> field will be explained shortly.</p>
<p>It is the first next entry in the ediff PO file that will actually be the ediff of headers of the two diffed PO files. Headers are diffed just like any other message, but the resulting ediff is given a few additional decorations:</p>
<pre class="programlisting">
# =========================================================
# Translation of The Witch River into Serbian.
# Koja Kojic &lt;koja.kojic@nedohodnik.net&gt;, 2008.
# {+Era Eric &lt;era.eric@ledopad.net&gt;, 2008.+}~
msgctxt "~"
msgid ""
"- l10n-wr/sr/wriver-main.po\n"
"+ l10n-wr/sr-mod/wriver-main.po\n"
msgstr ""
"Project-Id-Version: wriver 0.1\n"
"POT-Creation-Date: 2008-09-22 09:17+0200\n"
"PO-Revision-Date: 2008-09-{-25 20:44-}{+28 21:49+}+0100\n"
"Last-Translator: {-Koja Kojic &lt;koja.kojic@nedohodnik-}"
"{+Era Eric &lt;era.eric@ledopad+}.net&gt;\n"
"Language-Team: Serbian\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
</pre>
<p>Observe the usual ediff segments: translator comment with a new translator who updated the PO file has been added, and the <code class="literal">PO-Revision-Date</code> and <code class="literal">Last-Translator</code> header fields contain ediffs reflecting the update. These are the only actual differences between the two headers. More interesting are the additional decorations:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The very first translator comment (here a long line of equality signs) can be anything, and serves as a strong visual indicator of the header ediff. This is especially convenient when the ediff PO file contains diffs of several pairs of PO files.</p>
</li>
<li class="listitem">
<p>That this particular message is a header ediff, is indicated by the <code class="varname">msgctxt</code> string set to a special value, here a single tilde. This value is given up front by the <code class="literal">X-Ediff-Header-Context</code> of the ediff PO header. It should be computed during diffing such that it does not conflict with <code class="varname">msgctxt</code> of one of the message ediffs (e.g. it may simply be a sufficiently long sequence of tildes).</p>
</li>
<li class="listitem">
<p>The <code class="varname">msgid</code> string of the header ediff contains newline-separated paths of the diffed PO files. More precisely, the two lines of the <code class="varname">msgid</code> string are in the form <code class="literal">[+-] <em class="replaceable"><code>file-path</code></em>[ &lt;&lt;&lt; <em class="replaceable"><code>comment</code></em>]\n</code>. The trailing newline of the second file path is elided if the <code class="varname">msgstr</code> string does not end in newline, to prevent <span class="command"><strong>msgfmt</strong></span> from complaining. The file path is followed by the optional, <code class="literal">&lt;&lt;&lt;</code>-separated comment. This comment can be used for any purpose, one which will be demonstrated in <span class="command"><strong>poediff</strong></span>.</p>
</li>
</ul>
</div>
<p>Although when a PO file is properly updated there should always be some difference in the header, it may happen that there is none. In such case, the header ediff message is still added, but it contains only the additional decorations: the visual separator comment, the special <code class="varname">msgctxt</code>, and the <code class="varname">msgid</code> with file paths. All other comments and <code class="varname">msgstr</code> are empty; the empty <code class="varname">msgstr</code> immediatelly shows that there is no difference between the headers. This "empty" header ediff is needed to provide the file paths of diffed PO files, and, if several pairs of PO files were diffed, to separate their diffs in the ediff PO file.</p>
<p>After the header ediff message, ordinary ediff messages follow. When all constructed ediff messages from the current pair of PO files are listed, the next pair starts with a new header ediff message, and so on.</p>
<p>Especially when diffing several pairs of PO files, it may happen that two ediff messages have same keys (<code class="varname">msgid</code> and <code class="varname">msgctxt</code> strings) and thus cannot be both added as such to the ediff PO file. When that happens, the ediff message which was added after the first with the same key, will have its <code class="varname">msgctxt</code> string <span class="emphasis"><em>padded</em></span> by few random alphanumerics, to make its key unique. This padding sequence will be recorded in the <code class="literal">#. ediff:</code> comment, as <code class="literal">ctxtpad</code> field. For example:</p>
<pre class="programlisting">
# =========================================================
msgctxt "~"
msgid "...(first PO header ediff)..."
msgstr "..."
⁠
#. ediff: state {-fuzzy-}
msgid "White{+ horizon+}"
msgstr "Belo{+ obzorje+}"
⁠
# =========================================================
msgctxt "~"
msgid "...(second PO header ediff)..."
msgstr "..."
⁠
#. ediff: state {-fuzzy-}, ctxtpad q9ac3
msgctxt "|q9ac3~"
msgid "White{+ horizon+}"
msgstr "Belo{+ obzorje+}"
</pre>
<p>The padding sequence is appended to the original <code class="varname">msgctxt</code>, separated by <code class="literal">|</code>. If there was no original <code class="varname">msgctxt</code>, the padding sequence is further extended by a tilde.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-dpdiff" id="sec-dpdiff"></a>4.2.&nbsp;Producing Ediffs with <span class="command"><strong>poediff</strong></span></h2>
</div>
</div>
</div>
<p>The <span class="command"><strong>poediff</strong></span> script in Pology implements embedded diffing of PO files as defined in the previous section. To diff two PO files, running the usual:</p>
<pre class="programlisting">
$ poediff orig/foo.po mod/foo.po
</pre>
<p>will write out the ediff PO content to standard output, with some basic shell coloring of difference segments. The ediff can be written into a file (an ediff PO file) either with shell redirection, or the <code class="option">-o</code>/<code class="option">--output</code>. It is equally simple to diff directories:</p>
<pre class="programlisting">
$ poediff orig/ mod/
</pre>
<p>By default, given directories are recursively searched for PO files, and the PO files present in only one of the directories will also be included in the ediff.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dpdiffvcs" id="sec-dpdiffvcs"></a>4.2.1.&nbsp;Diffing With Underlying VCS</h3>
</div>
</div>
</div>
<p>When PO files are handled by a version control system (VCS), <span class="command"><strong>poediff</strong></span> can be put into VCS mode using the <code class="option">-c/--vcs <em class="replaceable"><code>VCS</code></em></code> option, where the value is the keyword of one of the <a class="link" href="#sec-cmsuppvcs" title="9.7.2.&nbsp;Version Control Systems">version control systems supported by Pology</a>. In VCS mode, instead of giving two paths to diff, any number of version-controlled paths (files or directories) are given. Without other options, all locally modified PO files in these paths are diffed against the last commit known to local repository. For example, if a program is using a Subversion repository, then the PO files in its <code class="filename">po/</code> directory can be diffed with:</p>
<pre class="programlisting">
$ poediff -c svn prog/po/
</pre>
<p>Specific revisions to diff can be given by the <code class="option">-r/--revision <em class="replaceable"><code>REV1</code></em>[:<em class="replaceable"><code>REV2</code></em>]</code>. <code class="literal"><em class="replaceable"><code>REV1</code></em></code> and <code class="literal"><em class="replaceable"><code>REV2</code></em></code> are not necessarily direct revision IDs, but any strings that the underlying VCS can convert into revision IDs. If <code class="literal"><em class="replaceable"><code>REV2</code></em></code> is omitted, diffing is preformed from <code class="literal"><em class="replaceable"><code>REV1</code></em></code> to current working copy.</p>
<p>When ediff is made in VCS mode, <code class="varname">msgid</code> strings in header ediffs will state revision IDs, in &lt;&lt;&lt;-separated comments next to file paths:</p>
<pre class="programlisting">
# =========================================================
# ...
msgctxt "~"
msgid ""
"- prog/po/sr.po &lt;&lt;&lt; 20537\n"
"+ prog/po/sr.po"
msgstr "..."
</pre></div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dpdiffopt" id="sec-dpdiffopt"></a>4.2.2.&nbsp;Command Line Options</h3>
</div>
</div>
</div>
<p>Options specific to <span class="command"><strong>poediff</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-b</code>, <code class="option">--skip-obsolete</code></span></dt>
<dd>
<p>By default, <a class="link" href="#sec-poobsol" title="2.5.3.&nbsp;Obsolete Messages">obsolete messages</a> are treated equally to non-obsolete, and can feature in the ediff output. This makes it possible to detect when a message has become obsolete, or has returned from obsolescence, and show this in the ediff. But sometimes including obsolete messages into diffing may not desired, and then this option can be issued to ignore them.</p>
</dd>
<dt><span class="term"><code class="option">-c <em class="replaceable"><code>VCS</code></em></code>, <code class="option">--vcs=<em class="replaceable"><code>VCS</code></em></code></span></dt>
<dd>
<p>The keyword of the underlying version control system, to switch <span class="command"><strong>poediff</strong></span> into <a class="link" href="#sec-dpdiffvcs" title="4.2.1.&nbsp;Diffing With Underlying VCS">VCS mode</a>. See <a class="xref" href="#sec-cmsuppvcs" title="9.7.2.&nbsp;Version Control Systems">Section&nbsp;9.7.2, “Version Control Systems”</a> for the list of supported version control systems (or issue <code class="option">--list-vcs</code> option).</p>
</dd>
<dt><span class="term"><code class="option">--list-options</code>, <code class="option">--list-vcs</code></span></dt>
<dd>
<p>Simple listings of options and VCS keywords. Intended mainly for writting shell completion definitions.</p>
</dd>
<dt><span class="term"><code class="option">-n</code>, <code class="option">--no-merge</code></span></dt>
<dd>
<p>Disable pairing of messages by <a class="link" href="#p-pairing-merging">by internal merging</a> of diffed PO files. Merging is performed only if there were some messages left unpaired after pairing by key and <a class="link" href="#p-pairing-pivoting">by pivoting</a>, so in the usual circumstances it is not done anyway. But when it is done, it may produce strange results, so this option can be used to prevent it.</p>
</dd>
<dt><span class="term"><code class="option">-o <em class="replaceable"><code>FILE</code></em></code>, <code class="option">--output=<em class="replaceable"><code>FILE</code></em></code></span></dt>
<dd>
<p>The ediff is by default written to the standard output, and this option can be used to send it to a file instead.</p>
</dd>
<dt><span class="term"><code class="option">-p</code>, <code class="option">--paired-only</code></span></dt>
<dd>
<p>When directories are diffed, by default the PO files present in only one of them will be included into the ediff, i.e. all their messages will be shown as added or removed. This option will limit diffing only to files present in both directories, in the sense of having the same relative paths (rather than e.g. same PO domain name).</p>
</dd>
<dt><span class="term"><code class="option">-Q</code>, <code class="option">--quick</code></span></dt>
<dd>
<p>Produced maximally stripped-down output, sometimes useful for quick visual observation of changes, but which cannot be used as patch. Equivalent to <code class="option">-bns</code>.</p>
</dd>
<dt><span class="term"><code class="option">-r <em class="replaceable"><code>REV1</code></em>[:<em class="replaceable"><code>REV2</code></em>]</code>, <code class="option">--revision=<em class="replaceable"><code>REV1</code></em>[:<em class="replaceable"><code>REV2</code></em>]</code></span></dt>
<dd>
<p>When operating in <a class="link" href="#sec-dpdiffvcs" title="4.2.1.&nbsp;Diffing With Underlying VCS">VCS mode</a>, the default is to make the diff from the last commit to the current working copy. This option can be used to diff between any two revisions. If the second revision is omitted, the diff is taken from first revision to current working copy.</p>
</dd>
<dt><span class="term"><code class="option">-s</code>, <code class="option">--strip-headers</code></span></dt>
<dd>
<p>Prevents diffing of PO headers, as well as inclusion of top ediff header in the output. This reduces clutter when the intention is to see only changes in messages through many PO files, but the resulting ediff cannot be used as patch.</p>
</dd>
</dl>
</div>
<p>Options common with other Pology tools:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-R</code>, <code class="option">--raw-colors</code>; <code class="option">--coloring-type</code></span></dt>
<dd>
<p>See <a class="xref" href="#sec-cmcolors" title="9.6.&nbsp;Output Coloring">Section&nbsp;9.6, “Output Coloring”</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dpdiffcfg" id="sec-dpdiffcfg"></a>4.2.3.&nbsp;User Configuration</h3>
</div>
</div>
</div>
<p><span class="command"><strong>poediff</strong></span> will consult <a class="link" href="#sec-cmcfguser" title="9.2.1.&nbsp;The [user] section">the <code class="literal">[user]</code> section</a> in <a class="link" href="#sec-cmconfig" title="9.2.&nbsp;User Configuration">user configuration</a> to fill out some of the header of the ediff PO file. It also consults its own section, with the following fields avaialbe:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[poediff]/merge=[*yes|no]</code></span></dt>
<dd>
<p>Setting to <code class="literal">no</code> is counterpart to <code class="option">--no-merge</code> command line option, i.e. this field can be used to permanently disable message pairing <a class="link" href="#p-pairing-merging">by merging</a>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-dppatch" id="sec-dppatch"></a>4.3.&nbsp;Applying Ediffs as Patches with <span class="command"><strong>poepatch</strong></span></h2>
</div>
</div>
</div>
<p>Basic application of an ediff patch is much easier than that of a line-level patch, because there will be no conflicts if messages have different wrapping, ordering, or <a class="link" href="#p-msgparts-extpre">extraction-prescribed</a> parts (source references, etc.). The patch is applied by resolving each ediff message from it into the originating old and new message, and if either the old or the new message exists (by key) in the target PO file and has equal <a class="link" href="#p-msgparts-extinv">extraction-invariant</a> parts, then the message modification is applied, and otherwise rejected.</p>
<p>Applying the modification to the target message means overwriting its extraction-invariant parts with those from the new message from the ediff, and leaving other parts untouched. If the target message is already equal to the new message by extraction-invariant parts, then the patch is silently ignored. This means that if the same patch is applied twice to the target PO file, the second application makes no modifications. Likewise if, by chance, the modifications given by the patch were already independently performed by another translator (e.g. a few simple updates to unfuzzy messages).</p>
<p>Command-line interface of Pology's <span class="command"><strong>poepatch</strong></span> is much like that of <span class="command"><strong>patch(1)</strong></span>, sans the myriad of its more obscure options. There is the <code class="option">-p</code> option to strip leading elements of file paths in the ediff, and <code class="option">-d</code> option to append to them a directory path where target PO files are to be looked up. If the ediff was produced in <a class="link" href="#sec-dpdiffvcs" title="4.2.1.&nbsp;Diffing With Underlying VCS">VCS mode</a>, then it can be applied as patch in any of the following ways:</p>
<pre class="programlisting">
$ cd repos/prog/po &amp;&amp; poepatch &lt;ediff.po
$ cd repos/ &amp;&amp; poepatch -p0 &lt;ediff.po
$ poepatch -d repos/app/po &lt;ediff.po
</pre>
<p>Header modifications (coming from the header ediff message) are applied in a slightly relaxed fashion: some of the standard header fields are ignored when checking whether the patch is applicable. These are the fields which are known to be volatile as the PO file goes through different translators, and do not influence the processing of the PO file (e.g. such as encoding or plural forms). The ignored fields are: <code class="literal">POT-Creation-Date</code>, <code class="literal">PO-Revision-Date</code>, <code class="literal">Last-Translator</code>, <code class="literal">X-Generator</code>. When the header modification is accepted, the ignored fields in the target header are overwritten with those from the patch (including being added or removed).</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dppatchrej" id="sec-dppatchrej"></a>4.3.1.&nbsp;Handling Rejected Ediffs</h3>
</div>
</div>
</div>
<p>All ediff messages which were rejected as patches will be written out to <code class="filename">stdin.rej.po</code> in the current working directory if the patch was read from standard input, or to <code class="filename"><em class="replaceable"><code>FILE</code></em>.rej.po</code> if the patch file was given by <code class="option">-i <em class="replaceable"><code>FILE</code></em>.po</code> option.</p>
<p>The file with rejected ediff messages will again be an ediff PO file. It will have the header as before, except that its comment will mention that the file contains rejects of a patching operation. Afterwards, rejected ediff messages rejected will follow. Every header ediff message will be present whether rejected or not, for the same purpose of separation and provision of file paths, but if it was not rejected as patch itself, it will be stripped of comments and <code class="varname">msgstr</code> string.</p>
<p>Furthermore, to every straigh-out rejected ediff message an <code class="literal">ediff-no-match</code> flag will be added. This is done, naturally, because some ediff messages may not be rejected straight-out. Consider the following scenario. A PO file has been merged to produce the fuzzy message:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>old</td>
<td>
<pre class="programlisting">
#: tools/power.c:348
msgid "Active sonar low frequency"
msgstr "Niska frekvencija aktivnog sonara"
</pre></td>
</tr>
<tr>
<td>new</td>
<td>
<pre class="programlisting">
#: tools/power.c:361
#, fuzzy
#| msgid "Active sonar low frequency"
msgid "Active sonar high frequency"
msgstr "Niska frekvencija aktivnog sonara"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>The translator updates the PO file, which produces the usual ediff message when going from fuzzy to translated:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>diff</td>
<td>
<pre class="programlisting">
#. ediff: state {-fuzzy-}
#: tools/power.c:361
msgid "Active sonar {-low-}{+high+} frequency"
msgstr "{-Niska-}{+Visoka+} frekvencija aktivnog sonara"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>However, <span class="emphasis"><em>before</em></span> this patch could have been applied, the programmer adds a trailing colon to the same message, and the catalog is merged again to produce:</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="2cm">
<col></colgroup>
<tbody>
<tr>
<td>new-2</td>
<td>
<pre class="programlisting">
#: tools/power.c:361
#, fuzzy
#| msgid "Active sonar low frequency"
msgid "Active sonar high frequency:"
msgstr "Niska frekvencija aktivnog sonara"
</pre></td>
</tr>
</tbody>
</table>
</div>
<p>The patch cannot be cleanly applied at this point, due to the extra colon added in the meantime to the <code class="varname">msgid</code>, so it has to be rejected. If nothing else is done, it would appear in the file of rejects as:</p>
<pre class="programlisting">
#. ediff: state {-fuzzy-}
#: tools/power.c:361
#, ediff-no-match
msgid "Active sonar {-low-}{+high+} frequency"
msgstr "{-Niska-}{+Visoka+} frekvencija aktivnog sonara"
</pre>
<p><a name="p-split-rejects" id="p-split-rejects"></a>It is wastefull to reject such a near-matching patch without any indication that it could be easily adapted to the latest message in the target PO file. Therefore, when an ediff message is rejected, the following analysis is performed: by trying out message pairings as on diffing, could the old message from the patch be paired with a current message from the target PO, and that current message with the new message from the patch? Or, in other words, can an existing message in the target PO be "fitted in between" the old and new messages defined by the patch? If this is the case, instead of the original, two special ediff messages -- <span class="emphasis"><em>split rejects</em></span> -- are constructed and written out: one from the old to the current message, and another from the current to the new message. They are flagged as <code class="literal">ediff-to-cur</code> and <code class="literal">ediff-to-new</code>, respectively:</p>
<pre class="programlisting">
#: tools/power.c:361
#, fuzzy, ediff-to-cur
#| msgid "Active sonar low frequency"
msgid "Active sonar high frequency{+:+}"
msgstr "Niska frekvencija aktivnog sonara"
⁠
#. ediff: state {-fuzzy-}
#: tools/power.c:361
#, ediff-to-new
#| msgid "Active sonar {-low-}{+high+} frequency{+:+}"
msgid "Active sonar {-low-}{+high+} frequency"
msgstr "{-Niska-}{+Visoka+} frekvencija aktivnog sonara"
</pre>
<p>There are more ways to interpret split rejects, depending on the circumstances. In this example, from the <code class="literal">ediff-to-cur</code> message the reviewer can see what had changed in the target message after the translator made the ediff. This can also be seen by comparing difference embedded into previous and current <code class="varname">msgid</code> strings in the <code class="literal">ediff-to-new</code> message. With a bit of editing, the reviewer can fold these two messages into an applicable patch:</p>
<pre class="programlisting">
#. ediff: state {-fuzzy-}
#: tools/power.c:361
#, ediff
msgid "Active sonar {-low-}{+high+} frequency:"
msgstr "{-Niska-}{+Visoka+} frekvencija aktivnog sonara"
</pre>
<p>Since the file of rejects is also an ediff PO, after edits such as this to make some patches applicable, it can be <span class="emphasis"><em>reapplied</em></span> as patch. When that is done, <span class="command"><strong>poepatch</strong></span> will silently ignore all ediff messages having <code class="literal">ediff-no-match</code> or <code class="literal">ediff-to-new</code> flags, as these have already been determined inapplicable. That is why in this example the reviewer has replaced the <code class="literal">ediff-to-new</code> flag with the plain <code class="literal">ediff</code> in the folded ediff message.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dppatchemb" id="sec-dppatchemb"></a>4.3.2.&nbsp;Embedding Patches</h3>
</div>
</div>
</div>
<p>Depending on the kind of text which is being translated, and distance between the source and target language grammar, ortography, and style, it may be difficult to review the ediff in isolation. In general, messages in ediff PO file will lack <span class="emphasis"><em>positional context</em></span>, which is in the full PO provided by messages immediately preceding and following the observed message. For example, a long passage from documentation probably needs no positional context. But a short, newly added message such as "Crimson" could very well need one, if it has neither <code class="varname">msgctxt</code> nor an extracted comment describing it: is it really a color? what grammatical ending should it have (in a language which matches adjective to noun gender)? Several messages around it in the full PO file could easily show whether it is just another color in a row, and their grammatical endings (determined by a translator earlier).</p>
<p>Another difficulty is when an ediff message needs some editing before being applied. This may not be easy to do this directly in the ediff PO file. Everything is fine so long as only the added text segments (<code class="literal">{+...+}</code>) are edited, but if the sentence needs to be restructured more thoroughly, the reviewer would have to make sure to put all additions into existing or new <code class="literal">{+...+}</code> segments, and to wrap all removals as <code class="literal">{-...-}</code> segments. If this is not carefully performed, the patch will not be applicable any more, as the old message resolved from it will no longer exactly match a message in the target PO file.</p>
<p>For these reasons, <span class="command"><strong>poepatch</strong></span> can apply the patch such as not to resolve the ediff, but to set all its extraction-invariant fields to the message in the target PO file. In effect, the target PO file becomes an ediff PO by itself, but only in the messages which were actually patched. To mark these messages for lookup, the usual <code class="literal">ediff</code> flag is added to them. For example, if the message in the patch file was:</p>
<pre class="programlisting">
#: title.c:274
msgid "Tutorial"
msgstr "{-Tutorijal-}{+Podučavanje+}"
</pre>
<p>then when the patch is successfully applied with embedding, the patched message in target PO file will look like this, among other messages:</p>
<pre class="programlisting">
#: main.c:110
msgid "Records of The Witch River"
msgstr "Beleške o Veštičjoj reci"
⁠
#: title.c:292
#, ediff
msgid "Tutorial"
msgstr "{-Tutorijal-}{+Podučavanje+}"
⁠
#: title.c:328
msgid "Start the Expedition"
msgstr "Pođi u ekspediciju"
</pre>
<p>Other than the addition of the <code class="literal">ediff</code> flag, note that the patched message kept its own source reference, rather than being overwritten by that from the patch. Same holds for all extraction-prescribed parts.</p>
<p>The reviewer can now jump over <code class="literal">ediff</code> flags, always having the full positional context for each patched message, and being able to edit it to heart's content, with only minimal care not to invalidate the ediff format. Wrapped difference segments can be entirely removed, non-wrapped segments can be freely edited; it should only not happen that a wrapped segment looses its opening or closing sequence. But this does not mean that the reviewer has to remove difference segments, that is, to manually unembed patched messages. <span class="command"><strong>poepatch</strong></span> can do this automatically, when run on the embedded-patched PO file with the <code class="option">-u</code>/<code class="option">--unembed</code> option.</p>
<p>A patch is applied with embedding by issuing the <code class="option">-e</code>/<code class="option">--embed</code> option:</p>
<pre class="programlisting">
$ poepatch -e &lt;ediff.po
patched (E): foo.po
</pre>
<p>where <code class="literal">(E)</code> in the output indicates that the embedding is engaged. After the patched PO file had been reviewed and patched messages possibly edited, all remaining embedded differences are removed, i.e. resolved to new versions, by running:</p>
<pre class="programlisting">
$ poepatch -u foo.po
</pre>
<p>More precisely, only those messages having the <code class="literal">ediff</code> flag are resolved, therefore the reviewer <span class="emphasis"><em>must not</em></span> remove them (unless manually unembedding the whole message).</p>
<p>What happens with rejected patches when embedding is engaged? They are also added into the target PO file, with heuristic positioning, and no separate file with rejects is created. Same as on plain patching, straight-out rejects will have the <code class="literal">ediff-no-match</code> flag, and split rejects <code class="literal">ediff-to-cur</code> or <code class="literal">ediff-to-new</code>. If these are not manually resolved during the review (<code class="literal">ediff-no-match</code> messages removed, <code class="literal">ediff-to-*</code> messages removed or folded), when <span class="command"><strong>poepatch</strong></span> is run to unembed the differences, it will remove all <code class="literal">ediff-no-match</code> and <code class="literal">ediff-to-new</code> messages, and resolve <code class="literal">ediff-to-cur</code> messages to current version.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dppatchopt" id="sec-dppatchopt"></a>4.3.3.&nbsp;Command Line Options</h3>
</div>
</div>
</div>
<p>Options specific to <span class="command"><strong>poepatch</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-a</code>, <code class="option">--aggressive</code></span></dt>
<dd>
<p>After the messages from the patch and the target PO file have been paired, normally only those differences that have no conflicts (e.g. in translation) will be applied. This option can be issued to instead unconditionally overwrite all <a class="link" href="#p-msgparts-extinv">extraction-invariant</a> parts of the message in the target PO file with those defined by the paired patch.</p>
</dd>
<dt><span class="term"><code class="option">-d</code>, <code class="option">--directory</code></span></dt>
<dd>
<p>The directory path to prepend to file paths read from the patch file, when trying to match the files on disk to patch.</p>
</dd>
<dt><span class="term"><code class="option">-e</code>, <code class="option">--embed</code></span></dt>
<dd>
<p>Apply patch <a class="link" href="#sec-dppatchemb" title="4.3.2.&nbsp;Embedding Patches">with embedding</a>.</p>
</dd>
<dt><span class="term"><code class="option">-i <em class="replaceable"><code>FILE</code></em></code>, <code class="option">--input=<em class="replaceable"><code>FILE</code></em></code></span></dt>
<dd>
<p>Read the patch from the given file instead from standard input.</p>
</dd>
<dt><span class="term"><code class="option">-n</code>, <code class="option">--no-merge</code></span></dt>
<dd>
<p>When <a class="link" href="#p-split-rejects">split rejects</a> are computed, all <a class="link" href="#sec-dpfrmpairing" title="4.1.3.&nbsp;Pairing Messages From Two PO Files">methods for pairing messages</a> like on diffing are used. Pairing by merging can sometimes lead to same strange results as on diffing, and this option disables it.</p>
</dd>
<dt><span class="term"><code class="option">-p <em class="replaceable"><code>NUM</code></em></code>, <code class="option">--strip=<em class="replaceable"><code>NUM</code></em></code></span></dt>
<dd>
<p>Strips the smallest prefix containing the given number of slashes from file paths read from the patch file, when trying to match the files on disk to patch. If this option is not given, only the base name of each read file path is taken as relative path to match on disk. (This is the same behavior as in <span class="command"><strong>patch(1)</strong></span>.)</p>
</dd>
<dt><span class="term"><code class="option">-u</code>, <code class="option">--unembed</code></span></dt>
<dd>
<p>Clears all embedded differences in input PO files, after they have been patched <a class="link" href="#sec-dppatchemb" title="4.3.2.&nbsp;Embedding Patches">with embedding</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-dppatchcfg" id="sec-dppatchcfg"></a>4.3.4.&nbsp;User Configuration</h3>
</div>
</div>
</div>
<p><span class="command"><strong>poepatch</strong></span> consults the following <a class="link" href="#sec-cmconfig" title="9.2.&nbsp;User Configuration">user configuration</a> fields:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[poepatch]/merge=[*yes|no]</code></span></dt>
<dd>
<p>Setting to <code class="literal">no</code> is counterpart to <code class="option">--no-merge</code> command line option, i.e. this field can be used to permanently disable <a class="link" href="#p-pairing-merging">pairing by mergingM</a> when computing split rejects.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id601725" href="#id601725" class="para" id="ftn.id601725">10</a>]</sup> For example Lokalize, when operating in <a class="ulink" href="http://docs.kde.org/stable/en/kdesdk/lokalize/sync.html" target="_top">merge mode</a>.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id654864" href="#id654864" class="para" id="ftn.id654864">11</a>]</sup> Although this should be quite rare. In the collection of PO files from several translation projects, with over 2 million words in total, there was not a single occurence where one of the chosen wrapper sequences was part of the text.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id661782" href="#id661782" class="para" id="ftn.id661782">12</a>]</sup> At the moment, the following text and PO editors are known to have highlighting for ediffs: Kate, Kwrite, Lokalize.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id637668" href="#id637668" class="para" id="ftn.id637668">13</a>]</sup> Whether two messages such as these would get paired for diffing in the first place, will be discussed later on.</p>
</div>
</div>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-summit" id="ch-summit"></a>Chapter&nbsp;5.&nbsp;Summitting Translation Branches</h2>
</div>
</div>
</div>
<p>Computer programs (though not only them) are sometimes concurrently developed and released from several <span class="emphasis"><em>branches</em></span>. For example, there may be one "stable" branch, which sees only small fixes and from which periodical releases are made, and another, "development" branch, which undergoes larger changes and may or may not be periodically released as well; at one point, the development branch will become the new stable branch, and the old stable branch will be abandoned. There may also be more than two branches which see active work, such as "development", "stable", and "old stable".</p>
<p>From programmers' point of view, working by branches can be very convenient. They can freely experiment with new features in the development branch, without having to wory that they will mess something up in the stable branch, from which periodical releases are made. In the stable branch they may fix some bugs discovered between the releases, or carry over some important and well-tested features from the development branch. For users who want to be on the cutting edge, they may provide experimental releases from the development branch.</p>
<p>For translators, however, having to deal with different branches of the same collection of PO files is rarely a convenience. It is text to be translated just as any, only duplicated across two or more file hierarchies. This means that translators additionaly have to think about how to make sure that new and modified translations made in one branch appear in other branches too. It gets particularly ugly if there are mismatches in PO file collections in different branches, like when a PO file is renamed, split into two or more PO files, or merged into another PO file.<sup>[<a name="id585276" href="#ftn.id585276" class="footnote" id="id585276">14</a>]</sup> Sometimes this branch juggling is not necessary; in strict two-branch setting, translators may choose to work only on the stable branch, and switch to the next stable branch when it gets created (or switch to the development branch shortly before it becomes stable). Even so, branch switching may not go very smooth in presence of mismatches in PO file collections.</p>
<p>Instead, for translators the most convenient would be to work on a single, "supercollection" of PO files, from which new and modified translations would be automatically periodically sent to appropriate PO files in branches. Such a supercollection can be created and maintained by Pology's <span class="command"><strong>posummit</strong></span> script. In terms of this script, the supercollection is called the <span class="emphasis"><em>summit</em></span>, the operation of creating and updating it is called <span class="emphasis"><em>gathering</em></span>, and the operation of filling out branch PO files is called <span class="emphasis"><em>scattering</em></span>.</p>
<p>How do summit PO files look like? When all branches contain the same PO file, then the counterpart summit PO file is simply the union of all messages from branch PO files. A message in the summit PO file differs from branch messages only by having the special <code class="literal">#. +&gt; ...</code> comment, which lists the branches that contain this message. If there would be two branches, named with <code class="literal">devel</code> and <code class="literal">stable</code> keywords, an excerpt from a summit PO file could be:</p>
<pre class="programlisting">
#. +&gt; devel
#: kdeui/jobs/kwidgetjobtracker.cpp:469
msgctxt "the destination URL of a job"
msgid "Destination:"
msgstr ""

#. +&gt; stable
#: kdeui/jobs/kwidgetjobtracker.cpp:469
msgid "Destination:"
msgstr ""

#. +&gt; devel stable
#: kdeui/jobs/kwidgetjobtracker.cpp:517
msgid "Keep this window open after transfer is complete"
msgstr ""
</pre>
<p>The first message above exists only in the development branch, the second only in the stable branch, and the third in both branches. The source reference always refers to the source file in the first listed branch. Any other extracted comments (<code class="literal">#.</code>) are also taken from the first listed branch.</p>
<p>Note that the first two messages are different only by context. The context was added in development branch, but not in stable, probably in order not to break the message freeze. However, due to special ordering of messages in summit PO files, these two messages appear together, allowing the translator to immediately make the correction in stable branch too if the new context in development branch shows it to be necessary.</p>
<p>When a PO file from one branch has a different name in another branch, or several PO files from one branch are represented with a single PO file in another branch, the summit can still handle it gracefully, by manually <span class="emphasis"><em>mapping</em></span> branch PO files to summit PO files. One branch PO file can be mapped to one or more summit PO files, and several branch PO files can be mapped to one summit PO file. Usually, but not necessarily, one branch (e.g. the development branch) is taken as reference for the summit file organization, and stray PO files from other branches are mapped accordingly.</p>
<p>If a team of translators works in the summit, it is sufficient that one team member (and possibly another one as backup) manages the summit. After the initial setup, this team member should periodically run <span class="command"><strong>posummit</strong></span> to update summit and branch PO files. All other team members can simply translate the summit PO files, oblivious of any summit operations behind the scenes. It is also possible that team members perform summit operations on their own, on a subset of PO files that they are about to work on. It is up to the team to agree upon the most convenient workflow.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-susetup" id="sec-susetup"></a>5.1.&nbsp;Setting Up The Summit with <span class="command"><strong>posummit</strong></span></h2>
</div>
</div>
</div>
<p>There are two major parts in setting up the summit: linking locations and organization of PO files in the branches to that of the summit, and deciding what summit <span class="emphasis"><em>mode</em></span> will be used.</p>
<p>Great flexibility is possible in linking branches to the summit, but at the expense of possibly heavy configuring. To make it simpler, currently there are two types of branch organization which can be handled automatically, just by specifying a few paths and options. In the <span class="emphasis"><em>by-language</em></span> branch organization, PO files in branches are grouped by language and their file names reflect their domain names:</p>
<pre class="screen">
devel/                  # development branch
    aa/                 # language A
        alpha.po
        bravo.po
        charlie.po
        ...
    bb/                 # language B
        alpha.po
        bravo.po
        charlie.po
        ...
    ...
    templates/          # templates
        alpha.pot
        bravo.pot
        charlie.pot
        ...
stable/                 # stable branch
    aa/
        ...
    bb/
        ...
    templates/
        ...
...
</pre>
<p>The other organization that can be automatically handled is <span class="emphasis"><em>by-domain</em></span>:</p>
<pre class="screen">
devel/                  # development branch
    alpha/              # domain alpha
        aa.po           # language A
        bb.po           # language B
        ...
        alpha.pot       # template
    bravo/
        aa.po
        bb.po
        ...
        bravo.pot
    charlie/
        aa.po
        bb.po
        ...
        charlie.pot
    ...
stable/                 # stable branch
    alpha/
        ...
    bravo/
        ...
    charlie/
        ...
...
</pre>
<p>In both organizations, there can be any number of subdirectories in the middle, between the branch top directory and directory where PO files are. For example, in by-language organization there could be some categorization:</p>
<pre class="screen">
path/to/devel/
    aa/
        utilities/
            alpha.po
            bravo.po
            ...
        games/
            charlie.po
            ...
    bb/
        ...
</pre>
<p>while in by-domain categorization the domain directories could be within their respective sources<sup>[<a name="id579858" href="#ftn.id579858" class="footnote" id="id579858">15</a>]</sup>:</p>
<pre class="screen">
devel/
    appfoo/
        src/
        doc/
        po/
            foo/
                aa.po
                bb.po
                ...
                foo.pot
            libfoo/
                aa.po
                bb.po
                ...
                libfoo.pot
        ...
    appbar/
        ...
</pre>
<p>There are three possible summit modes: direct summit, summit over dynamic templates, and summit over static templates. In the <span class="emphasis"><em>direct summit</em></span>, only branch PO files are processed, in that new and modifed messages are gathered from them and summit translations scattered to them. In <span class="emphasis"><em>summit over dynamic templates</em></span>, messages from branch PO files are gathered only once, at creation of the summit; after that, it is branch templates (POT files) that are gathered into summit templates, and then summit PO files are merged with them. Summit templates are not actually seen, but are gathered internally when merging command is issued and removed after merging is done. <span class="emphasis"><em>Summit over static templates</em></span> is quite the same, except that summit templates are explicitly gathered and kept around, and merging is done separately.</p>
<p>What is the reason for having three summit modes to choose from? Direct summit mode is there because it is the easiest to explain and understand, and does not require that branches contain templates. It is however not recommended, for two reasons. Firstly, someone may mistakenly translate directly in a branch<sup>[<a name="id667370" href="#ftn.id667370" class="footnote" id="id667370">16</a>]</sup>, and those translations may be silently gathered into the summit. This is bad for quality control (review, etc.), as it is expected that the summit is the sole source of translations. Secondly, you may want to perform some automatic modifications on translation when scattering, but not to get those modifications back into the summit on gathering, which would happen with direct summit. These issues are avoided by using summit over dynamic templates, though now branches must provide templates. Finally, summmit over static templates makes sense when several language teams share the summit setup: since gathering is the most complicated operation and sometimes requires manual intervention, it can be done once (by one person) on summit templates, while language teams can then merge and scatter their summits in a fully automatic fashion.</p>
<p>There is one important design decisions which holds for all summit modes: all summit PO files must be <span class="strong"><strong>unique by domain name</strong></span> (i.e. base file name without extension), even if they are in different subdirectories within the summit top directory. This in turn means that in automatically supported branch organizations (by-domain and by-language) PO domains should be unique as well.<sup>[<a name="id667398" href="#ftn.id667398" class="footnote" id="id667398">17</a>]</sup> This was done for two reasons. Less importantly, it is convenient to be able to identify a summit PO file simply by its domain name rather than the full path (especially in some <span class="command"><strong>posummit</strong></span> invocations). More importantly, uniqueness of domain names allows that PO files are located in different subdirectories between different branches. This happens, for example, in large projects in which code moves between modules. If branches do not satisfy this property, i.e. they contain same-name PO domains with totally different content, it is necessary to define a <span class="emphasis"><em>path transformation</em></span> (see <a class="xref" href="#sec-sustpptransf" title="5.1.4.&nbsp;Transforming Branch Paths">Section&nbsp;5.1.4, “Transforming Branch Paths”</a>) which will produce unique domain names with respect to the summit.</p>
<p>The following sections describe how to set up each of the modes, in each of the outlined branch organizations. They should be read in turn up to the mode that you want to use, because they build upon each other.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sustpdirect" id="sec-sustpdirect"></a>5.1.1.&nbsp;Setting Up Direct Summit</h3>
</div>
</div>
</div>
<p>Let us assume that branches are organized by-language, that branch top directories are in the same parent directory, and that you want the summit top directory to be on the level of branch parent directory. That is:</p>
<pre class="screen">
branches/
    devel-aa/
        alpha.po
        bravo.po
        ...
    stable-aa/
        alpha.po
        bravo.po
        ...
summit-aa/
    alpha.po
    bravo.po
    ...
    summit-config
</pre>
<p><code class="literal">aa</code> is the language code, which can be added for clarity, but is not necessary. It could also be a subdirectory, as in <code class="filename">branches/devel/aa</code> and <code class="filename">summit/aa</code>. At start you have the <code class="filename">branches/</code> directory ready; now you create the <code class="filename">summit-aa/</code> directory, and within it the summit configuration file <code class="filename">summit-config</code> with the following content:</p>
<pre class="programlisting">
S.lang = "aa"

S.summit = dict(
    topdir=S.relpath("."),
)

S.branches = [
    dict(id="devel",
         topdir=S.relpath("../branches/devel-aa")),
    dict(id="stable",
         topdir=S.relpath("../branches/stable-aa")),
    # ...and any other branches.
]

S.mappings = [
]
</pre>
<p>This is all that is necessary to set up a direct summit. The configuration file must be named exactly <code class="filename">summit-config</code>, because <span class="command"><strong>posummit</strong></span> will look for a file named like that through parent directories and automatically pick it up. As you may have recognized, <code class="filename">summit-config</code> is actually a Python source file; <span class="command"><strong>posummit</strong></span> will insert the special <code class="literal">S</code> object when evaluating <code class="filename">summit-config</code>, and it is through this object that summit options are set. <code class="literal">S.lang</code> states the language code of the summit. <code class="literal">S.summit</code> is a Python dictionary that holds options for the summit PO files (here only its location, through <code class="literal">topdir=</code> key), while <code class="literal">S.branches</code> is a list of dictionaries, each specifying options per branch (here the branch identifier by <code class="literal">id=</code> key and top directory). The <code class="function">S.relpath</code> function is used to make file and directory paths relative to <code class="filename">summit-config</code> itself. <code class="literal">S.mappings</code> is a list of PO file mappings, for cases of splitting, mergings and renamings between branches. In this example <code class="literal">S.mappings</code> is set to empty only to point out its importance, but it does not need to be present if there are no mappings.</p>
<p><a name="p-bydomorg" id="p-bydomorg"></a>If branches are organized by-domain, the summit tree will still look the same, with PO files named by domain rather than by language:</p>
<pre class="screen">
branches/
    devel/
        alpha/
            aa.po
            bb.po
            ...
        bravo/
            aa.po
            bb.po
            ...
        ...
    stable/
        alpha/
            aa.po
            bb.po
            ...
        bravo/
            aa.po
            bb.po
            ...
        ...
summit-aa/
    alpha.po
    bravo.po
    ...
    summit-config
</pre>
<p>The only difference in the summit configuration is the addition of <code class="literal">by_lang=</code> keys into the branch dictionaries:</p>
<pre class="screen">
S.branches = [
    dict(id="devel",
         topdir=S.relpath("../branches/devel"),
         by_lang=S.lang),
    dict(id="stable",
         topdir=S.relpath("../branches/stable"),
         by_lang=S.lang),
]
</pre>
<p>Presence of the <code class="literal">by_lang=</code> key signals that the branch is organized by-domain (i.e. PO files named by language), and the value is the language code within the branch. Normaly it is set to previously defined <code class="literal">S.lang</code>, but it can also be something else in case different codes are used between the branches or the branches and the summit.</p>
<p>When the configuration file has been written, the summit can be gathered for the first time (i.e. summit PO files created):</p>
<pre class="programlisting">
$ cd .../summit-aa/
$ posummit gather --create
</pre>
<p>The path of each created summit PO file will be written out, along with paths of branch PO files from which messages were gathered into the summit file. After the run is finished, the summit is ready for use.</p>
<p>While this was sufficient to set up a summit, there is a miriyad of options available for specialized purposes, which will be presented throughout this chapter. Also, given that summit configuration file is Python code, you can add into it any scripting that you wish. Some summit options (defined through the <code class="literal">S</code> object) even take Python functions as values.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sustpdyntpl" id="sec-sustpdyntpl"></a>5.1.2.&nbsp;Setting Up Summit over Dynamic Templates</h3>
</div>
</div>
</div>
<p>Again consider by-language organization of branches, similar to the direct summit example above, except that now template directories too must be present in branches:</p>
<pre class="screen">
branches/
    devel/
        aa/
            alpha.po
            bravo.po
            ...
        templates/
            alpha.pot
            bravo.pot
            ...
    stable/
        aa/
            alpha.po
            bravo.po
            ...
        templates/
            alpha.pot
            bravo.pot
            ...
summit-aa/
    alpha.po
    bravo.po
    ...
    summit-config
</pre>
<p>Here the language PO files and templates are put in subdirectories within the branch directory only for convenience, but this is not mandatory. For example, language files could reside in <code class="filename">branches/devel-aa</code> and templates in <code class="filename">branches/devel-templates</code>, no path connection is required between the two. This is because the template path per branch is explicitly given in <code class="filename">summit-config</code>, which would look like this:</p>
<pre class="programlisting">
S.lang = "aa"
S.over_templates = True

S.summit = dict(
    topdir=S.relpath("."),
)

S.branches = [
    dict(id="devel",
         topdir=S.relpath("../branches/devel/aa"),
         topdir_templates=S.relpath("../branches/devel/templates")),
    dict(id="stable",
         topdir=S.relpath("../branches/stable/aa"),
         topdir_templates=S.relpath("../branches/stable/templates")),
]

S.mappings = [
]
</pre>
<p>Compared to the configuration of a direct summit, two things are added here. <code class="literal">S.over_templates</code> option is set to <code class="literal">True</code> to indicate that summit over templates is used. The path to templates is set with <code class="literal">topdir_templates=</code> key for each branch.</p>
<p>In by-domain branch organization, the directory tree looks just the same as for direct summit, except that each domain directory also contains the templates:</p>
<pre class="screen">
branches/
    devel/
        alpha/
            aa.po
            bb.po
            ...
            alpha.pot
        bravo/
            aa.po
            bb.po
            ...
            bravo.pot
        ...
    stable/
        alpha/
            aa.po
            bb.po
            ...
            alpha.pot
        bravo/
            aa.po
            bb.po
            ...
            bravo.pot
        ...
summit-aa/
    alpha.po
    bravo.po
    ...
    summit-config
</pre>
<p>Summit configuration is modified in the same way as it was for the direct summit, by adding the <code class="literal">by_lang=</code> key to branch specifications:</p>
<pre class="programlisting">
S.branches = [
    dict(id="devel",
         topdir=S.relpath("../branches/devel/aa"),
         topdir_templates=S.relpath("../branches/devel/templates"),
         by_lang=S.lang),
    dict(id="stable",
         topdir=S.relpath("../branches/stable/aa"),
         topdir_templates=S.relpath("../branches/stable/templates"),
         by_lang=S.lang),
]
</pre>
<p>Initial gathering of the summit is done slightly differently compared to the direct summit:</p>
<pre class="programlisting">
$ cd .../summit-aa/
$ posummit gather --create --force
</pre>
<p>The <code class="option">--force</code> option must be used here because, unlike in direct summit, explicit gathering is not regularly done in summit over dynamic templates.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sustpstattpl" id="sec-sustpstattpl"></a>5.1.3.&nbsp;Setting Up Summit over Static Templates</h3>
</div>
</div>
</div>
<p>As mentioned earlier, summit over static templates can be used when several language teams want to share the summit setup, for the reasons of greater efficiency. The branch directory tree looks exactly the same as in summit over dynamic templates (with several languages being present), but the summit tree is somewhat different:</p>
<pre class="screen">
branches/
    # as before, either by-language or by-domain
summit/
    summit-config-shared
    aa/
        alpha.po
        bravo.po
        ...
    bb/
        alpha.po
        bravo.po
        ...
    templates/
        alpha.pot
        bravo.pot
        ...
</pre>
<p>First of all, there is now the <code class="filename">summit/</code> directory which contains subdirectories by language (the language summits) and one subdirectory for summit templates (the template summit). Then, there is no more the <code class="filename">summit-config</code> file, but <code class="filename">summit-config-shared</code>; the name can actually be anything, so long as it is not exactly <code class="filename">summit-config</code>. This is in order to prevent <span class="command"><strong>posummit</strong></span> from automatically picking it up, as now the configuration is not tied to a single language summit. Instead, the path to the configuration file and the language code are explicitly given as arguments to <span class="command"><strong>posummit</strong></span>.</p>
<p>The configuration file for by-language branches looks like this:</p>
<pre class="programlisting">
S.over_templates = True

S.summit = dict(
    topdir=S.relpath("%s" % S.lang),
    topdir_templates=S.relpath("templates")),
)

S.branches = [
    dict(id="devel",
         topdir=S.relpath("../branches/devel/%s" % S.lang),
         topdir_templates=S.relpath("../branches/devel/templates")),
    dict(id="stable",
         topdir=S.relpath("../branches/stable/%s" % S.lang),
         topdir_templates=S.relpath("../branches/stable/templates")),
]

S.mappings = [
]
</pre>
<p>Compared to summit over dynamic templates, here <code class="literal">S.lang</code> is no longer hardcoded in the configuration file, but set at each run of <span class="command"><strong>posummit</strong></span> through the command line. This means that paths of language directories too have to be dynamically adapted based on <code class="literal">S.lang</code>, hence the string interpolations <code class="literal">"...%s..." % S.lang</code>.</p>
<p>For by-domain branches, again simply <code class="literal">by_lang=</code> keys are added to branches:</p>
<pre class="programlisting">
S.branches = [
    dict(id="devel",
         topdir=S.relpath("../branches/devel/%s" % S.lang),
         topdir_templates=S.relpath("../branches/devel/templates"),
         by_lang=S.lang),
    dict(id="stable",
         topdir=S.relpath("../branches/stable/%s" % S.lang),
         topdir_templates=S.relpath("../branches/stable/templates"),
         by_lang=S.lang),
]
</pre>
<p>In summit over static templates mode, initital gathering is first done for summit templates, like this:</p>
<pre class="programlisting">
$ cd .../summit/
$ posummit summit-config-shared templates gather --create
</pre>
<p>The first two arguments are now the path to the configuration file and the language code, where <code class="literal">templates</code> is the dummy language code for templates<sup>[<a name="id648409" href="#ftn.id648409" class="footnote" id="id648409">18</a>]</sup>. After this is finished, language summits can be gathered:</p>
<pre class="programlisting">
$ posummit summit-config-shared aa gather --create --force
$ posummit summit-config-shared bb gather --create --force
$ ...
</pre>
<p>Note that <code class="option">--force</code> was not needed when gathering templates, because in this mode the template summit is periodically gathered, while language summits are not.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sustpptransf" id="sec-sustpptransf"></a>5.1.4.&nbsp;Transforming Branch Paths</h3>
</div>
</div>
</div>
<p>When branches contain only PO files which are used natively, by programs fetching translations at runtime, then all branch PO files will be unique by their domain name (as mandated by the Gettext runtime system). It will not happen that two branch subdirectories contain a PO file with the same name. This fits perfectly with the summit requirement that all summit PO files be unique by domain names.</p>
<p>However, if PO files are used as <a class="link" href="#p-dynstattr">an intermediate</a> to other formats, branches may contain same-name PO files which have otherwise nothing in common, in different subdirectories. For example, each subdirectory may contain a PO file named <code class="filename">index.po</code>, <code class="filename">help.po</code>, etc. If this would be left unattended, all the same-name PO files would be collapsed into single summit PO file, which makes no sense given that they have (almost) no common messages. For this reason, it is possible to define transformations which modify absolute branch paths during processing, such that branch PO files are seen with unique names.</p>
<p>Consider the following example of two branches for language <code class="literal">aa</code> (i.e. by-language organization) with PO files non-unique by domain name:</p>
<pre class="screen">
branches/
    devel-aa/
        chapter1/
            intro.po
            glossary.po
            ...
        chapter2/
            intro.po
            glossary.po
            ...
        ...
    stable-aa/
        chapter1/
            intro.po
            glossary.po
            ...
        chapter2/
            intro.po
            glossary.po
            ...
        ...
</pre>
<p>These branches cover some sort of a book, where each chapter has some standard elements, and thus some same-name PO files with totally different content in each chapter's subdirectory. To have unique domain names in the summit, you might decide upon a flat file tree with chapter in prefix:</p>
<pre class="screen">
summit-aa/
    chapter1-intro.po
    chapter1-glossary.po
    ...
    chapter2-intro.po
    chapter2-glossary.po
    ...
    summit-config
</pre>
<p>To achieve this, you must first write two Python functions (remember that the summit configuration file is a normal Python source file), one to split branch paths and another to join them, and add them to branch specifications in <code class="literal">S.branches</code>.</p>
<p>The function to split branch paths takes a single argument, the branch PO file path relative to the branch top directory, and returns the summit PO domain name and the summit subdirectory. For the example above, the splitting function would look like this:</p>
<pre class="programlisting">
def split_branch_path (subpath):
    import os
    filename = os.path.basename(subpath)      # get PO file name
    domain0 = filename[:filename.rfind(".")]  # strip .po extension
    subdir0 = os.path.dirname(subpath)        # get branch subdirectory
    domain = subdir0 + "-" + domain0          # set final domain name
    subdir = ""                               # set summit subdirectory
    return domain, subdir
</pre>
<p>Note that the branch subdirectory was used only to construct the summit domain name, while the summit subdirectory is an empty string because summit flat file tree should be flat.</p>
<p>The function to join branch paths takes three arguments. The first two are the summit PO domain name and the summit subdirectory. The third argument is the the value of <a class="link" href="#p-bydomorg"><code class="literal">by_lang=</code> key</a> for the given branch. The return value is the branch PO file path relative to the branch top directory. It would look like this:</p>
<pre class="programlisting">
def join_branch_path (domain, subdir, bylang):
    import os
    subdir0, domain0 = domain.split("-", 1)    # get branch domain name
                                               # and branch subdirectory
                                               # from summit domain name
    filename = domain0 + ".po"                 # branch PO file name
    subpath = os.path.join(subdir0, filename)  # branch relative path
    return subpath
</pre>
<p>Here the <code class="varname">subdir</code> argument (summit subdirectory) is not used is not used because it is always empty due to flat summit file tree, and <code class="varname">bylang</code> is not used because it is <code class="literal">None</code> due to by-language branch organization.</p>
<p>The definitions of splitting and joining functions are written into the <code class="filename">summit-config</code> file somewhere before the <code class="literal">S.branches</code> branch specification, and added to each branch through <code class="literal">transform_path=</code> key:</p>
<pre class="programlisting">
S.branches = [
    dict(id="devel",
         topdir=S.relpath("../branches/devel-aa"),
         transform_path=(split_branch_path, join_branch_path)),
    dict(id="stable",
         topdir=S.relpath("../branches/stable-aa"),
         transform_path=(split_branch_path, join_branch_path)),
]
</pre>
<p>This means that it is possible, if necessary, to define different splitting and joining functions per branch.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-sumaintain" id="sec-sumaintain"></a>5.2.&nbsp;Maintaining the Summit</h2>
</div>
</div>
</div>
<p>From time to time, summit PO files need to be updated to reflect changes in branch PO files, and scattered so that branch PO files get new translations from the summit. How are summit PO files updated, by whom and in which amount, depends on the summit mode and the organization of the translation team. The same holds for when and by whom the scattering is done.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sumntbasic" id="sec-sumntbasic"></a>5.2.1.&nbsp;Centralized Summit Maintenance</h3>
</div>
</div>
</div>
<p>The usual maintenance procedure would be for one designated person (e.g. the team coordinator) to update all summit PO files and to scatter new translations to branch PO files, at certain periods of time agreed upon in the translation team.</p>
<p>If there are no mismatches between the branch and summit PO files, the summit update procedure is fully automatic. How the summit is updated depends on the summit mode. In direct summit, the update is performed by gathering:</p>
<pre class="programlisting">
$ cd $SUMMITDIR
$ posummit gather
</pre>
<p>In summit over dynamic templates, merging is performed instead:</p>
<pre class="programlisting">
$ cd $SUMMITDIR
$ posummit merge
</pre>
<p>Finally, in summit over static templates, first the template summit is gathered, and then language summits are merged:</p>
<pre class="programlisting">
$ posummit $SOMEWHERE/summit-config-shared templates gather
$ posummit $SOMEWHERE/summit-config-shared aa merge
$ posummit $SOMEWHERE/summit-config-shared bb merge
...
</pre>
<p>Note that unlike when setting up the summit, no <code class="option">--create</code> or <code class="option">--force</code> options are used. Without them, <span class="command"><strong>posummit</strong></span> will warn about any new mismatches between branches and the summit and abort the operation, leaving the user to examine the situation and take corrective measures. <a class="xref" href="#sec-sumntmism" title="5.2.3.&nbsp;Handling Mismatches Between Branches and Summit">Section&nbsp;5.2.3, “Handling Mismatches Between Branches and Summit”</a> discusses this in detail.</p>
<p>Scattering to branches is always fully automatic. For direct summit and summit over dynamic templates it is performed with:</p>
<pre class="programlisting">
$ cd $SUMMITDIR
$ posummit scatter
</pre>
<p>For summit over static templates, scattering is done for each language summit:</p>
<pre class="programlisting">
$ posummit $SOMEWHERE/summit-config-shared aa scatter
$ posummit $SOMEWHERE/summit-config-shared bb scatter
...
</pre>
<p>If summit update (merge, gather, or both, depending on the summit mode) is scheduled to run automatically, the maintainer should make sure to be notified when <span class="command"><strong>posummit</strong></span> aborts, so that mismatches can be promptly handled.</p>
<p>The obvious advantage of this maintenance method is that other team members do not need to know anything about workings of the summit. They only fetch updated summit PO files, translate them, and submit them back. The disadvantage is that summit update may interfere with a particular translator who happened to be working on a PO file which just got updated in the repository, causing merge conflicts when he attempts to submit that PO file.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sumntdistrib" id="sec-sumntdistrib"></a>5.2.2.&nbsp;Distributed Summit Maintenance</h3>
</div>
</div>
</div>
<p>In this maintenance mode, each team member performs summit operations on exactly the PO files that he wants to work on. This has the advantage over centralized maintenance in that translators do not interfere in each others work, as summit PO files get updated only at the request of the translator working on it. Additionally, it may provide faster gather(-merge)-scatter turnaround time. Unfortunately, the disadvantage is that now all team members have to know how the summit is maintained, so this method is likely applicable only to strongly technical teams.</p>
<p>Distributed maintenance is in general the same as centralized, except that now all <span class="command"><strong>posummit</strong></span> command lines take extra arguments, namely the selection of PO files to operate on -- so called <span class="emphasis"><em>operation targets</em></span>. Operation targets can be given in two ways. One is directly by file or directory paths. For example, in summit over dynamic templates mode, when working on the <code class="filename">foobaz.po</code> file, the translator would use the following summit commands to merge it and scatter to the branches:</p>
<pre class="programlisting">
$ cd $SUMMITDIR
$ posummit merge foosuite/foobaz.po
$ # ...update the translation...
$ posummit scatter foosuite/foobaz.po
</pre>
<p>To update all files in <code class="filename">foosuite/</code> subdirectory at once, the translator can execute instead:</p>
<pre class="programlisting">
$ cd $SUMMITDIR
$ posummit merge foosuite/
$ posummit scatter foosuite/
</pre>
<p>It is also possible to single out a particular branch for scattering, by giving the path to the PO file in that branch instead of the summit. To scatter <code class="filename">foobaz.po</code> only to <code class="literal">devel</code> branch, in by-language branch organization the translator would use:</p>
<pre class="programlisting">
$ posummit scatter $SOMEWHERE/devel/aa/foosuite/foobaz.po
</pre>
<p>and in by-domain branch organization:</p>
<pre class="programlisting">
$ posummit scatter $SOMEWHERE/devel/foosuite/foobaz/po/foobaz/aa.po
</pre>
<p>Note that the current working directory still has to be within the summit directory, so that <span class="command"><strong>posummit</strong></span> can find the summit configuration file. (This requirement is not present for summit over static templates, as there the path to configuration file is given in command line.)</p>
<p>The other kind of operation targets are PO domain names and subdirectory names alone. In this formulation, the first example above could be replaced with:</p>
<pre class="programlisting">
$ posummit merge foobaz
$ posummit scatter foobaz
</pre>
<p>Since all summit PO file names are unique, this is sufficient information for <span class="command"><strong>posummit</strong></span> to know what it should operate on. To limit operation to a certain branch, the branch name is added in front of the domain names, separated by a colon. To scatter <code class="filename">foobaz.po</code> to <code class="literal">devel</code> branch:</p>
<pre class="programlisting">
$ posummit scatter devel:foobaz
</pre>
<p>and to scatter the complete <code class="filename">foosuite/</code> subdirectory to the same branch:</p>
<pre class="programlisting">
$ posummit scatter devel:foosuite/
</pre>
<p>Note that trailing slash is significant here, since otherwise the argument would be interpreted as single PO file (<span class="command"><strong>posummit</strong></span> would exit with an error, reporting that such a file does not exist). Summit also has a "branch name" assigned for use in operation targets of this kind, and that is <code class="literal">+</code>.</p>
<p>When merging (or gathering in direct summit mode) is attempted, <span class="command"><strong>posummit</strong></span> may abort with the report of mismatches between branches and the summit. The translator must then make the adjustments (<a class="xref" href="#sec-sumntmism" title="5.2.3.&nbsp;Handling Mismatches Between Branches and Summit">Section&nbsp;5.2.3, “Handling Mismatches Between Branches and Summit”</a> describes how, case by case), or report it to someone else to handle.</p>
<p>After selected summit and branch PO files have been updated, the translator can commit them. Alternatively, a half-distributed workflow could be used, where translators only update and commit summit PO files, while scattering to branches is centralized, and automatically performed at a given period. This makes sense because the scattering in no way interferes with translators' workflow and never needs any manual intervention.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sumntmism" id="sec-sumntmism"></a>5.2.3.&nbsp;Handling Mismatches Between Branches and Summit</h3>
</div>
</div>
</div>
<p>When something changes in the PO file tree in one of the branches, <span class="command"><strong>posummit</strong></span> will by default abort gathering (or merging in summit over dynamic templates), and present a list of its findings. At this point <span class="command"><strong>posummit</strong></span> could be made to continue by issuing the <code class="option">--create</code> option, but then it will resolve mismatches in a simplistic way, which will be wrong in many cases. Instead, you should examine what had happened in branches, possibly manually perform some operations on summit PO files and possibly add some branch-to-summit mappings, and rerun <span class="command"><strong>posummit</strong></span> after the necessary adjustments have been made.</p>
<p>Typical mismatches and their remedies are as follows:</p>
<div class="variablelist">
<dl>
<dt><span class="term">A branch PO file has been moved to another subdirectory (<span class="emphasis"><em>moving</em></span>).</span></dt>
<dd>
<p>In a translation project with modules represented by subdirectories, it may happen that a program or a library is moved from one module to another, with its PO files following the move. If this happened in all branches, <span class="command"><strong>posummit</strong></span> will report that the summit PO file should be moved as well; it can be rerun with <code class="option">--create</code> to do the move itself, or you can make the move manually. If the move happened in only one of the branches, <span class="command"><strong>posummit</strong></span> will not complain at all; more precisely, if at least one branch PO file is in same relative subdirectory as the summit PO file, it is not considered a mismatch.</p>
</dd>
<dt><span class="term">A totally new branch PO file has been added (<span class="emphasis"><em>addition</em></span>).</span></dt>
<dd>
<p>When a piece of software appears (created or imported) in the project, its PO files will appear with it. These PO files are "totally" new, in the sense that they are not derived from any existing PO file. In this case, <span class="command"><strong>posummit</strong></span> will report that new branch PO files have no corresponding summit PO files, and expected paths of the missing summit PO files. After having checked that the branch PO files are indeed totally new, you can rerun <span class="command"><strong>posummit</strong></span> with <code class="option">--create</code>, or manually copy branch PO files to expected summit paths (they will be equipped with summit-specific information when <span class="command"><strong>posummit</strong></span> rolls over them).</p>
</dd>
<dt><span class="term">A branch PO file has been removed (<span class="emphasis"><em>removal</em></span>).</span></dt>
<dd>
<p>A piece of software may be removed from the project (not maintained any more, moved to another project), which will cause its PO files to disappear. <span class="command"><strong>posummit</strong></span> will then report that some summit PO files have no corresponding branch PO files. You should check that branch PO files have indeed been simply removed, and then rerun <span class="command"><strong>posummit</strong></span> with <code class="option">--create</code>, or manually remove summit PO files.</p>
</dd>
<dt><span class="term">A branch PO file has been renamed (<span class="emphasis"><em>renaming</em></span>).</span></dt>
<dd>
<p>When, for example, a program changes its name, normally its PO file will be renamed as well. What will happen in this case is that <span class="command"><strong>posummit</strong></span> will report two problems: a branch PO file without corresponding summit PO file (new name), and a summit PO file without any corresponding branch PO files (old name). When you realize that the cause of these paired reports is indeed renaming (they could also be an unrelated addition and removal), you must rename the summit PO file manually. Note that if you had not done this and issued <code class="option">--create</code> option instead, the existing summit PO file would have been removed, and an empty one with the new name created -- definitely not what was desired.</p>
<p>A more complicated case of renaming is when the name is changed in only one branch. <span class="command"><strong>posummit</strong></span> then reports only the branch PO file with the new name as having no summit PO file, since the existing summit PO file matches non-renamed branch PO files. In this case, the usual correction is to rename the summit PO file to new name and map old names from other branches to the new name. If <code class="filename">foobaz.po</code> was renamed to <code class="filename">fooqwyx.po</code> in <code class="literal">devel</code> branch, but kept its name in <code class="literal">stable</code>, then the mapping in the summit configuration file would be:</p>
<pre class="programlisting">
S.mappings = [
    ...
    ("stable", "foobaz", "fooqwyx"),
    ...
]
</pre>
<p>Each mapping entry is a sequence of strings in parenthesis. The first string is the branch name, the second string is the domain name of the PO file in that branch, and the third string the domain name of the PO file in summit. When you add this mapping (and rename summit <code class="filename">foobaz.po</code> to <code class="filename">fooqwyx.po</code>), you can rerun <span class="command"><strong>posummit</strong></span>.</p>
<p>If the summit is over static templates, i.e. there are separate template and language summits, then renamings should be done in all of them.</p>
</dd>
<dt><span class="term">A branch PO file has been split into several files (<span class="emphasis"><em>splitting</em></span>).</span></dt>
<dd>
<p>If a single PO file becomes very big, it may be split into several smaller files by categories of messages (e.g. UI and help texts). A program may also be modularized, when the factored modules may take over part of the messages from the main PO file into their own PO files. Either way, <span class="command"><strong>posummit</strong></span> will again simply report that some new branch PO files have appeared and possibly some disappeared, and you recognize that the cause of this is a splitting. Splitting typically happens in the newest branch, but not in older branches. You should then make the same split in summit PO files and map the monolithic PO file from older branches to the newly split summit files. For example, if <code class="filename">foobaz.po</code> in <code class="literal">devel</code> branch got split into <code class="filename">foobaz.po</code> (of reduced size), <code class="filename">libfoobaz.po</code>, and <code class="filename">foobaz_help.po</code>, the mapping for the old monolithic PO file in the <code class="literal">stable</code> branch would be: <a name="l-splmap" id="l-splmap"></a></p>
<pre class="programlisting">
S.mappings = [
    ...
    ("stable", "foobaz", "foobaz", "libfoobaz", "foobaz_help"),
    ...
]
</pre>
<p>The first string in the mapping is the branch name, the second string is the PO domain name in that branch, and all following strings are the new summit PO domain names which contain part of original messages. The order of summit PO domains is somewhat important: if a message exists only in the monolithic PO file in the <code class="literal">stable</code> branch and not in split PO files in <code class="literal">devel</code> branch, and summit heuristics detects no appropriate insertion point into one of the summit PO files, that message will be added to the end of the first summit PO file listed.</p>
<p>"Making the same split in summit" deserves some special attention. For the templates summit (which exists in summit over static templates), this simply means adding any new files and removing old ones (<span class="command"><strong>posummit</strong></span> will do that itself if run with <code class="option">--create</code>). But for language summits, you should manually copy the original summit PO file to each new name in turn, and then perform gather (direct summit) or merge (summit over templates). In this way no translated messages will be lost in the split.<sup>[<a name="id637402" href="#ftn.id637402" class="footnote" id="id637402">19</a>]</sup></p>
</dd>
<dt><span class="term">Several branch PO files have been merged into one (<span class="emphasis"><em>merging</em></span>).</span></dt>
<dd>
<p>Sometimes formerly independent pieces of software are joined into a single package, for more effective maintenance and release. This can happen, for example, when selected plugins are taken into the host program distribution as "core plugins". Their separate PO files may then be merged into a single new PO file, or into an existing PO file. Like in the opposite case of splitting, <span class="command"><strong>posummit</strong></span> will simply report that some summit PO files no longer have branch counterparts, and possibly that a new branch PO file has appeared. This usually happens in the newest branch first, while older branches retain the separation. Then the same merging should be done in summit too, and mappings added for each of the old separate PO files in other branches. If <code class="filename">foobaz_info.po</code>, <code class="filename">foobaz_backup.po</code>, and <code class="filename">foobaz_filters.po</code> have been merged into existing <code class="filename">foobaz.po</code> in <code class="literal">devel</code> branch, the following mappings for the <code class="literal">stable</code> branch should be added: <a name="l-mrgmap" id="l-mrgmap"></a></p>
<pre class="programlisting">
S.mappings = [
    ...
    ("stable", "foobaz_info", "foobaz"),
    ("stable", "foobaz_backup", "foobaz"),
    ("stable", "foobaz_filters", "foobaz"),
    ...
]
</pre>
<p>As for making the same merge in the summit, for templates summit (in summit over static templates) you should manually remove old separate files and possibly add the new monolithic one, or run <span class="command"><strong>posummit</strong></span> with <code class="option">--create</code>. In language summits, in order to retain all existing translations, you should manually concatenate separate files into one (using Gettext's <span class="command"><strong>msgcat</strong></span>) and then perform gather (direct summit) or merge (summit over templates).</p>
</dd>
<dt><span class="term">A language branch PO file has appeared in summit over templates (<span class="emphasis"><em>injection</em></span>).</span></dt>
<dd>
<p>In summit over templates modes (dynamic or static), the normal way for a language summit PO file to appear is by starting from a clean template, and the corresponding branch PO file is then created on scatter. However, when a program previously developed elsewhere is imported into the project, its PO files are imported too. This will lead to the situation where there are translated branch PO files with no corresponding language summit PO files. This is corrected by forced gathering of the "injected" branch PO file. If the injected file is <code class="filename">alien.po</code>, in summit over dynamic templates you would execute:</p>
<pre class="programlisting">
$ cd $SUMMITDIR
$ posummit gather --create --force alien
</pre>
<p>and in summit over static templates:</p>
<pre class="programlisting">
$ posummit $SOMEWHERE/summit-config-shared aa gather --create --force alien
$ posummit $SOMEWHERE/summit-config-shared bb gather --create --force alien
$ ...
</pre>
<p>The <code class="option">--force</code> option is necessary because, in summit over template modes, language summit PO files are normally gathered just once when the summit is created, and later only merged.</p>
</dd>
</dl>
</div>
<p>Important thing to note about mismatches is that reports produced by <span class="command"><strong>posummit</strong></span> may be misleading, especially in more complicated situations (splitting, merging). This means that you must carefully examine what has actually happened, not based only on the branch file trees themselves, but also by keeping an eye on channels (e.g. mailing lists) where information for translators is most likely to appear.</p>
<p>There is also the possibility to map a whole branch subdirectory to another directory in the summit. Since summit PO files are unique by domain name, the only effect of subdirectory mapping is to prevent <span class="command"><strong>posummit</strong></span> from reporting that files should be moved to another subdirectory, and to have it report proper expected summit paths when new branch catalogs are discovered. For example, if the PO files from subdirectory <code class="filename">foosuite/</code> in <code class="literal">devel</code> branch and from subdirectory <code class="filename">foopack/</code> in <code class="literal">stable</code> branch should both be collected in summit subdirectory <code class="filename">foo/</code>, the subdirectory mapping would be:</p>
<pre class="programlisting">
S.subdir_mappings = [
    ...
    ("devel", "foosuite", "foo"),
    ("stable", "foopack", "foo"),
    ...
]
</pre>
<p>Subdirectory mappings should be needed rarely compared to file mappings. A tentative example could be when two closely related software forks are translated within the same project, and they have many PO files in their own subdirectories.</p>
<p>At some moment translation branches will be "shifted", for example <code class="literal">devel</code> will become the new <code class="literal">stable</code>, <code class="literal">stable</code> may become <code class="literal">oldstable</code> (if three branches are maintained), etc. When that happens, mappings should be shifted too. A typical case would be two branches, <code class="literal">devel</code> and <code class="literal">stable</code>, and some mappings only for <code class="literal">stable</code>; then, when the shift comes, all existing mappings would be simply removed.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sumntdeps" id="sec-sumntdeps"></a>5.2.4.&nbsp;Checking Summit Dependencies</h3>
</div>
</div>
</div>
<p>As the number of mappings grows, or if <a class="link" href="#sec-sustpptransf" title="5.1.4.&nbsp;Transforming Branch Paths">branch path transformation</a> is employed, it may not be readily clear which summit PO files are related to which branch PO files. Translator may need this information to know exactly which summit PO files to work on in order to have some set of branch files fully translated. For this reason, <span class="command"><strong>posummit</strong></span> provides the operation mode <code class="literal">deps</code>, in which any number of operation targets are given in command line, and the dependency chains are reported for those targets.</p>
<p>If you recall the <a class="link" href="#l-mrgmap">example mapping due to merging</a>, you can check the dependency chain for the file <code class="filename">foobaz_info.po</code> in <code class="literal">stable</code> branch by executing one of:</p>
<pre class="programlisting">
$ cd $SUMMITDIR
$ posummit deps $STABLEDIR/foobaz_info.po
$ posummit deps stable:foobaz_info
</pre>
<p>in direct summit or summit over dynamic templates, or</p>
<pre class="programlisting">
$ posummit $SOMEWHERE/summit-config-shared aa deps $STABLEDIR/foobaz_info.po
$ posummit $SOMEWHERE/summit-config-shared aa deps stable:foobaz_info
</pre>
<p>in summit over static templates. The output would look like this:</p>
<pre class="programlisting">
:    <em class="replaceable"><code>summit-dir</code></em>/foobaz.po  <em class="replaceable"><code>devel-dir</code></em>/foobaz.po <em class="replaceable"><code>stable-dir</code></em>/foobaz_info.po \
     <em class="replaceable"><code>stable-dir</code></em>/foobaz_backup.po <em class="replaceable"><code>stable-dir</code></em>/foobaz_filters.po
</pre>
<p>You can see that the complete dependency chain to which <code class="filename">foobaz_info.po</code> from <code class="literal">stable</code> belongs to has been written out. The first path in the chain is always the summit PO file, followed by all mapped PO files from each branch in turn.</p>
<p>If the file for which the dependency is mapped to more than one summit PO file, then the dependency chains for each of them is displayed. In the <a class="link" href="#l-splmap">example of mapping due to splitting</a>, if you request dependency for monolithic <code class="filename">foobaz.po</code> from <code class="literal">stable</code> branch, you would get three dependency chains:</p>
<pre class="programlisting">
:    <em class="replaceable"><code>summit-dir</code></em>/foobaz.po  <em class="replaceable"><code>devel-dir</code></em>/foobaz.po  <em class="replaceable"><code>stable-dir</code></em>/foobaz.po
:    <em class="replaceable"><code>summit-dir</code></em>/libfoobaz.po  <em class="replaceable"><code>devel-dir</code></em>/libfoobaz.po  <em class="replaceable"><code>stable-dir</code></em>/foobaz.po
:    <em class="replaceable"><code>summit-dir</code></em>/foobaz_help.po  <em class="replaceable"><code>devel-dir</code></em>/foobaz_help.po  <em class="replaceable"><code>stable-dir</code></em>/foobaz.po
</pre></div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-suconfig" id="sec-suconfig"></a>5.3.&nbsp;Elements of Summit Configuration</h2>
</div>
</div>
</div>
<p>Other then the main configuration fields for setting the summit type, summit and branch locations, and mappings, there are many other optional configuration fields. They can be used to make the translation workflow yet more efficient, by relieving translators from taking care of various details.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sucfghooks" id="sec-sucfghooks"></a>5.3.1.&nbsp;Summit Hooks</h3>
</div>
</div>
</div>
<p>Summit operations (gather, merge, scatter) are characterized by having PO files and messages flowing between the summit and branches. It is then natural to think of adding some <span class="emphasis"><em>filtering</em></span> into these flows. For example, on scatter, one could do small ortographic adjustments in translation, or automatically insert translated UI references.<sup>[<a name="id641526" href="#ftn.id641526" class="footnote" id="id641526">20</a>]</sup></p>
<p>Filtering is implemented by being able to insert Pology hooks (see <a class="xref" href="#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">Section&nbsp;9.10, “Processing Hooks”</a>) into various stages of summit operations; a particular stage will admit only certain types of hooks. To <a class="link" href="#sec-lguirefs" title="8.4.&nbsp;Automatic Insertion of UI Labels">fetch and insert translated UI references</a> on scatter, the <code class="literal">resolve-ui</code> hook can be added like this:</p>
<pre class="programlisting">
from pology.uiref import resolve_ui
S.hook_on_scatter_msgstr = [
    (resolve_ui(uicpathenv="UI_PO_DIR"),),
]
</pre>
<p><code class="literal">S.hook_on_scatter_msgstr</code> is a list of hooks which are applied on translation (<code class="varname">msgstr</code> fields) before it is written into branch PO files on scatter. Each element of this list is a tuple of one to three elements. The first element in the tuple is the hook function, here <a class="link" href="#hk-uiref-resolve-ui"><code class="literal">resolve_ui</code></a><sup>[<a name="id655428" href="#ftn.id655428" class="footnote" id="id655428">21</a>]</sup>. <code class="literal">resolve_ui</code> is an F3C hook, which is the type of hooks expected in <code class="literal">S.hook_on_scatter_msgstr</code> list.</p>
<p>The second and third element in the hook tuple are, respectively, selectors by branch and file. These are used when the hook is not meant to be applied on all branches and all PO files. The selector can be either a regular expression string, which is matched against the branch name or PO domain name (positive match means to apply the hook), or a function (return value evaluating as true means to apply the hook). If it is a function, the branch selector gets the branch name as input argument, and the file selector gets the summit PO domain name and summit subdirectory. For example, to add the specialized <code class="literal">resolve_ui_docbook4</code> hook only to <code class="literal">foobaz-manual.po</code> file, and plain <code class="literal">resolve_ui</code> to all other files, the hook list would be:</p>
<pre class="programlisting">
from pology.uiref import resolve_ui, resolve_ui_docbook4

S.hook_on_scatter_msgstr = [
    (resolve_ui_docbook4(uicpathenv="UI_PO_DIR"), "", "-manual$"),
    (resolve_ui(uicpathenv="UI_PO_DIR"), "", "(?&lt;!-manual)$"),
]
</pre>
<p>The branch selector here is empty string, which means that both hooks apply to all branches (since empty regular expression matches any string). The <code class="literal">resolve_ui_docbook4</code> hook has <code class="literal">"-manual$"</code> regular expression as the file selector, which means that is should be applied to all PO domain names ending in <code class="literal">-manual</code>. The <code class="literal">resolve_ui</code> hook has been given the opposite regular expression, <code class="literal">"(?&lt;!-manual)$"</code>, which matches any PO domain name <span class="emphasis"><em>not</em></span> ending in <code class="literal">-manual</code>.<sup>[<a name="id655535" href="#ftn.id655535" class="footnote" id="id655535">22</a>]</sup> Regular expressions can quickly become unreadable, so here is how the same selection could be achieved with selector functions:</p>
<pre class="programlisting">
from pology.uiref import resolve_ui, resolve_ui_docbook4

def is_manual (domain, subdir):
    return domain.endswith("-manual")
def is_not_manual (domain, subdir):
    return not is_manual(domain, subdir)

S.hook_on_scatter_msgstr = [
    (resolve_ui_docbook4(uicpathenv="UI_PO_DIR"), "", is_manual),
    (resolve_ui(uicpathenv="UI_PO_DIR"), "", is_not_manual),
]
</pre>
<p>When is more than one hook in the list, they are applied in the order if which they are listed.</p>
<p>This is all there is to say about hook application in general. What follows is a list of all presently defined hook insertion lists, with admissible hook types given in parentheses. Usually paired F* and S* hook types are possible, such that F* hooks are primary used for modification, while S* hooks could be employed for validation (e.g. writing out warnings).</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">S.hook_on_scatter_msgstr</code> (F3A, F3C, S3A, S3C)</span></dt>
<dd>
<p>Applied to the branch translation (<code class="varname">msgstr</code> fields) on scatter, before it is written into the branch PO file.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_scatter_msg</code> (F4A, S4A)</span></dt>
<dd>
<p>Applied to branch message on scatter, before it is written into the branch PO file. These hooks can modify any part of the message, like comments, or even the <code class="varname">msgid</code> field.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_scatter_cat</code> (F5A, S5A)</span></dt>
<dd>
<p>Applied to the branch PO file while still in internal parsed state on scatter, after <code class="literal">S.hook_on_scatter_msgstr</code> had been applied to all messages.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_scatter_file</code> (F6A, S6A)</span></dt>
<dd>
<p>Applied to the branch PO file as raw file on disk on scatter, after <code class="literal">S.hook_on_scatter_cat</code> had been applied. If one of the hooks reports non-zero value, the rest of the hooks in the list are not applied to that file.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_scatter_branch</code></span></dt>
<dd>
<p>Applied to the complete branch on scatter, after all other hooks on scatter had been applied. Functions used here are not part of the formal hook system. They take a single argument, the branch name, and return a number. If the return value is not zero, rest of the hooks are skipped on that branch.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_gather_file_branch</code> (F6A, S6A)</span></dt>
<dd>
<p>Applied to the branch PO file as raw file on disk on gather, before <code class="literal">S.hook_on_gather_cat_branch</code> is applied. The branch PO file will not be modified for real, but only its temporary copy.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_gather_cat_branch</code> (F5A, S5A)</span></dt>
<dd>
<p>Applied to the branch PO file while still in internal parsed state on gather, before <code class="literal">S.hook_on_gather_msg_branch</code> is applied to all messages.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_gather_msg_branch</code> (F4A, S4A)</span></dt>
<dd>
<p>Applied to the branch message on gather, before it is used to gather the corresponding summit message.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_gather_msg</code> (F4A, S4A)</span></dt>
<dd>
<p>Applied to the summit message on gather, after it had been gathered from the corresponding branch messages, but before it is written into the summit PO file.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_gather_cat</code> (F5A, S5A)</span></dt>
<dd>
<p>Applied to the summit PO file while still in internal parsed state on gather, after <code class="literal">S.hook_on_gather_msgstr</code> had been applied to all messages.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_gather_file</code> (F6A, S6A)</span></dt>
<dd>
<p>Applied to the summit PO file as raw file on disk on gather, after <code class="literal">S.hook_on_gather_cat</code> had been applied.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_merge_head</code> (F4B, S4B)</span></dt>
<dd>
<p>Applied to summit PO header on merge, after the summit PO file has been merged.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_merge_msg</code> (F4A, S4A)</span></dt>
<dd>
<p>Applied to summit message on merge, after <code class="literal">S.hook_on_merge_head</code> had been applied.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_merge_cat</code> (F5A, S6A)</span></dt>
<dd>
<p>Applied to the summit PO file while still in internal parsed state on merge, after <code class="literal">S.hook_on_gather_msg</code> had been applied to all messages.</p>
</dd>
<dt><span class="term"><code class="literal">S.hook_on_merge_file</code> (F6A, S6A)</span></dt>
<dd>
<p>Applied to the summit PO file as raw file on disk on merge, after <code class="literal">S.hook_on_merge_cat</code> had been applied.</p>
</dd>
</dl>
</div>
<p>You may notice that some logically possible hook insertion lists are missing (e.g. <code class="literal">S.hook_on_merge_msgstr</code>). This is because they are implemented on demand, as the need is observed in practice, and not before the fact.</p>
<p>Here is another example of hook interplay. Branch PO files may still rely on <a class="link" href="#p-embctxt">embedding the context</a> into the <code class="varname">msgid</code> field:</p>
<pre class="programlisting">
msgid "create new document|New"
msgstr ""
</pre>
<p>but you would nevertheless like to have proper <code class="varname">msgctxt</code> contexts in the summit:</p>
<pre class="programlisting">
msgctxt "create new document"
msgid "New"
msgstr ""
</pre>
<p>You can achieve this by writing two small F4A hooks, and inserting them at proper points:</p>
<pre class="programlisting">
def context_from_embedded (msg, cat):
    if "|" in msg.msgid:
        msg.msgctxt, msg.msgid = msg.msgid.split("|", 1)

def context_to_embedded (msg, cat):
    if msg.msgctxt is not None:
        msg.msgid = "%s|%s" % (msg.msgctxt, msg.msgid)
        msg.msgctxt = None

S.hook_on_gather_msg_branch = [
    (context_from_embedded,),
]

S.hook_on_scatter_msg = [
    (context_to_embedded,),
]
</pre>
<p>In this way, branch messages will be converted to proper context just before they are gathered into the summit, and the proper context will be converted back into the embedded when the messages are scattered to branches.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sucfgvcs" id="sec-sucfgvcs"></a>5.3.2.&nbsp;Integration with Version Control Systems</h3>
</div>
</div>
</div>
<p>Most likely, branch and summit directories will be kept under some sort of <a class="link" href="#sec-cmsuppvcs" title="9.7.2.&nbsp;Version Control Systems">version control</a>. This means that when <span class="command"><strong>posummit</strong></span> has finished running, any files that it had added, moved or removed, would have to be manually "reported" to the version control system (VCS). To avoid this, you can set in the summit configuration which VCS is used, among those supported by Pology, and <span class="command"><strong>posummit</strong></span> will issue proper VCS commands when changing the file tree. Then, after the <span class="command"><strong>posummit</strong></span> run, you can simply issue the VCS commit command on appropriate paths.</p>
<p>Since different VCS may be used for the summit and the branches, it is possible to set them separately. For example, if branches are in a Subversion repository and the summit in a Git repository, the summit configuration would contain:</p>
<pre class="programlisting">
S.summit_version_control = "git"
S.branches_version_control = "svn"
</pre>
<p>If the same VCS is used for branches and the summit (whether or not they are in the same repository), only one configuration field can be set:</p>
<pre class="programlisting">
S.version_control = "git"
</pre>
<p>If you would like <span class="command"><strong>posummit</strong></span> to execute VCS commands only in the summit and not in branches, then you would set only the <code class="literal">S.summit_version_control</code> field.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sucfgwrap" id="sec-sucfgwrap"></a>5.3.3.&nbsp;Text Wrapping in PO Files</h3>
</div>
</div>
</div>
<p>While wrapping of text fields in PO files (<code class="varname">msgid</code>, <code class="varname">msgstr</code>, etc) makes no technical difference, it may be <a class="link" href="#sec-cmwrap" title="9.8.&nbsp;Line Wrapping in PO Messages">convenient for editing</a> for them to be wrapped in a particular way. Since <span class="command"><strong>posummit</strong></span> is anyway modifying PO files both in the summit and branches, it might as well be told what kind of wrapping to use.</p>
<p>For example, a reasonable wrapping setup could be:</p>
<pre class="programlisting">
S.summit_wrap = False
S.summit_fine_wrap = True
S.branches_wrap = True
S.branches_fine_wrap = False
</pre>
<p><code class="literal">S.*_wrap</code> fields activate or deactivate basic (column-based) wrapping, while <code class="literal">S.*_fine_wrap</code> fields do the same for logical breaks. So in this example, summit messages are wrapped only on logical breaks (may be good for editing), while branch messages are wrapped only on columns (may reduce size of VCS deltas).</p>
<p>If not set, the default is basic wrapping without fine wrapping, for both branches and the summit.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sucfgviv" id="sec-sucfgviv"></a>5.3.4.&nbsp;Vivification of Summit PO Files</h3>
</div>
</div>
</div>
<p>In direct summit, summit PO files spring into existence by gathering branch PO files. However, in summit over static templates, by default translators have to start a new PO file by copying over the summit template and initializing it. While dedicated PO editors can do this automatically, all translators in the team have to configure their PO editor correctly (language code, plural forms...), and they have to have templates at hand. Furthermore, any statistic processing on the translation project as whole has to specifically consider templates as empty PO files.</p>
<p>Instead of this, it is possible to tell <span class="command"><strong>posummit</strong></span> to automatically initialize summit PO files from summit templates -- to "vivify" them -- when the language summit is merged. There is a summit configuration switch to enable vivification, as well as several fields to specify the information needed to initialize a PO file. Here is an example:</p>
<pre class="programlisting">
S.vivify_on_merge = True
S.vivify_w_translator = "Simulacrum"
S.vivify_w_langteam = "Nevernissian &lt;l10n@neverwhere.org&gt;"
S.vivify_w_language = "nn"
S.vivify_w_plurals = "nplurals=7; plural=(n==1 ? ...)"
</pre>
<p>Setting <code class="literal">S.vivify_on_merge</code> to <code class="literal">True</code> engages vivification. The <code class="literal">S.vivify_w_translator</code> field specifies the value of <code class="literal">Last-Translator:</code> header field in vivified PO file; it can be something catchy rather than a real translator's name, to be able to see later which summit PO files were not yet worked on. <code class="literal">S.vivify_w_langteam</code> is the contents of <code class="literal">Translation-Team:</code> header field (team's name and email address), <code class="literal">S.vivify_w_language</code> of <code class="literal">Language:</code> (language code), and <code class="literal">S.vivify_w_plurals</code> of <code class="literal">Plural-Forms:</code>.</p>
<p>In summit over dynamic templates, vivification is unconditionally active, whether <code class="literal">S.vivify_on_merge</code> is set or not. This is because synchronization of branches and the summit is checked by comparing template trees, and summit PO files are the only indicator of "virtual" presence of summit templates (while in summit over static templates, the summit template tree is physically present). Without vivification, it would also be very hard for project-wide statistics to take templates into account as empty summit PO files.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sucfgbmrg" id="sec-sucfgbmrg"></a>5.3.5.&nbsp;Merging in Branches</h3>
</div>
</div>
</div>
<p>By default it is assumed that branch PO files are merged with branch templates using a separate mechanism, which was already in place when the summit was introduced into the workflow. In summit over templates modes, if branch merging is performed asynchronously to summit merging, on scatter it may happen that some messages recently added to branch PO file are not yet present in corresponding summit PO file. In that case, <span class="command"><strong>posummit</strong></span> will issue warnings about missing messages in the summit. This is normally not a problem, because merging asynchronicity will stop causing such differences as the pre-release message freeze in the source sets in.</p>
<p>However, on the one hand side, warnings of about messages missing in the summit may be somewhat disconcerting, or aesthetically offending in the otherwise clean scatter output. On the other hand side, perhaps the existing mechanism of merging in branches is not too clean, and it would be nice to replace it with something more thorough. Therefore, in summit over templates modes, it is possible to configure the summit such that on merge, <span class="command"><strong>posummit</strong></span> merges not only the summit PO files, but also all branch PO files. This is achieved simply by adding the <code class="literal">merge=</code> key to each branch that should be merged:</p>
<pre class="programlisting">
S.branches = [
    dict(id="devel", ..., merge=True),
    dict(id="stable", ..., merge=True),
]
</pre>
<p>When merging in branches is activated, it is still possible to merge only the summit, or any single branch. This is done by using giving an operation target on merge, either the path to the branch top directory or the branch name. For example, in summit over dynamic templates:</p>
<pre class="programlisting">
$ cd $SUMMITDIR
$ posummit merge $DEVELDIR/  # merge only the devel branch
$ posummit merge devel:      # same
$ posummit merge .           # merge only the summit
$ posummit merge +:          # same
</pre></div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sucfghead" id="sec-sucfghead"></a>5.3.6.&nbsp;Propagation of Header Parts</h3>
</div>
</div>
</div>
<p>PO headers are treated somewhat differently from PO messages in summit operations:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>On gather, almost all of the standard header field of the <span class="emphasis"><em>primary branch PO file</em></span> are copied into the summit PO file. The primary branch PO file is defined as the first branch PO file (in case of several branch files being mapped onto the same summit PO file) from the first branch (as listed in the branch specification in summit configuration). The only exception is the <code class="literal">POT-Creation-Date:</code>, which is set to the time of gathering, if there were any other modifications to the summit PO file. Header comments are not copied over, except when the summit PO files is being automatically created for the first time.</p>
</li>
<li class="listitem">
<p>On merge, the summit PO file is merged with the summit PO template using <span class="command"><strong>msgmerge</strong></span>, so its header propagation rules apply. For example, no header comments will be touched, <code class="literal">POT-Creation-Date:</code> will be copied over from templates but <code class="literal">Last-Translator:</code> will not be touched, etc. This also means that, by default, any non-standard fields in the template (e.g. those starting with <code class="literal">X-*</code>) will be silently dropped.</p>
</li>
<li class="listitem">
<p>On scatter, almost the complete header is copied over from the <span class="emphasis"><em>primary summit PO file</em></span> into the branch PO file. The primary summit PO file is defined as the first mapped summit PO file, in cases when the single branch PO file has been mapped to several summit PO files. The exception are <code class="literal">Report-Msgid-Bugs-To:</code> and <code class="literal">POT-Creation-Date:</code>, which are preserved as they are in the branch PO file. Also, <code class="literal">PO-Revision-Date:</code> is set to that of the primary summit PO file only if there were any other modifications to the branch PO file (because it may happen that all updates to the summit PO file since the last scatter were for messages from other branches).</p>
</li>
</ul>
</div>
<p>There exists the possibility to influence this default header propagation. In particular, non-standard header fields may be added into branch and summit PO files and templates by different tools, and it may be significant to preserve and propagate these fields in some contexts. The following summit configuartion fields can used for that purpose:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">S.header_propagate_fields</code> field can be set to a list of non-standard header field names which should be propagated in gather and merge operations, from branch into summit PO files. For example, to propagate fields named <code class="literal">X-Accelerator-Marker:</code> and <code class="literal">X-Sources-Root-URL:</code>, the following can be added to summit configuration:</p>
<pre class="programlisting">
S.header_propagate_fields = [
    "X-Accelerator-Marker",
    "X-Sources-Root-URL",
]
</pre>
<p>Only the primary branch PO file is considered for determining the presence and getting the values of these header fields.</p>
</li>
<li class="listitem">
<p>Instead of simply overwriting on scatter most of the branch PO header fields with summit PO header fields, some additional branch fields may be preserved by setting <code class="literal">S.header_skip_fields_on_scatter</code> to the list of header field names to preserve. For example, to preserve <code class="literal">X-Scheduled-Release-Date:</code> field in branch PO files:</p>
<pre class="programlisting">
S.header_skip_fields_on_scatter = [
    "X-Scheduled-Release-Date",
]
</pre></li>
</ul>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sucfgascf" id="sec-sucfgascf"></a>5.3.7.&nbsp;Filtering by Ascription on Scatter</h3>
</div>
</div>
</div>
<p><a class="xref" href="#ch-ascript" title="Chapter&nbsp;6.&nbsp;Ascribing Modifications and Reviews">Chapter&nbsp;6, <i>Ascribing Modifications and Reviews</i></a> describes a translation review system available in Pology, in which every PO message has its modification and review history kept up to some depth in the past. Based on that history, it is possible to select which messages from working PO files (those under ascription) can be passed into release PO files, provided that these two file trees exist. Summit and branches can be viewed exactly as an instance of such separation, where the summit is the working tree, and each branch a release tree.</p>
<p>In this context, only the summit tree should be kept under ascription. Filtering for release is then, naturally, performed on scatter: to each summit PO message a sequence of one or more ascription selectors is applied, and if the message is selected by the selector sequence, it is passed into the branch PO file. Several selector sequences may be defined, for use in various release situations, through <code class="literal">S.ascription_filters</code> configuration field.</p>
<p>For example, to have a single filtering sequence which simply lets through all messages not modifed after last review, the following should be added to summit configuration:</p>
<pre class="programlisting">
S.ascription_filters = [
    ("regular", ["nmodar"]),
]
</pre>
<p>Each filtering sequence is represented by a two-element tuple. The first element is the name of the filtering sequence, here <code class="literal">regular</code>. You can set the name to anything you like; when there is only one filtering sequence, the name is actually nowhere used later. The second element of the tuple is a list of ascription selectors, which are given just as the values to <code class="option">-s</code> options in <span class="command"><strong>poascribe</strong></span> command line. Here only one selector is issued, <code class="literal">nmodar</code>, which is the negation of modified-after-review selector. This yields the desired filter to pass all messages "not modifed after last review".</p>
<p>A more involving example would be that of having one filter for regular scatter, and another "emergency" filter, which relaxes the strictness a bit in case there was no time to properly review all new translations. This emergency filter may let through unreviewed messages if modified by a select few persons, which are known to produce sufficient quality translators in first attempt. If these persons are, for example, <code class="literal">alice</code> and <code class="literal">bob</code> (by their ascription user names), then the two-filter setup could look like this:</p>
<pre class="programlisting">
S.ascription_filters = [
    ("regular", ["nmodar"]),
    ("emergency", ["nmodar:~alice,bob"]),
]
</pre>
<p>The <code class="literal">regular</code> filter looks like in the previous example. The <code class="literal">emergency</code> filter also uses just one <code class="literal">nmodar</code> selector, but with additional argument to consider all users except for <code class="literal">alice</code> and <code class="literal">bob</code>. Due to the fact that it is listed first, the <code class="literal">regular</code> filter is applied on scatter by default. Application of the <code class="literal">emergency</code> filter is requested by issuing the <code class="option">-a</code>/<code class="option">--asc-filter</code> option with filter name as value:</p>
<pre class="programlisting">
$ cd $SUMMITDIR
$ posummit scatter -a emergency
</pre>
<p>When scattering is performed under the ascription filter, messages stopped by the filter will be counted and their number (if non-zero) reported per branch PO file.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sucfgbranch" id="sec-sucfgbranch"></a>5.3.8.&nbsp;Other Branch Options</h3>
</div>
</div>
</div>
<p>Each branch entry in branch specification (<code class="literal">S.branches</code> configuration field) can have some keys in addition to those described earlier.</p>
<p>It is possible to exclude some branch PO files from summit operations, or to include only certain branch PO files into summit operations. This is done by setting <code class="literal">excludes=</code> and <code class="literal">includes=</code> keys. The value is a list of tests on branch PO file absolute path: if any test matches, the file is matched on the whole (logical OR). Each test can be either a regular expression string, or a function taking the file path as argument and returning a truth value. If only <code class="literal">excludes=</code> is set, then all files not matched are operated on, and if <code class="literal">includes=</code> is set, only matched files are operated on. If both keys are set, then only files matched by <code class="literal">includes=</code> and not matched by <code class="literal">excludes=</code> are operated on.</p>
<p>If branches are under version control and <span class="command"><strong>posummit</strong></span> is told to <a class="link" href="#sec-sucfgvcs" title="5.3.2.&nbsp;Integration with Version Control Systems">issue version control commands</a> as appropriate (i.e. <code class="literal">S.branches_version_control</code> configuration field is set), it is possible to exclude a specific branch from this, by setting its <code class="literal">skip_version_control=</code> key to <code class="literal">True</code>.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sucfgbonmrg" id="sec-sucfgbonmrg"></a>5.3.9.&nbsp;Other Merge Options</h3>
</div>
</div>
</div>
<p>As is usual, merging performed by <span class="command"><strong>posummit</strong></span> by default produces <a class="link" href="#sec-pofuzzy" title="2.5.1.&nbsp;Fuzzy Messages">fuzzy messages</a>; in summit PO files, as well as in branch PO files if <a class="link" href="#sec-sucfgbmrg" title="5.3.5.&nbsp;Merging in Branches">merging in branches</a> is enabled. It is possible to prevent fuzzy matching, by setting <code class="literal">S.summit_fuzzy_merging</code> and <code class="literal">S.branches_fuzzy_merging</code> configuration fields to <code class="literal">True</code>. There should be little reason to disable fuzzy matching in summit PO files, but it may be convenient to do so in branch PO files, which are not directly translated. For example, lack of fuzzy message will lead to smaller version control deltas.</p>
<p>Fuzzy messages are by default produced by <span class="command"><strong>msgmerge</strong></span> alone. This can be more finely tuned by processing the PO file before and after it has been merged, as done by <a class="link" href="#sec-miselfmerge" title="7.2.&nbsp;Self-Merging PO Files with poselfmerge">the <span class="command"><strong>poselfmerge</strong></span> command</a>. The <code class="literal">S.merge_min_adjsim_fuzzy</code> configuration field can be set to a number in range from 0 to 1, having the same effect on fuzzy matching as the <code class="option">-A</code>/<code class="option">--min-adjsim-fuzzy</code> option of <span class="command"><strong>poselfmerge</strong></span>. The <code class="literal">S.merge_rebase_fuzzy</code> field can be set to <code class="literal">True</code>, with the same meaning as the <code class="option">-b</code>/<code class="option">--rebase-fuzzies</code> option of <span class="command"><strong>poselfmerge</strong></span>.</p>
<p>Summit PO files may be merged by consulting a compendium, to produce additional exact and fuzzy matches. This possibility also draws on the functionality provided by <span class="command"><strong>poselfmerge</strong></span>. The <code class="literal">S.compendium_on_merge</code> configuration field is used to set the path to a compendium<sup>[<a name="id664755" href="#ftn.id664755" class="footnote" id="id664755">23</a>]</sup>, equivalently to the <code class="option">-C</code>/<code class="option">--compendium</code> option of <span class="command"><strong>poselfmerge</strong></span>. Since compendium matches are less likely to be appropriate than own matches, you may set the <code class="literal">S.compendium_fuzzy_exact</code> field to <code class="literal">False</code>, or the <code class="literal">S.compendium_min_words_exact</code> fiel to a positive integer number, with the same effect as <code class="option">-x</code>/<code class="option">--fuzzy-exact</code> and <code class="option">-W</code>/<code class="option">--min-words-exact</code> options of <span class="command"><strong>poselfmerge</strong></span>, respectively.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-sucfgbonsct" id="sec-sucfgbonsct"></a>5.3.10.&nbsp;Other Scatter Options</h3>
</div>
</div>
</div>
<p>Sometimes a summit PO file may be "pristine", meaning that all messages in it are clear, neither translated nor fuzzy. Pristine summit PO files may appear, for example, when <a class="link" href="#sec-sucfgviv" title="5.3.4.&nbsp;Vivification of Summit PO Files">vivification</a> is active. A pristine summit PO file will by default cause a likewise empty branch PO file to appear on scatter. This may or may not be a problem in a given project. If it is a problem, it is possible to set the minimal translation completeness of a summit PO file at which the branch PO file will be created on scatter. For example:</p>
<pre class="programlisting">
S.scatter_min_completeness = 0.8
</pre>
<p>sets the minimum completeness to scatter at 80%. Completeness is taken to be the ratio of the number of translated to all messages in the file (excluding obsolete).</p>
<p>Translation completeness of a summit PO file may deteriorate over time, as it is periodically gathered or merged, and no one comes around to update the translation. At some point, the completeness may become too low to be considered useful, so that it is better to stop releasing remaining translations in that file until it is updated. The completeness at which this happens, at which the branch PO file is automatically cleared of all translations on scatter, can be set through <code class="literal">S.scatter_acc_completeness</code> configuration field. The meaning of the value of this field is the same as for <code class="literal">S.scatter_min_completeness</code>; in fact, one might ask why not simply use <code class="literal">S.scatter_min_completeness</code> for this purpose as well. The reason is that sometimes a higher bar is put for the initial release, and having two separate configuration fields enables you to make this difference.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-suproblems" id="sec-suproblems"></a>5.4.&nbsp;Disadvantages to Summit Workflow and Remedies</h2>
</div>
</div>
</div>
<p>Although hopefully shadowed by the advantages, working in summit is not without some disadvantages. These should be weighed in when deciding on whether to try out the summit workflow.</p>
<p>In summit over template modes, any changes made manually in branch PO files will not propagate into summit, and will be soon lost to scattering. This means that the whole translation team must work in the summit. It is not possible for some members to use the summit, and some not. In direct summit mode, modifying branches directly would be even messier, as some changes would find their way into the summit and some not, depending on which branch contains the change and the order of gather and scatter operations.</p>
<p>A summit PO file will necessarily have more messages than either of the branch files. For example, in two successive development-stable branch cyclings within the KDE translation project (at the time about 1100 PO files with 750.000 words), summit PO files were on average 5% bigger (by number of words) than their branch counterparts. This percentage can be taken as the top limit of possibly wasted translation effort due to messages in development branch coming and going, given that as the next branch cycling approaches more and more messages become fixed and make into the next stable branch.</p>
<p>A more pressing issue with increased size of summit PO files is the following scenario: next stable release is around the corner, and the translation team has no time to update summit PO files fully, but could update only stable messages in them. For example, there are 1000 untranslated and fuzzy messages in the summit, out of which only 50 are coming from the stable branch. A clever dedicated PO editor could allow jumping only through untranslated and fuzzy messages which additionaly satisfy a general search criteria, in this case that a comment matches <code class="literal">\+&gt;.*stable</code> regular expression (assuming the stable branch is named <code class="literal">stable</code> in summit configuration). Lacking such a feature, with some external help it is enough if the editor can merely search through comments. First, Pology's <a class="link" href="#ch-sieve" title="Chapter&nbsp;3.&nbsp;Sieving"><span class="command"><strong>posieve</strong></span> command</a> can be used to equip all untranslated and fuzzy stable messages in summit PO files with an <code class="literal">untranslated</code> flag (producing <code class="literal">#, ..., untranslated</code> comment):</p>
<pre class="programlisting">
$ posieve tag-untranslated -sbranch:stable -swfuzzy <em class="replaceable"><code>paths...</code></em>
</pre>
<p>Then, in the PO editor you can jump through incomplete stable messages by simply searching for this flag. While doing that, you are not obligated to manually remove the flag: it will either automatically disappear on the next merge, or you can remove all flags afterwards by running:</p>
<pre class="programlisting">
$ posieve tag-untranslated -sstrip <em class="replaceable"><code>paths...</code></em>
</pre>
<p>There are some organizational issues with starting to use the summit, and, if it turns out counter-productive, stopping to use it. Team members have first to be reminded not to send in or commit branch PO files, and then if the summit is disbanded, to be reminded to go back to branch PO files. On the plus side, disbanding the summit is technically simple, simply removing its top directory and summit configuration file will do the job.</p>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id585276" href="#id585276" class="para" id="ftn.id585276">14</a>]</sup> One may think of relying upon the translation memory: translate only PO files from one branch, and batch-apply translation memory to PO files other branches, accepting only exact matches. This is dangerous, because short messages may need different translations in different PO files, resulting in hilarious mistranslations.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id579858" href="#id579858" class="para" id="ftn.id579858">15</a>]</sup> Unfortunatelly, the following common organization cannot be automatically supported:</p>
<pre class="screen">
path/to/devel/
    appfoo/
        src/
        doc/
        po/
            aa.po
            bb.po
            ...
            # no template!
        ...
    appbar/
        ...
</pre>
The problem is that there is no way to determine domain names from the file tree alone, and that different handling would be required for sources which actually have multiple PO domains.</div>
<div class="footnote">
<p><sup>[<a name="ftn.id667370" href="#id667370" class="para" id="ftn.id667370">16</a>]</sup> New translations do not have to appear in branches only by mistake. For example, some external sources, which have been translated elsewhere, may be integrated into the project.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id667398" href="#id667398" class="para" id="ftn.id667398">17</a>]</sup> More precisely, if there are two same-name PO domains inside one branch, they will both be gathered into the same summit PO file. The assumption is that PO files with same domain names have mostly common messages.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id648409" href="#id648409" class="para" id="ftn.id648409">18</a>]</sup> It can be changed by assigning another string to <code class="literal">S.templates_lang</code>.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id637402" href="#id637402" class="para" id="ftn.id637402">19</a>]</sup> One could also skip this and allow immediate loss of translations, and rely on the translation memory when later translating new PO files. But, especially in centralized summit maintenance, it is better to make things right early. Also, translation memory matches may not be as reliable, since they come not only from the original PO file, but from all PO files in the project.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id641526" href="#id641526" class="para" id="ftn.id641526">20</a>]</sup> Another possibility are validation filters, which do not modify the text but report possible problems, though <a class="link" href="#sec-lgrules" title="8.5.&nbsp;Validation Rules">validation rules</a> and <a class="link" href="#sv-check-rules" title="3.5.7.&nbsp;check-rules">the <span class="command"><strong>check-rules</strong></span> sieve</a> are likely a better solution.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id655428" href="#id655428" class="para" id="ftn.id655428">21</a>]</sup> <code class="literal">resolve_ui</code> is not the hook function itself, but a hook factory. It is called with the argument <code class="literal">uicpathenv="UI_PO_DIR"</code> to produced the actual hook function. See its documentation for details.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id655535" href="#id655535" class="para" id="ftn.id655535">22</a>]</sup> This pattern makes use of a <span class="emphasis"><em>negative lookbehind</em></span> token, a fairly advanced bit of regular expression syntax.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id664755" href="#id664755" class="para" id="ftn.id664755">23</a>]</sup> Here you can also use the <code class="literal">S.relpath()</code> function, to have the compendium path be relative to the directory of the summit configuration file.</p>
</div>
</div>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-ascript" id="ch-ascript"></a>Chapter&nbsp;6.&nbsp;Ascribing Modifications and Reviews</h2>
</div>
</div>
</div>
<p>It may not be obvious, especially to new translators, to which extent the translation needs to be reviewed. If the translator has exercised due diligence, how "wrong" can the translation be? Even if the translator has good command of the source language -- typically English in context of PO files -- the answer is "very wrong", all aspects considered.</p>
<p>With comparatively simple grammar of English, the meaning of a short English sentence (as typically encountered in program user interfaces) may vary much depend on the surrounding context. This context may not be obvious when the translator is going through isolated messages in the PO file, so he may commit the worst of errors from the reader's viewpoint: the senseless translation. An experienced reviewer will have developed sense for troublesome contexts, and will have at disposal several means to conclusively determine the context (including, for example, running the development version of the program).</p>
<p>Even if the context is correctly established, the translator may use "wrong" terminology, which is the next worse thing for the reader. A term used in translation does not need to be wrong by itself, in fact it may be exactly the correct term -- in another translation project. The reviewer will have more experience with terminology of the present project, and be able to bring the translation in line with it.</p>
<p>Style in the technical sense is a consistent choice between several perfectly valid constructs in target language when applied to text in the given technical context. For example, how to translate menu titles and items, button labels, or tooltips in user interface. Choices may include noun or verb forms, particular grammar categories, tone of address, and so on. There may be a style guide to the project which details such choices, and the reviewer will know it well.</p>
<p>Style in the linguistic sense is especially applicable to longer texts, such as tooltips in user interface or paragraphs in documentation. A typical error of a new translator is to closely adhere to English style and grammar. This may produce translation which is semantically and grammatically valid in the target language, but very out of style. Reviewer then steps in to naturalize such constructs.</p>
<p>Finally, while the reviewer may be an experienced translator, that does not mean that his own translations need no review. Immersion into the source language, distraction, and fatigue, will lead the reviewer into any of the above errors in translation, only with lesser frequency. This means that reviewers should also mutually review their own translations.</p>
<p>This calls for a systematic approach to review in translation workflow.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-ascrevcomp" id="sec-ascrevcomp"></a>6.1.&nbsp;Review Stages vs. Ascription</h2>
</div>
</div>
</div>
<p>Classical review workflow, <span class="emphasis"><em>by stages</em></span>, seems simple enough. Translator translates a new PO file or updates an existing translation, and declares it ready to review. A reviewer reviews it, and declares it ready to commit into the pool from which PO files are periodically released. A committer finally commits the file. The process is iterative: the reviewer may return the file to the translator, and translator later again declare it as ready for review. There may be several stages of review (such as <span class="emphasis"><em>proof-reading</em></span>, <span class="emphasis"><em>approving</em></span>), each of which may return the translation to a previous stage, or forward it to some special stage. The process may also be implemented on the subfile level, where each PO message can go through stages separately.</p>
<p>Regardless of the technical details, review workflows of this kind all have the following in common. Members of the translation team are assigned <span class="emphasis"><em>roles</em></span> (such as <span class="emphasis"><em>translator</em></span>, <span class="emphasis"><em>reviewer</em></span>, <span class="emphasis"><em>committer</em></span>) by which they step into the workflow. A single person can have more roles. Later review stages must wait for the earlier stages to complete, and the translation cannot be updated again before the current version clears the review pipeline (or the pipeline is aborted). Once the translation is committed, it becomes a part of simply "admitted" translations, with no further qualifiers.</p>
<p>The system of prescribed roles requires that team members assign the roles between themselves, stick to them, and shuffle them along the way. The prescribed review pipeline requires a tool to keep track of the current review stage of translation. This makes the review workflow rigid, with probable bottlenecks. Distribution of roles may become disbalanced by people coming into and leaving the team, or the tracking tool may be prohibitive to some scenarios (e.g. single translator making small adjustments in dozens of files across the project, but having to upload each manually through a web interface).</p>
<p>"Rigid" and "inefficient" are comparative qualifications, so what is it that review by stages can be compared to in this way?</p>
<p>Review <span class="emphasis"><em>by ascriptions</em></span> is even simpler conceptually, and yet less rigid and more efficient than the review by stages. It obligatory works on the PO message level, rather than PO file level. Anyone can simply translate some PO messages and directly commit modified PO files, without any review, but <span class="emphasis"><em>ascribing</em></span> modifications to own name. Anyone can review any PO message at any moment, commit modifications made during the review, and ascribe the review to own name (and possibly to a certain class -- review of context, of terminology, style, etc). When the time comes to release the translation, <span class="emphasis"><em>insufficiently</em></span> reviewed messages are automatically omitted, by evaluating the <span class="emphasis"><em>ascription history</em></span> of each message.</p>
<p>Based on the ascription history, the reviewer can select a subset of PO messages, and review only the difference between their historical and current versions. For example, Alice can select to review only messages modified since she or Bob had last reviewed them for style. She could see the difference from that last review to current version, e.g. if in the whole paragraph only a single word was changed by Charlie when he reviewed the terminology. Ascription history also propagate through merging of PO files with templates, so the reviewer can compare the change in original to the change in translation since the last review and judge if one fits the other.</p>
<p>Since everyone just commits, translations can be efficiently kept in a version control repository, with the ascription system added on top. After having done some translating, the translator simply substitutes commit command of the version control system (VCS) with "ascribe modifications" command of the ascription system (AS, which calls the underlying VCS internally). After reviewing, the reviewer uses "ascribe reviews" command of the AS to commit reviews to ascription history (as well as any modifications made during the review). To select messages for review, the reviewer issues "diff for review" command of the AS, with suitable parameters to narrow the message set; selected messages are marked in-place in PO files and equipped with <a class="link" href="#ch-diffpatch" title="Chapter&nbsp;4.&nbsp;Diffing and Patching">embedded differences</a>, and possibly directly opened in a PO editor.</p>
<p><a name="p-asrel" id="p-asrel"></a>When the translations are to be released, the release person issues "filter for release" command of the AS, which takes the working PO files and creates final PO files, in which the insufficiently reviewed messages are removed. Here "release time" can be understood figuratively: since filtering for release should be a fully automatic process, it can be performed at any interval of convenience.</p>
<p>What constitutes "sufficient review" can be defined in fine detail. It could be specified that messages modified by Alice need to have only review for terminology, but not necessarily for style; Charlie may belong to the group which needs to be reviewed on style, but not necessarily on context; Bob's reviews for style may be nice to have, but never blocking the release if missing. These decisions do not preclude released messages to be reviewed later on missing points, after higher priority reviews have been completed. The definition of sufficiency may be changed at any point, e.g. as team members get more experienced and require less review, without interfering with direct translation and review activities.</p>
<p>In summary, an AS preserves the operational efficiency of VCS, while at the same time providing great flexibility of review. All team members can be given commit access, no web or email detours are needed. There are no prescribed roles, but a functional equivalent of role assignment happens at the last possible moment (release time), can take into account both translators' and reviewers' abilities, and changing estimates of those over time. There is no staging between completing and committing the translation, which enables a translator to continue polishing the translation undisturbed until a reviewer comes around. There are no bottlenecks when performing small changes in many files, since a single AS command commits all changes just as a single VCS command would. On commit operations, the AS can also apply various checks (e.g. decline to commit syntactically invalid PO files) and modifications (e.g. update translator's data in the PO header).</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-ascsetup" id="sec-ascsetup"></a>6.2.&nbsp;Setting up Ascription with <span class="command"><strong>poascribe</strong></span></h2>
</div>
</div>
</div>
<p>Pology provides an ascription system in the form of the <span class="command"><strong>poascribe</strong></span> command.</p>
<p>Let the organization of PO files for the language <code class="literal">nn</code> in the version control repository be such:</p>
<pre class="programlisting">
l10n-nn/
    po/
        ui/
            alpha.po
            bravo.po
            ...
        doc/
            alpha.po
            bravo.po
            ...
        ...
</pre>
<p>Having PO files grouped by language can be taken as a hard prerequisite<sup>[<a name="id597772" href="#ftn.id597772" class="footnote" id="id597772">24</a>]</sup>. Also necessary is a single top subdirectory for the whole PO file tree (here <code class="filename">po/</code>), rather than having several PO subdirectories directly in the language directory.</p>
<p>Setting up ascription is now simple. Create the ascription configuration file named exactly <code class="filename">ascription-config</code> (<span class="command"><strong>poascribe</strong></span> expects this name), on the same level as the top PO directory:</p>
<pre class="programlisting">
l10n-nn/
    ascription-config
    po/
        ui/
            ...
        doc/
            ...
</pre>
<p>and set in it a few global configuration fields, and data for each known translator:</p>
<pre class="programlisting">
# ---------------------------
# Global ascription settings.

[global]

# Roots of the original and ascription trees.
catalog-root = po
ascript-root = po-ascript

# The underlying version control system.
version-control = svn

# Data for updating PO headers on request.
language = nn
language-team = Nevernissian
team-email = l10n-nn@neverwhere.org

# Default commit message.
commit-message = Translation updates.

# -----------------------
# Registered translators.

[user-alice]
name = Alice Akmalryn
original-name = Алиса Акмалрин
email = alice.akmalryn@someplacenice.org

[user-bob]
name = Bob Bromkin
original-name = Бобан Бромкин
email = bob.byomkin@otherplacenice.org

# ...and so on.
</pre>
<p>The configuration fields used in this example, and other possible configuration fields, are listed and described below.</p>
<p>Global settings in the configuration file:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">catalog-root</code></span></dt>
<dd>
<p>The path to top PO subdirectory. This should be a relative path, and relative to the location of the configuration file.</p>
</dd>
<dt><span class="term"><code class="literal">ascript-root</code></span></dt>
<dd>
<p>Relative path to the top directory of <a class="link" href="#p-ascftree">the ascription file tree</a>, which will be created and updated by <span class="command"><strong>poascribe</strong></span>.</p>
</dd>
<dt><span class="term"><code class="literal">version-control</code></span></dt>
<dd>
<p>The underlying version control system of the repository. The value is a keyword, see <a class="xref" href="#sec-cmsuppvcs" title="9.7.2.&nbsp;Version Control Systems">Section&nbsp;9.7.2, “Version Control Systems”</a> for a list of VCS supported by Pology.</p>
</dd>
<dt><span class="term"><code class="literal">language</code>,</span> <span class="term"><code class="literal">language-team</code>,</span> <span class="term"><code class="literal">team-email</code>,</span> <span class="term"><code class="literal">plural-header</code></span></dt>
<dd>
<p>These fields provide information about the language and the translation team, which <span class="command"><strong>poascribe</strong></span> uses to update header fields in modified PO files. <code class="literal">language</code> is the language code, while <code class="literal">language-team</code> is usually just the human-readable language name in English. <code class="literal">plural-header</code> is the exact contents of <code class="literal">Plural-Forms:</code> PO header field (if it contains a <code class="literal">%</code> character, you need to escape it as <code class="literal">%%</code>). For any of these fields that is not set, <span class="command"><strong>poascribe</strong></span> will remove the corresponding header field when updating the PO header.</p>
</dd>
<dt><span class="term"><code class="literal">title</code></span></dt>
<dd>
<p>The first comment line in the PO header, set when <span class="command"><strong>poascribe</strong></span> updates the header. It can contain the following placeholders for inserting file-dependent information: <code class="literal">%basename</code> is the base PO file name (e.g. <code class="literal">alpha.po</code>), <code class="literal">%poname</code> the PO domain name (e.g. <code class="literal">alpha</code>), <code class="literal">%langname</code> the human-readable language name (supplied by the <code class="literal">language-team</code> field), and <code class="literal">%langcode</code> the language code (supplied by the <code class="literal">language</code> field). Note that these placeholders actually must be written as <code class="literal">%%<em class="replaceable"><code>name</code></em></code>, to escape the special meaning of single <code class="literal">%</code> character. If <code class="literal">title</code> field is not set, <span class="command"><strong>poascribe</strong></span> will leave the title comment as it is in the PO file.</p>
</dd>
<dt><span class="term"><code class="literal">commit-message</code></span></dt>
<dd>
<p>The default commit message for the underlying VCS, when <span class="command"><strong>poascribe</strong></span> calls upon it to commit modified PO files. If this field is not set, an editor window will pop up to input the commit message, or the <code class="option">-m</code>/<code class="option">--message</code> option can be used to set the message through the command line. If the field is set, <code class="option">-m</code> can still be used to override the default commit message.</p>
</dd>
<dt><span class="term"><code class="literal">review-tags</code></span></dt>
<dd>
<p>The set of accepted <a class="link" href="#sec-ascfgrev" title="6.4.3.&nbsp;Fine-Grained Reviews">review tags</a>, given as whitespace-separated list of tags. If set, <span class="command"><strong>poascribe</strong></span> will abort when trying to use an unknown tag, otherwise it will accept any tag.</p>
</dd>
</dl>
</div>
<p>Each known translator is represented by a <code class="literal">[user-<em class="replaceable"><code>name</code></em>]</code> configuration section. Translator's user name in the ascription system has no direct relation with the underlying VCS account name (if VCS uses them), but it makes sense for them to be equal. This also means that a translator does not even have to have VCS account (repository commit access), though this is expected for the sake of efficiency. Translator configuration sections can contain the following fields:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">name</code></span></dt>
<dd>
<p>Translator's name, in the form supposed to be readable in English. This means that if the name is not originally written in Latin script, some romanized form should be given.</p>
</dd>
<dt><span class="term"><code class="literal">original-name</code></span></dt>
<dd>
<p>Translator's name in its original form, if it differs from the romanized form given by the <code class="literal">name</code> field.</p>
</dd>
<dt><span class="term"><code class="literal">email</code></span></dt>
<dd>
<p>The email address at which the translator may be contacted.</p>
</dd>
</dl>
</div>
<p>As soon as <code class="filename">ascription-config</code> file is committed to the repository, the ascription system through <span class="command"><strong>poascribe</strong></span> is ready for use. The only expected regular modifications to the configuration file are those of adding new translators. On the other hand, translators should never be removed, because even after they go away, their ascription records remain in the system.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-ascinit" id="sec-ascinit"></a>6.2.1.&nbsp;Initial Ascription</h3>
</div>
</div>
</div>
<p>The most common situation at the start of ascription workflow is that there already exists a considerable amount of translations, contributed by many different people over time. These existing translations should be ascribed as initial modifications -- but ascribed to whom? If it is not precisely known who translated what, the solution is to introduce a generic user in the configuration file, appropriately named "Unknown Hero" (or "Lost Translator", you can be inventive):</p>
<pre class="programlisting">
[user-uhero]
name = Unknown Hero
original-name = Незнани јунак
</pre>
<p>You should then ascribe all existing translations as modified and reviewed by this dummy translator:</p>
<pre class="programlisting">
$ cd $LANGDIR
$ poascribe commit -u uhero --all-reviewed -C  po/
</pre>
<p>The <code class="literal">commit</code> argument is the ascription mode, and the <code class="option">-u</code> option provides the user name to which ascriptions are made. This is an important point: ascriptions are made to a user defined in ascription configuration, and have nothing to do with VCS itself. It is the <code class="option">--all-reviewed</code> option that declares all messages to be reviewed as well (this option is normally used only this once, and not in day to day operation). The <code class="option">-C</code> option prevents automatic VCS adding and committing, which is useful for this initial step.</p>
<p>When this command line is executed, a progress bar will appear and the following output will start to unfold:</p>
<pre class="programlisting">
doc/alpha.po  (43/43)
doc/bravo.po  (81/81)
...
ui/alpha.po  (582/582)
ui/bravo.po  (931/931)
...
===== Ascription summary:
-           modified  reviewed
translated     11775     11775
fuzzy           2943      2943
obsolete/t       365       365
obsolete/f        26        26
</pre>
<p>The number in parenthesis indicates how many messages have been ascribed in the given PO file (modified/reviewed), and at the end the totals are given.</p>
<p>If, on the contrary, it is known who translated and reviewed what up to that point, ascription can be performed piece-wise with user names of real translators:</p>
<pre class="programlisting">
$ cd $LANGDIR
$ poascribe commit -u alice --all-reviewed -C  po/ui/
$ poascribe commit -u bob --all-reviewed -C  po/doc/
$ ...
</pre>
<p><a name="p-ascftree" id="p-ascftree"></a>After the initial ascription has been made, the <span class="emphasis"><em>ascription file tree</em></span> will appear next to the original file tree. There will be one ascription PO file for each summit PO file, with the same name and relative location within the tree:</p>
<pre class="programlisting">
l10n-nn/
    po/
        ui/
            alpha.po
            bravo.po
            ...
        ...
    po-ascript/
        ui/
            alpha.po
            bravo.po
            ...
        ...
</pre>
<p>Ascription PO files are used by <span class="command"><strong>poascribe</strong></span> to store the ascription history, rather than e.g. a database of some sort. This has the disadvantage in performance, but advantage in simplicity and robustness. For example, ascription files will be under version control as well.</p>
<p><span class="command"><strong>poascribe</strong></span> may also modify original PO files during this run, by removing any previous field comments (<code class="literal">#| ...</code>) on translated messages. These comments are sometimes erroneously left in when the PO file is translated with an older or less capable PO editor, and leaving them would result in unnecessary additions to ascription PO files.</p>
<p>The newly created ascription tree, any modifications to the original tree, and the ascription configuration file, can now be committed as usual. With Subversion as the VCS:</p>
<pre class="programlisting">
$ cd $LANGDIR
$ svn add ascription-config po-ascript
$ svn commit ascription-config po po-ascript -m "Initial ascription."
</pre></div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-ascdailytr" id="sec-ascdailytr"></a>6.3.&nbsp;Daily Use for Translators</h2>
</div>
</div>
</div>
<p>While this is generally a good idea, with ascription in place translators must always update the complete language directory by VCS, rather than just one particular PO file or subdirectory, so that the original and the ascription PO file trees are kept in sync.<sup>[<a name="id652462" href="#ftn.id652462" class="footnote" id="id652462">25</a>]</sup></p>
<p>In order not to have to report their user name to <span class="command"><strong>poascribe</strong></span> all the time (by the <code class="option">-u</code> option), translators can set it in <a class="link" href="#sec-cmconfig" title="9.2.&nbsp;User Configuration">Pology user configuration</a>, the <code class="literal">[poascribe]</code> section:</p>
<pre class="programlisting">
[poascribe]
user = alice
</pre>
<p>With this in place, translators can submit updated PO files simply by substituting VCS commit command with <code class="literal">poascribe commit</code> (or shortened: <code class="literal">co</code> or <code class="literal">ci</code>). With Subversion, this would look like:</p>
<pre class="programlisting">
$ cd $LANGDIR
$ poascribe co po/ui/*alpha*.po
po/ui/alpha.po  (44)
po/ui/libalpha.po  (15)
===== Ascription summary:
-           modified
translated       169
&gt;&gt;&gt;&gt;&gt; VCS is committing catalogs:
Sending      ui/alpha.po
Sending      ui/libalpha.po
Sending      summit-ascript/messages/kdefoo/fooapp.po
Sending      LANG/summit-ascript/messages/kdefoo/libfooapp.po
Transmitting file data ....
Committed revision 1267069.
$
</pre>
<p>The lines after <code class="literal">&gt;&gt;&gt;&gt;&gt; VCS...</code> are produce by the underlying VCS, which is Subversion in this example.<sup>[<a name="id684243" href="#ftn.id684243" class="footnote" id="id684243">26</a>]</sup></p>
<p>As can be seen from the example output, <span class="command"><strong>poascribe</strong></span> will add ascription records into ascription PO files corresponding to original PO files, and commit them all. Like a VCS command, <span class="command"><strong>poascribe co</strong></span> can take any number of PO file or directory paths. For a directory path, only files with <code class="filename">.po</code> extension in it will be processed, and any other ignored. <span class="command"><strong>poascribe</strong></span> can be run from any working directory with appropriate paths as arguments, and it will always find the associated ascription configuration and files. If a default commit message has not been set in the ascription configuration, <span class="command"><strong>poascribe</strong></span> will ask for it; or it can be given in command line through <code class="option">-m</code> option.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-asctrnocomm" id="sec-asctrnocomm"></a>6.3.1.&nbsp;Translators Without Commit Access</h3>
</div>
</div>
</div>
<p>With the ascription system in place, every regular translator should have the commit access to the repository. But, there may be some period of time before new translators are given commit access, or revision control may be too technical for some, and even those who have access may not be able to commit temporarily for some reason.</p>
<p>These translators may send in their work by email or any other informal channel, to <span class="emphasis"><em>any</em></span> member of the team how does have commit access. This team member can then commit received files without any review, as review can be conducted at any later time. If Bob sends some files to Alice, she can commit them immediately by stating Bob's user name:</p>
<pre class="programlisting">
$ poascribe co -u bob <em class="replaceable"><code>files...</code></em>
</pre>
<p>For this to work, the translator who sent in the files has to be defined in the ascription configuration. There are no hidden costs or security issues to this (as opposed to giving VCS commit access), so every new translator should be defined there before any work of that person is committed.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-ascdailyrev" id="sec-ascdailyrev"></a>6.4.&nbsp;Daily Use for Reviewers</h2>
</div>
</div>
</div>
<p>An ascription system opens up all sorts of possibilities for review patterns. Reviewers should keep in mind that for each message the full modification and review history is available, so that the translation team can think about how to make good use of it. What follows are some examples to illustrate the review functionality provided by <span class="command"><strong>poascribe</strong></span>.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-ascbaserev" id="sec-ascbaserev"></a>6.4.1.&nbsp;Basic Reviewing</h3>
</div>
</div>
</div>
<p>At the very basic level (which is the only level in <a class="link" href="#sec-ascrevcomp" title="6.1.&nbsp;Review Stages vs. Ascription">review by stages</a>), messages can be classified as simply unreviewed or reviewed. Alice now wants to review all unreviewed messages in a subset of PO files, say the <code class="filename">ui/</code> subdirectory. She issues the following command (<code class="literal">di</code> is short for <code class="literal">diff</code>):</p>
<pre class="programlisting">
$ poascribe di po/ui/
po/ui/alpha.po  (2)
po/ui/foxtrot.po  (7)
po/ui/november.po  (12)
===== Diffed for review: 21
$
</pre>
<p>With this, all unreviewed messages in listed PO files have been marked, and <span class="emphasis"><em>diffed</em></span>. If these PO files had already been reviewed before, some of the messages modified since then (those now marked for review) may have changed very little. For example, a few changed words in a paragraph-length message, or even just some punctuation. Therefore, for each message marked for review, Alice also wants to see the difference since the last review to current version. Here are two messages with typical review elements added by <code class="literal">poascribe di</code>:</p>
<pre class="programlisting">
#. ~ascto: charlie:m
#: gui/mainwindow.cc:372
#, ediff
msgid "GAME OVER. {-You won-}{+Tie+}!"
msgstr "KRAJ IGRE. {-Pobeda-}{+Nerešeno+}!"

#. ~ascto: bob:m charlie:m
#: game-state.cpp:117
#, ediff-total
msgid "Click the pause button again to resume the game."
msgstr "Kliknite ponovo na dugme pauze da nastavite igru."
</pre>
<p>In the first message, the first thing to note is the <code class="literal">#. ~ascto:</code> comment. This comment succinctly lists who did what with the message since the last review; here <code class="literal">charlie:m</code> means that Charlie is the one who modified it. Then there is the <code class="literal">ediff</code> flag, which Alice can search for in the editor to jump through messages marked for review. Finally, the original and translation have been diffed; here they show that, since the last review, the message was fuzzied by changing "You won" to "Tie", and what Charlie did in translation to unfuzzy it. Even on a message as short as this, the difference tells something useful to Alice: the phrase "Game over" likely has a formulaic translation, and the fact that it is not part of the difference means that the earlier reviewer had made sure it is consistent, so Alice does not have to check that.</p>
<p>The <code class="literal">#. ~ascto:</code> comment of the second message reveals that both Charlie and Bob had been modifying it. The <code class="literal">ediff-total</code> flag instead of plain <code class="literal">ediff</code> means that this message had no reviews until now, so there are no embedded differences in text fields.</p>
<p>Alice can now go through marked messages in listed PO files, review translations, and possibly make modifications. When making changes in a message with embedded differences, she can freely edit the text outside of difference segments and within <code class="literal">{+...+}</code> segments (as these are the ones which belong to current version of the text). While reviewing, Alice does <span class="emphasis"><em>not</em></span> remove any of the added message elements (except for an occasional difference segment, if she modifies a translation), as these elements are needed for a subsequent invocation of <span class="command"><strong>poascribe</strong></span>. If a message is particularly hard to translate and Alice wants to defer reviewing it for some later time, she can add to it the <code class="literal">unreviewed</code> flag (or <code class="literal">nrev</code> for short).</p>
<p>Once the review is complete, Alice simply commits the reviewed files:</p>
<pre class="programlisting">
$ poascribe co po/ui/
po/ui/alpha.po  (0/2)
po/ui/foxtrot.po  (0/7)
po/ui/november.po  (3/12)
===== Ascription summary:
-           modified  reviewed
translated         3        21
&gt;&gt;&gt;&gt;&gt; VCS is committing catalogs:
Sending      po/ui/november.po
Sending      po-ascript/ui/alpha.po
Sending      po-ascript/ui/foxtrot.po
Sending      po-ascript/ui/november.po
Transmitting file data ....
Committed revision 1284220.
$
</pre>
<p>Three things have happened here. First, all review states (flags, embedded differences, etc.) have been removed, restoring diffed PO files to original state. Then, any modifications that Alice has made during review are ascribed to her (here 3 out of 21 messages). Finally, all marked messages are ascribed as reviewed by Alice (any with <code class="literal">unreviewed</code> or <code class="literal">nrev</code> flags would have been omitted here). When committing, the only original PO file that got committed is the one with modifications made during review, and all the ascription PO files were committed because of the reviews recorded in them.</p>
<p>When many PO files with few changes per file should be reviewed, it becomes burdensome to manually open each and every diffed file for review, and then to make sure that all are committed with <span class="command"><strong>poascribe co</strong></span>. To make this easier, <code class="literal">-w toreview.out</code> option can be added to the <code class="literal">poascribe di</code> command line, which requests that paths of all diffed PO files be written into <code class="filename">toreview.out</code> file. This file can then be used to batch-open diffed PO files in an editor, as well as to commit them later by adding <code class="literal">-f toreview.out</code> to <code class="literal">poascribe co</code>. There is also <code class="option">-o</code> option, which tells <span class="command"><strong>poascribe</strong></span> to directly open PO files in one of the supported PO editors (see <a class="xref" href="#sec-cmsupped" title="9.7.1.&nbsp;PO Editors">Section&nbsp;9.7.1, “PO Editors”</a>). Putting it together, to efficiently review a whole bunch of small changes throughout many PO files, with Lokalize as the PO editor, you can execute:</p>
<pre class="programlisting">
$ poascribe di <em class="replaceable"><code>paths...</code></em> -w toreview.out -o lokalize
$ # ...only marked messages opened in Lokalize, review them...
$ poascribe co -f toreview.out
</pre>
<p>If for whatever reason you want to simply remove the review elements from messages without committing the PO files (effectively discarding the review), you can use the <code class="literal">purge</code> mode (short <code class="literal">pu</code>) of <span class="command"><strong>poascribe</strong></span>:</p>
<pre class="programlisting">
$ poascribe pu <em class="replaceable"><code>paths...</code></em>
</pre>
<p>If <code class="option">-k</code>/<code class="option">--keep-flags</code> option is added to this command line, the flags which mark the messages as reviewed get preserved; more precisely, every <code class="literal">ediff*</code> flag is replaced with <code class="literal">reviewed</code> flag, and every <code class="literal">unreviewed</code> flag is left in, so that subsequent invocation of <code class="literal">poascribe co</code> can record reviews. You will want this limited purging if you have some automatic validation tools to run before committing, and these tools would be thrown off by review elements (most likely by embedded differences).</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-ascselrev" id="sec-ascselrev"></a>6.4.2.&nbsp;Selecting Messages for Review</h3>
</div>
</div>
</div>
<p>Invocations of <span class="command"><strong>poascribe di</strong></span> without any options, as in the previous section, are equivalent to this:</p>
<pre class="programlisting">
$ poascribe di -s modar <em class="replaceable"><code>paths...</code></em>
</pre>
<p>The <code class="option">-s</code> option serves to issue a message <span class="emphasis"><em>selector</em></span>. <code class="literal">modar</code> is the default selector for the <code class="literal">diff</code> operation mode, and stands for "MODified-After-Review": it selects the earliest historical modification of the message after the last (or no) review of that message, if there is any such. By selecting a historical modification of the message, the difference from it to current version can be computed and embedded into the PO file, as seen in earlier examples.</p>
<p><a name="p-seltypes" id="p-seltypes"></a>There are various specialized selectors, and they fall into two groups: <span class="emphasis"><em>shallow selectors</em></span> and <span class="emphasis"><em>history selectors</em></span>. Shallow selectors look only into the current version of the message, and cannot select historical versions, which means that they cannot provide embedded differences. History selectors (<code class="literal">modar</code> is of this type) can select messages from history and provide differences. Several selectors can be issued on the command line, and the message is selected only if all selectors select it (boolean AND-linking). Shallow selectors are thus normally used as a pre-filters for history selectors. For example, to select messages modified after the last review, but only those <a class="link" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">found in the stable branch</a>, <code class="literal">branch</code> and <code class="literal">modar</code> selectors are chained like this:</p>
<pre class="programlisting">
$ poascribe di -s branch:stable -s modar <em class="replaceable"><code>paths...</code></em>
</pre>
<p>It is important that the history selector is given last, because the last selector determines which historical message is selected for diffing. If the ordering had been reversed in this example, same messages would get selected, but they would not have embedded differences, because <code class="literal">branch</code> is a shallow selector.</p>
<p>Selectors can take parameters themselves, like <code class="literal">branch:stable</code> in the previous example. Parameters are separated from the selector name by any non-alphanumeric character; this is colon by convention, but if a parameter contains a colon, something else, like slash, tilde, etc. can be used. Number of parameters can vary, and <code class="literal">modar</code> in particular can take from none to three. If Alice wants to review only those messages modified <span class="emphasis"><em>by Charlie</em></span> since the last review, she states this by first argument to <code class="literal">modar</code>:</p>
<pre class="programlisting">
$ poascribe di -s modar:charlie <em class="replaceable"><code>paths...</code></em>
</pre>
<p>If Alice does not give much credit to other reviewers, she can request selection of messages modified after <span class="emphasis"><em>her own</em></span> last review with second parameter to <code class="literal">modar</code>:</p>
<pre class="programlisting">
$ poascribe di -s modar::alice <em class="replaceable"><code>paths...</code></em>
</pre>
<p>Here the first parameter ("modified by..."), which is not needed, must be explicitly skipped, before proceeding to the second parameter ("reviewed by..."). (The third optional parameter to <code class="literal">modar</code> will be demonstrated later on.)</p>
<p>When a selector parameter is a user name, normally it can also be a comma-separated list of user names (<code class="literal">modar:bob,charlie</code>) or prefixed with tilde to negate, i.e. to select all users other than those listed (<code class="literal">modar:~alice</code>).</p>
<p>Any selector can be negated by prepending <code class="literal">n</code> to its name. For example, the history selector <code class="literal">modafter:<em class="replaceable"><code>date</code></em></code> selects first modification after the given date; to select messages modified after the last review, but only if modified during June 2010:</p>
<pre class="programlisting">
$ poascribe di -s modafter:2010-06 -s nmodafter:2010-07 -s modar <em class="replaceable"><code>paths...</code></em>
</pre>
<p>Negating a history selector produces a shallow selector: while <code class="literal">modafter</code> is a history selector, <code class="literal">nmodafter</code> is shallow. But the mutual ordering of the two in this example is not important, since the last selector in the chain is the usual <code class="literal">modar</code>.</p>
<p>Selectors can be issued in other modes too. If the PO file is big, and Alice has reviewed messages up to and including the message with entry number 246 when she has to pause until another day, she can commit reviews only up to this entry by issuing the <code class="literal">espan</code> selector:</p>
<pre class="programlisting">
$ poascribe co -s espan::246 <em class="replaceable"><code>paths...</code></em>
</pre>
<p>The first parameter to <code class="literal">espan</code>, here omitted, would be the entry number of the first message to select, in case messages should not be selected starting from the first in the file. There is also the counterpart <code class="literal">lspan</code> selector, which works with referent line numbers (those of <code class="varname">msgid</code> keywords) instead of entry numbers.</p>
<p>If you do not want to immediately diff for review, but to see first how many messages would be selected by the selector chain that you assembled, you can use the <code class="literal">status</code> operation mode (<code class="literal">st</code> for short) instead of <code class="literal">diff</code>. It takes selectors in the same way as <code class="literal">diff</code>, and shows counts of selected messages by category. You can also add the <code class="option">-b</code> option to have counts reported by PO file (where non-zero).</p>
<p>You may also want to observe the complete recorded ascription history of a message, all its modifications and reviews, with differences between each two modifications. For this you can use the <code class="literal">history</code> operation mode (<code class="literal">hi</code> for short), typically with one of <code class="literal">l</code> or <code class="literal">e</code> selectors to single out a particular message. The history will be written out to terminal, starting from the newest to the oldest version of the message, with highlighted embedded differences.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-ascfgrev" id="sec-ascfgrev"></a>6.4.3.&nbsp;Fine-Grained Reviews</h3>
</div>
</div>
</div>
<p>In the introduction of this chapter, several distinct things that can go wrong in translation were described. Not all reviewers may be able to check translation against all those problems. Here is a typical scenario of this kind:</p>
<p>Alice is computer-savvy and knows the translation project inside and out, which means that she can review well for context, terminology, and technical style. But, her language style leaves something to be desired, which shows in longer sentences and passages. Dan, on the other hand, is a very literary person, but not that much into the technical aspects. Dan's style reviews would thus be a perfect complement to Alice's general reviews.</p>
<p><span class="command"><strong>poascribe</strong></span> can support this scenario in the following way. A <span class="emphasis"><em>review type</em></span> tag <code class="literal">lstyle</code> for language style is defined in the ascription configuration, using the <code class="literal">review-tags</code> field:</p>
<pre class="programlisting">
[global]
...
review-tags = lstyle
</pre>
<p>With this addition to configuration, Alice can continue to review as she did before, without any changes in her workflow.</p>
<p>Dan selects messages for review similarly to Alice, but additionally giving the <code class="literal">lstyle</code> tag as the <span class="emphasis"><em>third</em></span> parameter of <code class="literal">modar</code>, and indicating that reviews should be tagged as <code class="literal">lstyle</code> using the <code class="option">-t</code> option:</p>
<pre class="programlisting">
$ poascribe di -s modar:::lstyle -t lstyle <em class="replaceable"><code>paths...</code></em>
</pre>
<p>After finishing the review, Dan commits as usual:</p>
<pre class="programlisting">
$ poascribe co PATHS...
</pre>
<p>If Dan is always going to review the language style, in order not to have to issue the selector and the tag in command line all the time, he can make them default for the <code class="literal">diff</code> mode in Pology user configuration:</p>
<pre class="programlisting">
[poascribe]
user = dan
selectors/diff = modar:::lstyle
tags/diff = lstyle
</pre>
<p>With this, Dan can use plain <code class="literal">poascribe di</code> just like Alice does.</p>
<p>The important point of review tags is that they make reviews by types independent. For example, Dan may come around to review the language style of the given message after several modifications and general reviews have been ascribed to it -- <code class="literal">modar:::lstyle</code> will simply ignore all reviews other than <code class="literal">lstyle</code> reviews. This is going to be reflected in the <code class="literal">~ascto:</code> comment of diffed messages:</p>
<pre class="programlisting">
#...
#. ~ascto: charlie:m alice:r bob:m
#...
msgid "..."
msgstr "..."
</pre>
<p>Here Alice has made one review between Charlie's and Bob's modifications, and that review, being general instead of <code class="literal">lstyle</code>, did not cause <code class="literal">modar</code> to stop at it. After Dan reviews this message for language style, Alice runs selection for review and gets this:</p>
<pre class="programlisting">
#...
#. ascto: bob:m dan:r(lstyle)
#...
msgid "..."
msgstr "..."
</pre>
<p>Again, since <code class="literal">lstyle</code> reviews do not mix with general reviews<sup>[<a name="id651669" href="#ftn.id651669" class="footnote" id="id651669">27</a>]</sup>, Dan's review did not hide Bob's modification that Alice did not check so far.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-ascmaint" id="sec-ascmaint"></a>6.5.&nbsp;General Maintenance Procedures</h2>
</div>
</div>
</div>
<p>After the ascription system is set up, there should be very little to do to maintain it. The details depend on the established translation workflow, and this section describes some of the procedures which may apply.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-ascmerge" id="sec-ascmerge"></a>6.5.1.&nbsp;Ascribing Merges</h3>
</div>
</div>
</div>
<p>If PO files are periodically merged with templates in a centralized manner, by one designated person or repository automation, these modifications must also be ascribed. This is done as any other ascription, by substituting the VCS commit command with <code class="literal">poascribe co</code>. For example:</p>
<pre class="programlisting">
$ svn commit $LANGDIR -m "Everything merged."
</pre>
<p>may be substituted with:</p>
<pre class="programlisting">
$ poascribe commit $LANGDIR -m "Everything merged."
</pre>
<p>Since the user is not explicitly given by the <code class="option">-u</code> option, this will ascribe modifications due to merging to the person set in Pology user configuration on the system where the command is executed. This is just fine. It is also possible to define a dummy user to which modifications due to merging are ascribed, though there is no known advantage to that at present.</p>
<p>Note that you can issue the <code class="option">-C</code> option to prevent <span class="command"><strong>poascribe</strong></span> from automatically committing merged files, in case are some automatic post-merge operations that you would like to perform on merged PO files beforehand. Afterward, standalone VCS commit command can be issued, but do not forget to include the ascription file tree in it as well.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-ascshuffle" id="sec-ascshuffle"></a>6.5.2.&nbsp;Shuffling Ascription PO Files</h3>
</div>
</div>
</div>
<p>Sometimes PO files are "shuffled" in the repository: renamed, moved to another subdirectory, etc. Such shuffling should be exactly mirrored in the ascription tree:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>If a PO file is moved or renamed, its counterpart ascription PO file should also be moved or renamed in the same way within the ascription tree.</p>
</li>
<li class="listitem">
<p>If a PO file is split into two, then it depends on how you handle the splitting. A good way would be to copy the old PO file to two new names, and then merge them with new templates. In this way as much of existing translation as possible will be preserved. If this is done, then the ascription PO files should be copied to new names, but then there is nothing to merge them with. This is just right, since message ascription histories generally interleave across the split (but also see <a class="xref" href="#sec-asctrim" title="6.5.4.&nbsp;Trimming Ascription History">Section&nbsp;6.5.4, “Trimming Ascription History”</a>).</p>
</li>
<li class="listitem">
<p>If two PO files are merged into one, you should probably handle that by using <span class="command"><strong>msgcat</strong></span> to properly concatenate them into the new PO file, and then merge the new PO file with its template. Then, the old ascription PO files should be concatenated with <span class="command"><strong>msgcat</strong></span> as well, and nothing more. But, <span class="emphasis"><em>make sure</em></span> that you issue the <code class="option">--use-first</code> to <span class="command"><strong>msgcat</strong></span>, for both concatenations. This is because when in the two concatenated PO files there are two messages with same <code class="varname">msgctxt</code>+<code class="varname">msgid</code> but different <code class="varname">msgstr</code>, <span class="command"><strong>msgcat</strong></span> will by default make a free-form composition of <code class="varname">msgstr</code> texts, for translator to manually disentangle later. This would ruin the ascription entry of such a message in the concatenated ascription PO file.</p>
</li>
</ul>
</div>
<p>After the shuffling is performed in both file trees, <code class="literal">poascribe co</code> is executed to smooth out and commit modifications.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-ascfltrel" id="sec-ascfltrel"></a>6.5.3.&nbsp;Filtering for Release</h3>
</div>
</div>
</div>
<p>At the moment of this writing, <a class="link" href="#p-asrel">filtering for release</a> has not been implemented yet in <span class="command"><strong>poascribe</strong></span>, but it is planned.</p>
<p>However, if you <a class="link" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">translate in summit</a>, it is possible to configure the summit to skip insufficiently reviewed messages when scattering to branches. See <a class="xref" href="#sec-sucfgascf" title="5.3.7.&nbsp;Filtering by Ascription on Scatter">Section&nbsp;5.3.7, “Filtering by Ascription on Scatter”</a> for details.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-asctrim" id="sec-asctrim"></a>6.5.4.&nbsp;Trimming Ascription History</h3>
</div>
</div>
</div>
<p>At the moment of this writing, trimming the ascription history has not been implemented yet in <span class="command"><strong>poascribe</strong></span>, but it is planned.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-ascoptions" id="sec-ascoptions"></a>6.6.&nbsp;Command Line Options</h2>
</div>
</div>
</div>
<p>Overview of operation modes:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">commit</code>, <code class="literal">co</code></span></dt>
<dd>
<p>Commits modifications and reviews to PO files. Default selector: <code class="literal">any</code>.</p>
</dd>
<dt><span class="term"><code class="literal">diff</code>, <code class="literal">di</code></span></dt>
<dd>
<p>Adds embedded differences and other review elements to selected messages in PO files. Default selector: <code class="literal">modar</code>.</p>
</dd>
<dt><span class="term"><code class="literal">history</code>, <code class="literal">hi</code></span></dt>
<dd>
<p>Outputs to terminal the complete history of modifications and reviews for selected messages. Default selector: <code class="literal">any</code>.</p>
</dd>
<dt><span class="term"><code class="literal">purge</code>, <code class="literal">pu</code></span></dt>
<dd>
<p>Removes all review elements from PO files (unless <code class="option">-k</code>/<code class="option">--keep-flags</code> option is added, when only review flags are kept). Default selector: <code class="literal">any</code>.</p>
</dd>
<dt><span class="term"><code class="literal">release</code>, <code class="literal">re</code></span></dt>
<dd>
<p><span class="emphasis"><em>Not implemented yet.</em></span></p>
</dd>
<dt><span class="term"><code class="literal">status</code>, <code class="literal">st</code></span></dt>
<dd>
<p>Shows ascription counts per message category (total for all selected messages, and also per PO file if <code class="option">-b</code>/<code class="option">--show-by-file</code> option is added). Default selector: <code class="literal">any</code>.</p>
</dd>
<dt><span class="term"><code class="literal">trim</code>, <code class="literal">tr</code></span></dt>
<dd>
<p><span class="emphasis"><em>Not implemented yet.</em></span></p>
</dd>
</dl>
</div>
<p>Options specific to <span class="command"><strong>poascribe</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-a <em class="replaceable"><code>SELECTOR[:ARGS]</code></em></code>, <code class="option">--select-ascription=<em class="replaceable"><code>SELECTOR[:ARGS]</code></em></code></span></dt>
<dd>
<p>By default, a historical message is selected for diffing with current message based on the last history selector given by <code class="option">-s</code>/<code class="option">--selector</code> option (if any). Instead, with this option you can explicitly set the selector for historical messages. It will be applied after the message has been selected by the primary selector chain. The option can be repeated, in which case a historical message is selected if all selectors match it.</p>
</dd>
<dt><span class="term"><code class="option">-A <em class="replaceable"><code>RATIO</code></em></code>, <code class="option">--min-adjsim-diff=<em class="replaceable"><code>RATIO</code></em></code></span></dt>
<dd>
<p>The minimum adjusted similarity between the current and the historical message at which embedded differences will be shown.<sup>[<a name="id688877" href="#ftn.id688877" class="footnote" id="id688877">28</a>]</sup> This is a number in range from 0.0 (always show) to 1.0 (never show). If the difference is not shown due to this limit, the message will get the flag <code class="literal">ediff-ignored</code> instead of the usual <code class="literal">ediff</code>. A reasonable value may be 0.6 to 0.8.</p>
</dd>
<dt><span class="term"><code class="option">-b</code>, <code class="option">--show-by-file</code></span></dt>
<dd>
<p>Some operation modes show summary at the end of the run, which is based on all processed PO files taken together. With this option you can request some of the summary elements to be shown per processed file.</p>
</dd>
<dt><span class="term"><code class="option">-C</code>, <code class="option">--no-vcs-commit</code></span></dt>
<dd>
<p>Issue this option if you want <span class="command"><strong>poascribe</strong></span> not to commit modifications to version control itself. This may be useful if you want to examine raw modifications it made, to perform some checks, etc, and commit manually later. But <span class="emphasis"><em>do not</em></span> modify any messages in between, as that would defeat the purpose of ascription.</p>
</dd>
<dt><span class="term"><code class="option">-d <em class="replaceable"><code>LEVEL</code></em></code>, <code class="option">--depth=<em class="replaceable"><code>LEVEL</code></em></code></span></dt>
<dd>
<p>Operation modes normally consider ascription history of a message starting from the newest and going down to the earliest ascription. With this option you can set the depth to which history is examined, where 0 is the newest ascription only, 1 the current and first previous ascription, etc.</p>
</dd>
<dt><span class="term"><code class="option">-D <em class="replaceable"><code>SPEC</code></em></code>, <code class="option">--diff-reduce-history=<em class="replaceable"><code>SPEC</code></em></code></span></dt>
<dd>
<p>Some special (possibly custom) selectors may need to examine only differences or commonalities between each two adjacent messages. In order not to have to build this functionality into each such selector, you can issue this option to preprocess ascription history such that each historical message is reduced based on the difference with the next earlier message. The message can be reduced to the parts equal, added or removed as compared to the earlier message. This is controlled by the <code class="literal"><em class="replaceable"><code>SPEC</code></em></code> value, which must start with one of the letters <code class="literal">e</code> (equal), <code class="literal">a</code> (added), or <code class="literal">r</code> (removed). This letter may be followed with an arbitrary sequence of characters, which will be used to separate the remaining parts of the text in the message; if there are no additional characters, space is used as the separator.</p>
</dd>
<dt><span class="term"><code class="option">-F <em class="replaceable"><code>HOOKSPEC</code></em></code>, <code class="option">--filter=<em class="replaceable"><code>HOOKSPEC</code></em></code></span></dt>
<dd>
<p>Sometimes it may be necessary to apply selectors not to the ascription history as it is, but to a suitably filtered version of the history. This option can be used to set a Pology F1A hook as filter, see <a class="xref" href="#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">Section&nbsp;9.10, “Processing Hooks”</a> for details. It can be repeated to set several filters.</p>
</dd>
<dt><span class="term"><code class="option">-G</code>, <code class="option">--show-filtered</code></span></dt>
<dd>
<p>When setting a filter on ascription history by the <code class="option">-F</code>/<code class="option">--filter</code> option in the <code class="literal">diff</code> mode, it may be good to see also the difference in filtered messages, those on which the selectors were actually applied. By issuing this option, every message field with an embedded difference will get added a visually conspicuous separator, followed by the filtered version of the text with difference as well. When you commit or purge the PO file diffed in this way, the separators and the filtered text are removed together with all other review elements.</p>
</dd>
<dt><span class="term"><code class="option">-k</code>, <code class="option">--keep-flags</code></span></dt>
<dd>
<p>When the diffed PO file is purged of review elements, by default all review elements are removed, so that on subsequent commit only modifications would be ascribed, if there were any. Issuing this option on purge causes that all review elements except for flags are removed. More precisely, <code class="literal">ediff*</code> flags are replaced with <code class="literal">reviewed</code>, and <code class="literal">unreviewed</code> flags are simply kept. This makes the subsequent commit also ascribe reviews. You need this if you want to apply some automatic checks to the PO file after the review and before the commit, where more intrusive review elements (like embedded differences) would interfere.</p>
</dd>
<dt><span class="term"><code class="option">-m <em class="replaceable"><code>TEXT</code></em></code>, <code class="option">--message=<em class="replaceable"><code>TEXT</code></em></code></span></dt>
<dd>
<p>The text of the commit message. If default commit message is set in the ascription configuration, this text overrides it. If default commit message is not set and this option is not issued, and editor window is opened to enter the commit message.</p>
</dd>
<dt><span class="term"><code class="option">-o <em class="replaceable"><code>EDITOR</code></em></code>, <code class="option">--open-in-editor=<em class="replaceable"><code>EDITOR</code></em></code></span></dt>
<dd>
<p>When diffing for review, instead of manually opening diffed PO files and searching for messages by flags, this option can be issued to have <span class="command"><strong>poascribe</strong></span> automatically open PO files in a PO editor (and possibly have the editor filter the message list to only selected messages). This work only with PO editors explicitly supported by Pology; the <em class="replaceable"><code>EDITOR</code></em> value is an editor keyword rather than an arbitrary editor command. See <a class="xref" href="#sec-cmsupped" title="9.7.1.&nbsp;PO Editors">Section&nbsp;9.7.1, “PO Editors”</a> for the list of supported editors.</p>
</dd>
<dt><span class="term"><code class="option">-L <em class="replaceable"><code>RATIO</code></em></code>, <code class="option">--max-fraction-select=<em class="replaceable"><code>RATIO</code></em></code></span></dt>
<dd>
<p>In <code class="literal">diff</code> mode, this option sets the ratio of selected messages to total messages in a given PO file, above which no message in that file will be selected although the selector chain matched them. The value is the number between 0.0 and 1.0; for example, 0.2 means to accept selection if the number of selected messages is at most 20% of the total number of messages. This can be used to discern between reviewing updated PO files and newly translated PO files, as the latter take much more time to review and hence may be of lesser priority.</p>
</dd>
<dt><span class="term"><code class="option">-s <em class="replaceable"><code>SELECTOR[:ARGS]</code></em></code>, <code class="option">--selector <em class="replaceable"><code>SELECTOR[:ARGS]</code></em></code></span></dt>
<dd>
<p>The option to set a selector, in various modes. Can be repeated to create selector chains, in which case a message must match all selectors to be selected. In <code class="literal">diff</code> mode, if the last selector in the chain is not a <a class="link" href="#p-seltypes">history selector</a>, selected messages will have no embedded differences (unless an ascription selector is explicitly given by the <code class="option">-A</code>/<code class="option">--select-ascription</code> option).</p>
</dd>
<dt><span class="term"><code class="option">-t <em class="replaceable"><code>TAG</code></em></code>, <code class="option">--tag=<em class="replaceable"><code>TAG</code></em></code></span></dt>
<dd>
<p>The review tag, denoting the type of the review. If <code class="literal">review-tags</code> field in ascription configuration set, this must be one of the tags defined there (general review has an empty string as tag, which is the default). The tag is normally issued in <code class="literal">diff</code> mode: it will be appended to review flags on diffed messages (e.g. <code class="literal">ediff/<em class="replaceable"><code>tag</code></em></code>), which will cause on commit that the review of this type is ascribed. In <code class="literal">commit</code> mode, this option has effect only if <code class="option">--all-reviewed</code> is issued as well, in which case this tag will override any from the PO file. Several tags may be given as comma-separated list.</p>
</dd>
<dt><span class="term"><code class="option">-u <em class="replaceable"><code>NAME</code></em></code>, <code class="option">--user=<em class="replaceable"><code>NAME</code></em></code></span></dt>
<dd>
<p>The user, one of those defined in ascription configuration, to whom modifications and reviews are ascribed on commit.</p>
</dd>
<dt><span class="term"><code class="option">-U</code>, <code class="option">--update-headers</code></span></dt>
<dd>
<p>If you work on PO files with a general text editor, you can issue this option on commit to have the header data in modified PO files automatically updated. The necessary information is fetched from the ascription configuration.</p>
</dd>
<dt><span class="term"><code class="option">-v</code>, <code class="option">--verbose</code></span></dt>
<dd>
<p>More detailed information on progress of the operation.</p>
</dd>
<dt><span class="term"><code class="option">-w <em class="replaceable"><code>FILE</code></em></code>, <code class="option">--write-modified=<em class="replaceable"><code>FILE</code></em></code></span></dt>
<dd>
<p>This option specifies the file into which to write the path of every PO file modified during the operation, one per line. This file can later be fed back to <span class="command"><strong>poascribe</strong></span> (and other Pology commands) with the <code class="option">-f</code>/<code class="option">--files-from</code> option.</p>
</dd>
<dt><span class="term"><code class="option">-x <em class="replaceable"><code>FILE</code></em></code>, <code class="option">--externals=<em class="replaceable"><code>FILE</code></em></code></span></dt>
<dd>
<p>If you have <a class="link" href="#sec-prascsel" title="11.5.&nbsp;Writing Ascription Selectors">written some custom selectors</a>, with this option you specify the path to the file containing them. It can be repeated to load several files with custom selectors.</p>
</dd>
<dt><span class="term"><code class="option">--all-reviewed</code></span></dt>
<dd>
<p>On commit, normally only messages having <code class="literal">ediff*</code> or <code class="literal">reviewed</code> flags will be ascribed as reviewed. If this option is used, instead all messages will be ascribed as reviewed (except for those having <code class="literal">unreviewed</code> flag).</p>
</dd>
</dl>
</div>
<p>Options common with other Pology tools:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-F FILE</code>, <code class="option">--files-from=FILE</code></span></dt>
<dd>
<p>See <a class="xref" href="#sec-cmffrom" title="9.5.&nbsp;Reading Paths From a File">Section&nbsp;9.5, “Reading Paths From a File”</a>.</p>
</dd>
<dt><span class="term"><code class="option">-e REGEX</code>, <code class="option">--exclude-name=REGEX</code>; <code class="option">-E REGEX</code>, <code class="option">--exclude-path=REGEX</code>; <code class="option">-i REGEX</code>, <code class="option">--include-name=REGEX</code>; <code class="option">-I REGEX</code>, <code class="option">--include-path=REGEX</code></span></dt>
<dd>
<p>See <a class="xref" href="#sec-cmincexc" title="9.4.&nbsp;Path Inclusion and Exclusion">Section&nbsp;9.4, “Path Inclusion and Exclusion”</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-ascconfig" id="sec-ascconfig"></a>6.7.&nbsp;User Configuration</h2>
</div>
</div>
</div>
<p>The following <a class="link" href="#sec-cmconfig" title="9.2.&nbsp;User Configuration">configuration</a> fields can be used to modify general behavior of <span class="command"><strong>poascribe</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[poascribe]/aselectors</code></span></dt>
<dd>
<p>The list of explicit selectors of historical messages, as if they were issued with multiple <code class="option">-a</code>/<code class="option">--aselector</code> options. The first character in the value must be non-alphanumeric (e.g. <code class="literal">/</code>), and that character is then used to separate selector specifications; the value must also end with this character.</p>
</dd>
<dt><span class="term"><code class="literal">[poascribe]/diff-reduce-history</code></span></dt>
<dd>
<p>Counterpart to <code class="option">-D</code>/<code class="option">diff-reduce-history</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[poascribe]/filters</code></span></dt>
<dd>
<p>Comma-separated list of history filters, as if they were issued with multiple <code class="option">-F</code>/<code class="option">--filter</code> options.</p>
</dd>
<dt><span class="term"><code class="literal">[poascribe]/max-fraction-select</code></span></dt>
<dd>
<p>Counterpart to <code class="option">-L</code>/<code class="option">max-fraction-select</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[poascribe]/min-adjsim-diff</code></span></dt>
<dd>
<p>Counterpart to <code class="option">-A</code>/<code class="option">--min-adjsim-diff</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[poascribe]/po-editor</code></span></dt>
<dd>
<p>Counterpart to <code class="option">-o</code>/<code class="option">--open-in-editor</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[poascribe]/selectors</code></span></dt>
<dd>
<p>List of message selectors, as if they were issued with multiple <code class="option">-s</code>/<code class="option">--selector</code> options. The first character in the value must be non-alphanumeric (e.g. <code class="literal">/</code>), and that character is then used to separate selector specifications; the value must also end with this character.</p>
</dd>
<dt><span class="term"><code class="literal">[poascribe]/tags</code></span></dt>
<dd>
<p>Counterpart to <code class="option">-t</code>/<code class="option">--tag</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[poascribe]/update-headers=[yes|*no]</code></span></dt>
<dd>
<p>Setting to <code class="literal">yes</code> is counterpart to <code class="option">-U</code>/<code class="option">--update-headers</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[poascribe]/user</code></span></dt>
<dd>
<p>Counterpart to <code class="option">-u</code>/<code class="option">--user</code> command line option.</p>
</dd>
<dt><span class="term"><code class="literal">[poascribe]vcs-commit/=[*yes|no]</code></span></dt>
<dd>
<p>Setting to <code class="literal">no</code> is counterpart to <code class="option">-C</code>/<code class="option">--no-vcs-commit</code> command line option.</p>
</dd>
</dl>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-ascsels" id="sec-ascsels"></a>6.8.&nbsp;Review Selectors</h2>
</div>
</div>
</div>
<p><span class="command"><strong>poascribe</strong></span> provides a variety of internal selectors, and new selectors are added as general need for them is observed in practice. Selectors come in two types: history and shallow; the former also select a historical message from which to show the differences to the current message, while the latter do not. Arguments to selectors are added consistently separated with any non-alphanumeric character, customarily colon (<code class="literal">:</code>) when possible. If less arguments are given than the selector can take, all remaining arguments are set to empty (the selector may or may not accept this).</p>
<p>Available internal selectors are as follows:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">any</code> (shallow)</span></dt>
<dd>
<p>Selects any message.</p>
</dd>
<dt><span class="term"><code class="literal">active</code> (shallow)</span></dt>
<dd>
<p>Selects active messages, i.e. those translated and not obsolete.</p>
</dd>
<dt><span class="term"><code class="literal">asc:<em class="replaceable"><code>USER</code></em></code> (history)</span></dt>
<dd>
<p>Selects latest historical message ascribed (modified or reviewed) by the given user, or to any user if the argument is empty. Multiple users can be given as a comma-separated list, and selection inverted by prepending <code class="literal">~</code>.</p>
</dd>
<dt><span class="term"><code class="literal">branch:<em class="replaceable"><code>NAME</code></em></code> (shallow)</span></dt>
<dd>
<p>Selects messages belonging to the given branch (see <a class="xref" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">Chapter&nbsp;5, <i>Summitting Translation Branches</i></a>). Several branch names may be given, as comma-separated list.</p>
</dd>
<dt><span class="term"><code class="literal">current</code> (shallow)</span></dt>
<dd>
<p>Selects current messages, i.e. those not obsolete.</p>
</dd>
<dt><span class="term"><code class="literal">e:<em class="replaceable"><code>ENTRYNUM</code></em></code> (shallow)</span></dt>
<dd>
<p>Selects a message with given entry number in the PO file (first message has entry number 1, second 2, etc).</p>
</dd>
<dt><span class="term"><code class="literal">espan:<em class="replaceable"><code>START</code></em>:<em class="replaceable"><code>END</code></em></code> (shallow)</span></dt>
<dd>
<p>Select messages with entry numbers between given start and end, including both. If start is empty, 1 is assumed; if end is empty, number of messages is assumed.</p>
</dd>
<dt><span class="term"><code class="literal">fexpr:<em class="replaceable"><code>EXPRESSION</code></em></code> (shallow)</span></dt>
<dd>
<p>Selects messages matching a boolean search expression on message parts. It has same syntax as the <a class="link" href="#p-fexprdesc"><code class="literal">fexpr</code> parameter</a> of the <span class="command"><strong>find-messages</strong></span> sieve.</p>
</dd>
<dt><span class="term"><code class="literal">hexpr:<em class="replaceable"><code>EXPRESSION</code></em>:<em class="replaceable"><code>USER</code></em>:<em class="replaceable"><code>DIFFSPEC</code></em></code> (history)</span></dt>
<dd>
<p>Like <code class="literal">fexpr</code>, but matches through historical messages starting from the latest ascription. If user argument is not empty, matches only messages ascribed to that user. Multiple users can be given as a comma-separated list, and selection inverted by prepending <code class="literal">~</code>. The last argument, if not empty, requests to reduce historical messages by incremental differences before matching them; see the <code class="option">--diff-reduce-history</code> option for the syntax and other details.</p>
</dd>
<dt><span class="term"><code class="literal">l:<em class="replaceable"><code>LINENUM</code></em></code> (shallow)</span></dt>
<dd>
<p>Selects a message with given referent line number in the PO file. This is the line number of <code class="varname">msgid</code> message field. ±1 offset is accepted.</p>
</dd>
<dt><span class="term"><code class="literal">lspan:<em class="replaceable"><code>START</code></em>:<em class="replaceable"><code>END</code></em></code> (shallow)</span></dt>
<dd>
<p>Select messages with referent line numbers between given start and end, including both. If start is empty, 1 is assumed; if end is empty, total number of lines is assumed.</p>
</dd>
<dt><span class="term"><code class="literal">mod:<em class="replaceable"><code>USER</code></em></code> (history)</span></dt>
<dd>
<p>Selects latest historical message modified by the given user, or by any user if the argument is empty. Multiple users can be given as a comma-separated list, and selection inverted by prepending <code class="literal">~</code>.</p>
</dd>
<dt><span class="term"><code class="literal">modafter:<em class="replaceable"><code>TIMESTAMP</code></em>:<em class="replaceable"><code>USER</code></em></code> (history)</span></dt>
<dd>
<p>Selects the earliest historical message modified at or after the given date and time. The full timestamp format is <code class="literal"><em class="replaceable"><code>YEAR</code></em>-<em class="replaceable"><code>MONTH</code></em> <em class="replaceable"><code>DAY</code></em> <em class="replaceable"><code>HOUR</code></em>:<em class="replaceable"><code>MINUTE</code></em>:<em class="replaceable"><code>SECOND</code></em></code>, but trailing elements can be omitted as logical; for example, <code class="literal">2010-10</code> would be interpreted as <code class="literal">2010-10-01 00:00:00</code>. If the user argument is not empty, only modifications by that user are considered; multiple users can be given as a comma-separated list, and selection inverted by prepending <code class="literal">~</code>.</p>
</dd>
<dt><span class="term"><code class="literal">modam:<em class="replaceable"><code>USER1</code></em>:<em class="replaceable"><code>USER2</code></em></code> (history)</span></dt>
<dd>
<p>Selects the earliest historical message which introduced modifications after the last modification, or the very first historical message. This makes sense only if one or both of the user arguments are not empty. If the first user argument is not empty, only modifications by that user are considered for selection. If the second user argument is not empty, only the modifications by that user are considered as base. For both user arguments, multiple users can be given as a comma-separated list, and selection inverted by prepending <code class="literal">~</code>.</p>
</dd>
<dt><span class="term"><code class="literal">modar:<em class="replaceable"><code>MODUSER</code></em>:<em class="replaceable"><code>REVUSER</code></em>:<em class="replaceable"><code>TAG</code></em></code> (history)</span></dt>
<dd>
<p>Selects the earliest historical message which introduced modifications after the last review, or the very first historical message if there was no review yet. If the first user argument is not empty, only modifications by that user are considered and reviews by that user are ignored. If the second user argument is not empty, only reviews by that user are considered and modifications by that user are ignored. For both user arguments, multiple users can be given as a comma-separated list, and selection inverted by prepending <code class="literal">~</code>. The last argument determines which review types (by review tag) to consider, where empty value means "general review"; multiple tags can be given as comma-separated list.</p>
</dd>
<dt><span class="term"><code class="literal">modarm:<em class="replaceable"><code>MODUSER</code></em>:<em class="replaceable"><code>REVUSER</code></em>:<em class="replaceable"><code>TAG</code></em></code> (history)</span></dt>
<dd>
<p>Like <code class="literal">modar</code>, but uses as base for selection the last review <span class="emphasis"><em>or</em></span> the last modification. This generally makes sense only if some combination of user arguments is given too.</p>
</dd>
<dt><span class="term"><code class="literal">rev:<em class="replaceable"><code>USER</code></em></code> (history)</span></dt>
<dd>
<p>Selects latest historical message reviewed by the given user, or by any user if the argument is empty. Multiple users can be given as a comma-separated list, and selection inverted by prepending <code class="literal">~</code>.</p>
</dd>
<dt><span class="term"><code class="literal">revbm:<em class="replaceable"><code>REVUSER</code></em>:<em class="replaceable"><code>MODUSER</code></em>:<em class="replaceable"><code>TAG</code></em></code> (history)</span></dt>
<dd>
<p>Selects the earliest historical message which has been reviewed just before a modification occurred. If the first user argument is not empty, only reviews by that user are considered and modifications by that user are ignored. If the second user argument is not empty, only modifications by that user are considered and reviews by that user are ignored. For both user arguments, multiple users can be given as a comma-separated list, and selection inverted by prepending <code class="literal">~</code>. The last argument determines which review types (by review tag) to consider, where empty value means "general review"; multiple tags can be given as comma-separated list.</p>
</dd>
<dt><span class="term"><code class="literal">tmodar:<em class="replaceable"><code>MODUSER</code></em>:<em class="replaceable"><code>REVUSER</code></em>:<em class="replaceable"><code>TAG</code></em></code> (history)</span></dt>
<dd>
<p>Like <code class="literal">modar</code>, but considers as modified only those historical messages with modifications in translation (<code class="varname">msgstr</code>).</p>
</dd>
<dt><span class="term"><code class="literal">unasc</code> (shallow)</span></dt>
<dd>
<p>Select messages that are not yet ascribed, i.e. those which are modified but not yet committed.</p>
</dd>
</dl>
</div>
<p>Every selector automatically gets a negative counterpart, with the name prefixed by <code class="literal">n*</code>. The negative selector is always shallow, regardless of the type of the original selector.</p>
<p>Custom selectors can be written in a standalone Python source file, which is then fed to <span class="command"><strong>poascribe</strong></span> using the <code class="option">-x</code>/<code class="option">--externals</code> option. A file with several custom selectors should have this layout:</p>
<pre class="programlisting">
def selector_foo (args):
    ...

def selector_bar (args):
    ...

xm_selector_factories = {
    # key: (factory, is_history_selector)
    "foo": (selector_foo, False),
    "bar": (selector_bar, True),
}
</pre>
<p><code class="function">selector_foo</code> and <code class="function">selector_bar</code> are factory functions for selectors <code class="literal">foo</code> and <code class="literal">bar</code>. After loading the file, <span class="command"><strong>poascribe</strong></span> will look for the <code class="varname">xm_selector_factories</code> dictionary to see which selectors are defined and of what type they are. See <a class="xref" href="#sec-prascsel" title="11.5.&nbsp;Writing Ascription Selectors">Section&nbsp;11.5, “Writing Ascription Selectors”</a> for the instructions on writing selector factory functions.</p>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id597772" href="#id597772" class="para" id="ftn.id597772">24</a>]</sup> <span class="emphasis"><em>Technically</em></span>, PO files could also be grouped by PO domain:</p>
<pre class="programlisting">
po/
    ui/
        alpha/
            ...
            nn.po
            mm.po
            ...
</pre>
but this would lead to a host of strange sharings of ascription settings and auxiliary file locations between different languages. In general, it is assumed that each translation team manages its own separate ascription.</div>
<div class="footnote">
<p><sup>[<a name="ftn.id652462" href="#id652462" class="para" id="ftn.id652462">25</a>]</sup> There should be no technical problem here, since VCS updates are inexpensive in terms of network traffic, but there may be a problem of changing one's habits.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id684243" href="#id684243" class="para" id="ftn.id684243">26</a>]</sup> If the underlying VCS would a distributed one, such Git, and the push to a designated central repository is expected afterward, it must be performed manually.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id651669" href="#id651669" class="para" id="ftn.id651669">27</a>]</sup> General review too has a tag assigned, the empty string, in case the reviewer needs to explicitly issue it in some context.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id688877" href="#id688877" class="para" id="ftn.id688877">28</a>]</sup> Unlike for example in fuzzy messages, the similarity between the current and the earlier message from the ascription history may be exactly zero, it the PO file has undergone several merges in between. For example, in a two-word message, the first merge could have replaced the first word, and the second merge the second word.</p>
</div>
</div>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-misctools" id="ch-misctools"></a>Chapter&nbsp;7.&nbsp;Miscellaneous Tools</h2>
</div>
</div>
</div>
<p>This chapter describes various smaller standalone tools in Pology, which do not introduce any major PO processing concepts nor can be grouped under a common topic.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-mirewrap" id="sec-mirewrap"></a>7.1.&nbsp;Rewrapping PO Files with <span class="command"><strong>porewrap</strong></span></h2>
</div>
</div>
</div>
<p>The <span class="command"><strong>porewrap</strong></span> script does one simple thing: it rewraps message strings (<code class="varname">msgid</code>, <code class="varname">msgstr</code>, etc.) in PO files. Gettext's tools, e.g. <span class="command"><strong>msgcat</strong></span>, can be used for rewrapping as well, so what is the reason of existence of <span class="command"><strong>porewrap</strong></span>? The lesser reason is convenience. Arbitrary number of PO file paths can be given to it as arguments, as well as directory paths which will be recursively search for PO files. The more important reason is that Pology can also perform "fine" wrapping, as described in <a class="xref" href="#sec-cmwrap" title="9.8.&nbsp;Line Wrapping in PO Messages">Section&nbsp;9.8, “Line Wrapping in PO Messages”</a>. Thus, running:</p>
<pre class="programlisting">
$ porewrap --no-wrap --fine-wrap somedir/
</pre>
<p>will rewrap all PO files found in <code class="filename">somedir/</code> and below, such that basic wrapping (on column) is disabled (<code class="literal">--no-wrap</code>), while fine wrapping (on logical breaks) is enabled (<code class="literal">--fine-wrap</code>).</p>
<p>Other than from command line options, <span class="command"><strong>porewrap</strong></span> will also consult the PO file header and the user configuration, for the wrapping mode. Command line options have the highest priority, followed by the PO header, and the user configuration at the end. For details on how to set the wrapping mode in PO headers, see the description of <code class="literal">X-Wrapping</code> header field in <a class="xref" href="#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a>. If none of these sources specify the wrapping mode, <span class="command"><strong>porewrap</strong></span> will apply basic wrapping.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-mirwopts" id="sec-mirwopts"></a>7.1.1.&nbsp;Command Line Options</h3>
</div>
</div>
</div>
<p>Options specific to <span class="command"><strong>porewrap</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-v</code>, <code class="option">--verbose</code></span></dt>
<dd>
<p>Since <span class="command"><strong>porewrap</strong></span> just opens and writes back all the PO files given to it, it normally does not report anything. But this option can be issued for it to report PO file paths as they have been written out.</p>
</dd>
</dl>
</div>
<p>Options common with other Pology tools:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">--wrap</code>; <code class="option">--no-wrap</code>; <code class="option">--fine-wrap</code>; <code class="option">--no-fine-wrap</code>; <code class="option">--wrap-column=COL</code></span></dt>
<dd>
<p>See <a class="xref" href="#sec-cmwropts" title="9.8.1.&nbsp;Common Command Line Options for Wrapping">Section&nbsp;9.8.1, “Common Command Line Options for Wrapping”</a>.</p>
</dd>
<dt><span class="term"><code class="option">-F FILE</code>, <code class="option">--files-from=FILE</code></span></dt>
<dd>
<p>See <a class="xref" href="#sec-cmffrom" title="9.5.&nbsp;Reading Paths From a File">Section&nbsp;9.5, “Reading Paths From a File”</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-mirwcfg" id="sec-mirwcfg"></a>7.1.2.&nbsp;User Configuration</h3>
</div>
</div>
</div>
<p><span class="command"><strong>porewrap</strong></span> reads the wrapping mode fields as described in <a class="xref" href="#sec-cmwrcfg" title="9.8.2.&nbsp;Common User Configuration Fields for Wrapping">Section&nbsp;9.8.2, “Common User Configuration Fields for Wrapping”</a>, from its <code class="literal">[porewrap]</code> section.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-miselfmerge" id="sec-miselfmerge"></a>7.2.&nbsp;Self-Merging PO Files with <span class="command"><strong>poselfmerge</strong></span></h2>
</div>
</div>
</div>
<p>Normally, PO files are periodically merged with latest PO templates, to introduce changes from the source material while preserving as much of the existing translation as possible. <span class="command"><strong>poselfmerge</strong></span>, on the other hand, will merge the PO file with "itself". More precisely, it will derive the temporary template version of the PO file (by cleaning it from translations and other details), and then merge the original PO file with the derived template, by calling <span class="command"><strong>msgmerge</strong></span> internally. This can have several uses:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The fuzzy matching algorithm of <span class="command"><strong>msgmerge</strong></span> is extremely fast and robust, but treats all messages the same and in isolation, without trying out more complicated (and necessarily much slower) heuristic criteria. This can cause the translator to spend more time updating a fuzzy message than it would take to translate it from scratch. <span class="command"><strong>poselfmerge</strong></span> can be therefore instructed to go over all fuzzy messages created by merging, and apply additional heuristics to determine whether to leave the message fuzzy or to clean it up and make it fully untranslated.</p>
</li>
<li class="listitem">
<p>Sometimes the PO file can contain a number of quite similar longer messages (this is especially the case when <a class="link" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">translating in summit</a>). A capable PO editor should automatically offer the previous translation on the next similar message (by using internal translation memory), and show the what the small differences in the original text are, thus greately speeding up the translation of that message. If, however, the PO editor is not that capable, or you use a plain text editor, while translating you can simply skip every long message that looks familiar, and afterwards run <span class="command"><strong>poselfmerge</strong></span> on the PO file to introduce fuzzy matches on those messages.</p>
</li>
<li class="listitem">
<p>More generally, if your PO editor does not have (a good enough) translation memory feature, or you edit PO files with a plain text editor, you can instruct <span class="command"><strong>poselfmerge</strong></span> to use one or more <span class="emphasis"><em>PO compendia</em></span> to provide additional exact and fuzzy matches. This is essentially the batch application of translation memory. <a class="xref" href="#sec-cbcompend" title="10.1.&nbsp;Creating and Using PO Compendia">Section&nbsp;10.1, “Creating and Using PO Compendia”</a> provides some hints on how to create and maintain PO compendia.</p>
</li>
</ul>
</div>
<p>Arguments to <span class="command"><strong>poselfmerge</strong></span> are any number of PO file paths or directories to search for PO files, which will be modified in place:</p>
<pre class="programlisting">
$ poselfmerge foo.po bar.po somedir/
</pre>
<p>However, this run will do almost nothing (except possibly rewrap files), just as <span class="command"><strong>msgmerge</strong></span> would do nothing if the same template were used twice. Instead, all special processing must be requested by command line options, or activated through the <a class="link" href="#sec-cmconfig" title="9.2.&nbsp;User Configuration">user configuration</a> to avoid issuing some options with same values all the time.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-mismopts" id="sec-mismopts"></a>7.2.1.&nbsp;Command Line Options</h3>
</div>
</div>
</div>
<p>Options specific to <span class="command"><strong>poselfmerge</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-A <em class="replaceable"><code>RATIO</code></em></code>, <code class="option">--min-adjsim-fuzzy=<em class="replaceable"><code>RATIO</code></em></code></span></dt>
<dd>
<p>The minimum required "adjust similarity" between the old and the new orginal text in a fuzzy message, in order to accept it and not clean it to untranslated state. The similarity is expressed as the ratio in range 0.0-1.0, with 0.0 meaning no similarity and 1.0 no difference. A practical range is 0.6-0.8. If this option is not issued, fuzzy messages are kept as they are (as if 0.0 would be given).</p>
<p>The requirement for computation of adjusted similarity is that fuzzy messages contain previous strings, i.e. that the PO file was originally merged with <code class="option">--previous</code> to <span class="command"><strong>msgmerge</strong></span>.</p>
</dd>
<dt><span class="term"><code class="option">-b</code>, <code class="option">--rebase-fuzzies</code></span></dt>
<dd>
<p>Normally, when merging with template, the untranslated and fuzzy messages already present in the PO file are not checked again for approximate matches. This is on the one hand side a performance measure (why fuzzy match again something that was already matched before?), and on the other hand a safety measure (higher trust in an old fuzzy match based on the PO file itself than e.g. a new match from an arbitrary compendium). By issuing this option, prior to merging all untranslated message are removed from the PO file, as well as all fuzzy messages which still have their base translated message in the PO file (judging by previous strings). This activates fuzzy matching on untranslated messages (e.g. if new compendium given, or for similar messages skipped during translation), and updates base translated messages on fuzzy messages.</p>
</dd>
<dt><span class="term"><code class="option">-C <em class="replaceable"><code>POFILE</code></em></code>, <code class="option">--compendium=<em class="replaceable"><code>POFILE</code></em></code></span></dt>
<dd>
<p>The PO file to use as compendium on merging, to produce more exact and fuzzy matches. This option can be repeated to add several compendia.</p>
</dd>
<dt><span class="term"><code class="option">-v</code>, <code class="option">--verbose</code></span></dt>
<dd>
<p><span class="command"><strong>poselfmerge</strong></span> normally operates silently, and this option requests some progress information. Quite useful if processing a large collection of PO files, because merging and post-merge processing can take <span class="emphasis"><em>a lot</em></span> of time (especially in presence of compendium).</p>
</dd>
<dt><span class="term"><code class="option">-W <em class="replaceable"><code>NUMBER</code></em></code>, <code class="option">--min-words-exact=<em class="replaceable"><code>NUMBER</code></em></code></span></dt>
<dd>
<p>When an exact match for an untranslated message is produced from the compendium, it is not always safe to silently accept it, because the compendium may contain translations from contexts totally unrelated with the current PO file. The shorter the message, the higher the chance that translation will not be suitable in current context. This option provides the minimum number of words (in the original) to accept an exact match from the compendium, or else the message is made fuzzy. The reasonable value depends on the relation between the source and the target language, with 5 to 10 probably being on the safe side.</p>
<p>Note that afterwards you can see when an exact match has been demoted into a fuzzy one, by that message not having previous strings (<code class="literal">#| msgid "..."</code>, etc.).</p>
</dd>
<dt><span class="term"><code class="option">-x</code>, <code class="option">--fuzzy-exact</code></span></dt>
<dd>
<p>This option is used to unconditionally demote exact matches from the compendium into fuzzy messages (e.g. regardless of the length of the text, as done by <code class="option">-W</code>/<code class="option">--min-words-exact</code>). This may be needed, for example, when there is a strict review procedure in place, and the compendium is built from unreviewed translations.</p>
</dd>
</dl>
</div>
<p>Options common with other Pology tools:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">--wrap</code>; <code class="option">--no-wrap</code>; <code class="option">--fine-wrap</code>; <code class="option">--no-fine-wrap</code>; <code class="option">--wrap-column=COL</code></span></dt>
<dd>
<p>See <a class="xref" href="#sec-cmwropts" title="9.8.1.&nbsp;Common Command Line Options for Wrapping">Section&nbsp;9.8.1, “Common Command Line Options for Wrapping”</a>.</p>
</dd>
<dt><span class="term"><code class="option">-F FILE</code>, <code class="option">--files-from=FILE</code></span></dt>
<dd>
<p>See <a class="xref" href="#sec-cmffrom" title="9.5.&nbsp;Reading Paths From a File">Section&nbsp;9.5, “Reading Paths From a File”</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-mismcfg" id="sec-mismcfg"></a>7.2.2.&nbsp;User Configuration</h3>
</div>
</div>
</div>
<p>It is likely that the translator will have a certain personal preference of the various match acceptance criteria provided by command line options. Instead of issuing those options all the time, the following user configuration fields may be set:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[poselfmerge]/fuzzy-exact=[yes|*no]</code></span></dt>
<dd>
<p>Counterpart to the <code class="option">-x</code>/<code class="option">--fuzzy-exact</code> option.</p>
</dd>
<dt><span class="term"><code class="literal">[poselfmerge]/min-adjsim-fuzzy</code></span></dt>
<dd>
<p>Counterpart to the <code class="option">-A</code>/<code class="option">--min-adjsim-fuzzy</code> option.</p>
</dd>
<dt><span class="term"><code class="literal">[poselfmerge]/min-words-exact</code></span></dt>
<dd>
<p>Counterpart to the <code class="option">-W</code>/<code class="option">--min-words-exact</code> option.</p>
</dd>
<dt><span class="term"><code class="literal">[poselfmerge]/rebase-fuzzies=[yes|*no]</code></span></dt>
<dd>
<p>Counterpart to the <code class="option">-b</code>/<code class="option">--rebase-fuzzies</code> option.</p>
</dd>
</dl>
</div>
<p>Of course, command line options can be issued to override the user configuration fields when necessary.</p>
<p><span class="command"><strong>poselfmerge</strong></span> also reads the wrapping mode fields as described in <a class="xref" href="#sec-cmwrcfg" title="9.8.2.&nbsp;Common User Configuration Fields for Wrapping">Section&nbsp;9.8.2, “Common User Configuration Fields for Wrapping”</a>, from its <code class="literal">[poselfmerge]</code> section.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-mimtrans" id="sec-mimtrans"></a>7.3.&nbsp;Machine Translation with <span class="command"><strong>pomtrans</strong></span></h2>
</div>
</div>
</div>
<p><span class="emphasis"><em>Machine translation</em></span> is the process where a computer program is used to produce translation of more than a trivial piece of text, starting from single sentences, over paragraphs, to full documents. There are debates on how useful machine translation is right now and how much better it could become in the future, and there is a steady line of research in that direction. Limiting to widely available examples of machine translation software today, it is safe to say that, on the one hand, machine translation can preserve a lot of the meaning of the original and thus be very useful to the reader who needs to grasp the main points of the text, but on the other hand, are not at all passable for producing translations of the quality expected of human translators who are native speaker of the target language.</p>
<p>As far as Pology is concerned, the question of machine translation reduces to this: would it increase the efficiency of translation if PO files were first machine-translated, and then manually corrected by a human translator? There is no general answer to this question, as it depends stronly on all elements in the chain: the quality of machine translation software, the source language, the target language, and the human translator. Be that as it may, Pology provides the <span class="command"><strong>pomtrans</strong></span> script, which can fill in untranslated messages in PO files by passing original text through various machine translation services.</p>
<p><span class="command"><strong>pomtrans</strong></span> has two principal modes of operation. The more straightforward is the direct mode, where original texts are simply <code class="varname">msgid</code> strings in the given PO file. In this mode, PO files can be machine-translated with:</p>
<pre class="programlisting">
$ pomtrans <em class="replaceable"><code>transerv</code></em> -t <em class="replaceable"><code>lang</code></em> <em class="replaceable"><code>paths...</code></em>
</pre>
<p>The first argument is the translation service keyword, chosen from one known to <span class="command"><strong>pomtrans</strong></span>. The <code class="option">-t</code> option specifies the target language; it may not be necessary if processed PO files have the <code class="literal">Language:</code> header field properly set. The source language is assumed to be English, but there is an option to specify another source language. Afterwards an arbitrary number of paths follow, which may be either single PO files or directories which will be recursively searched for PO files.</p>
<p><span class="command"><strong>pomtrans</strong></span> will try to translate only untranslated messages, and not fuzzy messages. When it translates a message, by default it will make it fuzzy as well, meaning that a human should go through all machine-translated messages. These defaults are based on the perceived current quality of most machine translation services. There are several command line options to change this behavior.</p>
<p>The other mode of operation is the parallel mode. Here <span class="command"><strong>pomtrans</strong></span> takes the original text to be the translation into another language, i.e. <code class="varname">msgstr</code> strings from a PO file translated into another language. For example, if a PO file should be translated into Spanish (i.e. from English to Spanish), and that same PO file is available fully translated into French (i.e. from English to French), then <span class="command"><strong>pomtrans</strong></span> could be used to translate from French to Spanish. This is done in the following way:</p>
<pre class="programlisting">
$ pomtrans <em class="replaceable"><code>transerv</code></em> -s <em class="replaceable"><code>lang1</code></em> -t <em class="replaceable"><code>lang2</code></em> -p <em class="replaceable"><code>search</code></em>:<em class="replaceable"><code>replace</code></em> <em class="replaceable"><code>paths...</code></em>
</pre>
<p>As in direct mode, the first argument is the translation service. Then both the source (<code class="option">-s</code>) and the target language (<code class="option">-t</code>) are specified; again, if PO files have their <code class="literal">Language:</code> header fields set, these options are not necessary. The perculiar here is the <code class="option">-p</code> option, which specifies two strings, separated by colon. These are used to construct paths to source language PO files, by replacing the first string in paths of target language PO files with the second string. For example, if the file tree is:</p>
<pre class="programlisting">
foo/
    po/
        alpha/
            alpha.pot
            fr.po
            es.po
        bravo/
            bravo.pot
            fr.po
            es.po
</pre>
<p>then the invocation could be:</p>
<pre class="programlisting">
$ cd .../foo/
$ pomtrans <em class="replaceable"><code>transerv</code></em> -s fr -t es -p es.:fr. po/*/es.po
</pre>
<p>In case a PO file in target language does not have a counterpart in source language, it is simply skipped.</p>
<p>There is another variation of the parallel mode, where source language texts are drawn not from counterpart PO files, but from a single, compendium PO file in source language. This mode is engaged by giving the path to that compendium with the <code class="option">-c</code> option, instead of the <code class="option">-p</code> option for path replacement.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-mimtopts" id="sec-mimtopts"></a>7.3.1.&nbsp;Command Line Options</h3>
</div>
</div>
</div>
<p>Options specific to <span class="command"><strong>pomtrans</strong></span>:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-a <em class="replaceable"><code>CHARS</code></em></code>, <code class="option">--accelerator=<em class="replaceable"><code>CHARS</code></em></code></span></dt>
<dd>
<p>Characters used as <a class="link" href="#sec-poaccel" title="2.3.4.&nbsp;Accelerators">accelerator markers</a> in user interface messages. They should be removed from the source language text before translation, in order not to confuse the translation service.<sup>[<a name="id637006" href="#ftn.id637006" class="footnote" id="id637006">29</a>]</sup></p>
</dd>
<dt><span class="term"><code class="option">-c <em class="replaceable"><code>FILE</code></em></code>, <code class="option">--parallel-compendium=<em class="replaceable"><code>FILE</code></em></code></span></dt>
<dd>
<p>The path to source language compendium, in parallel translation mode.</p>
</dd>
<dt><span class="term"><code class="option">-l</code>, <code class="option">--list-transervs</code></span></dt>
<dd>
<p>Lists known translation services (the keywords which can be the first argument to <span class="command"><strong>pomtrans</strong></span>).</p>
</dd>
<dt><span class="term"><code class="option">-m</code>, <code class="option">--flag-mtrans</code></span></dt>
<dd>
<p>Adds the <code class="literal">mtrans</code> flag to each machine-translated message. This may be useful to positively identify machine-translated messages in the resulting PO file, as otherwise they are simply fuzzy.</p>
</dd>
<dt><span class="term"><code class="option">-M <em class="replaceable"><code>MODE</code></em></code>, <code class="option">--translation-mode=<em class="replaceable"><code>MODE</code></em></code></span></dt>
<dd>
<p>Translation services need as input the mode in which to operate, usually the source and target language at minimum. By default the translation mode is constructed based on source and target languages, but this is sometimes not precise enough. This option can be used to issue a custom mode string for the chosen translation service, overriding the default construction. The format of the mode string is translation service dependent, check documentation of respective translation services for details.</p>
</dd>
<dt><span class="term"><code class="option">-n</code>, <code class="option">--no-fuzzy-flag</code></span></dt>
<dd>
<p>By default machine-translated messages are made fuzzy, which is prevented by this option. It goes without saying that this is dangerous at current state of the art in machine translation, and should be used only in very specific scenarios (e.g. high quality machine translation between two dialects of the same language).</p>
</dd>
<dt><span class="term"><code class="option">-p <em class="replaceable"><code>SEARCH</code></em>:<em class="replaceable"><code>REPLACE</code></em></code>, <code class="option">--parallel-catalogs=<em class="replaceable"><code>SEARCH</code></em>:<em class="replaceable"><code>REPLACE</code></em></code></span></dt>
<dd>
<p>The string to search for in paths of target language PO files, and the string to replace them with to construct paths of source language PO files, in parallel translation mode.</p>
</dd>
<dt><span class="term"><code class="option">-s <em class="replaceable"><code>LANG</code></em></code>, <code class="option">--source-lang=<em class="replaceable"><code>LANG</code></em></code></span></dt>
<dd>
<p>The source language code, i.e. the language which is being translated from.</p>
</dd>
<dt><span class="term"><code class="option">-t <em class="replaceable"><code>LANG</code></em></code>, <code class="option">--target-lang=<em class="replaceable"><code>LANG</code></em></code></span></dt>
<dd>
<p>The target language code, i.e. the language which is being translated into.</p>
</dd>
<dt><span class="term"><code class="option">-T <em class="replaceable"><code>PATH</code></em></code>, <code class="option">--transerv-bin=<em class="replaceable"><code>PATH</code></em></code></span></dt>
<dd>
<p>If the selected translation service is (or can be) a program on the local computer, this option can be used to specify the path to its executable file, if it is not in the <code class="envar">PATH</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-mimtservs" id="sec-mimtservs"></a>7.3.2.&nbsp;Supported Machine Translation Services</h3>
</div>
</div>
</div>
<p>Currently supported translation services are as follows (with keyword in parenthesis):</p>
<div class="variablelist">
<dl>
<dt><span class="term">Apertium (<code class="literal">apertium</code>)</span></dt>
<dd>
<p><a class="ulink" href="http://www.apertium.org/" target="_top">Apertium</a> is a free machine translation platform, developed by the TRANSDUCENS research group of University of Alicante. There is a basic web service, but the software can be locally installed and that is how <span class="command"><strong>pomtrans</strong></span> uses it (some distributions provide packages).</p>
</dd>
<dt><span class="term">Google Translate (<code class="literal">google</code>)</span></dt>
<dd>
<p><a class="ulink" href="http://translate.google.com/" target="_top">Google Translate</a> is Google's proprietary web machine-translation service, which can be used free of charge. At the moment, <span class="command"><strong>pomtrans</strong></span> makes one query to it per message, which can take quite some time on long PO files.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id637006" href="#id637006" class="para" id="ftn.id637006">29</a>]</sup> This also means that, at the moment, machine-translated text has no accelerator when the original text did have one. Some heuristics may be implemented in the future to add the accelerator to translated text as well.</p>
</div>
</div>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-lingo" id="ch-lingo"></a>Chapter&nbsp;8.&nbsp;Language Validation and Derivation</h2>
</div>
</div>
</div>
<p>Pology was designed with strong language-specific support in mind, and this chapter describes the currently available features in the direction of validation and derivation of translation as whole and various bits in it.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-lglangenv" id="sec-lglangenv"></a>8.1.&nbsp;The Notion of Language in Pology</h2>
</div>
</div>
</div>
<p>A versatile translation-supporting tool has to have some language-specific functionality. But, it is difficult to agree on what is a language and what is a dialect, what is standard and what is jargon, what is derived from what, how any of these are named, and there are many witty remarks about existing classifications. Therefore, Pology takes a rather simple and non-formal approach to the definition of "language", but such that should provide good technical leverage for constructing language-specific functionality.</p>
<p>There are two levels of language-specificity in Pology.</p>
<p>The first level is simply the "language". In linguistic sense this can be a language proper (whatever that means), a dialect, a variant written in different script, etc. Each language in this sense is assigned a code in Pology, when first elements of support for that language are introduced. By convention this code should be an <a class="ulink" href="http://en.wikipedia.org/wiki/ISO_639" target="_top">ISO 639</a> code (either two- or three-digit) if applicable, but in principle can be anything. Another convenient source of language codes is the GNU C library. For example, Portugese language spoken in Portugal would have the code <code class="literal">pt</code> (ISO 639) while Portugese spoken in Brazil would be <code class="literal">pt_BR</code> (GNU C library).</p>
<p>The second level of language-specificity is the "environment". In linguistic terms this could be whatever distinct but minor variations in vocabulary, style, tone, or ortography, which are specific to certain groups of people within a single language community. Within Pology, this level is used to support variations between specific translation environments, such as long-standing translation projects and their teams. Although translating into the same language, translation teams will almost inevitably have some differences in terminology, style guidelines, etc. Environments also have codes assigned.</p>
<p>In every application in Pology, the language and its environments have a hierarchical relation. In general, language-specific elements defined outside of a specific environment ("environment-agnostic" elements) are a sort of a relaxed least common denominator, and specific environments add their own elements to that. Relaxed means that environment-agnostic elements can sometimes include that which holds for most but not all environments, while each environment can override what it needs to. This prevents the environment-agnostic language support from getting too limited just to cater for perculiarities in certain environments.</p>
<p>When processing PO files, it is necessary to somehow convey to Pology tools to which language and environment the PO files belong. The most effective way of doing this is by adding the necessary information to PO headers. All Pology tools that deal with language-specific elements will check the header of the PO file they process for the language and environment. Some Pology tools will also consult the user configuration (typically with lower priority than PO headers) or provide appropriate command line options (typically giving them higher priority). See <a class="xref" href="#sec-cmheader" title="9.9.&nbsp;Influential Header Fields">Section&nbsp;9.9, “Influential Header Fields”</a> and <a class="xref" href="#sec-cmconfig" title="9.2.&nbsp;User Configuration">Section&nbsp;9.2, “User Configuration”</a> for details.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="id581444" id="id581444"></a>8.1.1.&nbsp;Supported Languages and Environments</h3>
</div>
</div>
</div>
<p>The following languages and environments within those languages currently have some level of support in Pology (assigned code in parenthesis, "t.t." stands for translation team):</p>
<div class="informaltable">
<table border="1">
<colgroup>
<col width="30%">
<col width="70%"></colgroup>
<thead>
<tr>
<th>Language</th>
<th>Environments</th>
</tr>
</thead>
<tbody>
<tr>
<td>Catalan (<code class="literal">ca</code>)</td>
<td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>French (<code class="literal">fr</code>)</td>
<td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>Galician (<code class="literal">gl</code>)</td>
<td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>Japanese (<code class="literal">ja</code>)</td>
<td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>Low Saxon (<code class="literal">nds</code>)</td>
<td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>Norwegian Nynorsk (<code class="literal">nn</code>)</td>
<td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>Romanian (<code class="literal">ro</code>)</td>
<td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>Russian (<code class="literal">ru</code>)</td>
<td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>Serbian (<code class="literal">sr</code>)</td>
<td>
<table width="100%" border="0">
<colgroup>
<col></colgroup>
<tbody>
<tr>
<td>KDE t.t. (<code class="literal">kde</code>)</td>
</tr>
<tr>
<td>The Battle for Wesnoth t.t. (<code class="literal">wesnoth</code>)</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr>
<td>Spanish (<code class="literal">es</code>)</td>
<td class="auto-generated">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-lgspell" id="sec-lgspell"></a>8.2.&nbsp;Spell Checking</h2>
</div>
</div>
</div>
<p>Pology can employ various well-known spell-checkers to check the translation in PO files. Currently there is standalone support for <a class="ulink" href="http://aspell.net/" target="_top">Aspell</a>, and unified support for many spell-checkers (including Aspell) through <a class="ulink" href="http://www.abisource.com/projects/enchant/" target="_top">Enchant, the spell-checking wrapper library</a> (more precisely, through <a class="ulink" href="http://pyenchant.sourceforge.net" target="_top">Python bindings</a> for Enchant).</p>
<p>Spell-checking of one PO file or a collection of PO files can be performed directly by <a class="link" href="#ch-sieve" title="Chapter&nbsp;3.&nbsp;Sieving">sieving</a> them through one of <a class="link" href="#sv-check-spell" title="3.5.8.&nbsp;check-spell"><span class="command"><strong>check-spell</strong></span></a> (Aspell) or <a class="link" href="#sv-check-spell-ec" title="3.5.9.&nbsp;check-spell-ec"><span class="command"><strong>check-spell-ec</strong></span></a> sieves. The sieve will report each unknown word, possibly with a list of suggestions, and the location of the message (file and line/entry numbers). It can also be requested to show the full message, with unknown words in the translation highlighted.</p>
<p>Also provided are several <a class="link" href="#hk-spell">spell-checking hooks</a>, which can be used as building blocks in custom translation validation chains. For example, a spell-checking hook can be used to define the spell-checking rule within Pology's <a class="link" href="#sec-lgrules" title="8.5.&nbsp;Validation Rules">validation rules</a> collection for a given language.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgspdicts" id="sec-lgspdicts"></a>8.2.1.&nbsp;Internal Spelling Dictionaries</h3>
</div>
</div>
</div>
<p>Pology collects internal language-specific word lists as supplements to system spelling dictionaries. One use of internal dictionaries is to record those words which are omitted in the system spelling dictionaries, but are actually proper words in the given language. Such words should be added into internal dictionaries only as an immediate fix for false spelling warnings, with an eye towards integrating them into the upstream spelling dictionaries of respective spell-checkers.</p>
<p>More importantly, internal dictionaries serve to collect words specific to a given environment, i.e. the words which are deemed too specific to be part of the upstream, general spelling dictionaries for the language. For example, this can be technical jargon, with newly coined terms which are yet to be more widely accepted. Another example could be translation of fiction, in books or computer games, where it is common-place to make up words for fictional objects, animals, places, etc. which are not even intended to be more widely used.</p>
<p>In Pology source tree, internal spelling dictionaries by language are located in <code class="filename">lang/<em class="replaceable"><code>lang</code></em>/spell/</code> directories. This directory can contain arbitrary number of dictionary files, which are all automatically picked up by Pology when spelling-checking for that language is done. Dictionary files directly in this directory are environment-agnostic, and should contain only the words which are standard (or standard derivations) in the language, but happen to be missing from the system spelling dictionary. Subdirectories represent specific environments, they are named with the environment code, and can also contain any number of dictionaries. An example of internal dictionary tree with environments:</p>
<pre class="programlisting">
lang/
    sr/
        spell/
            colors.aspell
            fruit.aspell
            ...
            science.aspell
            kde/
                general.aspell
            wesnoth/
                general.aspell
                propernames.aspell
</pre>
<p>Dictionary files are in the Aspell word list format (regardless of the spell-checker actually used), and must have <code class="filename">.aspell</code> extension. This is a simple plain text format, listing one word per line. Only the first line is special, the header, which states the language code, number of words in the list, and the encoding. For example:</p>
<pre class="programlisting">
personal_ws-1.1 fr 1234 UTF-8
apricot
banana
cherry
...
</pre>
<p>Actually the only significant element of the header is the encoding. Language code and number of words can be arbitrary, as Pology will not use them.</p>
<p>Pology provides the <span class="command"><strong>organizeDict.py</strong></span> script which sorts word list files alphabetically (and corrects the word count in the header, even if not important), so that you do not have to manually insert new words in proper order. The script is simply run with arbitrary number of word list files as arguments, and modifies them in place. In case of duplicate words, it will report duplicates and eliminate them. In case of words with invalid characters (e.g. space), the script will output a warning, but it will not remove them; automatic removal of invalid words can be requested with <code class="option">-r</code>/<code class="option">--remove-invalid</code> option.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgspskip" id="sec-lgspskip"></a>8.2.2.&nbsp;Skipping Messages and Words</h3>
</div>
</div>
</div>
<p>Sometimes a message or a few words in it should not be spell-checked. This can be, for example, when the message is dense computer input (like a command line synopsis), or when a word is part of a literal phrase (such as an email address). It may be possible to filter the text to remove some of the non-checkable words prior to spell-checking (especially when spell-checking is done as a <a class="link" href="#sec-lgrules" title="8.5.&nbsp;Validation Rules">validation rule</a>), but not all such words can be automatically detect. For example, especially problematic are onomatopoeic constructs ("Aaargh! Who released the beast?!").</p>
<p>For this reason it is possible to manually skip spell-checking on a message, or on certain words within a message, by adding a <a class="link" href="#sec-cmskipcheck" title="9.11.&nbsp;Skipping and Selecting Checks">special translator comment</a>. The whole message is skipped by adding the <code class="literal">no-check-spell</code> translator flag to it:</p>
<pre class="programlisting">
# |, no-check-spell
</pre>
<p>Words within the message are skipped by listing them in <code class="literal">well-spelled:</code> translator comment, comma- or space-separated:</p>
<pre class="programlisting">
# well-spelled: Aaarg, gaaah, khh
</pre>
<p>Which of these two levels of skipping to use depends on the nature of the text. For example, if most of the text is composed of proper words, and there are only a few which should not be checked, it is probably better to list those words explicitly instead of skipping the whole message.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-lggrammar" id="sec-lggrammar"></a>8.3.&nbsp;Grammar Checking</h2>
</div>
</div>
</div>
<p>With Pology you can use <a class="ulink" href="http://www.languagetool.org/" target="_top">LanguageTool</a>, a free grammar and style checker, to check translation in PO files. At the moment LanguageTool is applicable only through <a class="link" href="#sv-check-grammar" title="3.5.5.&nbsp;check-grammar">the <span class="command"><strong>check-grammar</strong></span> sieve</a>, so look up the details in its documentation.</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-lguirefs" id="sec-lguirefs"></a>8.4.&nbsp;Automatic Insertion of UI Labels</h2>
</div>
</div>
</div>
<p>In program documentation, but also in help texts in running programs, frequently labels from user interface are mentioned. Here are two such messages, one a UI tooltip, the other a Docbook paragraph:</p>
<pre class="programlisting">
#: comic.cpp:466
msgid "Press the \"Get New Comics...\" button to install comics."
msgstr ""

#: index.docbook:157
msgid ""
"&lt;guimenuitem&gt;Selected files only&lt;/guimenuitem&gt; extracts only "
"the files which have been selected."
msgstr ""
</pre>
<p>In the usual translation process, an embedded UI label is manually translated just like the surrounding text. You could directly translate the label, hoping that the original UI message was translated in the same way, but this will frequently not be the case (especially for longer labels). To be thorough, you could look up the UI message in its PO file, or run the program, to see how it was actually translated. There are two problems with being thorough in this way: it takes time to look up original UI messages, and worse, translation of a UI message might change in the future (e.g. after a review) and leave the referencing message out of date.</p>
<p>An obvious solution to these problems, in principle, would be to leave embedded UI labels untranslated but properly marked (such as with <code class="literal">&lt;gui*&gt;</code> tags in Docbook), and have an automatic system fetch their translations from original UI messages and insert them into referencing messages. However, there could be many implementational variations of this approach (like at which stage of the translation chain the automatic insertion happens), with some significant details to get right.</p>
<p>At present, Pology approaches automatic insertion of UI labels in a generalized way, which does not mandate any particular organization of PO files or translation workflow. It defines a syntax for wrapping and disambiguating UI references, for linking referencing and originating PO files, and provides a series of <a class="link" href="#hk-uiref-resolve-ui">hooks to resolve and validate UI references</a>. A UI reference resolving hook will simply replace a properly equipped non-translated UI label with its translation. This implies that PO files which are delivered must not be the same PO files which are directly translated, because resolving UI references in directly translated PO files would preclude their automatic update in the future<sup>[<a name="id652692" href="#ftn.id652692" class="footnote" id="id652692">30</a>]</sup>. It is upon the translator or the translation team to establish the separation between delivered and translated PO files. One way is by translating in summit (see <a class="xref" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">Chapter&nbsp;5, <i>Summitting Translation Branches</i></a>), which by definition provides the desired separation, and setting UI reference resolving hooks as <a class="link" href="#sec-sucfghooks" title="5.3.1.&nbsp;Summit Hooks">filters on scatter</a>.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lguiformat" id="sec-lguiformat"></a>8.4.1.&nbsp;Wrapping UI References</h3>
</div>
</div>
</div>
<p>If UI references are inserted into the text informally (even if relying on certain ortographic or typographic conventions), then they must be manually wrapped in the translation using an explicit UI reference directive. For example:</p>
<pre class="programlisting">
#: comic.cpp:466
msgid "Press the \"Get New Comics...\" button to install comics."
msgstr "Pritisnite dugme „~%/Get New Comics/“ da instalirate stripove."
</pre>
<p>Explicit UI reference directives are of the format <em class="replaceable"><code>head</code></em>/<em class="replaceable"><code>reference-text</code></em>/. The directive head is <code class="literal">~%</code> in this example, which is the default, but another head may be specified as parameter to UI resolving hooks. Delimiting slashes in the UI reference directive can be replaced with any other character consistenly (e.g. if the UI text itself contains a slash). Note that the directive head must be fixed for a collection of PO files (though more than one head can be defined), while delimiting character can be freely chosen from one to another directive.</p>
<p>The other the type are implicit UI references, which do not require special directive, made possible when UI text is indicated in the text through formal markup. This is the case, for example, in PO files coming from Docbook documenation:</p>
<pre class="programlisting">
#: index.docbook:157
msgid ""
"&lt;guimenuitem&gt;Selected files only&lt;/guimenuitem&gt; extracts only "
"the files which have been selected."
msgstr ""
"&lt;guimenuitem&gt;Selected files only&lt;/guimenuitem&gt; raspakuje samo "
"datoteke koje su izabrane."
</pre>
<p>Here the translation contains nothing special, save for the fact that the UI reference is not translated. UI resolving hooks can be given a list of tags to be considered as UI references, and for some common formats (such as Docbook) there are predefined specialized hooks which already list all UI tags.</p>
<p>If the message of the UI text is unique by its <code class="varname">msgid</code> string in the originating PO file, then it can be wrapped simply as in previous examples. This means that even if it has the <code class="varname">msgctxt</code> string, the reference will still be resolved. But, if there are several UI messages with same <code class="varname">msgid</code> (implying different <code class="varname">msgctxt</code>), then the <code class="varname">msgctxt</code> string has to be manually added to the reference. This is done by puting the context into the prefix of the reference, separated by the pipe <code class="literal">|</code> character. For example, if the PO file has these two messages:</p>
<pre class="programlisting">
msgctxt "@title:menu"
msgid "Columns"
msgid "Kolone"

msgctxt "@action:inmenu View Mode"
msgid "Columns"
msgstr "kolone"
</pre>
<p>then the correct one can be selected in an implicit UI reference like this:</p>
<pre class="programlisting">
msgid ""...&lt;guibutton&gt;Columns&lt;/guibutton&gt;..."
msgstr "...&lt;guibutton&gt;@title:menu|Columns&lt;/guibutton&gt;..."
</pre>
<p>In the very unlikely case of <code class="literal">|</code> character being part of the context string itself, the <code class="literal">¦</code> character ("broken bar") can be used as the context separator instead.</p>
<p>If the UI reference equipped with context does not resolve to a message through direct match on context, the given context string will next be tried as regular expression match on <code class="varname">msgctxt</code> strings of the messages with matching <code class="varname">msgid</code> (matching will be case-insensitive). If this results in exactly one matched message, the reference is resolved. This matching sequence allows simplification and robustness in case of longer contexts, which would look ungainly in the UI reference and may slightly change over time.</p>
<p>If two UI messages have equal <code class="varname">msgid</code> but are not part of the same PO file, that is not a conflict because one of those PO files has the priority (see <a class="xref" href="#sec-lguilink" title="8.4.3.&nbsp;Linking to Originating PO Files">Section&nbsp;8.4.3, “Linking to Originating PO Files”</a>).</p>
<p>If of UI two messages with equal <code class="varname">msgid</code> one has <code class="varname">msgctxt</code> and the other does not, the message without context can be selected by adding the context separator in front of the text with nothing before it (i.e. as if the context is "empty").</p>
<p>Sometimes, though rarely, it happens that the referenced UI text is not statically complete, that is, that it contains a format directive which is resolved at runtime. In such cases, the reference must be transformed to exactly an existing <code class="varname">msgid</code>, and the arguments are substituted with special syntax. If the UI message is:</p>
<pre class="programlisting">
msgid "Configure %1..."
msgstr "Podesi %1..."
</pre>
<p>then it can be used in an implicit UI reference like this:</p>
<pre class="programlisting">
msgid "...&lt;guimenuitem&gt;Configure Foobar...&lt;/guimenuitem&gt;..."
msgstr "...&lt;guimenuitem&gt;Configure %1...^%1:Foobar&lt;/guimenuitem&gt;..."
</pre>
<p>Substitution arguments follow after the text, separated with the <code class="literal">^</code> character. Each argument specifies the format directive it replaces and the argument text, separated by <code class="literal">:</code>. In the unlikely case that <code class="literal">^</code> is part of the <code class="varname">msgid</code> itself, the <code class="literal">ª</code> ("feminine ordinal indicator") can be used instead as the argument separator.</p>
<p>If there are several format directives in the UI reference, they are by default considered "named". This means that all same format directives will be replaced by the same argument. This is the right thing to do for some formats, e.g. <code class="literal">python-format</code> or <code class="literal">kde-format</code> messages, but not for all formats. In <code class="literal">c-format</code>, if there are two <code class="literal">%s</code> in the text, to replace just one of them with the current argument, the format directive attached to the argument must be preceded with <code class="literal">!</code>:</p>
<pre class="programlisting">
#, c-format
msgid "...&lt;guilabel&gt;This Foo or that Bar&lt;/guilabel&gt;..."
msgstr "...&lt;guilabel&gt;This %s or that %s.^!%s:foo^!%s:bar&lt;/guilabel&gt;..."
</pre>
<p>In general, but especially with implicit references, the text wrapped as reference may actually contain several references in form of UI path (<code class="literal">"...go to Foo-&gt;Bar-&gt;Baz, and click on..."</code>). To handle such cases, if it is not possible or it is not convenient to wrap each element of the UI path separately, UI reference resolving hooks can be given one or more UI path separators (e.g. <code class="literal">-&gt;</code>) to split and resolve the element references on their own.</p>
<p>Sometimes the UI reference in the original text is not valid, i.e. such message no longer exists in the program. This can happen due to slight interpunction mismatch, small style changes, etc., such that you can easily locate the correct UI message and use its <code class="varname">msgid</code> as the reference. However, if the UI reference is not valid due to documentation being outdated, there is no correct UI message to use in translation. This should most certainly be reported to the authors, but up until they fix it, it presents a problem for immediate resolution of UI references. For this reason, a UI reference can be temporarily translated in place, by preceding it with twin context separators:</p>
<pre class="programlisting">
msgid "...<span class="guilabel">An Outdated Label</span>..."
msgstr "...<span class="guilabel">||Zastarela etiketa</span>..."
</pre>
<p>This will resolve into the verbatim text of the reference (i.e. context separators will simply be removed), without the hook complaining about an unresolvable reference.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lguinorm" id="sec-lguinorm"></a>8.4.2.&nbsp;Normalization of UI Text</h3>
</div>
</div>
</div>
<p>The text of the UI message may contain some characters and substrings which should not be carried over into the text which references the message, or should be modified. To cater for this, UI PO files are normalized after being opened and before UI references are looked up in them. In fact, UI references are written precisely in this normalized form, rather than using the true original <code class="varname">msgid</code> from the UI PO file. This is both for convenience and for necessity.</p>
<p>One typical thing to handle in normalization is the accelerator marker. UI reference resolving hooks eliminate accelerator markers automatically, by for that they need to known what the accelerator marker character is. To find this out, hooks will read <a class="link" href="#hdr-x-accelerator-marker">the <code class="literal">X-Accelerator-Marker</code> header field</a>.</p>
<p>Another problem is when UI messages contain subsections which would invalidate the target format which is being translated in the referencing PO file, e.g. malformed XML in Docbook catalogs. For example, literal <code class="literal">&amp;</code> must be represented as <code class="literal">&amp;amp;</code> in Docbook markup, thus this UI message:</p>
<pre class="programlisting">
msgid "Scaled &amp; Cropped"
msgstr ""
</pre>
<p>would be referenced as:</p>
<pre class="programlisting">
msgid "...&lt;guimenuitem&gt;Scaled &amp;amp; Cropped&lt;/guimenuitem&gt;..."
msgstr "...&lt;guimenuitem&gt;Scaled &amp;amp; Cropped&lt;/guimenuitem&gt;..."
</pre>
<p>Resolving hooks have parameters for specifying the type of escaping needed by the target format.</p>
<p>Normalization may flatten several different messages from the UI PO file into one. Example of this is when <code class="varname">msgid</code> fields are equal but for the accelerator marker. If this happens and normalized translations are not equal for all flattened messages, a special "tail" is added to their contexts, consisting of a tilde and several alphanumeric characters. The first run of the resolving (or validation) hook will report ambiguities of this kind, as well as assigned contexts, so that proper context can be copied and pasted over into the UI reference. The alphanumeric context tail is computed from the non-normalized <code class="varname">msgid</code> alone, so it will not change if, for example, messages in the UI PO file get reordered.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lguilink" id="sec-lguilink"></a>8.4.3.&nbsp;Linking to Originating PO Files</h3>
</div>
</div>
</div>
<p>In general, the UI message may not be present in the same PO file in which it is referenced in another messages. This is always the case for documentation PO files. Therefore UI reference resolving hooks need to know two things: the list of all UI PO files (those from which UI references may be drawn), and, for each PO file which contains UI references, the list of PO files from which it may draw UI references.</p>
<p>The list of UI PO files can be given to resolving hooks explicitly, as list of PO file paths (or directory paths to search for PO files). This can, however, be inconvenient, as it implies either that the resolution script must be invoked in a specific directory (if paths are relative), or that UI PO files must reside in a fixed directory on the system where the resolution script is run (if paths are absolute). Therefore there is another way of specifying paths to UI PO files, through an environment variable which contains a colon-separated list of directory paths. Both the explict list of paths and the environment variable which contains the paths can be given as parameters to hooks.</p>
<p>By default, for a given PO file, UI references are looked for only in the PO file of the same name, assuming that it is found among UI PO files. This may be sufficient, for example, for UI references in tooltips, but it is frequently not sufficient for documentation PO files, which may have a different names from corresponding UI PO file names. Therefore a PO file can be manually linked to UI PO files from which it draws UI references, through a special header field <code class="literal">X-Associated-UI-Catalogs</code>. This field specifies only the PO domain names, as space- or comma-separated list:</p>
<pre class="programlisting">
msgid ""
msgstr ""
"Project-Id-Version: foobar\n"
"..."
"X-Associated-UI-Catalogs: foobar libfoobar libqwyx\n"
</pre>
<p>The order of domain names in the list is important: if the referenced UI message exists in more than one linked PO file, the translation is taken from the one which appears earlier in the list. Knowing PO domain names, resolving hooks can look up the exact file paths in the supplied list of paths.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lguinotes" id="sec-lguinotes"></a>8.4.4.&nbsp;Notes on UI Reference Resolution</h3>
</div>
</div>
</div>
<p>When a UI reference cannot be resolved, for whatever reason -- it does not exist, there is a context conflict, the message is not translated, etc. -- resolving hooks will output warnings and fallback to original text.</p>
<p>For each resolving hook there exists the counterpart validation hook. Validation hooks may be used in a "dry run" before starting to build PO files for delivery, or they may be built into a general translation validation framework (such as Pology's <a class="link" href="#sec-lgrules" title="8.5.&nbsp;Validation Rules">validation rules</a>).</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-lgrules" id="sec-lgrules"></a>8.5.&nbsp;Validation Rules</h2>
</div>
</div>
</div>
<p>There are great many possible mistakes to be made when translating. Some of these mistakes can only be observed and corrected by a human reviewer<sup>[<a name="id589542" href="#ftn.id589542" class="footnote" id="id589542">31</a>]</sup>, and review is indeed an important part of the translation workflow. However, many mistakes, especially those more technical in nature, can be fully or partially detected by automatic means.</p>
<p>A number of tools are available to perform various checks on translation in PO files. The basic one is Gettext's <span class="command"><strong>msgfmt</strong></span> command, which, when run with <code class="option">-c</code>/<code class="option">--check</code> option, will detect many "hard" technical problems. These are the kind of problems which may cause the program that uses translation to crash, or that may cause loss of information to the program user. Another is <a class="ulink" href="http://translate.sourceforge.net/wiki/toolkit/pofilter" target="_top">Translate Toolkit's <span class="command"><strong>pofilter</strong></span> command</a>, which applies heuristic checks to detect common (and not so common) stylistic and semantic slips in translation. Dedicated PO editors may also provide some checks of their own, or make use of external batch tools.</p>
<p>One commonality of existing validation tools is that they aim for generality, that is, try to apply a fixed battery of checks to all <a class="link" href="#sec-lglangenv" title="8.1.&nbsp;The Notion of Language in Pology">languages and environments</a> (although some differentiation by translation projects may be present, such as in <span class="command"><strong>pofilter</strong></span>). Another commonality, unavoidable in heuristic approaches, is wrong detection of valid translation as invalid, the so called "false positives". These two elements produce combined negative effect: since the number and specificity of checks is not that great compared to what a dedicated translator could come up with for given language and environment, and since many reported errors are false positives without possibility for cancelation, the motivation to apply automatic checks sharply decreases; the more so the greater the amount of translation.</p>
<p>Pology therefore provides a system for users to assemble collections of <span class="emphasis"><em>validation rules</em></span> adapted to their language and environment, with multi-level facilities for applying or skipping rules in certain contexts, pre-filtering of text before applying rules, and post-filtering and opening problematic messages in PO editors. Rules can be written and tuned in the course of translation, and false positives can be systematically canceled, such that over time the collection of rules becomes both highly specific and highly accurate. Since Pology supports language and environment variations from the ground up, such rule collections can be committed to Pology source distribution, so that anyone may use them when applicable.</p>
<p>Validation rules are primarily based on pattern matching with <a class="link" href="#sec-cmregex" title="9.3.&nbsp;Regular Expressions">regular expressions</a>, but they can in principle contain any Python code through Pology's <a class="link" href="#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">hook system</a>. For example, since there are spell-checking hooks provided, spell-checking can be easily made into one validation rule. One could even aim to integrate every available check into the validation rule system, such that it becomes the single and uniform source of all automatic checks in the translation workflow.</p>
<p>The primary tool in Pology for applying validation rules is <a class="link" href="#sv-check-rules" title="3.5.7.&nbsp;check-rules">the <span class="command"><strong>check-rules</strong></span> sieve</a>. This section describes how to write rules, how to organize rule collections, and, importantly, how to handle false positives.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgrltour" id="sec-lgrltour"></a>8.5.1.&nbsp;Guided Tour of the Rule System</h3>
</div>
</div>
</div>
<p>There are many nuances to the validation rule system in Pology, so it is best to start off with an example-based exposition of the main elements. Subsequent sections will then look into each element in detail.</p>
<p>Rules are defined in rule files, with flat structure and minimalistic syntax, since the idea is to write the rules during the translation (or the translation review). Here is one rule file with two rules:</p>
<pre class="programlisting">
# Personal rules of Horatio the Indefatigable.

[don't|can't|isn't|aren't|won't|shouldn't|wouldn't]i
id="gram-contr"
hint="Do not use contractions."

{elevator}i
id="term-elevator"
hint="Translate 'elevator' as 'lift'."
valid msgstr="lift"
</pre>
<p>A rule file should begin with a comment telling something about the rules defined in the file. Then the rules follow, normally separated by one or more blank lines. Each rule starts with a <span class="emphasis"><em>trigger pattern</em></span>, of which there are several types. The trigger pattern can sometimes be everything there is to the rule, but it is usually followed by a number of <span class="emphasis"><em>subdirectives</em></span>.</p>
<p>The first rule above starts with a regular expression pattern on the translation, which is denoted by the <code class="literal">[...]</code> syntax. The regular expression matches English contractions, case-insensitively as indicated by trailing <code class="literal">i</code> flag. The trigger pattern is followed by the <code class="literal">id</code> subdirective, which specifies an identifier for the rule (here <code class="literal">gram-contr</code> is short for "grammar, contractions"). The identifier does not have to be present, and does not even have to be unique if present (uses of rule identifiers will be explained later). If the rule matches a message, the message is reported to the user as problematic, along with a note provided in the <code class="literal">hint</code> subdirective.</p>
<p>The second rule starts with a regular expression pattern on the original (rather than the translation), for which the <code class="literal">{...}</code> syntax is reserved. Then the <code class="literal">id</code> and <code class="literal">hint</code> subdirectives follow, as in the first rule. But unlike the first rule, up to this point the second rule would be somewhat strange: report a problem whenever the word "elevator" is found in the original text? That is where the final <code class="literal">valid</code> subdirective comes in, by specifying a condition on translation (<code class="literal">msgstr=</code>) which cancels the trigger pattern. So this rule efectively states "report every message which has the word 'elevator' in the original, but not the word 'lift' in the translation", making it a terminology assertion rule.</p>
<p>If the given example rule file is saved as <code class="filename">personal.rules</code>, it can be applied to a collection of PO files by the <span class="command"><strong>check-rules</strong></span> sieve in the following way:</p>
<pre class="programlisting">
$ posieve check-rules -s rfile:<em class="replaceable"><code>pathto</code></em>/personal.rules <em class="replaceable"><code>PATHS...</code></em>
</pre>
<p>The path to the rule file to apply is given by the <code class="option">rfile:</code> sieve parameter. All messages which are "failed" by rules will be output to the terminal, with spans of the text that triggered the rule highlighted and the note attached to the rule displayed after the message. Additionally, one of the parameters for automatically opening messages in the PO editor can be issued, to make correcting problems (or canceling false positives) that more comfortable.</p>
<p>The <code class="option">rfile:</code> sieve parameter can be repeated to add several rule files. If all rule files put into one directory (and its subdirectories), a single <code class="option">rdir:</code> parameter can be used to specify the path to that directory, and all files with <code class="filename">.rules</code> extension will be recursively collected from it and applied. Finally, if rule files are put into Pology's rule directory for the given language, at <code class="filename">lang/<em class="replaceable"><code>lang</code></em>/rules/</code>, then <span class="command"><strong>check-rules</strong></span> will automatically pick them up when neither <code class="option">rfile:</code> nor <code class="option">rdir:</code> parameters are issued. This is a simple way to test the rules if the intention is to include them into Pology distribution.</p>
<p>Instead of applying all defined rules, parameters <code class="option">rule:</code>, <code class="option">rulerx:</code>, <code class="option">norule:</code>, <code class="option">norulerx:</code> of <span class="command"><strong>check-rules</strong></span> can be used to select specific rules to apply or to not apply, by their identifiers. To apply only the no-contractions rule:</p>
<pre class="programlisting">
$ posieve check-rules -s rfile:<em class="replaceable"><code>pathto</code></em>/personal.rules -s rule:gram-contr <em class="replaceable"><code>PATHS...</code></em>
</pre>
<p>and to apply all but terminology rules, assuming that their identifiers start with <code class="literal">term-</code>:</p>
<pre class="programlisting">
$ posieve check-rules -s rfile:<em class="replaceable"><code>pathto</code></em>/personal.rules -s norulerx:term-.* <em class="replaceable"><code>PATHS...</code></em>
</pre>
<p>When the rule trigger pattern is a regular expression, it can always be made more or less specific. The previous example of matching English contractions could be generalized like this:</p>
<pre class="programlisting">
[\w+'t\b]i
</pre>
<p>This regular expression will match one or more word-characters (<code class="literal">\w+</code>) followed by 't (<code class="literal">'t</code>) which is positioned at the word boundary (<code class="literal">\b</code>). More general patterns increase the likelyhood of false positives, but this is not really a problem, since tweaking the rules in the course of translation is expected. It is a bigger problem if the pattern is made too specific at first, such that it misses out some cases. It is therefore recommended to start with "greedy" patterns, and then constrain them as false positivies are observed.</p>
<p>However, tweaking trigger patterns can only go so far.<sup>[<a name="id649734" href="#ftn.id649734" class="footnote" id="id649734">32</a>]</sup> The workhorse of rule flexibility is instead the mentioned <code class="literal">valid</code> subdirective. Within a single <code class="literal">valid</code> directive there may be several tests, and many types of tests are provided. The trigger will be canceled if all the tests in the <code class="literal">valid</code> subdirective are satisfied (boolean AND linking). There may be several <code class="literal">valid</code> subdirectives, each with its own battery of tests, and then the trigger is canceled if any of the <code class="literal">valid</code> subdirectives are satisfied (boolean OR linking). For example, to disallow a certain word in translation unless used in few specific constructs, the following set of <code class="literal">valid</code> subdirectives can be used:</p>
<pre class="programlisting">
[foo]i
id="style-nofoo"
hint="The word 'foo' is allowed only in '*goo foo' and 'foo bar*' constructs."
valid after="goo "
valid before=" bar"
</pre>
<p>The first <code class="literal">valid</code> subdirective cancels the rule if the trigger pattern matched just after a "goo " segment, and the second if it matched just before a " bar" segment. Another example would be a terminology assertion rule where a certain translation is expected in general, but another translation as well is allowed in a specific PO file:</p>
<pre class="programlisting">
{foobar}i
id="term-foobar"
hint="Translate 'foobar' as 'froobaz' (somewhere 'groobaz' allowed too)."
valid msgstr="froobaz"
valid msgstr="groobaz" cat="gfoo"
</pre>
<p>Here the second <code class="literal">valid</code> subdirective uses the <code class="literal">cat=</code> test to specify the other possible translation in the specific PO file. Tests can be negated by prepending <code class="literal">!</code> to them, so to require the specific PO file to have <span class="emphasis"><em>only</em></span> the other translation:</p>
<pre class="programlisting">
valid msgstr="froobaz" !cat="gfoo"
valid msgstr="groobaz" cat="gfoo"
</pre>
<p>When a regular expression is not sufficient as the rule trigger, a validation hook can be used instead (one of V* hook types). See <a class="xref" href="#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">Section&nbsp;9.10, “Processing Hooks”</a> for general discussion on hooks in Pology. For example, since there are spell-checking hooks already available, the complete rule for spell-checking could be:</p>
<pre class="programlisting">
*hook name="spell/check-spell-sp" on="msgstr"
id="spelling"
hint="Misspelled words detected."
</pre>
<p>The <code class="literal">name=</code> field specifies the hook, and the <code class="literal">on=</code> field what parts of the message it should operate on. The parts given by <code class="literal">on=</code> field must be appropriate for the hook type; since <code class="literal">spell/check-spell-sp</code> is a V3A hook, it can operate on any string in the message, including the translation as requested here. Validation hooks can provide some notes of their own (here list of replacement suggestions for a faulty word), which will be shown next to the note given by rule's <code class="literal">hint=</code> subdirective.</p>
<p>Examples so far all suffer from one basic problem: the trigger pattern will fail to match a word which has an accelerator marker inside it.<sup>[<a name="id649888" href="#ftn.id649888" class="footnote" id="id649888">33</a>]</sup> This is actually an instance of a broader problem, that some rules should operate on a somewhat modified, filtered text, instead on the original text. This is why the rule system in Pology also provides extensive filtering capabilities. If the accelerator marker is <code class="literal">_</code> (the underscore), here is how it could be removed before applying the rules:</p>
<pre class="programlisting">
# Personal rules of Horatio the Indefatigable.

addFilterRegex match="_" repl="" on="pmsgid,pmsgstr"

# Rules follow...
</pre>
<p>The <code class="literal">addFilterRegex</code> directive sets a regular expression filter that will be applied to messages before applying any of the rules that follow. <code class="literal">match=</code> field provides the pattern, <code class="literal">repl=</code> what to replace it with, and <code class="literal">on=</code> which parts of the message to filter.</p>
<p>The accelerator marker filter from the previous example is quite crude. It fixes the accelerator marker character, and it will simply remove all of them from the text. Filters too can be hooks instead of regular expressions, and in this case it is better to use the dedicated accelerator marker removal hook:</p>
<pre class="programlisting">
# Personal rules of Horatio the Indefatigable.

addFilterHook name="remove/remove-accel-msg" on="msg"

# Rules follow...
</pre>
<p><a class="link" href="#hk-remove-remove-accel">The <code class="literal">remove/remove-accel-msg</code> hook</a> is an F4A hook, and therefore the <code class="literal">on=</code> field specifies the whole message as the target of filtering. This hook will use information from PO file headers and respect command line overrides to determine the accelerator marker character, and then remove them only from valid accelerator positions.</p>
<p>Filters to not have to be given as global directives, influencing all the rules below them, but they can be defined for a single rule, using one of rule subdirectives. The other way around, global filters can also have a handle assigned (using the <code class="literal">handle=</code> field), and then this handle can be used to remove the filter on a specific rule.</p>
<p>The last important concept in the Pology's validation rule system are rule environments. The examples so far defined rules for a given language, which means that they in principle apply to any PO file of that language. This is generally insufficient (e.g. terminology differences between translation projects), so rules too can be made to support Pology's <a class="link" href="#sec-lglangenv" title="8.1.&nbsp;The Notion of Language in Pology">language and environment</a> hierarchy. Going back to the initial rule file example, let us assume that while "elevator" should always become "lift", but that English contractions are not accepted only in more formal translations. Then, the rule file could be modified to:</p>
<pre class="programlisting">
# Personal rules of Horatio the Indefatigable.

[don't|can't|isn't|aren't|won't|shouldn't|wouldn't]i
environment formal
...

{elevator}i
...
</pre>
<p>The first rule now has the <code class="literal">environment</code> subdirective, which sets this rule's environment to <code class="literal">formal</code>. If <span class="command"><strong>check-rules</strong></span> is now run as before, only the second rule will be applied, as it is environment-agnostic. To apply the first rule as well, the <code class="literal">formal</code> environment must be requested through the <code class="option">env:</code> sieve parameter:</p>
<pre class="programlisting">
$ posieve check-rules -s rfile:<em class="replaceable"><code>pathto</code></em>/personal.rules -s env:formal <em class="replaceable"><code>PATHS...</code></em>
</pre>
<p>Another way to request the environment is to specify it inside the PO file itself, through the <a class="link" href="#hdr-x-environment">the <code class="literal">X-Environment:</code> header field</a>. This is generally preferable, because it both reduces the amount of command line arguments (which may be accidentaly omitted sometimes), other parts of Pology too can make use of the environment information in the PO header, and, most importantly, it makes possible that not all PO files processed in a single run belong to the same environment.</p>
<p>If all the rules which belong to the formal environment are grouped at the end of the rule file, then the global <code class="literal">environment</code> directive can be used to set the environment for all of them, instead of the subdirective on each of them:</p>
<pre class="programlisting">
# Personal rules of Horatio the Indefatigable.

{elevator}i
...

environment formal

[don't|can't|isn't|aren't|won't|shouldn't|wouldn't]i
...
</pre>
<p>A more usual application of the global <code class="literal">environment</code> directive is to split environment-specific rules into a separate file, and then put the <code class="literal">environment</code> directive at the top. Most flexibly, <code class="literal">valid</code> subdirectives provide the <code class="literal">env=</code> test, so that the rule trigger can be canceled in a condition including the environment. In the running example, this could be used as:</p>
<pre class="programlisting">
# Personal rules of Horatio the Indefatigable.

[don't|can't|isn't|aren't|won't|shouldn't|wouldn't]i
...
valid !env="formal"

{elevator}i
...
</pre>
<p>It depends on the particular organization of rule files, and on types of rules, which method of environment-sensitivity should be used. Filters too are sensitive to environments, either conforming to global environment directives same as rules, or using their own <code class="literal">env=</code> fields.</p>
<p>When requesting environments in validation runs (through <code class="option">env:</code> sieve parameter or <code class="literal">X-Environment:</code> header field), more than one environment can be specified. Then the rules from all those environments, plus the environment-agnostic rules, will be applied. Here comes another function of rule identifiers (provided with the <code class="literal">id=</code> rule subdirective): if two rules in different environments have same identifier, then the rule from the more specific environment overrides the rule from the less specific environment. The more specific environment is normally taken to be the one encountered later in the requested environment list.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgrlfiles" id="sec-lgrlfiles"></a>8.5.2.&nbsp;Layout of Rule Files</h3>
</div>
</div>
</div>
<p>Rule files are kept simple, to facilitate easy editing without verbose syntax getting in the way. A rule file has the following layout:</p>
<pre class="programlisting">
# Title of the rule collection.
# Author name.
# License.

# Directives affecting all the rules.
<em class="replaceable"><code>global-directive</code></em>
...
<em class="replaceable"><code>global-directive</code></em>

# Rule 1.
<em class="replaceable"><code>trigger-pattern</code></em>
<em class="replaceable"><code>subdirective-1</code></em>
...
<em class="replaceable"><code>subdirective-n</code></em>

# Rule 2.
<em class="replaceable"><code>trigger-pattern</code></em>
<em class="replaceable"><code>subdirective-1</code></em>
...
<em class="replaceable"><code>subdirective-n</code></em>

...

# Rule N.
<em class="replaceable"><code>trigger-pattern</code></em>
<em class="replaceable"><code>subdirective-1</code></em>
...
<em class="replaceable"><code>subdirective-n</code></em>
</pre>
<p>The rather formal top comment (licence, etc.) is required for the rule files inside Pology distribution. In most contexts rule files are expected to have the <code class="filename">.rules</code> extension, so it is best to always use it (mandatory for internal rules files). Rule files must be UTF-8 encoded.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgrltrigpat" id="sec-lgrltrigpat"></a>8.5.3.&nbsp;Rule Triggers</h3>
</div>
</div>
</div>
<p>The rule trigger is most often a regular expression pattern, given within curly or square brackets, <code class="literal">{...}</code> or <code class="literal">[...]</code>, to match the original or the translation part of the message, respectively. The closing bracket may be followed by single-character matching modifiers, as follows:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">i</code>: case-sensitive matching for <span class="emphasis"><em>all</em></span> patterns in the rule, including but not limited to the trigger pattern. Default matching is case-insensitive.</p>
</li>
</ul>
</div>
<p>Bracketed patterns are the shorthand notation, which are sufficient most of the time. There is also the more verbose notation <code class="literal">*<em class="replaceable"><code>message-part</code></em>/<em class="replaceable"><code>regex</code></em>/<em class="replaceable"><code>modifiers</code></em></code>, where instead of <code class="literal">/</code> any other non-letter character can be used consistently as separator. The verbose notation is needed when some part of the message other than the original or the translation should be matched, or when brackets would cause balancing issues (e.g. when a closing curly bracket without the opening bracket is a part of the match for the original text). For all messages, <code class="literal"><em class="replaceable"><code>message-part</code></em></code> can be one of the following keywords:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">msgid</code>: match on original</p>
</li>
<li class="listitem">
<p><code class="literal">msgstr</code>: match on translation</p>
</li>
<li class="listitem">
<p><code class="literal">msgctxt</code>: match on disambiguating context</p>
</li>
</ul>
</div>
<p>For example, <code class="literal">{foobar}i</code> is equivalent to <code class="literal">*msgid/foobar/i</code>.</p>
<p>For plural messages, <code class="literal">msgid/.../</code> (and conversely <code class="literal">{...}</code>) tries to match either the <code class="varname">msgid</code> or the <code class="varname">msgid_plural</code> string, whereas <code class="literal">msgstr/.../</code> (and <code class="literal">[...]</code>) try to match any <code class="varname">msgstr</code> string. If only particular of these strings should be matched, the following keywords can be used as well:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">msgid_singular</code>: match only the <code class="varname">msgid</code> string</p>
</li>
<li class="listitem">
<p><code class="literal">msgid_plural</code>: match only the <code class="varname">msgid_plural</code> string</p>
</li>
<li class="listitem">
<p><code class="literal">msgstr_<em class="replaceable"><code>N</code></em></code>: match only the <code class="varname">msgstr</code> string with index <code class="literal"><em class="replaceable"><code>N</code></em></code></p>
</li>
</ul>
</div>
<p><a name="p-triggerhooks" id="p-triggerhooks"></a>When regular expressions on message strings are not sufficient as rule triggers, a hook can be used instead. Hooks are described in <a class="xref" href="#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">Section&nbsp;9.10, “Processing Hooks”</a>. Since hooks are Python functions, in principle any kind of test can be performed by them. A rule with the hook trigger is defined as follows:</p>
<pre class="programlisting">
*hook name="<em class="replaceable"><code>hookspec</code></em>" on="<em class="replaceable"><code>part</code></em>" casesens="[yes|no]"
# Rule subdirectives follow...
</pre>
<p>The <code class="literal">name=</code> field provides the hook specification. Only V* type (validation) hooks can be used in this context. The <code class="literal">on=</code> field defines on which part of the message the hook will operate, and needs to conform to the hook type. The following message parts can be specified, with associated hook types:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">msg</code>: the hook applies to the complete message; for type V4A hooks.</p>
</li>
<li class="listitem">
<p><code class="literal">msgid</code>: the hook applies to the original text (<code class="varname">msgid</code>, <code class="varname">msgid_plural</code>), but considering other parts of the message; for type V3A and V3B hooks.</p>
</li>
<li class="listitem">
<p><code class="literal">msgstr</code>: the hook applies to the translation text (all <code class="varname">msgstr</code> strings), but considering other parts of the message; for type V3A and V3C hooks.</p>
</li>
<li class="listitem">
<p><code class="literal">pmsgid</code>: the hook applies to the original text, without considering the rest of the message; for type V1A hooks.</p>
</li>
<li class="listitem">
<p><code class="literal">pmsgstr</code>: the hook applies to the translation, without considering the rest of the message; for type V1A hooks.</p>
</li>
</ul>
</div>
<p>The <code class="literal">casesens=</code> field in trigger hook specification controls whether the patterns in the rest of the rule (primarily in <code class="literal">valid</code> subdirectives) are case-sensitive or not. This field can be omitted, and then patterns are case-sensitive.</p>
<p>If the rule trigger pattern matches (or the trigger hook reports some problems), the message is by default considered "failed" by the rule. The message may be still passed by subdirectives that follow, which test if some additional conditions hold.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgrlsubdirs" id="sec-lgrlsubdirs"></a>8.5.4.&nbsp;Rule Subdirectives</h3>
</div>
</div>
</div>
<p>There are several types of rule subdirectives. The main subdirective is <code class="literal">valid</code>, which provides additional tests to pass the message failed by the trigger pattern. The tests are given by a list of <code class="literal"><em class="replaceable"><code>name</code></em>="<em class="replaceable"><code>pattern</code></em>"</code> entries. For a <code class="literal">valid</code> directive to pass the message, all its tests must hold, and if any of the <code class="literal">valid</code> directives passes the message, then the rule as whole passes it. Effectively, this means the boolean AND relationship within a directive, and OR across directives.</p>
<p>The following tests are currently available in <code class="literal">valid</code> subdirectives:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">msgid="<em class="replaceable"><code>REGEX</code></em>"</code></span></dt>
<dd>
<p>The original text (<code class="varname">msgid</code> or <code class="varname">msgid_plural</code> string) must match the regular expression.</p>
</dd>
<dt><span class="term"><code class="literal">msgstr="<em class="replaceable"><code>REGEX</code></em>"</code></span></dt>
<dd>
<p>The translation (any <code class="varname">msgstr</code> string) must match the regular expression.</p>
</dd>
<dt><span class="term"><code class="literal">ctx="<em class="replaceable"><code>REGEX</code></em>"</code></span></dt>
<dd>
<p>The disambiguating context (<code class="varname">msgctxt</code> string) must match the regular expression.</p>
</dd>
<dt><span class="term"><code class="literal">srcref="<em class="replaceable"><code>REGEX</code></em>"</code></span></dt>
<dd>
<p>The file path of one of the source references (in <code class="literal">#: ...</code> comment) must match the regular expression</p>
</dd>
<dt><span class="term"><code class="literal">comment="<em class="replaceable"><code>REGEX</code></em>"</code></span></dt>
<dd>
<p>One of the extracted or translator comments (<code class="literal">#. ...</code> or <code class="literal"># ...</code>) must match the regular expression.</p>
</dd>
<dt><span class="term"><code class="literal">span="<em class="replaceable"><code>REGEX</code></em>"</code></span></dt>
<dd>
<p>The text segment matched by the trigger pattern must match this regular expression as well.</p>
</dd>
<dt><span class="term"><code class="literal">before="<em class="replaceable"><code>REGEX</code></em>"</code></span></dt>
<dd>
<p>The text segment matched by the trigger pattern must be placed exactly before one of the text segments matched by this regular expression.</p>
</dd>
<dt><span class="term"><code class="literal">after</code></span></dt>
<dd>
<p>The text segment matched by the trigger pattern must be placed exactly after one of the text segments matched by this regular expression.</p>
</dd>
<dt><span class="term"><code class="literal">cat="<em class="replaceable"><code>DOMAIN1</code></em>,<em class="replaceable"><code>DOMAIN2</code></em>,..."</code></span></dt>
<dd>
<p>The PO domain name (i.e. MO file name without <code class="filename">.mo</code> extension) must be contained in the given comma-separated list of domain names.</p>
</dd>
<dt><span class="term"><code class="literal">catrx="<em class="replaceable"><code>REGEX</code></em></code></span></dt>
<dd>
<p>The PO domain name must match the regular expression.</p>
</dd>
<dt><span class="term"><code class="literal">env="<em class="replaceable"><code>ENV1</code></em>,<em class="replaceable"><code>ENV2</code></em>,..."</code></span></dt>
<dd>
<p>The operating environment must be contained in the given comma-separated list of environment keywords.</p>
</dd>
<dt><span class="term"><code class="literal">head="/<em class="replaceable"><code>FIELD-REGEX</code></em>/<em class="replaceable"><code>VALUE-REGEX</code></em>"</code></span></dt>
<dd>
<p>The PO file header must contain the field and value combination, each specified by a regular expression pattern. Instead of <code class="literal">/</code>, any other character may be used consistently as delimiter for the field regular expression.</p>
</dd>
</dl>
</div>
<p>Each test can be negated by prefixing it with <code class="literal">!</code>. For example, <code class="literal">!cat="foo,bar"</code> will match if the PO domain name is neither <code class="literal">foo</code> nor <code class="literal">bar</code>. Tests are "short-circuiting", so it is good for performance to put simple direct matching tests (e.g. <code class="literal">cat=</code>, <code class="literal">env=</code>) before more more expensive regular expression tests (<code class="literal">msgid=</code>, <code class="literal">msgstr=</code>, etc.).</p>
<p>Subdirectives other than <code class="literal">valid</code> set states and properties of the rule. The property directives are written simply as <code class="literal"><em class="replaceable"><code>property</code></em>="<em class="replaceable"><code>value</code></em>"</code>. These include:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">hint</code></span></dt>
<dd>
<p>A note to show to the user when the rule fails a message.</p>
</dd>
<dt><span class="term"><code class="literal">id</code></span></dt>
<dd>
<p>An "almost unique" identifier for the rule (see <a class="xref" href="#sec-lgrlenvs" title="8.5.6.&nbsp;Effect of Rule Environments">Section&nbsp;8.5.6, “Effect of Rule Environments”</a>).</p>
</dd>
</dl>
</div>
<p>State directives are given by the directive name, possibly followed by keyword parameters: <code class="literal"><em class="replaceable"><code>directive</code></em> <em class="replaceable"><code>arg1</code></em> ...</code>. These can be:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">validGroup <em class="replaceable"><code>GROUPNAME</code></em></code></span></dt>
<dd>
<p>Includes a previously defined standalone group of <code class="literal">valid</code> subdirectives.</p>
</dd>
<dt><span class="term"><code class="literal">environment <em class="replaceable"><code>ENVNAME</code></em></code></span></dt>
<dd>
<p>Sets the environment in which the rule is applied.</p>
</dd>
<dt><span class="term"><code class="literal">disabled</code></span></dt>
<dd>
<p>Disables the rule, so that it is no longer applied to messages. Disabled rule can still be applied by direct request (e.g. using the <code class="option">rule:</code> parameter of <span class="command"><strong>check-rules</strong></span> sieve).</p>
</dd>
<dt><span class="term"><code class="literal">addFilterRegex</code>, <code class="literal">addFilterHook</code>, <code class="literal">removeFilter</code></span></dt>
<dd>
<p>A group of subdirectives to define filters which are applied to messages before the rule is applied to them. See <a class="xref" href="#sec-lgrlfilter" title="8.5.7.&nbsp;Filtering Messages">Section&nbsp;8.5.7, “Filtering Messages”</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgrlglobdirs" id="sec-lgrlglobdirs"></a>8.5.5.&nbsp;Global Directives in Rule Files</h3>
</div>
</div>
</div>
<p>Global directives are typically placed at the beginning of a rule file, before any rules. They define common elements for all rules to use, or set state for all rules below them. A global directive can also be placed in the middle of the rule file, between two rules, when it will affect all the rules that follow it, but not those that precede it. The following global directives are defined:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">validGroup</code></span></dt>
<dd>
<p>Defines common groups of <code class="literal">valid</code> subdirectives, which can be included by any rule using the <code class="literal">validGroup</code> subdirective:</p>
<pre class="programlisting">
# Global validity group.
validGroup passIfQuoted
valid after="“" before="”"
valid after="‘" before="’"

....

# Rule X.
{...}
validGroup passIfQuoted
valid ...
...

# Rule Y.
{...}
validGroup passIfQuoted
valid ...
...
</pre></dd>
<dt><span class="term"><code class="literal">environment</code></span></dt>
<dd>
<p>Sets a specific environment for the rules that follow, unless overriden with the namesake rule subdirective:</p>
<pre class="programlisting">
# Global environment.
environment FOO

...

# Rule X, belongs to FOO.
{...}
...

# Rule Y, overrides to BAR.
{...}
environment BAR
...
</pre>
<p>See <a class="xref" href="#sec-lgrlenvs" title="8.5.6.&nbsp;Effect of Rule Environments">Section&nbsp;8.5.6, “Effect of Rule Environments”</a> for details on use of environments.</p>
</dd>
<dt><span class="term"><code class="literal">include</code></span></dt>
<dd>
<p>Used to include files into rule files:</p>
<pre class="programlisting">
include file="foo.something"
</pre>
<p>If the file to include is specified by relative path, it is taken as relative to the file which includes it.</p>
<p>The intent behind <code class="literal">include</code> directive is not to include one rule file into another (files with <code class="filename">.rules</code> extension), because normally all rule files in a directory are automatically included by the rule applicator (e.g. <span class="command"><strong>check-rules</strong></span> sieve). Instead, files that are included should have an extension different from <code class="filename">.rules</code>, and contain a number of directives needed in several rule files; for example, a set of <a class="link" href="#sec-lgrlfilter" title="8.5.7.&nbsp;Filtering Messages">filters</a>.</p>
</dd>
<dt><span class="term"><code class="literal">addFilterRegex</code>, <code class="literal">addFilterHook</code>, <code class="literal">removeFilter</code></span></dt>
<dd>
<p>A group of directives to define filters which are applied to messages before the rules are applied. See <a class="xref" href="#sec-lgrlfilter" title="8.5.7.&nbsp;Filtering Messages">Section&nbsp;8.5.7, “Filtering Messages”</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgrlenvs" id="sec-lgrlenvs"></a>8.5.6.&nbsp;Effect of Rule Environments</h3>
</div>
</div>
</div>
<p>When there are no <code class="literal">environment</code> directives in a rule file, either global or as rule subdirectives, then all rules in that rule file are considered as being "environment-agnostic". When applying a rule set (e.g. with the <span class="command"><strong>check-rules</strong></span> sieve), the applicator may be put into one or more <span class="emphasis"><em>operating environments</em></span>, either by specifying them as arguments (e.g. in command line) or in PO file headers. If one or more operating environments are given and the rule is environment-agnostic, it will be applied to the message irrespective of the operating environments. However, if there were some <code class="literal">environment</code> directives in the rule file, some rules will be environment-specific. An environment-specific rule will be applied only if its environment matches one of the set operating environments.</p>
<p>Rule environments are used to control application of rules between different translation environments (projects, teams, people). Some rules may be common to all environments, some may be somewhat common, and some not common at all. Common rules would than be made environment-agnostic (i.e. not covered by any <code class="literal">environment</code> directive), while entirely non-common rules would be provided in separate rule files per environment, with one global <code class="literal">environment</code> directive in each.</p>
<p>How to handle "somewhat" common rules depends on circumstances. They could simply be defined as environment-specific, just like non-common rules, but this may reduce the amount of common rules too much for the sake of perculiar environments. Another way would be to define them as environment-agnostic, and then override them in certain environments. This is done by giving the environment-specific rule the same identifier (<code class="literal">id</code> subdirective) as that of the environment-agnostic rule. It may also happen that the bulk of the rule is environment-agnostic, except for a few tests in <code class="literal">valid</code> subdirectives which are not. In this case, <code class="literal">env=</code> and <code class="literal">!env=</code> tests can be used to differentiate between environments.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgrlfilter" id="sec-lgrlfilter"></a>8.5.7.&nbsp;Filtering Messages</h3>
</div>
</div>
</div>
<p>It is frequently advantageous to apply a set of rules not on the message as it is, but on a suitably filtered variant. For example, if rules are used for terminology checks, it would be good to remove any markup from the text; otherwise, an <code class="literal">&lt;email&gt;</code> tag in the original could be understood as a real word, and a warning issued for missing the expected counterpart in the translation.</p>
<p>Filters sets are created using <code class="literal">addFilter*</code> directives, global or within rules:</p>
<pre class="programlisting">
# Remove XML-like tags.
addFilterRegex match="&lt;.*?&gt;" on="pmsgid,pmsgstr"
# Remove long command-line options.
addFilterRegex match="--[\w-]+" on="pmsgid,pmsgstr"

# Rule A will act on a message filtered by previous two directives.
{...}
...

# Remove function calls like foo(x, y).
addFilterRegex match="\w+\(.*?\)" on="pmsgid,pmsgstr"

# Rule B will act on a message filtered by previous three directives.
{...}
...
</pre>
<p>Filters are added cumulatively to the filter set, and the current set is affecting all the rules below it.<sup>[<a name="id698929" href="#ftn.id698929" class="footnote" id="id698929">34</a>]</sup> If a <code class="literal">addFilter*</code> directive appears within the rule, it adds a filter only to the filter set of that rule:</p>
<pre class="programlisting">
# Rule C, with an additional filter just for itself.
{...}
addFilterRegex match="grep\(1\)" on="pmsgstr"
...

# Rule D, sees only previous global filter additions.
{...}
...
</pre>
<p>These examples illustrate use of the <code class="literal">addFilterRegex</code> directive, which is described in more detail below, as well as other <code class="literal">addFilter*</code> directives.</p>
<p>All <code class="literal">addFilter*</code> have the <code class="literal">on=</code> field. It specifies the message part on which the filter should operate, similar to the <code class="literal">on=</code> field in hook rule triggers. Unlike in triggers, in filters it is possible to state several parts to filter, as comma-separated list. The following message parts are exposed for filtering:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">msg</code>: filter the "complete" message. What this means exactly depends on the particular filter directive.</p>
</li>
<li class="listitem">
<p><code class="literal">msgid</code>: filter the original text (<code class="varname">msgid</code>, <code class="varname">msgid_plural</code>), but possibly taking into account other parts of the message.</p>
</li>
<li class="listitem">
<p><code class="literal">msgstr</code>: filter the translation (all <code class="varname">msgstr</code> strings), but possibly taking into account other parts of the message.</p>
</li>
<li class="listitem">
<p><code class="literal">pmsgid</code>: filter the original text.</p>
</li>
<li class="listitem">
<p><code class="literal">pmsgstr</code>: filter the translation.</p>
</li>
<li class="listitem">
<p><code class="literal">pattern</code>: a quasi-part, to filter not the message, but all matching patterns (regular expressions, substring tests, equality tests) in the rules themselves.</p>
</li>
</ul>
</div>
<p>Not all filter directives can filter on all of these parts. Admissible parts are listed with each filter directive.</p>
<p>To remove a filter from the current filter set, <code class="literal">addFilter*</code> directives can define the filter <span class="emphasis"><em>handle</em></span>, which can then be given to a <code class="literal">removeFilter</code> directive:</p>
<pre class="programlisting">
addFilterRegex match="&lt;.*?&gt;" on="pmsgid,pmsgstr" handle="tags"

# Rule A, "tags" filter applies to it.
{...}
...

# Rule B, removes "tags" filter only for itself.
{...}
removeFilter handle="tags"
...

# Rule C, "tags" filter applies to it again.
{...}
...

removeFilter handle="tags"

# Rule D, "tags" filter does not apply to it and any following rule.
{...}
...
</pre>
<p>Several filters may share the same handle, in which case the <code class="literal">removeFilter</code> directive removes all of them from the current filter set. One filter can have more than one handle, given as comma-separated list of handles in <code class="literal">handle=</code> field, and then it can be removed from the filter set by any of those handles. Likewise, the <code class="literal">handle=</code> field in <code class="literal">removeFilter</code> directive can state several handles by which to remove filters. <code class="literal">removeFilter</code> as rule subdirective influences the complete rule, regardless of its position among other subdirectives.</p>
<p><code class="literal">clearFilters</code> directive is used to completely clear the filter set. It has no fields. Like <code class="literal">removeFilter</code>, it can be issued either globally, or as rule subdirective.</p>
<p>A filter may be added or removed only in certain environments, specified by the <code class="literal">env=</code> field in <code class="literal">addFilter*</code> and <code class="literal">removeFilter</code> directives.</p>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-lgrlfiltdirs" id="sec-lgrlfiltdirs"></a>8.5.7.1.&nbsp;Filter Directives</h4>
</div>
</div>
</div>
<p>Currently the following directives for adding filters are available:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">addFilterRegex</code></span></dt>
<dd>
<p>Parts of the text to remove are determined by a regular expression match. The pattern is given by the <code class="literal">match=</code> field. If instead of simple removal of the matched segment the replacement is wanted, the <code class="literal">repl=</code> field is used to specify the replacement string (it can include backreferences to regex groups in the pattern):</p>
<pre class="programlisting">
# Replace in translation the %&lt;number&gt; format directives with a tilde.
addFilterRegex match="%\d+" repl="~" on="pmsgstr"
</pre>
<p>Case-sensitivity of matching can be changed by adding the <code class="literal">casesens=[yes|no]</code> field; default is case-sensitive matching.</p>
<p>Applicable (<code class="literal">on=</code> field) to <code class="literal">pmsgid</code>, <code class="literal">pmsgstr</code>, and <code class="literal">pattern</code>.</p>
</dd>
<dt><span class="term"><code class="literal">addFilterHook</code></span></dt>
<dd>
<p>Text is processed with a filtering hook (F* hook types). The hook specification is given by the <code class="literal">name=</code> field. For example, to remove accelerator markers from UI messages in a smart way, while checking various sources for the exact accelerator marker character (command line, PO file header), this filter can be set:</p>
<pre class="programlisting">
addFilterHook name="remove/remove-accel-msg" on="msg"
</pre>
<p>Applicable (<code class="literal">on=</code> field) to <code class="literal">msg</code> (for F4A hooks), <code class="literal">msgid</code> (F3A, F3B), <code class="literal">msgstr</code> (F3A, F3C), <code class="literal">pmsgid</code> (F1A), <code class="literal">pmsgstr</code> (F1A), and <code class="literal">pattern</code> (F1A).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-lgrlfiltercost" id="sec-lgrlfiltercost"></a>8.5.7.2.&nbsp;Cost of Filtering</h4>
</div>
</div>
</div>
<p>Filtering may be run-time expensive, and it normally is in practical uses. Therefore the rule applicator will try to create and apply as few unique filter sets as possible, by considering their signatures -- a hash of ordering, type, and fields in the filter set for the given rule. Each message will be filtered only as many times as there are different filter sets, rather than once for every rule. The appropriate filtered version of the message will be given to each rule according to its filter set.</p>
<p>This means that you should be careful when adding and removing filters, in order to have as few filter sets as really necessary. For example, you may know that filters P and Q can be applied in any order, and in one rule file specify P followed by Q, but in another rule file Q followed by P. However, the rule applicator must assume that the order of filters is significant, so it will create two filter sets, PQ and QP, and spend twice as much time in filtering.</p>
<p>For big filter sets which are needed in several rule files, the best is to split them out in a separate file and use the <code class="literal">include</code> global directive to include them at the beginning of rule files.</p>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgrlquotesc" id="sec-lgrlquotesc"></a>8.5.8.&nbsp;Quoting and Escaping</h3>
</div>
</div>
</div>
<p>In all the examples so far, ASCII double quotes were used as value delimiters (<code class="literal">"..."</code>). However, just as in the verbose notation for trigger patterns (<code class="literal">*msgid/.../</code>, etc.), all quoted values can in fact consistently use any other non-alphanumeric character (e.g. single quote, slash, etc.). On the other hand, literal quotes inside a value can be escaped by prefixing them with <code class="literal">\</code> (backslash). Values which are regular expression are sent to the regular expression engine without resolving any escapes other than for the quote character itself.</p>
<p>The general statement terminator in a rule file is the newline, but if a line would be too long, it can be continued into the next line by putting <code class="literal">\</code> (backslash) in the last column.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgrlfalse" id="sec-lgrlfalse"></a>8.5.9.&nbsp;Canceling False Positives</h3>
</div>
</div>
</div>
<p>As it was explained earlier, it is very important to have a through system of handling false positives in validation rules. There are several levels on which false positives can be canceled, and they will be described in the following, going from the nearest to the furthest from the rule definition itself. Some guidelines on when to use which level will also be provided, but you should keep in mind that this is far from a well-examined topic.</p>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-lgrlfpdisable" id="sec-lgrlfpdisable"></a>8.5.9.1.&nbsp;Disabling a Rule</h4>
</div>
</div>
</div>
<p>The <code class="literal">disable</code> subdirective can be added to the rule to disable its application. This may seem a quaint method of "handling false positivies", but it is not outright ridiculous, because a disabled rule can still be applied by directly requesting it (e.g. <code class="option">rule:</code> parameter of <span class="command"><strong>check-rules</strong></span>). This is useful for rules which produce too many false positivies to be applied as part of a rule set, but which are still better than ad-hoc searches. In other words, such rules can be understood as codified special searches, to be run only when the user has enough time to wade through all the false positives in search for the few real problems.</p>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-lgrlfptrigger" id="sec-lgrlfptrigger"></a>8.5.9.2.&nbsp;Restricting the Rule Trigger</h4>
</div>
</div>
</div>
<p>The first real way of canceling false positives is by making the regular expression pattern for the rule trigger less greedy. For example, the trigger pattern for the terminology rule on "tool" could be written at first as:</p>
<pre class="programlisting">
{\btool}i
</pre>
<p>This will match any word that starts with <code class="literal">tool</code>, due to <code class="literal">\b</code> word boundary token at pattern start. The word boundary is not repeated at the end with the intention to also catch the plural form of the word, "tools". But, this pattern will also match the word "toolbar", which may have its own rule. Then, the pattern can be restricted to really match only "tool" and "tools", in several ways, for example:</p>
<pre class="programlisting">
{\btools?\b}i
</pre>
<p>Now the word boundary is placed at the end as well, but also the optional letter 's' is inserted (<code class="literal">?</code> means "zero or one appearance of the preceding element"). Another way would be to write out both forms in full:</p>
<pre class="programlisting">
{\b(tool|tools)\b}i
</pre>
<p>The brackets are needed because the OR-operator <code class="literal">|</code> has lower priority than word boundary <code class="literal">\b</code>, so without brackets the meaning would be "word which starts with 'tool' or ends with 'tools'".</p>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-lgrlfpvaldir" id="sec-lgrlfpvaldir"></a>8.5.9.3.&nbsp;Adding <code class="literal">valid</code> Subdirectives to the Rule</h4>
</div>
</div>
</div>
<p>Python's regular expressions, used in rule patterns, have rich special features, but which are frequently better not used in rules. For example, the trigger for the terminology rule on "line" (of text) could be written at first as:</p>
<pre class="programlisting">
{\blines?\b}i
</pre>
<p>But this would also catch the phrase "command line", which as a standalone concept, may have its own rule. To avoid this match, a proficient user of regular expressions may think of adding a <span class="emphasis"><em>negative lookbehind</em></span> to the trigger pattern:</p>
<pre class="programlisting">
{(?&lt;!command )\blines?\b}i
</pre>
<p>However, it is much less cryptic and more extensible to add a <code class="literal">valid</code> subdirective instead:</p>
<pre class="programlisting">
{\blines?\b}i
valid after="command "
</pre>
<p>This cancels the rule if the word "line" was matched just after the word "command", while clearly showing the special-case context.</p>
<p><code class="literal">valid</code> subdirectives are particularly useful for wider rule cancelations, such as by PO domain (catalog) name. For example, the word "wizard" could be translated differently when denoting a step-by-step dialog in a utilitarian program and a learned magic wielding character in a computer game. Then the <code class="literal">cat=</code> test can be used to allow the other term in the game's PO file:</p>
<pre class="programlisting">
{\bwizard}i
valid msgstr="<em class="replaceable"><code>term-for-step-by-step-dialog</code></em>"
valid cat="foodungeon" msgstr="<em class="replaceable"><code>term-for-magician</code></em>"
</pre>
<p>This requires specifying the domain names of all games with wizard characters to which the rule set is applied, which may not be that comfortable. Another way could be to introduce the <code class="literal">fantasy</code> environment and use the <code class="literal">env=</code> test:</p>
<pre class="programlisting">
{\bwizard}i
valid msgstr="<em class="replaceable"><code>term-for-step-by-step-dialog</code></em>"
valid env="fantasy" msgstr="<em class="replaceable"><code>term-for-magician</code></em>"
</pre>
<p>and to add the <code class="literal">fantasy</code> environment <a class="link" href="#hdr-x-environment">into the header</a> of the PO file that needs it.</p>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-lgrlfpskip" id="sec-lgrlfpskip"></a>8.5.9.4.&nbsp;Skipping the Rule on a Message</h4>
</div>
</div>
</div>
<p>Sometimes there is just a single strange message that falsely triggers the rule, such that there is nothing to generalize about the false positive. You could still cancel this false positivie in the rule definition itself, by adding a <code class="literal">valid</code> directive with the <code class="literal">cat=</code> test for the PO domain name and <code class="literal">msgid=</code> test to single out the troublesome message:</p>
<pre class="programlisting">
{\bfroobaz}i
id="term-frobaz"
valid msgstr="..."
valid cat="foo" msgid="the amount of froobaz-HX which led to"
</pre>
<p>However, rules are supposed to be at least somewhat general, and singling out a particular message in the rule is as excessive non-generality as it gets. It is also a maintenance problem: the message may dissapear in the future, leaving cruft in the rule file, or it may change slightly, but enough for the <code class="literal">msgid=</code> test not to match it any more.</p>
<p>A much better way of skipping a rule on a particular message is by adding a special translator comment to that message, in the PO file:</p>
<pre class="programlisting">
# skip-rule: term-froobaz
msgid "...the amount of froobaz-HX which led to..."
msgstr "..."
</pre>
<p>The comment starts with <code class="literal">skip-rule:</code>, and is followed by a comma-separated list of rules to skip, by their identifiers (defined by <code class="literal">id=</code> in the rule).</p>
<p>There is a catch to the translator comment approach, though. When a with <code class="literal">skip-rule:</code> comment message becomes fuzzy, it depends on the new text of the message whether the comment should be kept or removed. This means that on fuzzy messages translators have to observe and adapt translator comments just as they adapt the <code class="varname">msgstr</code> strings. Unfortunatelly, some translators do not pay sufficient attention to translator comments, which is further exacerbated by some PO editors which underrepresent translator comments in the user interface (or even do not enable editing them). However, from the point of view of PO translation workflow, not giving full attention to translator comments is plainly an error: translators should be told better, and PO editors should be upgraded.<sup>[<a name="id624093" href="#ftn.id624093" class="footnote" id="id624093">35</a>]</sup></p>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-lgrlfpreworig" id="sec-lgrlfpreworig"></a>8.5.9.5.&nbsp;Rewriting Original Text of a Message</h4>
</div>
</div>
</div>
<p>Sometimes it is possible to do better than plainly skipping a rule on a message. Consider the following message:</p>
<pre class="programlisting">
#: dialogs/ScriptManager.cpp:498
msgid "Please refer to the console debug output for more information."
msgstr "Pogledajte ispravljački izlaz u školjci za više podataka."
</pre>
<p>An observant translator could conclude that "console" is not the best choice of term in the original text, that "shell" (or "terminal") would be more accurate, and translate the message as if the more accurate term was used in the original. However, this could cause the terminology rule for "console" (in its accurate meaning) to complain about the proper term missing in translation. Adding <code class="literal">skip-rule: term-console</code> comment would indeed cancel this false positive, but what about the terminology rule on "shell"? There is nothing in the original text to trigger it and check for the proper term in translation.</p>
<p>This example is an instance of the general case where the translator would formulate the original text somewhat differently, and make the translation based on that reformulation. Or, when the mere style of the original causes a rule to be falsely triggered, while diferently worded original would be just fine. In such cases, instead of adding a comment to crudely skip a rule, translator can add a comment to <span class="emphasis"><em>rewrite</em></span> the original text before applying rules to it:</p>
<pre class="programlisting">
# rewrite-msgid: /console/shell/
#: dialogs/ScriptManager.cpp:498
msgid "Please refer to the console debug output for more information."
msgstr "Pogledajte ispravljački izlaz u školjci za više podataka."
</pre>
<p>The rewrite directive comment starts with <code class="literal">rewrite-msgid:</code> and is followed by search regular expression and replacement strings, delimited with <code class="literal">/</code> or another non-alphanumeric character. With this rewrite, the wrong terminology rule, for "console", will not be triggered, while the correct rule, for "shell", will be.</p>
<p>At the moment, unlike <code class="literal">skip-rule:</code>, <code class="literal">rewrite-msgid:</code> is not an integral part of the rule system. It is instead implemented as a filtering hook. So to use it, add this filter into rule files (or into the filter set file included by rule files):</p>
<pre class="programlisting">
addFilterHook name="remove/rewrite-msgid" on="msg"
</pre>
<p>Sometimes it is not quite clear whether to skip a rule or rewrite the original, that is, whether to use <code class="literal">skip-rule:</code> or <code class="literal">rewrite-msgid:</code> comment. A guideline could be as follows. If the concept covered by the falsely triggered rule is present but somewhat camouflaged in the original, or one concept is switched for another (such as "console" with "shell" in the example above), then <code class="literal">rewrite-msgid:</code> should be used to "normalize" the original text. If the original text has nothing to do with the concept covered by the triggered rule, then <code class="literal">skip-rule:</code> should be used. An example of the latter would be such a message from a game:</p>
<pre class="programlisting">
# skip-rule: term-shell
# src/tanks_options.cpp:249
msgid "Fire shells upward"
</pre>
<p>Here the word "shell" denotes a cannon shell, which has nothing to do with <code class="literal">term-shell</code> rule for the operating system shell, and the rule is therefore skipped.</p>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-lgsynder" id="sec-lgsynder"></a>8.6.&nbsp;Syntagma Derivation</h2>
</div>
</div>
</div>
<p>Consider a message extracted from a .desktop file, representing the name of a GUI utility:</p>
<pre class="programlisting">
#. field: Name
#: data/froobaz.desktop:5
msgid "Froobaz Image Examiner"
msgstr ""
</pre>
<p>Program names from .desktop files can be read and presented to the user by any other program. For example, when an image is right-clicked in a file browser, it could offer to open the file with the utility named with this message. In the PO file of that file browser, the message for the menu item could be:</p>
<pre class="programlisting">
#. TRANSLATORS: %s is a program name, to open a file with.
#: src/contextmenu.c:5
msgid "Open with %s"
msgstr ""
</pre>
<p>In languages featuring noun inflection, it is likely that the program name in this message should have the grammar case different from the nominative (basic) case. This means that simply inserting the name read from the .desktop file, into directly translated text, will produce a grammatically incorrect phrase. Translator may try to adapt the message to the nominative form of the name (by shuffling words, adding "helper" words, adding punctuation), but this will produce stylistically suboptimal phrase. That is, style will be sacrificed for grammar. In order not to have to make such compromises, now and in the future certain <span class="emphasis"><em>translation scripting</em></span> systems may be available atop the PO format<sup>[<a name="id666047" href="#ftn.id666047" class="footnote" id="id666047">36</a>]</sup>, which would, in this example, enable the translator to specify which non-nominative form of the program name to fetch and insert.</p>
<p>Whatever the shape the translation scripting system takes, different forms of phrases have to be derived somehow for use by that system. Given the nuances of spoken languages, fully automatic derivation is probably not going to be possible<sup>[<a name="id666074" href="#ftn.id666074" class="footnote" id="id666074">37</a>]</sup>. Pology therefore provides the <span class="emphasis"><em>syntagma<sup>[<a name="id666090" href="#ftn.id666090" class="footnote" id="id666090">38</a>]</sup> derivator</em></span> system (<span class="emphasis"><em>synder</em></span> for short), which allows manual derivation of phrase forms and properties with minimal verbosity, using macro expansion based on partial regularities in the grammar.</p>
<p>Syntagma derivations can be written and maintained in a standalone plain text file, although currently Pology provides no end-user functionality to convert such files (i.e. derive all forms defined by them) to formats which a target translation system could consume. Instead, one can make use of the <code class="classname">Synder</code> class from the <span class="package">pology.synder</span> module to construct a custom converters. Of course, in the future, such converters may become part of Pology. There are already syntax highlighting definitions for the synder file format, for some text editors, in the <code class="filename">syntax/</code> directory of Pology distribution.</p>
<p>What is provided right now in terms of end-user functionality is <a class="link" href="#sv-collect-pmap" title="3.5.12.&nbsp;collect-pmap">the <span class="command"><strong>collect-pmap</strong></span> sieve</a>. It enables translators to write syntagma derivations in translator comments in PO messages, and then extract them (deriving all forms) into a file in the appropriate format for the target translation system. The example message above from the .desktop file could be equipped with a synder entry like this:</p>
<pre class="programlisting">
# synder: Frubaz|ov ispitiv|ač slika
#. field: Name
#: data/froobaz.desktop:5
msgid "Froobaz Image Examiner"
msgstr "Frubazov ispitivač slika"
</pre>
<p>The translator comment starts with the keyword <code class="literal">synder:</code>, and is followed by the synder entry which defines all the needed forms of the translated name. What you can see is that the synder entry is quite compact, exactly two characters longer than the pure translated name, and yet it defines over a dozen forms and some properties (gender, number) of the name.</p>
<p>The rest of this section describes the syntax of synder entries, and the layout and organization of synder files. As an example application, we consider a dictionary of proper names, where for each name in the source language we want to define the basic name and some of its forms and properties in the target language.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgsdbasic" id="sec-lgsdbasic"></a>8.6.1.&nbsp;Basic Derivations</h3>
</div>
</div>
</div>
<p>For the name in source language <span class="emphasis"><em>Venus</em></span> and in target language <span class="emphasis"><em>Venera</em></span>, we could write the following simplest derivation, which defines only the basic form in the target language:</p>
<pre class="programlisting">
Venus: =Venera
</pre>
<p><code class="literal">Venus</code> is the <span class="emphasis"><em>key syntagma</em></span> or the <span class="emphasis"><em>derivation key</em></span>, and it is separated by the colon (<code class="literal">:</code>) from the properties of the syntagma. Properties are written as <code class="literal"><em class="replaceable"><code>key</code></em>=<em class="replaceable"><code>value</code></em></code> pairs, and separated by commas; in <code class="literal">=Venera</code>, the <span class="emphasis"><em>property key</em></span> is the empty string, and the <span class="emphasis"><em>property value</em></span> is <code class="literal">Venera</code>.</p>
<p>We would now like to define some grammar cases in the target language. <span class="emphasis"><em>Venera</em></span> is the nominative (basic) case, so instead of the empty string we set <code class="literal">nom</code> as its property key. Other cases that we want to define are genitive (<code class="literal">gen</code>) <span class="emphasis"><em>Venere</em></span>, dative (<code class="literal">dat</code>) <span class="emphasis"><em>Veneri</em></span>, and accusative (<code class="literal">acc</code>) <span class="emphasis"><em>Veneru</em></span>. Then we can write:</p>
<pre class="programlisting">
Venus: nom=Venera, gen=Venere, dat=Veneri, acc=Veneru
</pre>
<p>By this point, everything is written out manually, there are no "macro derivations" to speak of. But observe the difference between different grammar cases of <span class="emphasis"><em>Venera</em></span> -- only the final letter is changing. Therefore, we first write the following <span class="emphasis"><em>base derivation</em></span> for this system of case endings alone, called <code class="literal">declension-1</code>:</p>
<pre class="programlisting">
|declension-1: nom=a, gen=e, dat=i, acc=u
</pre>
<p>A base derivation is normally also <span class="emphasis"><em>hidden</em></span>, by prepending <code class="literal">|</code> (pipe) to its key syntagma. We make it hidden because it should be used only in other derivations, and does not represent a proper entry in our dictionary example. In the processing stage, derivations with hidden key syntagmas will not be offered on queries into dictionary. We can now use this base derivation to shorten the derivation for <span class="emphasis"><em>Venus</em></span>:</p>
<pre class="programlisting">
Venus: Vener|declension-1
</pre>
<p>Here <code class="literal">Vener</code> is the <span class="emphasis"><em>root</em></span>, and <code class="literal">|declension-1</code> is the <span class="emphasis"><em>expansion</em></span>, which references the previously defined base derivation. The final forms are derived by inserting the property values found in the expansion (<code class="literal">a</code> from <code class="literal">nom=a</code>, <code class="literal">e</code> from <code class="literal">gen=e</code>, etc.) at the position where the expansion occurs, for each of the property keys found in the expansion, thus obtaining the desired properties (<code class="literal">nom=Venera</code>, <code class="literal">gen=Venere</code>, etc.) for the current derivation.</p>
<p>Note that <code class="literal">declension-1</code> may be a too verbose name for the base derivation. If the declension type can be identified by the stem of the nominative case (here <code class="literal">a</code>), to have much more natural derivations we could write:</p>
<pre class="programlisting">
|a: nom=a, gen=e, dat=i, acc=u
Venus: Vener|a
</pre>
<p>Now the derivation looks just like the nominative case alone, only having the root and the stem separated by <code class="literal">|</code>.</p>
<p>The big gain of this transformation is, of course, when there are many syntagmas having the same declension type. Other such source-target pairs could be <span class="emphasis"><em>Earth</em></span> and <span class="emphasis"><em>Zemlja</em></span>, <span class="emphasis"><em>Europe</em></span> and <span class="emphasis"><em>Evropa</em></span>, <span class="emphasis"><em>Rhea</em></span> and <span class="emphasis"><em>Reja</em></span>, so we can write:</p>
<pre class="programlisting">
|a: nom=a, gen=e, dat=i, acc=u
Venus: Vener|a
Earth: Zemlj|a
Europe: Evrop|a
Rhea: Rej|a
</pre>
<p>From this it can also be seen that derivations are terminated by newline. If necessary, single derivation can be split into several lines by putting a <code class="literal">\</code> character (backslash) at the end of each line but the last.</p>
<p>Expansions are implicitly terminated by a whitespace or a comma, or by another expansion. If these characters are part of the expansion itself (i.e. of the key syntagma of the derivation that the expansion refers to), or the text continues right after the expansion without a whitespace, curly brackets can be used to explicitly delimit the expansion:</p>
<pre class="programlisting">
Alpha Centauri: Alf|{a}-Kentaur
</pre>
<p>Any character which is special in the current context may be escaped with a backslash. Only the second colon here is the separator:</p>
<pre class="programlisting">
Destination\: Void: Odredišt|{e}: ništavilo
</pre>
<p>because the first colon is escaped, and the third colon is not in the context where colon is a special character.</p>
<p>A single derivation may state more than one key syntagma, comma-separated. For example, if the syntagma in source language has several spellings:</p>
<pre class="programlisting">
Iapetus, Japetus: Japet|
</pre>
<p>The key syntagma can also be an empty string. This is useful for base derivations when the stem-naming is used and the stem happens to be null -- such as in the previous example. The derivation to which this empty expansion refers to would be:</p>
<pre class="programlisting">
|: nom=, gen=a, dat=u, acc=
</pre>
<p>Same-valued properties do not have to be repeated, but instead several property keys can be linked to one value, separated with <code class="literal">&amp;</code> (ampersand). In the previous base derivation, <code class="literal">nom=</code> and <code class="literal">acc=</code> properties could be unified in this way, resulting in:</p>
<pre class="programlisting">
|: nom&amp;acc=, gen=a, dat=u
</pre>
<p>Synder files may contain comments, starting with <code class="literal">#</code> and continuing to the end of line:</p>
<pre class="programlisting">
# A comment.
Venus: Vener|a # another comment
</pre></div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgsdmulexp" id="sec-lgsdmulexp"></a>8.6.2.&nbsp;Multiple Expansions</h3>
</div>
</div>
</div>
<p>A single derivation may contain more than one expansion. There are two distinct types of multiple expansion, <span class="emphasis"><em>outer</em></span> and <span class="emphasis"><em>inner</em></span>.</p>
<p>Outer multiple expansion is used when it is advantageous to split derivations by grammar classes. The examples so far were only deriving grammar cases of nouns, but we may also want to define possesive adjectives per noun. For <span class="emphasis"><em>Venera</em></span>, the possesive adjective in nominative case is <span class="emphasis"><em>Venerin</em></span>. Using the stem-naming of base derivations, we could write:</p>
<pre class="programlisting">
|a: …  # as above
|in: …  # posessive adjective
Venus: Vener|a, Vener|in
</pre>
<p>Expansions are resolved from left to right, with the expected effect of derived properties accumulating along the way. The only question is what happens if two expansions produce properties with same keys but different values. In this case, the value produced by the last (rightmost) expansion overrides previous values.</p>
<p>Inner multiple expansion is used on multi-word syntagmas, when more than one word needs expansion. For example, the source syntagma <span class="emphasis"><em>Orion Nebula</em></span> has the target pair <span class="emphasis"><em>Orionova maglina</em></span>, in which the first word is a possesive adjective, and the second word a noun. The derivation for this is:</p>
<pre class="programlisting">
|a: …  # as above
|ova&gt;: …  # posessive adjective as noun, &gt; is not special here
Orion Nebula: Orion|ova&gt; maglin|a
</pre>
<p>Inner expansions are resolved from left to right, such everything on the right of the expansion currently resolved is treated as literal text. If all expansions define same properties by key, then the total derivation will have all those properties, with values derived as expected. However, if there is some difference in property sets, then the total derivation will get their intersection, i.e. only those properties found in all expansions.</p>
<p>Both outer and inner expansion may be used in a single derivation.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgsdexpmask" id="sec-lgsdexpmask"></a>8.6.3.&nbsp;Expansion Masks</h3>
</div>
</div>
</div>
<p>An expansion can be made not to include all the properties defined in the refered to derivation, but only a subset of them. It can also be made to modify the property keys from the refered to derivation.</p>
<p>Recall the example of <span class="emphasis"><em>Orion Nebula</em></span> and <span class="emphasis"><em>Orionova maglina</em></span>. Here the possesive adjective <span class="emphasis"><em>Orionova</em></span> has to be matched in both case and gender to the noun <span class="emphasis"><em>maglina</em></span>, which is of feminine gender. Earlier we defined a special adjective-as-noun derivation <code class="literal">|ova&gt;</code>, specialized for feminine gender nouns, but now we want to make use of the full posessive adjective derivation, which is not specialized to any gender. Let the property keys of this derivation be of the form <code class="literal">nommas</code> (nominative masculine), <code class="literal">genmas</code> (genitive masculine), …, <code class="literal">nomfem</code> (nominative feminine), <code class="literal">genfem</code> (genitive feminine), …. If we use the stem of nominative masculine form, <span class="emphasis"><em>Orionov</em></span>, to name the possesive adjective base derivation, we get:</p>
<pre class="programlisting">
|ov: nommas=…, genmas=…, …, nomfem=…, genfem=…, …
Orion Nebula: Orion|ov~...fem maglin|a
</pre>
<p><code class="literal">|ov~...fem</code> is a <span class="emphasis"><em>masked</em></span> expansion. It specifies to include only those properties with keys starting with any three characters and ending in <code class="literal">fem</code>, as well as to drop <code class="literal">fem</code> (being a constant) from the resulting property keys. This precisely selects only the feminine forms of the possesive adjective and transforms their keys into noun keys needed to match with those of <code class="literal">|a</code> expansion.</p>
<p>We could also use this same masked expansion as the middle step, to produce the feminine-specialized adjective-as-noun base derivation:</p>
<pre class="programlisting">
|ov: nommas=…, genmas=…, …, nomfem=…, genfem=…, …
|ova&gt;: |ov~...fem
Orion Nebula: Orion|ova&gt; maglin|a
</pre>
<p>A special case of masked expansion is when there are no variable characters in the mask (no dots). In the pair <span class="emphasis"><em>Constellation of Cassiopeia</em></span> and <span class="emphasis"><em>Sazvežđe Kasiopeje</em></span>, the <span class="emphasis"><em>of Cassiopeia</em></span> is translated as single word in genitive case, <span class="emphasis"><em>Kasiopeje</em></span>, avoiding the need for preposition. If standalone <span class="emphasis"><em>Cassiopeia</em></span> has its own derivation, then we can use it like this:</p>
<pre class="programlisting">
Cassiopeia: Kasiopej|a
Constellation of Cassiopeia: Sazvežđ|e |Cassiopeia~gen
</pre>
<p><code class="literal">|e</code> is the usual nominative-stem expansion. The <code class="literal">|Cassiopeia~gen</code> expansion produces only the genitive form of <span class="emphasis"><em>Cassiopeia</em></span>, but with the empty property key. If this expansion would be treated as normal inner expansion, it would cancel all properties produced by <code class="literal">|e</code> expansion, since none of them has an empty key. Instead, when an expansion produces a single property with empty key, its value is treated as literal text and concatenated to all property values produced up to that point. Just as if we had written:</p>
<pre class="programlisting">
Constellation of Cassiopeia: Sazvežđ|e Kasiopeje
</pre>
<p>Sometimes the default modification of propety keys, removal of all fixed characters in the mask, is not what we want. This should be a rare case, but if it happens, the mask can also be given a <span class="emphasis"><em>key extender</em></span>. For example, if we would want to select only feminine forms of the <code class="literal">|ov</code> expansion, but preserve the <code class="literal">fem</code> ending of the resulting keys, we would write:</p>
<pre class="programlisting">
Foobar: Fubar|ov~...fem%*fem
</pre>
<p>The key extender in this expansion is <code class="literal">%*fem</code>. For each resulting property, the final key is constructed by substituting every <code class="literal">*</code> with the key resulting from the <code class="literal">~...fem</code> mask. Thus, the <code class="literal">fem</code> ending is readded to every key, as desired.</p>
<p>Expanded values can have their capitalization changed. By prepending <code class="literal">^</code> (circumflex) or <code class="literal">`</code> (backtick) to the syntagma key of the expansion, the first letter in fetched values is uppercased or lowercased, respectively. We could derive the pair <span class="emphasis"><em>Distant Sun</em></span> and <span class="emphasis"><em>Udaljeno sunce</em></span> by using the pair <span class="emphasis"><em>Sun</em></span> and <span class="emphasis"><em>Sunce</em></span> (note the case difference in <span class="emphasis"><em>Sunce</em></span>/<span class="emphasis"><em>sunce</em></span>) like this:</p>
<pre class="programlisting">
Sun: Sunc|e  # this defines uppercase first letter
Distant Sun: Dalek|o&gt; |`Sun  # this needs lowercase first letter
</pre></div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgsdspecprop" id="sec-lgsdspecprop"></a>8.6.4.&nbsp;Special Properties</h3>
</div>
</div>
</div>
<p>Property keys may be given several endings, to make these properties behave differently from what was described so far. These ending are not treated as part of the property key itself, so they should not be given when querying derivations by syntagma and property key.</p>
<p><span class="emphasis"><em>Cutting</em></span> properties are used to avoid the normal value concatenation on expansion. For example, if we want to define the gender of nouns through base expansions, we could come up with:</p>
<pre class="programlisting">
|a: nom=a, gen=e, dat=i, acc=u, gender=fem
Venus: Vener|a
</pre>
<p>However, this will cause the <code class="literal">gender</code> property in expansion to become <code class="literal">Venerafem</code>. For the <code class="literal">gender</code> property to be taken verbatim, without concatenting segments from the calling derivation, we make it a cutting property by appending <code class="literal">!</code> (exclamation mark) to its key:</p>
<pre class="programlisting">
|a: nom=a, gen=e, dat=i, acc=u, gender!=fem
</pre>
<p>Now when dictionary is queried for <code class="literal">Venus</code> syntagma and <code class="literal">gender</code> property, we will get the expected <code class="literal">fem</code> value.</p>
<p>Cutting properties also behave differently in multiple inner expansions. Instead of being canceled when not all inner expansions define it, simply the rightmost value is taken -- just like in outer expansions.</p>
<p><span class="emphasis"><em>Terminal</em></span> properties are those hidden with respect to expansion, i.e. they are not taken into the calling derivation. A property is made terminal by appending <code class="literal">.</code> (dot) to its key. For example, if some derivations have the short description property <code class="literal">desc</code>, we typically do not want it to propagate into calling derivations which happen not to override it by outer expansion:</p>
<pre class="programlisting">
Mars: Mars|, desc.=planet
Red Mars: Crven|i&gt; |Mars  # a novel
</pre>
<p><span class="emphasis"><em>Canceling</em></span> properties will cause a previously defined property with the same key to be removed from the collection of properties. Canceling property is indicated by ending its key with <code class="literal">^</code> (circumflex). The value of canceling property has no meaning, and can be anything. Canceling is useful in expansions and alternative derivations (more on that later), where some properties introduced by expansion or alternative fallback should be removed from the final collection of properties.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgsdtags" id="sec-lgsdtags"></a>8.6.5.&nbsp;Text Tags</h3>
</div>
</div>
</div>
<p>Key syntagmas and property values can be equipped with arbitrary simple tags, which start with the tag name in the form <code class="literal">~<em class="replaceable"><code>tag</code></em></code> and extend to the next tag or the end of syntagma. For example, when deriving people names, we may want to tag their first and last name, using tags <code class="literal">~fn</code> and <code class="literal">~ln</code> respectively:</p>
<pre class="programlisting">
~fn Isaac ~ln Newton: ~fn Isak| ~ln Njutn|
</pre>
<p>In default queries to the dictionary, tags are simply ignored, syntagmas and property values are reported as if there were no tags. However, custom derivators (based on the <code class="classname">Synder</code> class from <span class="package">pology.synder</span>) can define transformation functions, to which tagged text segments will be passed, so that they can treat them specially when producing the final text.</p>
<p>Tag is implicitly terminated by whitespace or comma (or colon in key syntagmas), but if none of these characters can be put after the tag, the tag name can be explicitly delimited with curly brackets, as <code class="literal">~{<em class="replaceable"><code>tag</code></em>}</code>.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgsdalts" id="sec-lgsdalts"></a>8.6.6.&nbsp;Alternative Derivations</h3>
</div>
</div>
</div>
<p>Sometimes there may be several alternative derivations to the given syntagma. The default derivation (in some suitable sense) is written as explained so far, and alternative derivations are written under named <span class="emphasis"><em>environments</em></span>.</p>
<p>For example, if deriving a transcribed person's name, there may be several versions of the transcription. <span class="emphasis"><em>Isaac Newton</em></span>, as the name of the Renaissance scientist, may be normally used in its traditional transcription <span class="emphasis"><em>Isak Njutn</em></span>, while a contemporary person of that name would be transcribed in the modern way, as <span class="emphasis"><em>Ajzak Njuton</em></span>. Then, in the entry of Newton the scientist, we could also mention what the modern transcription would be, under the environment <code class="literal">modern</code>:</p>
<pre class="programlisting">
Isaac Newton: Isak| Njutn|
    @modern: Ajzak| Njuton|
</pre>
<p>Alternative derivations are put on their own lines after the default derivation, and instead of the key syntagma, they begin with the environment name. The environment name starts with <code class="literal">@</code> and ends with colone, and then the usual derivation follows. It is conventional, but not mandatory, to add some indent to the environment name. There can be any number of non-default environments.</p>
<p>The immediate question that arises is how are expansions treated in non-default environments. In the previous example, what does <code class="literal">|</code> expansion resolve to in <code class="literal">modern</code> environment? This depends on how the synder file is processed. By default, it is required that derivations referenced by expansions have matching environments. If <code class="literal">|</code> were defined as:</p>
<pre class="programlisting">
|: nom=, gen=a, dat=u, acc=
</pre>
<p>then the expansion of <span class="emphasis"><em>Isaac Newton</em></span> in <code class="literal">modern</code> environment would fail. Instead, it would be necessary to define the base derivations as:</p>
<pre class="programlisting">
|: nom=, gen=a, dat=u, acc=
    @modern: nom=, gen=a, dat=u, acc=
</pre>
<p>However, this may not be a very useful requirement. As can be seen in this example already, in many cases base derivations are likely to be same for all environments, so they would be needlessly duplicated. It is therefore possible to define <span class="emphasis"><em>environment fallback</em></span> chain in processing, such that when a derivation in certain environment is requested but not available, environments in the fallback chain are tried in order. In this example, if the chain would be given as <code class="literal">("modern", "")</code> (the empty string is the name of default environment), then we could write:</p>
<pre class="programlisting">
|: nom=, gen=a, dat=u, acc=
Isaac Newton: Isak| Njutn|
    @modern: Ajzak| Njuton|
Charles Messier: Šarl| Mesje|
</pre>
<p>When derivation of <span class="emphasis"><em>Isaac Newton</em></span> in <code class="literal">modern</code> environment is requested, the default expansion for <code class="literal">|</code> will be used, and the derivation will succeed. Derivation of <span class="emphasis"><em>Charles Messier</em></span> in <code class="literal">modern</code> environment will succeed too, because the environment fallback chain is applied throughout; if <span class="emphasis"><em>Charles Messier</em></span> had different modern transcription, we would have explicitly provided it.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgsdwspace" id="sec-lgsdwspace"></a>8.6.7.&nbsp;Treatment of Whitespace</h3>
</div>
</div>
</div>
<p>ASCII whitespace in derivations, namely the space, tab and newline, is not preserved as-is, but by default it is <span class="emphasis"><em>simplified</em></span> in final property values. The simplification consists of removing all leading and trailing ASCII whitespace, and replacing all inner sequences of ASCII whitespace with a single space. Thus, these two derivations are equivalent:</p>
<pre class="programlisting">
Venus: nom=Venera
Venus  :  nom =  Venera
</pre>
<p>but these two are not:</p>
<pre class="programlisting">
Venus: Vener|a
Venus: Vener  |a
</pre>
<p>because the two spaces between the root <code class="literal">Vener</code> and expansion <code class="literal">|a</code> become inner spaces in resulting values, so they get converted into a single space.</p>
<p>Non-ASCII whitespace, on the other hand, is preserved as-is. This means that significant whitespace, like non-breaking space, zero width space, word joiners, etc. can be used normally.</p>
<p>It is possible to have different treatment of whitespace, through an optional parameter to the derivator object (<code class="classname">Synder</code> class). This parameter is a transformation function to which text segments with raw whitespace are passed, so that anything can be done with them.</p>
<p>Due to simplifaction of whitespace, indentation of key syntagmas and environment names is not significant, but it is nevertheless enforced to be consistent. This will not be accepted as valid syntax:</p>
<pre class="programlisting">
Isaac Newton: Isak| Njutn|
    @modern: Ajzak| Njuton|
 George Washington: Džordž| Vašington|  # inconsitent indent
  @modern: Džordž| Vošington|  # inconsitent indent
</pre>
<p>Consistent indenting is enforced both for stylistic reasons when several people are working on the same synder file, and to discourage indentation styles unfriendly to version control systems, such as:</p>
<pre class="programlisting">
Isaac Newton: Isak| Njutn|
     @modern: Ajzak| Njuton|
George Washington: Džordž| Vašington|
          @modern: Džordž| Vošington|  # inconsitent indent
</pre>
<p>Unfriendliness to version control comes from the need to reindent lines which are otherwise unchanged, merely in order to keep them aligned to lines which were actually changed.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgsdorg" id="sec-lgsdorg"></a>8.6.8.&nbsp;Uniqueness, Ordering, and Inclusions</h3>
</div>
</div>
</div>
<p>Within single synder file, each derivation must have at least one unique key syntagma, because they are used as keys in dictionary lookups. These two derivations are in conflict:</p>
<pre class="programlisting">
Mars: Mars|  # the planet
Mars: mars|  # the chocholate bar
</pre>
<p>There are several possibilities to resolve key conflicts. The simplest possibility is to use keyword-like key syntagmas, if key syntagmas themselves do not need to be human readable:</p>
<pre class="programlisting">
marsplanet: Mars|
marsbar: mars|
</pre>
<p>If key syntagmas have to be human readable, then one option is to extend them in human readable way as well:</p>
<pre class="programlisting">
Mars (planet): Mars|
Mars (chocolate bar): mars|
</pre>
<p>This method too is not acceptable if key syntagmas are intended to be of equal weight to derived syntagmas, like in a dictionary application. In that case, the solution is to add a hidden keyword-like syntagma to both derivations:</p>
<pre class="programlisting">
Mars, |marsplanet: Mars|
Mars, |marsbar: mars|
</pre>
<p>Processing will now silently eliminate <code class="literal">Mars</code> as the key to either derivation, because it is conflicted, and leave only <code class="literal">marsplanet</code> as key for the first and <code class="literal">marsbar</code> as key for the second derivation. These remaining keys must also used in expansions, to reference the appropriate derivation. However, when querying the dictionary for key syntagmas by key <code class="literal">marsplanet</code>, only <span class="emphasis"><em>Mars</em></span> will be returned, because <code class="literal">marsplanet</code> is hidden; likewise for <code class="literal">marsbar</code>.</p>
<p>Ordering of derivations is not important. The following order is valid, although the expansion <code class="literal">|Venus~gen</code> is seen before the derivation of <span class="emphasis"><em>Venus</em></span>:</p>
<pre class="programlisting">
Merchants of Venus: Trgovc|i&gt; s |Venus~gen
Venus: Vener|a
</pre>
<p>This enables derivations to be ordered naturally, e.g. alphabetically, instead of the order being imposed by dependencies.</p>
<p>It is possible to include one synder file into another. A typical use case would be to split out base derivations into a separate file, and include it into other synder files. If basic derivations are defined in <code class="filename">base.sd</code>:</p>
<pre class="programlisting">
|: nom=, gen=a, dat=u, acc=, gender!=mas
|a: nom=a, gen=e, dat=i, acc=u, gender!=fem
…
</pre>
<p>then the file <code class="filename">solarsys.sd</code>, placed in the same directory, can include <code class="filename">base.sd</code> and use its derivations in expansions like this:</p>
<pre class="programlisting">
&gt;base.sd
Mercury: Merkur|
Venus: Vener|a
Earth: Zemlj|a
…
</pre>
<p><code class="literal">&gt;</code> is the inclusion directive, followed by the absolute or relative path to file to be included. If the path is relative, it is considered relative to the including file, and not to some externaly defined set of inclusion paths.</p>
<p>If the including and the included file contain a derivation with same key syntagmas, these two derivations are <span class="emphasis"><em>not</em></span> a conflict. On expansion, first the derivations from the current file are checked, and if the referenced derivation is not there, then the included files are checked in reverse of the inclusion order. In this way, it is possible to override some of base derivations in one or few including files.</p>
<p>Inclusions are "shallow": only the derivations in the included file itself are visible (available for use in expansions) in the including file. In other words, if file A includes file B, and file B includes file C, then derivations from C are not automatically visible in A; to use them, A must explicitly include C.</p>
<p>Shallow inclusion and ordering-independent resolution of expansions, taken together, enable mutual inclusions: A can include B, while B can include A. This is an important capability when building derivations of taxonomies. While derivation of X naturally belongs to file A and of Y to file B, X may nevertheless be used in expansion in another derivation in B, and Y in another derivation in A.</p>
<p>To make derivations from several synder files available for queries, these files are imported into the derivator object one by one. Derivations from imported files (but not from files included by them, according to shallow inclusion principle) all share a single namespace. This means that key syntagmas across imported files can conflict, and must be resolved by one of outlined methods.</p>
<p>The design rationale for the inclusion mechanism was that in each collection of derivations, each <span class="emphasis"><em>visible</em></span> derivation, one which is available to queries by the user of the collection, must be accessible by at least one unique key, which does not depend on the underlying file hierarchy.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-lgsderrors" id="sec-lgsderrors"></a>8.6.9.&nbsp;Error Handling</h3>
</div>
</div>
</div>
<p>There are three levels of errors which may happen in syntagma derivations.</p>
<p>The first level are syntax errors, such as synder entry missing a colon which separates the key syntagma from the rest of the entry, unclosed curly bracket in expansion, etc. These errors are reported as soon as the synder file is imported into the derivator object or included by another synder file.</p>
<p>The second level of errors are expansion errors, such as an expansion referencing an undefined derivation, or an expansion mask discarding all properties. These errors are reported lazily, when the problematic derivation is actually looked up for the first time.</p>
<p>The third level is occupied by semantic errors, such as if we want every derivation to have a certain property, or <code class="literal">gender</code> property to have only values <code class="literal">mas</code>, <code class="literal">fem</code>, and <code class="literal">neu</code>, etc. and a derivation violates some of these requirements. At the moment, there is no prepared way to catch semantic errors.</p>
<p>In future, a mechanism (in form of file-level directives, perhaps) may be introduced to immediately report reference errors on request, and to constrain property keys and property values to avoid semantic errors. Until then, the way to validate a collection of derivations would be to write a piece of Python code which will import all files into a derivator object, iterate through derivations (this alone will catch expansion errors) and check for semantic errors.</p>
</div>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id652692" href="#id652692" class="para" id="ftn.id652692">30</a>]</sup> Another advantage is that original text too will sometimes contain out-of-date UI references, which this process will automatically discover and enable the translation to be more up-to-date than the original. Of course, reporting the problem to the authors would be desireable, or even necessary when the related feature no longer exists.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id589542" href="#id589542" class="para" id="ftn.id589542">31</a>]</sup> Taking into account the current level of artificial intelligence development, which, granted, may become more sophisticated in the future.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id649734" href="#id649734" class="para" id="ftn.id649734">32</a>]</sup> And cause regular expressions to become horribly complicated.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id649888" href="#id649888" class="para" id="ftn.id649888">33</a>]</sup> Why not remove accelerator markers automatically before applying rules? Because some rules might be exactly about accelerator markers, e.g. if it should not be put next to certain letters.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id698929" href="#id698929" class="para" id="ftn.id698929">34</a>]</sup> These filtering examples are only for illustrative purposes, as there are more precise methods to remove markup, or literals such as command line options.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id624093" href="#id624093" class="para" id="ftn.id624093">35</a>]</sup> Until that is sufficiently satisfied, one simple safety measure is to remove <code class="literal">skip-rule:</code> comments from fuzzy messages just after the PO file is merged with template. This will sometimes cause false positive to reappear, but, after all, this is only a tertiary element in the translation workflow (after translation and review).</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id666047" href="#id666047" class="para" id="ftn.id666047">36</a>]</sup> As of this writting, one currently operative translation scripting system is <a class="ulink" href="http://techbase.kde.org/Localization/Concepts/Transcript" target="_top">KDE's Transcript</a>. Another one being developed, albeit not with PO format as base, is <a class="ulink" href="http://wiki.mozilla.org/L20n" target="_top">Mozilla's L20n</a>.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id666074" href="#id666074" class="para" id="ftn.id666074">37</a>]</sup> An exception would be <a class="ulink" href="http://en.wikipedia.org/wiki/Constructed_language" target="_top">constructed languages</a> with regular grammar, such as Esperanto.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id666090" href="#id666090" class="para" id="ftn.id666090">38</a>]</sup> A combination of words having a certain meaning, possibly greater than the sum of meanings of each word.</p>
</div>
</div>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-common" id="ch-common"></a>Chapter&nbsp;9.&nbsp;Common Functionality</h2>
</div>
</div>
</div>
<p>Different parts of Pology provide common functionality, such as thematic groups of options to scripts, file selection patterns, reliance on PO metadata, etc. This chapter describes such common functionality.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cmshellcomp" id="sec-cmshellcomp"></a>9.1.&nbsp;Shell Completion</h2>
</div>
</div>
</div>
<p>Shell completion means that, similarly as for command names, it is possible to contextually complete command parameters by pressing the <span class="keycap"><strong>Tab</strong></span> key. This allows you to efficiently type in the command line, as well as to quickly remind yourself of options and option parameters without resorting to documentation or browsing the file system.</p>
<p>For example, pressing <span class="keycap"><strong>Tab</strong></span> just after <a class="link" href="#ch-sieve" title="Chapter&nbsp;3.&nbsp;Sieving">the <span class="command"><strong>posieve</strong></span> command</a> will complete sieve names, and <span class="keycap"><strong>Tab</strong></span> after the <code class="option">-s</code> option will complete sieve parameters based on sieves that precede it in the command line. This:</p>
<pre class="programlisting">
$ posieve s&lt;TAB&gt;
</pre>
<p>will show all sieves beginning with <code class="literal">s</code>, and complete the sieve name once sufficient number of characters have been entered to uniquely determine it, while this:</p>
<pre class="programlisting">
$ posieve stats -s m&lt;TAB&gt;
</pre>
<p>will show all parameters to <span class="command"><strong>stats</strong></span> beginning with <code class="literal">m</code>, and complete one of them after few more characters are typed in.</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cmconfig" id="sec-cmconfig"></a>9.2.&nbsp;User Configuration</h2>
</div>
</div>
</div>
<p>Various parts of Pology can be configured through the configuration file <code class="filename">.pologyrc</code> in the root of user's home directory (<code class="filename">~/.pologyrc</code> for short). The configuration file does not have to exist, so you have to create it when you want to configure something for the first time. It must be UTF-8 encoded.</p>
<p>The configuration file is in the <a class="ulink" href="http://en.wikipedia.org/wiki/INI_file" target="_top">INI</a> format, which is composed of sections beginning with a <code class="literal">[<em class="replaceable"><code>section</code></em>]</code> line, and fields of the form <code class="literal"><em class="replaceable"><code>field</code></em> = <em class="replaceable"><code>value</code></em></code> within a section. Comments can be written after <code class="literal">#</code> character at the beginning of the line. Here is an example of a <code class="filename">~/.pologyrc</code> file:</p>
<pre class="programlisting">
[user]
name = Chusslove Illich
original-name = Часлав Илић
email = caslav.ilic@gmx.net
po-editor = Kate

[enchant]
# Autodetection sufficient.

[posieve]
msgfmt-check = yes
param-ondiff/stats = yes

# Project setups follow.

[project-kde]
language = sr
language-team = Serbian
team-email = kde-i18n-sr@kde.org
plural-forms = nplurals=4; plural=n==1 ? ...
</pre>
<p>This configuration contains four sections: <code class="literal">[user]</code>, <code class="literal">[enchant]</code>, <code class="literal">[posieve]</code>, and <code class="literal">[project-kde]</code>. The <code class="literal">[user]</code> section provides some information on the person who uses Pology. The <code class="literal">[enchant]</code> section configures the Enchant spell checker wrapper, used by Pology for spell checking. The <code class="literal">[posieve]</code> section configures the behavior of the <a class="link" href="#ch-sieve" title="Chapter&nbsp;3.&nbsp;Sieving"><span class="command"><strong>posieve</strong></span></a> script. The <code class="literal">[project-kde]</code> section provides information on a project that the user contributes translation to.</p>
<p>Some details about the configuration file syntax are as follows. Leading and trailing whitespace in section and field names and values is not significant, e.g. <code class="literal">foo=bar</code> is same as <code class="literal">foo = bar</code>. Percent (%) character is used to expand the value of another field, for example:</p>
<pre class="programlisting">
rootdir = /path/to/somewhere
datadir = %(rootdir)s/data
</pre>
<p>where the <code class="literal">%(...)s</code> is Python's string interpolation syntax. Importantly, when you need a literal % character within a value (such as in <code class="literal">plural-forms</code> field in the previous example), you must repeat it twice, <code class="literal">%%</code>. Switch-type fields (<code class="literal">msgfmt-check</code> in the previous example) can take any of the following values for the two states: <code class="literal">0</code>, <code class="literal">no</code>, <code class="literal">false</code>, or <code class="literal">off</code>; and <code class="literal">1</code>, <code class="literal">yes</code>, <code class="literal">true</code>, or <code class="literal">on</code> (case is not important).</p>
<p>Sections in the configuration can be of one of four general types:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>General sections, which provide information used by various parts of Pology as they need them. The <code class="literal">[user]</code> section from the previous example is a general section.</p>
</li>
<li class="listitem">
<p>External tool sections, which are used to configure external libraries and programs used within Pology. The <code class="literal">[enchant]</code> section from the previous example is of this type.</p>
</li>
<li class="listitem">
<p>Internal tool sections, which configure the behavior of Pology's own scripts. This is the <code class="literal">[posieve]</code> section from the previous example.</p>
</li>
<li class="listitem">
<p>Project sections, which provide information related to particular translation projects that the user is contributing to. Names of these sections always start with <code class="literal">project-</code>, such as <code class="literal">[project-kde]</code> from the previous example.</p>
</li>
</ul>
</div>
<p>Internal tool sections are documented together with the respective tools, while sections of other types are described in the following.</p>
<p>When mentioning configuration fields in their documentation and elsewhere, they are referred to as <code class="literal">[<em class="replaceable"><code>section</code></em>]/<em class="replaceable"><code>field</code></em></code>. If there is only a fixed number of possible values to a field, this is denoted as <code class="literal">[<em class="replaceable"><code>section</code></em>]/<em class="replaceable"><code>field</code></em>=[<em class="replaceable"><code>VALUE1</code></em>|<em class="replaceable"><code>VALUE2</code></em>|<em class="replaceable"><code>VALUE3</code></em>|...]</code>; if one of the values is the default, it is prefixed with a star (*).</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmcfguser" id="sec-cmcfguser"></a>9.2.1.&nbsp;The <code class="literal">[user]</code> section</h3>
</div>
</div>
</div>
<p>Many parts of Pology can take advantage of information about you and the tools you use. This information is given in the <code class="literal">[user]</code> section. For example, when initializing PO file from a template, your name, email address in the PO header can be filled out, or a PO file can be opened in a translation editor that you use (if it is supported).</p>
<p>Known configuration fields are as follows:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[user]/name</code></span></dt>
<dd>
<p>Your name if it is written in Latin script, or the romanized equivalent of your name. The intention is that it is readable (or semi-readable) to people from various places in the world, who would use it to contact you if necessary.</p>
</dd>
<dt><span class="term"><code class="literal">[user]/original-name</code></span></dt>
<dd>
<p>This is your name in your native language and script, whatever it may be. If it would be the same as the name in the <code class="literal">[user]/name</code> field, setting this field is not necessary.</p>
</dd>
<dt><span class="term"><code class="literal">[user]/email</code></span></dt>
<dd>
<p>Your email address.</p>
</dd>
<dt><span class="term"><code class="literal">[user]/language</code></span></dt>
<dd>
<p>The language code of the language you translate into. If by any chance you translate into several languages, this field can be overridden in per-project configuration sections.</p>
</dd>
<dt><span class="term"><code class="literal">[user]/encoding</code></span></dt>
<dd>
<p>The encoding of the PO files you work on. Nowdays this should really, really be UTF-8. If it is not UTF-8 for everything that you work on, you can override it in per-project configuration sections.</p>
</dd>
<dt><span class="term"><code class="literal">[user]/plural-forms</code></span></dt>
<dd>
<p>The value for the <a class="link" href="#sec-poplurals" title="2.4.&nbsp;Plural Forms"><code class="literal">Plural-Forms</code> PO header field</a> used for your language. If it differs between projects, you can override the value set here in per-project configuration sections.</p>
</dd>
<dt><span class="term"><code class="literal">[user]/po-editor</code></span></dt>
<dd>
<p>The human-readable name of the editor with which you translate (it does not have to be a dedicated PO editor). This is used in contexts where your editor preference is announced, such as through the <code class="literal">X-Generator</code> PO header field.</p>
</dd>
<dt><span class="term"><code class="literal">[user]/po-editor-id=[lokalize]</code></span></dt>
<dd>
<p>The keyword under which the PO editor that you use is known to Pology. For the moment, only Lokalize is supported. This is used when a Pology tool is told to open PO files on the messages it matched.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmcfgenchant" id="sec-cmcfgenchant"></a>9.2.2.&nbsp;The <code class="literal">[enchant]</code> section</h3>
</div>
</div>
</div>
<p>This section configures <a class="ulink" href="http://www.abisource.com/projects/enchant/" target="_top">Enchant</a>, a wrapper library for spell checking, which is used for Pology's <a class="link" href="#sec-lgspell" title="8.2.&nbsp;Spell Checking">spell checking functionality</a>. Through Enchant it is possible to use various spell checkers, such as Aspell, Ispell, Hunspell, etc. in a uniform way.</p>
<p>Known configuration fields are as follows:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[enchant]/provider=[aspell|ispell|myspell|...]</code></span></dt>
<dd>
<p>The keyword denoting the spell checker that Enchant should use. It can also be a comma-separated list of several keywords, when Enchant will use the first available spell checker in the list. You can find the up-to-date list of all known provider keywords in the <span class="command"><strong>enchant(1)</strong></span> man page, and run <span class="command"><strong>enchant-lsmod</strong></span> command to see exactly which of those are recognized as available on the system.</p>
</dd>
<dt><span class="term"><code class="literal">[enchant]/language</code></span></dt>
<dd>
<p>The spell checking dictionary that should be used, by language code. This value is used only if the language is not specified in any other way, such as in the PO header or through command line.</p>
</dd>
<dt><span class="term"><code class="literal">[enchant]/environment</code></span></dt>
<dd>
<p>The sub-language environment for spell checking. This is related to Pology's internal spelling dictionary supplements, see the <a class="link" href="#sec-lgspell" title="8.2.&nbsp;Spell Checking">section on spell checking</a>. This value is used only if the environment is not specified in any other way, such as in the PO header or through command line.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmcfgaspell" id="sec-cmcfgaspell"></a>9.2.3.&nbsp;The <code class="literal">[aspell]</code> section</h3>
</div>
</div>
</div>
<p>At first Pology used <a class="ulink" href="http://aspell.net/" target="_top">Aspell</a> for spell checking, before Enchant was introduced. Direct support for Aspell was nevertheless kept, due to some specifics that the Enchant wrapper does not support yet. (Which means that you should better use Enchant if it satisfies your needs.)</p>
<p>Known configuration fields are as follows:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[aspell]/language</code></span></dt>
<dd>
<p>See <code class="literal">[enchant]/language</code>.</p>
</dd>
<dt><span class="term"><code class="literal">[aspell]/encoding</code></span></dt>
<dd>
<p>Encoding for the text sent to Aspell.</p>
</dd>
<dt><span class="term"><code class="literal">[aspell]/variety</code></span></dt>
<dd>
<p>The sub-language variety of the Aspell spelling dictionary.</p>
</dd>
<dt><span class="term"><code class="literal">[aspell]/environment</code></span></dt>
<dd>
<p>See <code class="literal">[enchant]/environment</code>.</p>
</dd>
<dt><span class="term"><code class="literal">[aspell]/supplements-only=[yes|*no]</code></span></dt>
<dd>
<p>Whether to ignore the system spelling dictionary and use only Pology's internal dictionary supplements.</p>
</dd>
<dt><span class="term"><code class="literal">[aspell]/simple-split=[yes|*no]</code></span></dt>
<dd>
<p>By default, Pology splits the text into words in a clever fashion (eliminating text markup, format directives, etc.) before sending them to the spell checker. Sometimes this leads to bad result, and then this field can be set to <code class="literal">yes</code> to split text simply on whitespace (possibly, in the given context, in combination with <a class="link" href="#sec-cmhooks" title="9.10.&nbsp;Processing Hooks">a pre-filtering hook</a> on the text).</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmcfgproj" id="sec-cmcfgproj"></a>9.2.4.&nbsp;Per-project sections (<code class="literal">[project-*]</code>)</h3>
</div>
</div>
</div>
<p>You will easily come into the situation where you need to translate and maintain translated material within different projects, each with its own set of rules and conventions. Pology is designed to support project switching extensively, and one element of that are per-project configuration sections.</p>
<p>A project configuration sections has the name <code class="literal">[project-<em class="replaceable"><code>PKEY</code></em>]</code>, where <em class="replaceable"><code>PKEY</code></em> is the project keyword. You can choose the project keyword freely, but it should contain only ASCII letters, digits, underscore and hyphen. Project configuration fields frequently have fallbacks to fields in other configuration sections. This means that when the project field is not set, its corresponding field in that other (more general) section gets used instead. In the following, this is the whenever you are instructed to see a field in another section.</p>
<p>Per-project configuration fields are as follows:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[project-*]/name</code></span></dt>
<dd>
<p>See <code class="literal">[user]/name</code>.</p>
</dd>
<dt><span class="term"><code class="literal">[project-*]/original-name</code></span></dt>
<dd>
<p>See <code class="literal">[user]/original-name</code>.</p>
</dd>
<dt><span class="term"><code class="literal">[project-*]/email</code></span></dt>
<dd>
<p>See <code class="literal">[user]/email</code>.</p>
</dd>
<dt><span class="term"><code class="literal">[project-*]/language</code></span></dt>
<dd>
<p>See <code class="literal">[user]/language</code>.</p>
</dd>
<dt><span class="term"><code class="literal">[project-*]/language-team</code></span></dt>
<dd>
<p>This is the name of the team which translates this project into given language. Since usually there is only one translation team per language in a project, the value of this field is just the human-readable name of the language (as opposed to language code) in English.</p>
</dd>
<dt><span class="term"><code class="literal">[project-*]/team-email</code></span></dt>
<dd>
<p>The email address for communication with the translation team as whole (usually the team's mailing list).</p>
</dd>
<dt><span class="term"><code class="literal">[project-*]/encoding</code></span></dt>
<dd>
<p>See <code class="literal">[user]/encoding</code>.</p>
</dd>
<dt><span class="term"><code class="literal">[project-*]/plural-forms</code></span></dt>
<dd>
<p>See <code class="literal">[user]/plural-forms</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cmregex" id="sec-cmregex"></a>9.3.&nbsp;Regular Expressions</h2>
</div>
</div>
</div>
<p>There are great many places in Pology where you can supply a matching pattern, to select or deselect something. This could be a PO file by its path, a PO message by its <code class="varname">msgid</code>, etc. Almost always and by default, this matching pattern will be a <span class="emphasis"><em>regular expression</em></span> (or <span class="emphasis"><em>regex</em></span> for short). Regular expressions are a powerful pattern matching language, a fascinating topic in their own right, and they will serve you well in just about any context of searching on computers. The plain text editor that you use probably offers regular expressions in its search dialog, so does your office text processor, and so on.</p>
<p>Actually, the only point of this brief section is to impress the importance and usefulness of regular expressions onto you, in the case that you have not used them yet. The Internet is full of tutorials on regular expressions, so that there is no point in linking any one particular here.</p>
<p>It should be mentioned that different regular expression engines have somewhat different syntax and expressiveness. Pology uses regular expressions from the Python Standard Library, described here: <a class="ulink" href="http://docs.python.org/library/re.html" target="_top">http://docs.python.org/library/re.html</a> (keep in mind that this page is a reference, and not a tutorial, so you should look elsewhere to learn basics of regular expressions).</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cmincexc" id="sec-cmincexc"></a>9.4.&nbsp;Path Inclusion and Exclusion</h2>
</div>
</div>
</div>
<p>Pology scripts that can recursively search directory paths for PO files will usually provide several options by which certain files can be included or excluded from processing. The first pair of these options include or exclude files by path:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-E <em class="replaceable"><code>REGEX</code></em></code>, <code class="option">--exclude-path=<em class="replaceable"><code>REGEX</code></em></code></span></dt>
<dd>
<p>Every file with the path that does not match the supplied pattern is excluded from processing. This option can be repeated, when a file is excluded if its path matches <span class="emphasis"><em>every</em></span> pattern. When you want to exclude by <span class="emphasis"><em>any</em></span> pattern matching the path, you can connect those patterns with regular expression <code class="literal">|</code>-operator in a single option. This allows you to build up complex exclusion conditions if necessary.</p>
</dd>
<dt><span class="term"><code class="option">-I <em class="replaceable"><code>REGEX</code></em></code>, <code class="option">--include-path=<em class="replaceable"><code>REGEX</code></em></code></span></dt>
<dd>
<p>Only those files which have the path matching the supplied pattern are included into processing. If the option is repeated, a file is included only if its path matches every pattern.</p>
</dd>
</dl>
</div>
<p>Especially those PO files which are used at runtime (as opposed to those used for <a class="link" href="#p-dynstattr">static translation</a>), but others too, are frequently sufficiently identified by their <span class="emphasis"><em>domain</em></span> name. The domain name is the base name of the installed MO file without the extension, e.g. for <code class="filename">/usr/share/locale/sr/LC_MESSAGES/foobar.mo</code> the domain name is <code class="literal">foobar</code>. If, in a given translation project, PO files for a given language are all collected under one top directory of that language, their base names are also formed of domain names.<sup>[<a name="id603602" href="#ftn.id603602" class="footnote" id="id603602">39</a>]</sup> When this is the case, it may be more convenient or safer to match PO files by their domain names instead of paths, which is done by options:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-e <em class="replaceable"><code>REGEX</code></em></code>, <code class="option">--exclude-name=<em class="replaceable"><code>REGEX</code></em></code></span></dt>
<dd>
<p>Counterpart to <code class="option">-E</code>/<code class="option">--exclude-path</code> which matches by domain name.</p>
</dd>
<dt><span class="term"><code class="option">-i <em class="replaceable"><code>REGEX</code></em></code>, <code class="option">--include-name=<em class="replaceable"><code>REGEX</code></em></code></span></dt>
<dd>
<p>Counterpart to <code class="option">-I</code>/<code class="option">--include-path</code> which matches by domain name.</p>
</dd>
</dl>
</div>
<p>All inclusion and exclusion options can be freely mixed and repeated, with consequent resolution. A file is processed if it matches all inclusion patterns (if any is given) and does not match at least one exclusion pattern (if any is given). The other way around, a file is not processed if does not match at least one inclusion pattern (if any is given) or it matches all exclusion patterns (if any is given).</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cmffrom" id="sec-cmffrom"></a>9.5.&nbsp;Reading Paths From a File</h2>
</div>
</div>
</div>
<p>Sometimes it is convenient to make a temporary or semi-permanent grouping of files, such that the file group can be referenced through a single argument instead of repeating all the files all the time. This is particularly useful when shell piping is not applicable or not comfortable enough. The classic and simple way to group files is by having a file-list file, which contains one file path by line, which a shell command can read to collect files to process.</p>
<p>Many Pology scripts can write and read file-list files. Having scripts write such files automatically is simple enough, just check given script's documentation to see if it has this capability (e.g. the <code class="option">-m</code> option to <span class="command"><strong>posieve</strong></span>). More interesting are the special features that you can use when writing a file-list file manually. You would do this for standing categories which are periodically updated, such as a list of PO files ready for release.</p>
<p>For completeness, here is first an example of a basic file-list file:</p>
<pre class="programlisting">
xray/alpha.po
xray/bravo.po
yankee/charlie.po
yankee/delta.po
</pre>
<p>As is usual for path arguments to Pology scripts, you can specify both file and directory paths, and directory paths will be searched recursively for PO files (or whatever the file type that the script is processing):</p>
<pre class="programlisting">
xray/
yankee/
zulu/echo.po
zulu/foxtrot.po
</pre>
<p>You can add comments by starting the line with hash (<code class="literal">#</code>), and have empty lines:</p>
<pre class="programlisting">
# Translations ready for release.

# Full modules.
xray/
yankee/

# Specific files.
zulu/echo.po
zulu/foxtrot.po
</pre>
<p>The inclusion-exclusion functionality equivalent to <a class="link" href="#sec-cmincexc" title="9.4.&nbsp;Path Inclusion and Exclusion">inclusion-exclusion command line options</a> is provided through inclusion-exclusion directives. They are specified by starting the line with colon (<code class="literal">:</code>), followed by directive type token, followed by a regular expression. The directives are:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">:/-<em class="replaceable"><code>REGEX</code></em></code> to exclude files by path,</p>
</li>
<li class="listitem">
<p><code class="literal">:/+<em class="replaceable"><code>REGEX</code></em></code> to include files by path,</p>
</li>
<li class="listitem">
<p><code class="literal">:-<em class="replaceable"><code>REGEX</code></em></code> to exclude files by base name without extension, and</p>
</li>
<li class="listitem">
<p><code class="literal">:+<em class="replaceable"><code>REGEX</code></em></code> to include files by base name without extension.</p>
</li>
</ul>
</div>
<p>For example, if a whole module should be processed but for one PO file in it, it is easier to list the whole module and exclude that one file, as compared to listing all other files:</p>
<pre class="programlisting">
# Modules.
xray/
yankee/
# Exclude november.po (in whichever module it is).
:-november
</pre>
<p>Ordering and position of include-exclude directives is not significant, as they are all applied to all collected files. The semantics of application of multiple directives is the same as that of <a class="link" href="#sec-cmincexc" title="9.4.&nbsp;Path Inclusion and Exclusion">counterpart command line options</a>.</p>
<p>File-list files are normally fed to Pology scripts with the following option:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-f <em class="replaceable"><code>FILE</code></em></code>, <code class="option">--files-from=<em class="replaceable"><code>FILE</code></em></code></span></dt>
<dd>
<p>Read files to process from a file which contains one path per line, or special entries as described above. This option can be repeated to read several file lists. Additional paths to process can still be given as command line arguments. Any inclusion-exclusion options will be applied to the files read from the file as well (in addition to the file's internal inclusion-exclusion directives, if any).</p>
</dd>
</dl>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cmcolors" id="sec-cmcolors"></a>9.6.&nbsp;Output Coloring</h2>
</div>
</div>
</div>
<p>In some contexts, Pology scripts color the terminal output for better visual separation and highlighting of important parts of the text. Examples include warning and error messages, data presented as tables and bars, and, importantly, matched segments of the text in search and validation operations.</p>
<p>Output coloring is turned on by default, but sensitive to output destination: the text is colored if the output is to the terminal (using terminal escape sequences), but not if it is piped to a file. Pology scripts provide the following options by which you can influence this behavior:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">-R</code>, <code class="option">--raw-colors</code></span></dt>
<dd>
<p>Disables output destination sensitivity, such that the text is always colored. This is useful when the output is piped to another command which can understand terminal escape sequences by which colors are produce, such as <span class="command"><strong>less(1)</strong></span>. A typical example would be piping search results from <a class="link" href="#sv-find-messages" title="3.5.17.&nbsp;find-messages">the <span class="command"><strong>find-messages</strong></span> sieve</a> to be able to scroll them back and forth:</p>
<pre class="programlisting">
$ posieve find-messages ... -R | less -R
</pre>
<p>The <code class="option">-R</code> of <span class="command"><strong>less</strong></span> tells it to interpret escape sequences as colors, rather than showing them as literal text.</p>
</dd>
<dt><span class="term"><code class="option">--coloring-type=[none|term*|html]</code></span></dt>
<dd>
<p>Instead of coloring for the terminal, with this option you can choose another coloring type. <code class="literal">none</code> disables coloring, <code class="literal">term</code> is the default, while <code class="literal">html</code> will produce HTML-tagged text ready for embedding into a web page (e.g. inside a &lt;pre&gt; element). For example, with a little bit of additional scripting, you could use <a class="link" href="#sv-stats" title="3.5.30.&nbsp;stats">the <span class="command"><strong>stats</strong></span> sieve</a> and <code class="literal">html</code> coloring to periodically update a web page with translation statistics.</p>
</dd>
</dl>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cminttools" id="sec-cminttools"></a>9.7.&nbsp;Integration with Other Tools</h2>
</div>
</div>
</div>
<p>One of the general aims of Pology is to fit well with other tools typically found in translation workflows based on PO. Although examples of this can be seen throughout the manual, this section gives the overview of integration by the particular supported tool.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmsupped" id="sec-cmsupped"></a>9.7.1.&nbsp;PO Editors</h3>
</div>
</div>
</div>
<p>When Pology is used to validate the translation, be it through informal but <a class="link" href="#sv-find-messages" title="3.5.17.&nbsp;find-messages">precise searches</a> or formal <a class="link" href="#sec-lgrules" title="8.5.&nbsp;Validation Rules">validation rules</a>, those translations found to be invalid must be modified (or possibly a special translator comment added to the message to silence a false positive). Pology will normally always report the PO file path and the location of the message within the file, so that you can get to it in you preferred PO editor. For greater efficiency, however, Pology can directly open the PO files on problematic messages in some PO editors. Currently these are:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><a class="ulink" href="http://userbase.kde.org/Lokalize" target="_top">Lokalize</a></span></dt>
<dd>
<p>Many <a class="link" href="#ch-sieve" title="Chapter&nbsp;3.&nbsp;Sieving">sieves</a>, notably <span class="command"><strong>find-messages</strong></span>, <span class="command"><strong>check-rules</strong></span>, or <span class="command"><strong>check-spell</strong></span>, provide the parameter <code class="option">lokalize</code> to open PO files on reported messages in Lokalize. This means that when run over a collection of PO files, each PO file with at least one reported message will be loaded into one of Lokalize tabs, and only the reported messages will be shown for editing under each tab. A slight catch is that Lokalize must be manually started before a sieve is run, and the Lokalize project which contains all the sieved PO files must be opened; otherwise, simply nothing will happen.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmsuppvcs" id="sec-cmsuppvcs"></a>9.7.2.&nbsp;Version Control Systems</h3>
</div>
</div>
</div>
<p>From the viewpoint of translators, PO files are frequently (though not always) handled in the same way as program code, through version control systems (VCS). Pology defines an abstraction of version control functionality, which enables its tools to transparently cooperate with several VCS. Usually it is necessary to tell a Pology tool which VCS is used, which is done by specifying one of VCS keywords. Currently supported VCS and their keywords are:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><a class="ulink" href="http://git-scm.com/" target="_top">Git</a>: <code class="literal">git</code></p>
</li>
<li class="listitem">
<p><a class="ulink" href="http://subversion.tigris.org/" target="_top">Subversion</a>: <code class="literal">svn</code>, <code class="literal">subversion</code></p>
</li>
<li class="listitem">
<p>none (when specifying a VCS is required, but none is actually used): <code class="literal">none</code>, <code class="literal">noop</code></p>
</li>
</ul>
</div>
<p>VCS integration is available in following places:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Producing embedded diffs with <span class="command"><strong>poediff</strong></span> (see <a class="xref" href="#ch-diffpatch" title="Chapter&nbsp;4.&nbsp;Diffing and Patching">Chapter&nbsp;4, <i>Diffing and Patching</i></a>). Option <code class="option">-c</code>/<code class="option">--vcs</code> can be used to switch <span class="command"><strong>poediff</strong></span> into VCS mode, such that it diffs given paths between repository head and working copy, or between given revisions.</p>
</li>
<li class="listitem">
<p>Translating in summit (see <a class="xref" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">Chapter&nbsp;5, <i>Summitting Translation Branches</i></a>). <span class="command"><strong>posummit</strong></span> will automatically add or remove files from version control as well as to and from disk, so that the modified repository tree can be directly committed after a summit maintenance operation has completed its run.</p>
</li>
<li class="listitem">
<p>Review ascription (see <a class="xref" href="#ch-ascript" title="Chapter&nbsp;6.&nbsp;Ascribing Modifications and Reviews">Chapter&nbsp;6, <i>Ascribing Modifications and Reviews</i></a>). VCS support is central part of <span class="command"><strong>poascribe</strong></span>, so it will automatically add, remove and commit files to version control as particular ascription operations require.</p>
</li>
</ul>
</div>
<p>Another interesting aspect of VCS support is that, when writing modified PO files to disk, by default Pology will reformat them (almost) only as much as necessary. For example, if only one <code class="varname">msgstr</code> string in the whole PO file has changed, and wrapping is active, only this string and nothing else will be rewrapped when the file is written out. This makes VCS revision deltas smaller and more informative.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cmwrap" id="sec-cmwrap"></a>9.8.&nbsp;Line Wrapping in PO Messages</h2>
</div>
</div>
</div>
<p>While <a class="link" href="#sec-powrap" title="2.1.2.&nbsp;String Wrapping">line wrapping of message strings</a> irrelevant to programs that fetch translations from them, it may be significant to the translator, especially when editing the PO file with a plain text editor. Well-wrapped strings make it easier for the translator to follow the text structure, especially in longer messages.</p>
<p>Most Gettext tools (<span class="command"><strong>msgmerge</strong></span>, <span class="command"><strong>msgcat</strong></span>, <span class="command"><strong>msgfilter</strong></span>, etc.) provide options to wrap or not to wrap strings, where wrapping is done on the given column and escaped newlines (<code class="literal">\n</code>). Pology can produce this type of wrapping ("basic" wrapping) as well, but it can also wrap on expected visual line breaks in known text markup, e.g. <code class="literal">&lt;p&gt;</code> and <code class="literal">&lt;br&gt;</code> in HTML ("fine" wrapping). Compare this message in basic wrapping alone:</p>
<pre class="programlisting">
msgid ""
"&lt;p&gt;These settings control the storage of the corrected images. "
"There are four modes to choose from:&lt;/p&gt;&lt;p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;Subfolder:&lt;/"
"b&gt; The corrected images will be saved in a subfolder under the "
"current album path.&lt;/li&gt;&lt;li&gt;&lt;b&gt;Prefix:&lt;/b&gt; A custom prefix will be "
"added to the corrected image.&lt;/li&gt;&lt;li&gt;&lt;b&gt;Suffix:&lt;/b&gt; A custom "
"suffix will be added to the corrected image.&lt;/li&gt;&lt;li&gt;&lt;b&gt;Overwrite:&lt;/"
"b&gt; All original images will be replaced.&lt;/li&gt;&lt;/ul&gt;&lt;/p&gt;&lt;p&gt;Each of "
"the four modes allows you to add an optional keyword to the image "
"metadata.&lt;/p&gt;"
msgstr ""
</pre>
<p>and in basic and fine wrapping together:</p>
<pre class="programlisting">
msgid ""
"&lt;p&gt;These settings control the storage of the corrected images. "
"There are four modes to choose from:&lt;/p&gt;"
"&lt;p&gt;"
"&lt;ul&gt;"
"&lt;li&gt;&lt;b&gt;Subfolder:&lt;/b&gt; The corrected images will be saved in a "
"subfolder under the current album path.&lt;/li&gt;"
"&lt;li&gt;&lt;b&gt;Prefix:&lt;/b&gt; A custom prefix will be added to the corrected "
"image.&lt;/li&gt;"
"&lt;li&gt;&lt;b&gt;Suffix:&lt;/b&gt; A custom suffix will be added to the corrected "
"image.&lt;/li&gt;"
"&lt;li&gt;&lt;b&gt;Overwrite:&lt;/b&gt; All original images will be replaced.&lt;/li&gt;"
"&lt;/ul&gt;"
"&lt;/p&gt;"
"&lt;p&gt;Each of the four modes allows you to add an optional keyword "
"to the image metadata.&lt;/p&gt;"
msgstr ""
</pre>
<p>If you are editing the PO file with a dedicated PO editor, it may itself provide finely tuned wrapping and ignore the wrapping in the PO file, in which case Pology's wrapping facilities are superfluous to you<sup>[<a name="id681869" href="#ftn.id681869" class="footnote" id="id681869">40</a>]</sup>. But a PO editor may also present strings wrapped just as they are in the PO file (and most do!), when Pology's fine wrapping is just as useful as in combination with a plain text editor.</p>
<p>At least for alphabetic languages, the most convenient wrapping may be fine wrapping alone (no basic wrapping), while turning on editor's dynamic (visual) line wrapping. This both makes the text structure easy to follow, and allows editing the translation by logical units (paragraphs, list items) without manually adjusting column breaks or putting up with ugly overlength or mid-broken lines. However, for ideographic languages, editor's dynamic line wrapping may produce bad results, and there basic wrapping might be necessary. In fact, for the moment, for ideographic languages it may be better to pass Pology's wrapping entirely and stick with Gettext's wrapping, since the wrapping algorithm in Gettext is more sophisticated and directly supports ideographic writing systems.</p>
<p>If no wrapping mode is specified when the given PO file is written out, Pology will apply basic wrapping, just as Gettext tools do. There are three general sources from which Pology tools may try to determine the wrapping mode for the given PO file, in decreasing priority: from the command line options, from the PO file's header, and from the user configuration. A tool may or may not provide command line options and configuration fields for wrapping, but PO file headers are always consulted (since this is in Pology's core PO file handling facilities). See the description of <a class="link" href="#hdr-x-wrapping">the <code class="literal">X-Wrapping</code> header field</a> for how to set the wrapping mode in the PO header, and <a class="link" href="#sv-set-header" title="3.5.29.&nbsp;set-header">the <code class="literal">set-header</code> sieve</a> for how to set this field in many PO files at once.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmwropts" id="sec-cmwropts"></a>9.8.1.&nbsp;Common Command Line Options for Wrapping</h3>
</div>
</div>
</div>
<p>Pology tools in which the wrapping mode can be set from command line, will provide the following options:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="option">--wrap</code></span></dt>
<dd>
<p>Perform basic wrapping, on certain column.</p>
</dd>
<dt><span class="term"><code class="option">--no-wrap</code></span></dt>
<dd>
<p>Do not perform basic wrapping.</p>
</dd>
<dt><span class="term"><code class="option">--fine-wrap</code></span></dt>
<dd>
<p>Perform fine wrapping, on various expected visual breaks introduced by text markup in rendered text.</p>
</dd>
<dt><span class="term"><code class="option">--no-fine-wrap</code></span></dt>
<dd>
<p>Do not perform fine wrapping.</p>
</dd>
<dt><span class="term"><code class="option">--wrap-column=<em class="replaceable"><code>COL</code></em></code></span></dt>
<dd>
<p>The column at which the text should be wrapped. The wrapped line in the PO file will never be longer than this many columns, including the outer quotes. If not given, the default is 79.</p>
</dd>
</dl>
</div>
<p>Both positive and negative wrapping options are provided in order to be able to override the wrapping mode defined by the user configuration of the PO header. As in Gettext tools, strings are always wrapped on <code class="literal">\n</code> regardless of the wrapping mode.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmwrcfg" id="sec-cmwrcfg"></a>9.8.2.&nbsp;Common User Configuration Fields for Wrapping</h3>
</div>
</div>
</div>
<p>The following configuration fields will be read by the tools which consult the user configuration for wrapping mode, in their respective configuration sections:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">[<em class="replaceable"><code>section</code></em>]/wrap=[*yes|no]</code></span></dt>
<dd>
<p>Whether to perform basic wrapping, counterpart to <code class="option">--wrap</code> and <code class="option">--no-wrap</code> command line options.</p>
</dd>
<dt><span class="term"><code class="literal">[<em class="replaceable"><code>section</code></em>]/fine-wrap=[yes|*no]</code></span></dt>
<dd>
<p>Whether to perform fine wrapping, counterpart to <code class="option">--fine-wrap</code> and <code class="option">--no-fine-wrap</code> command line options.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cmheader" id="sec-cmheader"></a>9.9.&nbsp;Influential Header Fields</h2>
</div>
</div>
</div>
<p><a class="link" href="#sec-poheader" title="2.6.&nbsp;PO Header">The PO header</a> is a natural place to provide the information which holds for the PO file as whole. Pology scripts, sieves, and hooks can take into account a number of header fields, when available, to automatically determine some aspects of processing. The fields considered are as follows:</p>
<div class="variablelist">
<dl>
<dt><a name="hdr-language" id="hdr-language"></a><span class="term"><code class="literal">Language</code></span></dt>
<dd>
<p>This field contains the language code of the translation, which Pology will take into account in all contexts where language-dependent processing is done (such as when <a class="link" href="#sec-lgspell" title="8.2.&nbsp;Spell Checking">spell-checking</a>). You can also specify the language into which you translate in <a class="link" href="#sec-cmconfig" title="9.2.&nbsp;User Configuration">user configuration</a>, and sometimes in the command line. The language stated by the PO header will override the user configuration, but it will be in turn overridden by the command line. See also <a class="xref" href="#sec-lglangenv" title="8.1.&nbsp;The Notion of Language in Pology">Section&nbsp;8.1, “The Notion of Language in Pology”</a>.</p>
</dd>
<dt><a name="hdr-x-accelerator-marker" id="hdr-x-accelerator-marker"></a><span class="term"><code class="literal">X-Accelerator-Marker</code></span></dt>
<dd>
<p><a class="link" href="#sec-poaccel" title="2.3.4.&nbsp;Accelerators">Accelerator markers</a> are a frequent obstacle in text processing, such as <a class="link" href="#sv-find-messages" title="3.5.17.&nbsp;find-messages">searching</a> or <a class="link" href="#sec-lgspell" title="8.2.&nbsp;Spell Checking">spell-checking</a>, because they can split words apart. This field can be used to specify which character is used as accelerator marker throughout the file, if any. If there are several possible characters, they can be given as comma-separated list<sup>[<a name="id682209" href="#ftn.id682209" class="footnote" id="id682209">41</a>]</sup>. While it is usually possible to specify the accelerator marker through the command line, the header field is much more convenient and flexible: there is no need to remember to add the command line option at every run, and different PO files can have different accelerator markers. However, if command line option is issued, it will override the header field.</p>
<p>There is a difference between this field not existing in the header, and existing but with an empty value (i.e. <code class="literal">"X-Accelerator-Marker: \n"</code>). If the field does not exist, some processing elements will go into the "greedy" mode, where they use a list of known frequent accelerator markers (e.g. to remove them from the text). If the field is set to empty value, these processing elements will take it that there are no accelerator markers in text.</p>
</dd>
<dt><a name="hdr-x-associated-ui-catalogs" id="hdr-x-associated-ui-catalogs"></a><span class="term"><code class="literal">X-Associted-UI-Catalogs</code></span></dt>
<dd>
<p>This field lists the PO domains which are the source of user interface references (button labels, menu items, etc.) throughout the text in current PO file. This makes it possible to automatically fetch and insert UI translations, rather than having to look them up manually and maintain them against changes; see <a class="xref" href="#sec-lguirefs" title="8.4.&nbsp;Automatic Insertion of UI Labels">Section&nbsp;8.4, “Automatic Insertion of UI Labels”</a> for details. Several PO domains can be given as space- or comma-separated list. If the UI message is found in more than one listed PO domain, the earlier in the list takes precedence.</p>
</dd>
<dt><a name="hdr-x-environment" id="hdr-x-environment"></a><span class="term"><code class="literal">X-Environment</code></span></dt>
<dd>
<p>The language environment to which the translation belongs; see <a class="xref" href="#sec-lglangenv" title="8.1.&nbsp;The Notion of Language in Pology">Section&nbsp;8.1, “The Notion of Language in Pology”</a> for details. It can be a single keyword, or a comma-separated list of keywords. If several environments are given, the later in the list (which is usually the more specific) takes precedence.</p>
</dd>
<dt><a name="hdr-x-text-markup" id="hdr-x-text-markup"></a><span class="term"><code class="literal">X-Text-Markup</code></span></dt>
<dd>
<p>When the text contains <a class="link" href="#sec-pomarkup" title="2.3.2.&nbsp;Text Markup">markup</a>, it may be useful to remove it such that only the plain text remains. This is the case, for example, when computing word counts or applying <a class="link" href="#sec-lgrules" title="8.5.&nbsp;Validation Rules">terminology validation rules</a>. Another use case would be the validation of markup itself (whether a tag is properly closed, whether a tag exists, etc.) This header field specifies the markup type found in the text, as a keyword, so that Pology can determine how to process it. Several markup types can be given as comma-separated list.</p>
<p>Pology currently recognizes the following markup types:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">docbook4</code> -- Docbook 4.x markup, in documentation POs</p>
</li>
<li class="listitem">
<p><code class="literal">html</code> -- HTML 4.01</p>
</li>
<li class="listitem">
<p><code class="literal">kde4</code> -- markup in KDE4 UI POs, a mix of Qt rich-text and KUIT</p>
</li>
<li class="listitem">
<p><code class="literal">kuit</code> -- UI semantic markup in KDE 4</p>
</li>
<li class="listitem">
<p><code class="literal">qtrich</code> -- Qt rich-text, (almost) a subset of HTML</p>
</li>
<li class="listitem">
<p><code class="literal">xmlents</code> -- only XML-like entities, no other formal markup</p>
</li>
</ul>
</div>
</dd>
<dt><a name="hdr-x-wrapping" id="hdr-x-wrapping"></a><span class="term"><code class="literal">X-Wrapping</code></span></dt>
<dd>
<p>This header field can be set to tell Pology how to <a class="link" href="#sec-cmwrap" title="9.8.&nbsp;Line Wrapping in PO Messages">wrap strings</a> in the current PO file, for example, when <span class="command"><strong>posieve</strong></span> modifies a message and writes the modified PO file, or when rewrapping is done explicitly by <span class="command"><strong>porewrap</strong></span>. The value is a comma-separated list of wrapping modes, chosen from:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="literal">basic</code> -- wrapping on certain column</p>
</li>
<li class="listitem">
<p><code class="literal">fine</code> -- wrapping on logical breaks (such as <code class="literal">&lt;p&gt;</code> or <code class="literal">&lt;br/&gt;</code> tags)</p>
</li>
</ul>
</div>
<p>Wrapping on escaped newline <code class="literal">\n</code> is always performed, regardless of the wrapping mode. If the field value is empty, no other wrapping is done. If more than one wrapping mode is given (e.g. <code class="literal">"X-Wrapping: basic, fine\n"</code>), it is specificaly defined how modes are combined, so the ordering is not important. As usual, if wrapping is specified by a command line option, that will override the header field.</p>
</dd>
</dl>
</div>
<p>All of the listed header fields may be set manually, when you get to work on the particular PO file. But frequently it is possible to set them automatically, or at least automatically for the first time with later manual corrections where needed. For this you may use <a class="link" href="#sv-set-header" title="3.5.29.&nbsp;set-header">the <span class="command"><strong>set-header</strong></span> sieve</a>. If PO files are periodically merged by the translation project automation (rather than each translator merging on his own only the PO files which he is about to update), the natural moment to run <span class="command"><strong>set-header</strong></span> is just after the merging. If translation is done <a class="link" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">in summit</a>, you can specify in summit configuration to set header fields on merging.</p>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cmhooks" id="sec-cmhooks"></a>9.10.&nbsp;Processing Hooks</h2>
</div>
</div>
</div>
<p>Pology enables the user to insert special processing elements, called <span class="emphasis"><em>hooks</em></span>, at many places in the processing chain. Hooks are Python functions with certain prescribed input, output, and behavior. Depending on the exact combination of these three ingredients, there are various <span class="emphasis"><em>hook types</em></span>. Finally, some hooks can be adapted to a given context through their <span class="emphasis"><em>hook factories</em></span>. Pology defines many hooks internally, and users can add their own external hooks.</p>
<p>Usage of hooks is best illustrated through examples. Suppose that you want to use the <a class="link" href="#sv-find-messages" title="3.5.17.&nbsp;find-messages">the <span class="command"><strong>find-messages</strong></span> sieve</a> to look for a certain word, but the text contains XML-like tags of the form <code class="literal">&lt;<em class="replaceable"><code>tagname</code></em>&gt;...&lt;<em class="replaceable"><code>/tagname</code></em>&gt;</code> which happen to be throwing off your search. Suppose that there exists a hook called <code class="literal">remove-xml-tags</code>, in the Pology library module <code class="literal">remove</code>, which takes a piece of text as input and returns that piece of text cleared of any XML-like tags. Then you could insert this hook into the search to clear the tags before matching the text, by using the <code class="option">filter:</code> parameter to <span class="command"><strong>find-messages</strong></span>:</p>
<pre class="programlisting">
$ posieve find-messages -s filter:'remove/remove-xml-tags' ...
</pre>
<p>Here <code class="literal">remove/remove-xml-tags</code> is the hook specification, and this is its usual simplest form: the module name, followed by slash, followed by the hook name. (Sometimes it can be only the module name, when the hook function within that module has the same name as the module, but this is rare.) The hook specification was enclosed in single quotes, for the shell to see it as single string; this was not necessary here, but it is a good habit to keep up when adding hooks through command line, because hook specification can get quite involved.</p>
<p>Suppose now that there is a single hook that can remove any kind of markup from the text (not only XML-like tags) called <code class="literal">remove-markup</code>, but that it has to be told which markup to remove, by giving it one of the markup type keywords known to Pology. Continuing the previous example, this could be done like this:</p>
<pre class="programlisting">
$ posieve find-messages -s filter:'remove/remove-markup~"docbook4"' ...
</pre>
<p>Now the hook specification is <code class="literal">remove/remove-markup~"docbook4"</code>. Note that outer single quotes in the command line are necessary, as otherwise the shell would strip internal double quotes, which are here integral part of hook specification. <code class="literal">remove-markup</code> is actually a <span class="emphasis"><em>hook factory</em></span>, which produces a hook based on the parameters given after the tilde (<code class="literal">~</code>) character. Here <code class="literal">"docbook4"</code> is that parameter; why must it be quoted? Because the part after the tilde is passed as argument list to a Python function, and <code class="literal">"docbook4"</code> must be of string type, which is in Python denoted by quotes. For a hook factory <code class="literal">foo/bar</code> which would take a string and a number, the hook specification would be <code class="literal">foo/bar~"qwyx",5</code>. Sometimes a hook factory has default values for some or all of its arguments; in the latter case, if the defaults are sufficient, the part after the tilde in the hook specification can be left empty (e.g. <code class="literal">foo/bar~</code>).</p>
<p>Hooks can be language- and project-dependent. Suppose that in your language the letters are sometimes accented, but the accents should be ignored on spell-checking. Then Pology may contain a hook which strips accents from text in your language. If your language code is <code class="literal">ll</code>, and the hook is <code class="literal">remove-accents</code> in (language-specific) module <code class="literal">remove</code>, you could check spelling while ignoring accents using the <a class="link" href="#sv-find-messages" title="3.5.17.&nbsp;find-messages">the <span class="command"><strong>check-spell-ec</strong></span> sieve</a>:</p>
<pre class="programlisting">
$ posieve check-spell-ec -s filter:'ll:remove/remove-accents' ...
</pre>
<p>The hook specification now also contains the language code separated by colon, as <code class="literal">ll:...</code>. If the hook is project-specific instead, it is prefixed with <code class="literal">pp%...</code>, where <code class="literal">pp</code> is the project identifier and percent sign the separator. If the hook is both language- and project-specific, then the specification is <code class="literal">ll:pp%...</code> or <code class="literal">pp%ll:...</code>.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmhooktypes" id="sec-cmhooktypes"></a>9.10.1.&nbsp;Hook Types</h3>
</div>
</div>
</div>
<p>In places where a hook can be inserted, it is convenient to succinctly state which types of hooks are acceptable. Hook types are therefore coded with letter-number-letter combinations. The first letter can be F, V, or S, standing for filtering, validation, or side-effect hook, in that order. Filtering hooks modify their input, validation hooks report problems in input in a way understood by their clients, while side-effect hooks can do anything except modifying the input. The number after the first letter describes the composition of input, which can be pure text, PO message, PO header, etc. and their combinations. The final letter indicates the semantics of the input, like whether the input text is supposed to be the original (<code class="varname">msgid</code>) or the translation (<code class="varname">msgstr</code>) or can be any of them.</p>
<p>The following hooks types are currently defined (the hook type is followed by the expected input in parenthesis):</p>
<div class="variablelist">
<dl>
<dt><span class="term">F1A (text)</span></dt>
<dd>
<p>Modifies the input text.</p>
</dd>
<dt><span class="term">V1A (text)</span></dt>
<dd>
<p>Validates the input text.</p>
</dd>
<dt><span class="term">S1A (text)</span></dt>
<dd>
<p>Side-effects based on the input text.</p>
</dd>
<dt><span class="term">F3A (text, message, file)</span></dt>
<dd>
<p>Modifies the input text, which is one of the strings in the given PO message, which belongs to the given PO file. The difference between F1A and F3A hooks is that an F1A hook can process text based only on the text itself, while an F3A hook can process text by taking into account the information elsewhere in the PO message (e.g. in comments) and the PO file (e.g. in header). This holds for all *1* and *3* hook types.</p>
</dd>
<dt><span class="term">V3A (text, message, file)</span></dt>
<dd>
<p>Validates the input text, which is one of the strings in the given PO message, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">S3A (text, message, file)</span></dt>
<dd>
<p>Side-effects based on the input text, which is one of the strings in the given PO message, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">F3B (original, message, file)</span></dt>
<dd>
<p>Modifies the input text, which is the <code class="varname">msgid</code> (or <code class="varname">msgid_plural</code>) string in the given PO message, which belongs to the given PO file. The difference between F3A and F3B hooks is that the input text of an F3B hook is expected to be precisely the original string in the message, while giving anything else will lead to undefined results. This holds for all *3A, *3B, *3C hook types.</p>
</dd>
<dt><span class="term">V3B (original, message, file)</span></dt>
<dd>
<p>Validates the input text, which is the <code class="varname">msgid</code> (or <code class="varname">msgid_plural</code>) string in the given PO message, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">S3B (original, message, file)</span></dt>
<dd>
<p>Side-effects based on the input text, which is the <code class="varname">msgid</code> (or <code class="varname">msgid_plural</code>) string in the given PO message, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">F3C (translation, message, file)</span></dt>
<dd>
<p>Modifies the input text, which is one of the <code class="varname">msgstr</code> strings in the given PO message, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">V3C (translation, message, file)</span></dt>
<dd>
<p>Validates the input text, which is one of the <code class="varname">msgstr</code> strings in the given PO message, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">S3C (translation, message, file)</span></dt>
<dd>
<p>Side-effects based on the input text, which is one of the <code class="varname">msgstr</code> strings in the given PO message, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">F4A (message, file)</span></dt>
<dd>
<p>Modifies the input PO message, which belongs to the given PO file. The difference between F4A and F3A hooks is that an F3A hook can modify only the given string in the message, while an F4A hook can modify any number of strings, comments, etc. in the message. This holds for all *3* and *4* hook types.</p>
</dd>
<dt><span class="term">V4A (message, file)</span></dt>
<dd>
<p>Validates the input PO message, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">S4A (message, file)</span></dt>
<dd>
<p>Side-effects based on the input PO message, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">F4B (header, file)</span></dt>
<dd>
<p>Modifies the input PO header, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">V4B (header, file)</span></dt>
<dd>
<p>Validates the input PO header, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">S4B (header, file)</span></dt>
<dd>
<p>Side-effects based on the input PO header, which belongs to the given PO file.</p>
</dd>
<dt><span class="term">F5A (file)</span></dt>
<dd>
<p>Modifies the input PO file. As opposed to F1* and F3* hooks, which can modify only elements within PO messages, F5* hooks can also add, remove, and change positions of messages within the PO file.</p>
</dd>
<dt><span class="term">V5A (file)</span></dt>
<dd>
<p>Validates the input PO file. As opposed to V1* and V3* hooks, which report only problems confined to PO messages, V5* hooks can also report problems due to relation between several PO messages each of which is valid in itself.</p>
</dd>
<dt><span class="term">S5A (file)</span></dt>
<dd>
<p>Side-effects based on the input PO file.</p>
</dd>
<dt><span class="term">F6A (any file)</span></dt>
<dd>
<p>Modifies the input file, whether in PO or another format, on the level of pure text lines. This is unlike F5A hooks which operate on the level of entries in the PO file; F6A hooks are also typically limited to certain types of files, perhaps even only PO files. This holds for all *6* hook types.</p>
</dd>
<dt><span class="term">V6A (raw file)</span></dt>
<dd>
<p>Validates the input file.</p>
</dd>
<dt><span class="term">S6A (raw file)</span></dt>
<dd>
<p>Side-effects based on the input file.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cminthooks" id="sec-cminthooks"></a>9.10.2.&nbsp;List of Internal Hooks</h3>
</div>
</div>
</div>
<p>Pology does not establish strict separation between users and programmers, but presents a continuum between pure use and pure programming, so that users can engage according to their needs and abilities. Hooks, in particular, occupy the middle of this range. On the one hand side, they can be used even from command line; on the other hand side, they are actually Python functions, and hook specifications (in command line and elsewhere) sometimes require Python argument lists (the part after the tilde). This makes it hard both to list all available hooks<sup>[<a name="id643789" href="#ftn.id643789" class="footnote" id="id643789">42</a>]</sup>, and to decide where and how to document them, in the user manual or in the library programming interface (API) documentation. Therefore, the following will be done. Here, in the user manual, only functions written specifically to be used as hooks will be listed (sometimes grouped by similarity), with their types and short descriptions. To that the link to the complete hook description in the API documentation will be added.<sup>[<a name="id643801" href="#ftn.id643801" class="footnote" id="id643801">43</a>]</sup></p>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-cmghooks" id="sec-cmghooks"></a>9.10.2.1.&nbsp;General Hooks</h4>
</div>
</div>
</div>
<div class="variablelist">
<dl>
<dt><a name="hk-bpatterns-bad-patterns" id="hk-bpatterns-bad-patterns"></a><span class="term"><a class="ulink" href="../../api/html/pology.bpatterns-module.html#bad_patterns" target="_top"><code class="literal">bpatterns/bad-patterns</code></a> (S3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.bpatterns-module.html#bad_patterns_msg" target="_top"><code class="literal">bpatterns/bad-patterns-msg</code></a> (S4A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.bpatterns-module.html#bad_patterns_msg_sp" target="_top"><code class="literal">bpatterns/bad-patterns-msg-sp</code></a> (V4A)</span></dt>
<dd>
<p>Detects unwanted patterns in text, by regular expression matching. Patterns can be specified either as direct arguments, or listed in file given as argument.</p>
<div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Caution</h3>
<p>This hook is deprecated. Use <a class="link" href="#sec-lgrules" title="8.5.&nbsp;Validation Rules">validation rules</a> instead, which are much a richer method of defining and checking for problems.</p>
</div>
</dd>
<dt><a name="hk-gtxtools-msgfilter" id="hk-gtxtools-msgfilter"></a><span class="term"><a class="ulink" href="../../api/html/pology.gtxtools-module.html#msgfilter" target="_top"><code class="literal">gtxtools/msgfilter</code></a> (F6A)</span></dt>
<dd>
<p>Pipes the PO file through Gettext's <span class="command"><strong>msgfilter(1)</strong></span>. The filter argument and options to <span class="command"><strong>msgfilter</strong></span> can be specified as parameters to hook factory. (May be used to wrap the PO file canonically, as Pology does not produce exactly the same wrapping as Gettext tools.)</p>
</dd>
<dt><a name="hk-gtxtools-msgfmt" id="hk-gtxtools-msgfmt"></a><span class="term"><a class="ulink" href="../../api/html/pology.gtxtools-module.html#msgfmt" target="_top"><code class="literal">gtxtools/msgfmt</code></a> (S6A)</span></dt>
<dd>
<p>Pipes the PO file through Gettext's <span class="command"><strong>msgfmt(1)</strong></span>, discarding output and reporting any errors as warnings. Useful for hard check of the PO file syntax, and extended checks performed when <span class="command"><strong>msgfmt</strong></span> is run with <code class="option">--check</code> option.</p>
</dd>
<dt><a name="hk-markup-check-xml" id="hk-markup-check-xml"></a><span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_xml" target="_top"><code class="literal">markup/check-xml</code></a> (S3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_xml_sp" target="_top"><code class="literal">markup/check-xml-sp</code></a> (V3C)</span></dt>
<dd>
<p>Checks whether general XML markup in translation is well-formed, and possibly also whether entities are defined. Checks can be performed either only when the original text itself is valid or unconditionally.</p>
</dd>
<dt><a name="hk-markup-check-xml-spec" id="hk-markup-check-xml-spec"></a><span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_docbook4" target="_top"><code class="literal">markup/check-docbook4</code></a> (S3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_docbook4_sp" target="_top"><code class="literal">markup/check-docbook4-sp</code></a> (V3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_docbook4_msg" target="_top"><code class="literal">markup/check-docbook4-msg</code></a> (V4A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_html" target="_top"><code class="literal">markup/check-html</code></a> (S3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_html_sp" target="_top"><code class="literal">markup/check-html-sp</code></a> (V3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_qtrich" target="_top"><code class="literal">markup/check-qtrich</code></a> (S3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_qtrich_sp" target="_top"><code class="literal">markup/check-qtrich-sp</code></a> (V3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_kde4" target="_top"><code class="literal">markup/check-kde4</code></a> (S3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_kde4_sp" target="_top"><code class="literal">markup/check-kde4-sp</code></a> (V3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_pango" target="_top"><code class="literal">markup/check-pango</code></a> (S3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_pango_sp" target="_top"><code class="literal">markup/check-pango-sp</code></a> (V3C)</span></dt>
<dd>
<p>Specializations of <a class="link" href="#hk-markup-check-xml"><code class="literal">markup/check-xml</code></a> hook for various XML formats. Aside from well-formedness, these hooks can also check whether used tags really exist in the format, whether tags are properly nested, etc. (Full conformance to DTD or schema cannot be checked due to chunking into messages.)</p>
</dd>
<dt><a name="hk-markup-check-xmlents" id="hk-markup-check-xmlents"></a><span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_xmlents" target="_top"><code class="literal">markup/check-xmlents</code></a> (S3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.markup-module.html#check_xmlents_sp" target="_top"><code class="literal">markup/check-xmlents-sp</code></a> (V3C)</span></dt>
<dd>
<p>Checks whether XML-like entities (<code class="literal">&amp;foo;</code>) are defined. This can be used when the markup is not trully XML-like but it uses XML-like entities, or simply to have separate checking of tagging (by <a class="link" href="#hk-markup-check-xml-spec"><code class="literal">markup/check-xml-*</code></a> hooks) and entities for convenience.</p>
</dd>
<dt><a name="hk-noop" id="hk-noop"></a><span class="term"><a class="ulink" href="../../api/html/pology.noop-module.html#text" target="_top"><code class="literal">noop/text</code></a> (F1A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.noop-module.html#textm" target="_top"><code class="literal">noop/textm</code></a> (F3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.noop-module.html#msg" target="_top"><code class="literal">noop/msg</code></a> (F4A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.noop-module.html#hdr" target="_top"><code class="literal">noop/hdr</code></a> (F4B),</span> <span class="term"><a class="ulink" href="../../api/html/pology.noop-module.html#cat" target="_top"><code class="literal">noop/cat</code></a> (F5A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.noop-module.html#path" target="_top"><code class="literal">noop/path</code></a> (F6A)</span></dt>
<dd>
<p>Filtering hooks that do nothing ("no-operation"). These are useful in contexts where a filtering hook is required, but input should not be really modified.</p>
</dd>
<dt><a name="hk-normalize-demangle-srcrefs" id="hk-normalize-demangle-srcrefs"></a><span class="term"><a class="ulink" href="../../api/html/pology.normalize-module.html#demangle_srcrefs" target="_top"><code class="literal">normalize/demangle-srcrefs</code></a> (F4A)</span></dt>
<dd>
<p>In some message extraction scenarios, the source references end up pointing to dummy files which existed only during the extraction, but true source references can still be reconstructed (based on dummy file names or extracted comments). This hook will reconstruct true source references and replace dummy references with them.</p>
</dd>
<dt><a name="hk-normalize-uniq-source" id="hk-normalize-uniq-source"></a><span class="term"><a class="ulink" href="../../api/html/pology.normalize-module.html#uniq_source" target="_top"><code class="literal">normalize/uniq-source</code></a> (F4A)</span></dt>
<dd>
<p>Sometimes source references in PO message end up doubled (e.g. one prefixed with <code class="filename">./</code> and the other not) due to perculiarities of the extraction process. This hook will make source references unique.</p>
</dd>
<dt><a name="hk-normalize-uniq-auto-comment" id="hk-normalize-uniq-auto-comment"></a><span class="term"><a class="ulink" href="../../api/html/pology.normalize-module.html#uniq_auto_comment" target="_top"><code class="literal">normalize/uniq-auto-comment</code></a> (F4A)</span></dt>
<dd>
<p>When extracted comments are automatically added to messages by the extraction tool, if the message is repeated in several source files it may end up containing multiple equal extracted comments. This hook can be used to make extracted comments unique (either all or those matching some criteria).</p>
</dd>
<dt><a name="hk-normalize-canonical-header" id="hk-normalize-canonical-header"></a><span class="term"><a class="ulink" href="../../api/html/pology.normalize-module.html#canonical_header" target="_top"><code class="literal">normalize/canonical-header</code></a> (F4B)</span></dt>
<dd>
<p>Rearranges content of the PO header into canonical form. For example, translator comments will be sorted according to years of contribution, any repeated translator comments will be merged, etc.</p>
</dd>
<dt><a name="hk-remove-remove-accel" id="hk-remove-remove-accel"></a><span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_accel_text" target="_top"><code class="literal">remove/remove-accel-text</code></a> (F3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_accel_text_greedy" target="_top"><code class="literal">remove/remove-accel-text-greedy</code></a> (F3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_accel_msg" target="_top"><code class="literal">remove/remove-accel-msg</code></a> (F4A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_accel_msg_greedy" target="_top"><code class="literal">remove/remove-accel-msg-greedy</code></a> ()</span></dt>
<dd>
<p>Removes accelerator marker from one or all strings in the message. They will check if the PO file <a class="link" href="#hdr-x-accelerator-marker">specifies the accelerator marker</a>; if not, non-greedy variants will do nothing, while greedy variants will remove everything that is frequently used as accelerator marker.</p>
</dd>
<dt><a name="hk-remove-remove-markup" id="hk-remove-remove-markup"></a><span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_markup_text" target="_top"><code class="literal">remove/remove-markup-text</code></a> (F3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_markup_msg" target="_top"><code class="literal">remove/remove-markup-msg</code></a> (F4A)</span></dt>
<dd>
<p>Converts markup (e.g. XML tags) in one or all strings in the message to plain text. The PO file will be asked for <a class="link" href="#hdr-x-text-markup">the expected markup types in text</a>; if no markup type is specified, these hooks will do nothing.</p>
</dd>
<dt><a name="hk-remove-remove-fmtdirs" id="hk-remove-remove-fmtdirs"></a><span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_fmtdirs_text" target="_top"><code class="literal">remove/remove-fmtdirs-text</code></a> (F3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_fmtdirs_text_tick" target="_top"><code class="literal">remove/remove-fmtdirs-text-tick</code></a> (F3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_fmtdirs_msg" target="_top"><code class="literal">remove/remove-fmtdirs-msg</code></a> (F4A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_fmtdirs_msg_tick" target="_top"><code class="literal">remove/remove-fmtdirs-msg-tick</code></a> (F4A)</span></dt>
<dd>
<p>Removes <a class="link" href="#sec-poformdir" title="2.3.1.&nbsp;Format Directives">format directives</a> in one or all strings in the message, or replaces them with a fixed placeholder. The type of format directives is determined by <code class="literal">*-format</code> message flags.</p>
</dd>
<dt><a name="hk-remove-remove-literals" id="hk-remove-remove-literals"></a><span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_literals_text" target="_top"><code class="literal">remove/remove-literals-text</code></a> (F3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_literals_text_tick" target="_top"><code class="literal">remove/remove-literals-text-tick</code></a> (F3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_literals_msg" target="_top"><code class="literal">remove/remove-literals-msg</code></a> (F4A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_literals_msg_tick" target="_top"><code class="literal">remove/remove-literals-msg-tick</code></a> (F4A)</span></dt>
<dd>
<p>Removes "literal" segments from one or all strings in the message, or replaces them wih a fixed placeholder. Literal segments are those which are used as computer input somewhere along the line, such as URLs, email addresses, command line options, etc. and therefore generally do not conform to human language rules. Translator can also explicitly declare literal segments, by adding a special translator comment.</p>
</dd>
<dt><a name="hk-remove-remove-marlits" id="hk-remove-remove-marlits"></a><span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_marlits_text" target="_top"><code class="literal">remove/remove-marlits-text</code></a> (F3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_marlits_msg" target="_top"><code class="literal">remove/remove-marlits-msg</code></a> (F4A)</span></dt>
<dd>
<p><a class="link" href="#hk-remove-remove-literals"><code class="literal">remove/remove-literals-*</code></a> hooks can positively determine only certain types of literals based on the text alone. If the text contains semantic markup, such as Docbook, literal segments can also be determined based on tags, and these hooks will remove both such tags and their text. The markup type will be taken <a class="link" href="#hdr-x-text-markup">from the PO file</a>. (When these hooks are used, <code class="literal">remove/remove-literals-*</code> is not needed.)</p>
</dd>
<dt><a name="hk-remove-rewrite-msgid" id="hk-remove-rewrite-msgid"></a><span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#rewrite_msgid" target="_top"><code class="literal">remove/rewrite-msgid</code></a> (F4A)</span></dt>
<dd>
<p><a class="link" href="#sec-lgrules" title="8.5.&nbsp;Validation Rules">Checks are sometimes defined</a> such that something is first looked up in the original text, and if it is found, something is expected in the translation. No matter how well written these checks are, the original text will sometimes be a bit out of the ordinary, and the check will fail the translation although everything is fine. This can usually be corrected by the translator manually adding a directive, in a special translator comment, to "rewrite" the problematic part of the original before the check is applied.</p>
</dd>
<dt><a name="hk-remove-rewrite-inverse" id="hk-remove-rewrite-inverse"></a><span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#rewrite_inverse" target="_top"><code class="literal">remove/rewrite-inverse</code></a> (F4A)</span></dt>
<dd>
<p>The original text in the message needs to be modified for the same reasons as described in <a class="link" href="#hk-remove-rewrite-msgid"><code class="literal">remove/rewrite-msgid</code></a>, but it is actually easiest to replace the original text entirely with the original text from another message sharing the same translation (i.e. by "inverse" pairing of messages over translation).</p>
</dd>
<dt><a name="hk-remove-remove-paired-ents" id="hk-remove-remove-paired-ents"></a><span class="term"><a class="ulink" href="../../api/html/pology.remove-module.html#remove_paired_ents" target="_top"><code class="literal">remove/remove-paired-ents</code></a> (F4A)</span></dt>
<dd>
<p>Removes all XML-like entities (<code class="literal">&amp;foo;</code>) from the original text, and all XML-like entities from the translation that were encountered in the original. This may be useful prior to markup validity checks, when the list of defined entities cannot be provided.</p>
</dd>
<dt><a name="hk-spell" id="hk-spell"></a><span class="term"><a class="ulink" href="../../api/html/pology.spell-module.html#check_spell" target="_top"><code class="literal">spell/check-spell</code></a> (S3A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.spell-module.html#check_spell_sp" target="_top"><code class="literal">spell/check-spell-sp</code></a> (V3A)</span></dt>
<dd>
<p>Spell-checking hooks, as one element of <a class="link" href="#sec-lgspell" title="8.2.&nbsp;Spell Checking">Pology's spell-checking functionality</a>.</p>
</dd>
<dt><a name="hk-uiref-resolve-ui" id="hk-uiref-resolve-ui"></a><span class="term"><a class="ulink" href="../../api/html/pology.uiref-module.html#resolve_ui" target="_top"><code class="literal">uiref/resolve-ui</code></a> (F3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.uiref-module.html#resolve_ui_docbook4" target="_top"><code class="literal">uiref/resolve-ui-docbook4</code></a> (F3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.uiref-module.html#resolve_ui_kde4" target="_top"><code class="literal">uiref/resolve-ui-kde4</code></a> (F3C)</span></dt>
<dd>
<p>When translating program documentation, using these hooks it is possible to leave UI references (button labels, menu items, etc.) untranslated and let them be <a class="link" href="#sec-lguirefs" title="8.4.&nbsp;Automatic Insertion of UI Labels">automatically inserted into translation later on</a>. The basic hook requires UI references to be manually wrapped in translation in order to be detected, while specialized versions will also use semantic markup for detection (e.g. <code class="literal">&lt;guilabel&gt;</code> element in Docbook).</p>
</dd>
<dt><a name="hk-uiref-check-ui" id="hk-uiref-check-ui"></a><span class="term"><a class="ulink" href="../../api/html/pology.uiref-module.html#check_ui" target="_top"><code class="literal">uiref/check-ui</code></a> (V3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.uiref-module.html#check_ui_docbook4" target="_top"><code class="literal">uiref/check-ui-docbook4</code></a> (V3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.uiref-module.html#check_ui_kde4" target="_top"><code class="literal">uiref/check-ui-kde4</code></a> (V3C)</span></dt>
<dd>
<p>While <a class="link" href="#hk-uiref-resolve-ui"><code class="literal">uiref/resolve-ui</code></a> hooks will complain when they cannot find a translation for a UI reference, when checking the overall validity of translation it is more convenient to use specialized check-only hooks which will not modify the PO file on succesfully resolved UI references.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-cmlshooks" id="sec-cmlshooks"></a>9.10.2.2.&nbsp;Language-Specific Hooks</h4>
</div>
</div>
</div>
<div class="variablelist">
<dl>
<dt><a name="hk-lang-ja-katakana" id="hk-lang-ja-katakana"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.ja.katakana-module.html#katakana" target="_top"><code class="literal">ja:katakana</code></a> (F1A)</span></dt>
<dd>
<p>Removes everything but Katakana words from Japanese text, and separates retained words with spaces. (Used as filter prior to spell-checking words in Katakana.)</p>
</dd>
<dt><a name="hk-lang-nn-exclusion-inofficial-forms" id="hk-lang-nn-exclusion-inofficial-forms"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.nn.exclusion-module.html#inofficial_forms" target="_top"><code class="literal">nn:exclusion/inofficial-forms</code></a> (V3C)</span></dt>
<dd>
<p>Checks if there are any inofficial word forms in Norwegian Nynorsk translation.</p>
</dd>
<dt><a name="hk-lang-sr-accents-resolve-agraphs" id="hk-lang-sr-accents-resolve-agraphs"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.accents-module.html#resolve_agraphs" target="_top"><code class="literal">sr:accents/resolve-agraphs</code></a> (F1A)</span></dt>
<dd>
<p>Converts "accent graphs" to proper accented letters in Serbian Cyrillic text (e.g. <code class="literal">^а</code> becomes <code class="literal">а̂</code>).</p>
</dd>
<dt><a name="hk-lang-sr-accents-remove-accents" id="hk-lang-sr-accents-remove-accents"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.accents-module.html#remove_accents" target="_top"><code class="literal">sr:accents/remove-accents</code></a> (F1A)</span></dt>
<dd>
<p>Replaces accented letters in Serbian Cyrillic text with their non-accented counterparts. (Useful as filter prior to spell-checking.)</p>
</dd>
<dt><a name="hk-lang-sr-limit-charset" id="hk-lang-sr-limit-charset"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.charsets-module.html#limit_to_isocyr" target="_top"><code class="literal">sr:charsets/limit-to-isocyr</code></a> (F1A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.charsets-module.html#limit_to_isolat" target="_top"><code class="literal">sr:charsets/limit-to-isolat</code></a> (F1A)</span></dt>
<dd>
<p>In situations where it is necessary to use an 8-bit encoding instead of Unicode for Serbian text, these hooks can be used to constrain characters in text to only those representable by the target 8-bit encoding.</p>
</dd>
<dt><a name="hk-lang-sr-checks-naked-latin" id="hk-lang-sr-checks-naked-latin"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.checks-module.html#naked_latin" target="_top"><code class="literal">sr:checks/naked-latin</code></a> (V3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.checks-module.html#naked_latin_origui" target="_top"><code class="literal">sr:checks/naked-latin-origui</code></a> (V3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.checks-module.html#naked_latin_se" target="_top"><code class="literal">sr:checks/naked-latin-se</code></a> (S3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.checks-module.html#naked_latin_origui_se" target="_top"><code class="literal">sr:checks/naked-latin-origui-se</code></a> (S3C)</span></dt>
<dd>
<p>In translations into Serbian using Cyrillic script, ordinary segments in Latin script may indicate error or omission in translation. These hooks will look for such stray Latin segments, while ignoring recognizable literal segments such as URLs, commands, options, etc.</p>
</dd>
<dt><a name="hk-lang-sr-nobr-to-nobr-hyphens" id="hk-lang-sr-nobr-to-nobr-hyphens"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.nobr.to_nobr_hyphens-module.html#" target="_top"><code class="literal">sr:nobr/to-nobr-hyphens</code></a> (F1A)</span></dt>
<dd>
<p>The ordinary hyphen (-) is normally treated as a character on which the text can be split into the next line. In Serbian texts, hyphens are sometimes used to attach case endings to nouns (especially acronyms), which should not be split into the next line. This hooks guesses such positions and replaces the ordinary hyphen with no-break hyphen.</p>
</dd>
<dt><a name="hk-lang-sr-reduce" id="hk-lang-sr-reduce"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.reduce-module.html#words_ec" target="_top"><code class="literal">sr:reduce/words-ec</code></a> (F1A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.reduce-module.html#words_ec_lw" target="_top"><code class="literal">sr:reduce/words-ec-lw</code></a> (F1A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.reduce-module.html#words_ic" target="_top"><code class="literal">sr:reduce/words-ic</code></a> (F1A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.reduce-module.html#words_ic_lw" target="_top"><code class="literal">sr:reduce/words-ic-lw</code></a> (F1A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.reduce-module.html#words_ic_lw_dlc" target="_top"><code class="literal">sr:reduce/words-ic-lw-dlc</code></a> (F1A)</span></dt>
<dd>
<p>Various reductions of Serbian text to a subset of words of certain type, possibly rearranged in a particular way.</p>
</dd>
<dt><a name="hk-lang-sr-trapres-froments" id="hk-lang-sr-trapres-froments"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.trapres-module.html#froments" target="_top"><code class="literal">sr:trapres/froments</code></a> (F3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.trapres-module.html#froments_t1" target="_top"><code class="literal">sr:trapres/froments-t1</code></a> (F3C),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.trapres-module.html#froments_t1db" target="_top"><code class="literal">sr:trapres/froments-t1db</code></a> (F3C)</span></dt>
<dd>
<p>Hooks which resolve grammatical inserts in form of XML entities in Serbian text, based on the "trapnakron" contained within Pology. See the documentation in Serbian section for details.</p>
</dd>
<dt><a name="hk-lang-sr-uiref" id="hk-lang-sr-uiref"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.uiref-module.html#" target="_top"><code class="literal">sr:uiref/mod_entities</code></a> (F1A)</span></dt>
<dd>
<p>When UI references are <a class="link" href="#hk-uiref-resolve-ui">automatically resolved</a> in documentation, and the UI texts may contain <a class="link" href="#hk-lang-sr-trapres-froments">grammatical inserts in form of XML entities</a>, these inserts may need to be slightly modified to keep the documentation structure valid.</p>
</dd>
<dt><a name="hk-lang-sr-wconv" id="hk-lang-sr-wconv"></a><span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.wconv-module.html#ctol" target="_top"><code class="literal">sr:wconv/ctol</code></a> (F1A),</span> <span class="term"><a class="ulink" href="../../api/html/pology.lang.sr.wconv-module.html#cltoa" target="_top"><code class="literal">sr:wconv/cltoa</code></a> (F1A),</span> <span class="term">and many more</span></dt>
<dd>
<p>Hooks for various transliterations and hybridizations of Serbian text, by script (Cyrillic, Latin) and dialect (Ekavian, Ijekavian). See the documentation in Serbian section for details.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sec-cmpshooks" id="sec-cmpshooks"></a>9.10.2.3.&nbsp;Project-Specific Hooks</h4>
</div>
</div>
</div>
<div class="variablelist">
<dl>
<dt><a name="hk-proj-kde-header-equip-header" id="hk-proj-kde-header-equip-header"></a><span class="term"><a class="ulink" href="../../api/html/pology.proj.kde.header-module.html#equip_header" target="_top"><code class="literal">kde%header/equip-header</code></a> (F4B)</span></dt>
<dd>
<p>Adds assorted header fields to PO files within the KDE Translation Project, with values based on their name and position in the repository tree, so that Pology and other tools are better informed how to process them.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmexthooks" id="sec-cmexthooks"></a>9.10.3.&nbsp;Using External Hooks</h3>
</div>
</div>
</div>
<p>[Not implemented yet.]</p>
<p>See <a class="xref" href="#sec-prhooks" title="11.4.&nbsp;Writing Hooks">Section&nbsp;11.4, “Writing Hooks”</a> for instructions on how to write and contribute hooks.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cmskipcheck" id="sec-cmskipcheck"></a>9.11.&nbsp;Skipping and Selecting Checks</h2>
</div>
</div>
</div>
<p>With all the different heuristic checks and rules that Pology can apply, false positives -- messages proclaimed invalid when they are actually valid -- are inevitable. False positivies are <span class="emphasis"><em>very</em></span> inconvenient in serious automatic quality control effort. They make it harder for translators to spot real problems, which in turn demotivates them to apply automatic checks at all. If there is one or few dedicated persons in the translation team to tweak and apply automatic checks, they would be particularly hard-hit with this negative feedback. False positives can reduce automatic quality control from a strong normative element in the workflow, to merely advisory "run-if-you-have-the-time" extra.</p>
<p>For this reason, most checks in Pology provide a way for them to be disabled on certain messages, files, or the processing batch, such that it is possible to methodically cancel false positives. From the other side, it is usually possible to run one or few checks on their own, in order to be easier to define and debug. Each checking tool and element documents such functionality, and in the following only some general patterns are described.</p>
<p>The simplest method to disable or enable some checks is "dynamically", for single validation run, through an option to the tool which is being run. For example, <a class="link" href="#sv-check-rules" title="3.5.7.&nbsp;check-rules">the <span class="command"><strong>check-rules</strong></span> sieve</a> provides several parameters to select and deselect validation rules which are to be applied. The important point here is that checks in Pology usualy have some sort of a unique identifier, a keyword, by which they can be referred to.</p>
<p>"Static" methods to disable or enable checks are those where the instruction is written down somewhere, in a specific format, and automatically taken into account by the validation tool in subsequent runs. There may be several static methods to disable a certain check, differing in their reach: a group of PO files, single PO file, single message, or even a part of the text in the message. Within one PO file, the following methods are common:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The PO header is a natural place to disable or enable checks for the complete PO file, by adding a custom <code class="literal">X-</code> header field.</p>
</li>
<li class="listitem">
<p>On the single message level, the only place where it is possible to add a manual processing instruction is a <a class="link" href="#sec-pomancmnt" title="2.2.3.&nbsp;Translator Comments">translator comment</a>. This is because if it would put anywhere else (e.g. as extracted comment or a flag), it would be removed on subsequent merging with template. These instructions are usualy kept simple, like this:</p>
<pre class="programlisting">
# <em class="replaceable"><code>some-instruction</code></em>: <em class="replaceable"><code>arguments</code></em>
#: ...
msgid "..."
msgstr "..."
</pre>
<p>Instructions are always composed of two or more words, separated by hyphens, ended by colon, and followed by an arbitrary argument string (e.g. a list of identifiers of checks to skip on this message). This makes it sufficiently unlikely that another, free-form translator comment will be accidentally interpreted as a known instruction.<sup>[<a name="id682697" href="#ftn.id682697" class="footnote" id="id682697">44</a>]</sup></p>
</li>
<li class="listitem">
<p><a name="p-trflag" id="p-trflag"></a>A special type of translator comment with processing instructions is a comment of the following form:</p>
<pre class="programlisting">
# |, <em class="replaceable"><code>flag1</code></em>, <em class="replaceable"><code>flag2</code></em>, ...
</pre>
<p>This is a "translator flag" comment, which is used to set processing instructions too simple to occupy one whole comment line (e.g. those of the switch type, never needing arguments). It starts with <code class="literal">|,</code>, and continues with comma-separated list of flag-like keywords.</p>
</li>
</ul>
</div>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id603602" href="#id603602" class="para" id="ftn.id603602">39</a>]</sup> The other frequently encountered file organization is when there is one directory per PO domain, and that directory contains PO files for all languages, named as <code class="filename"><em class="replaceable"><code>LANG</code></em>.po</code>.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id681869" href="#id681869" class="para" id="ftn.id681869">40</a>]</sup> But if several people are working on a collection of PO files, it is nevertheless good to agree on fixed wrapping. This is both friendly to those exposed to original wrapping, and to version control systems.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id682209" href="#id682209" class="para" id="ftn.id682209">41</a>]</sup> This does mean that the case when the comma itself is the accelerator marker is not covered, but this case is beyond unlikely.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id643789" href="#id643789" class="para" id="ftn.id643789">42</a>]</sup> For example, any Python function in Pology that takes one string and returns the modified version of that string can be considered an F1A hook!</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id643801" href="#id643801" class="para" id="ftn.id643801">43</a>]</sup> In the API documentation, the very first line of the function description will show if the function is a direct hook or a hook factory, the function header will list the inputs for a direct hook (which conform to the declared hook type) or the factory parameters for a hook factory, and the rest of the description will explain the operation of the hook and the meaning of factory parameters.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id682697" href="#id682697" class="para" id="ftn.id682697">44</a>]</sup> Especially considering that free-form translator comments are more usually written in the language of the translation.</p>
</div>
</div>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-combined" id="ch-combined"></a>Chapter&nbsp;10.&nbsp;Combined Arms Tactics</h2>
</div>
</div>
</div>
<p>While each particular PO processing tool from Pology and other packages may be documented in itself, it may not be always obvious how to use these tools together. This chapter presents some scenarios where combined tool usage may increase the quality and efficiency of daily work on translation.</p>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cbcompend" id="sec-cbcompend"></a>10.1.&nbsp;Creating and Using PO Compendia</h2>
</div>
</div>
</div>
<p>A <span class="emphasis"><em>PO compendium</em></span> is simply a PO file which aggregates messages from many other normal PO files, usually all same-language PO files in a given translation project. It may aggregate only the messages currently present in project PO files, but also messages that were present once and are no longer. As such, the compendium can be regarded as an instance of a <span class="emphasis"><em>translation memory</em></span>. This section explains how to create, update, and apply such a translation memory.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cbcomptm" id="sec-cbcomptm"></a>10.1.1.&nbsp;Why Translation Memory?</h3>
</div>
</div>
</div>
<p>Imagine that the translator wants to start translating a PO file that was so far never translated, but which has content similar to some other, translated PO files. Perhaps it was even derived from those other PO files, by merging, splitting, etc. This means that many messages in the present PO file may have been translated already in some other PO file, or at least that very similar translated messages exist in other PO files. Since the translation memory (TM) contains all known translated messages, it can be used to automatically produce translated and fuzzy messages in the present PO file, significantly reducing translation effort. Matching against the TM can be performed either as the translator goes from message to message in the editor (if the editor has a TM feature), or at once for all messages (by a specialized command) before starting to go through messages in the editor.</p>
<p>In most non-PO based translation workflows, translation memories are crucial for efficiency. This is because most non-PO formats have no concept of merging with templates. Each new revision of the source material results in (an equivalent of) entirely empty translation files, and it is translator's duty to somehow bring old translations into the new context. A carefully maintained TM, with a corresponding matching tool, is the foremost way to do this.</p>
<p>In a PO-based translation workflow, merging with templates already provides most of what TM is essential for. In effect, the old PO file that is being merged can be considered as a TM for the new PO file that will become based on the new template. Even when PO files are renamed, merged, or split, if that is properly done, no translations will be lost. A TM for PO files is therefore useful mostly to smooth out glitches in translation maintenance procedures (e.g. a PO file improperly split).<sup>[<a name="id601369" href="#ftn.id601369" class="footnote" id="id601369">45</a>]</sup> Nevertheless, having a well maintained TM in the form of PO compendium cannot hurt, while providing for the (hopefully) rare situations where TM matching is actually needed.</p>
<p>Many dedicated PO editors will automatically maintain an internal TM, usually in a database format, into which they will scoop messages from all PO files that were opened in them. However, in a team environment, these internal TMs are inferior to a PO compendium. For one, different translators will have different TMs; a translator may start to work on a file for which there are TM matches in another translator's internal TM. Internal TMs may be volatile, for example corrupted due to an editor bug, or perish during system maintenance. There is no control over which messages are scooped by the editor, and how they are treated (e.g. which message parts are being ignored).</p>
<p>On the other hand, a PO compendium can be maintained in a central place, and, being a PO file in itself, kept in version control just like all other PO files. In this way, all translators have fast access to a unified TM, which is secured from accidental corruption. Tight control over which messages are collected and how they are collected may be asserted, in the script which is written to update the compendium. This script can be made to run periodically, and to automatically commit updated compendium the version control repository.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmcompcr" id="sec-cmcompcr"></a>10.1.2.&nbsp;Maintaining a Centralized PO Compendium</h3>
</div>
</div>
</div>
<p>As a first attempt, the PO compendium can be created simply by concatenting all PO files in the project into one called <code class="filename">compendium.po</code>, using <span class="command"><strong>msgcat</strong></span>. If PO files are organized by language (all PO files of a given language kept in directory of that language), then the concatenation command would be:</p>
<pre class="programlisting">
$ cd $LANGDIR
$ find -iname \*.po | xargs msgcat -o compendium.po
</pre>
<p>Unfortunatelly, a compendium created in this way has a number of drawbacks:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Aside from translated messages, the compendium will also contain untranslated and fuzzy messages. While untranslated messages are obviously dead weight, a case could be made for taking in fuzzy messages. But in light of the suggested usage of the compendium in the following section, fuzzy messages too should be ignored.</p>
</li>
<li class="listitem">
<p>Messages in the compendium will contain all parts as normal messages do. Some of these parts (such as source references) are unnecessary, since they will be ignored when applying the compendium later. Other than increasing the size of the compendium, another problem with these parts is that changes in them will cause unnecessary version control differences, so they should be stripped from the compendium.</p>
</li>
<li class="listitem">
<p>Messages will be ordered as they are seen in concatenated PO files. The ordering of messages in the compendium is also of no importance for application. But, any changes in message ordering between two compendium updates will cause unnecessary version control differences, so it is best to sort messages by their keys (<code class="varname">msgid</code> and <code class="varname">msgctxt</code> fields).</p>
</li>
<li class="listitem">
<p>When two or more PO files contain the same message by key (<code class="varname">msgid</code> and <code class="varname">msgctxt</code>) but with different translations (due to context), such as:</p>
<pre class="programlisting">
msgid "Open File"
msgstr "Otvori datoteku"

msgid "Open File"
msgstr "Otvaranje datoteke"
</pre>
<p><span class="command"><strong>msgcat</strong></span> will <span class="emphasis"><em>aggregate</em></span> translations (and translator comments if any) in the compendium message, and make it fuzzy:</p>
<pre class="programlisting">
#, fuzzy
msgid "Open File"
msgstr ""
"#-#-#-#-#  alpha.po (alpha-1.2.9)  #-#-#-#-#\n"
"Otvori datoteku\n"
"#-#-#-#-#  bravo.po (bravo-0.8.12)  #-#-#-#-#\n"
"Otvaranje datoteke"
</pre>
<p>Since the context should be double-checked anyway when applying the compendium later (especially for short messages), it is better to instead pick one of the translations and have a normal translated compendium message. If each translation appears only once, then it does not matter which is picked; but if one translation appears 10 times and the other once, clearly the former should be picked. That is, the most frequent translation should be picked.</p>
</li>
<li class="listitem">
<p>The PO header is treated in the same way as messages by <span class="command"><strong>msgcat</strong></span>: since all headers have equal <code class="varname">msgid</code> field (empty), their <code class="varname">msgstr</code> fields will be aggregated. This too is just dead weight since the header is not used in applications of the compendium. Instead, a brief and informative header should be explicitly set (mentioning that this is a compendium PO file, for which project and language, etc).</p>
</li>
<li class="listitem">
<p>In some translation projects, PO files frequently contain <span class="emphasis"><em>meta-messages</em></span>, such as those where translators can add their names and contact addresses. These messages have the same key (<code class="varname">msgid</code>) in all PO files, but should be translated differently in general, the more so the more the people in the translation team. So it may be better to omit such messages from the compendium.</p>
</li>
</ul>
</div>
<p>It must be noted that none of these problems are an actual deficiency of <span class="command"><strong>msgcat</strong></span> itself. Since its function is general concatenation of PO files, it cannot make any of the assumptions necessary for the present application. Instead, <span class="command"><strong>msgcat</strong></span> should be used as a part of a wider script, in which the necessary additional processing happens, tailored to the particular translation project and translation team.</p>
<p>Let us assume the following layout of the top directory for the translation project <code class="literal">foo</code> and translation team (language) <code class="literal">nn</code>:</p>
<pre class="programlisting">
foo-nn/
    ui/
        alpha.po
        bravo.po
        ...
    doc/
        alpha.po
        bravo.po
        ...
    update-compendium-foo-nn.sh
    compendium-foo-nn.po
</pre>
<p><code class="filename">update-compendium-foo-nn.sh</code> will be the script to create or update the compendium, <code class="filename">compendium-foo-nn.po</code> the compendium itself. It helps clarity to add the project name and language into names of these two files, because both are tailored to that project and that language. Taking into account the aforementioned drawbacks of a simple compendium made by <span class="command"><strong>msgcat</strong></span> and the suggested resolutions, <code class="filename">update-compendium-foo-nn.sh</code> could look like this<sup>[<a name="id599985" href="#ftn.id599985" class="footnote" id="id599985">46</a>]</sup>:</p>
<pre class="programlisting">
#!/bin/sh
#
# Create the PO compendium of Foo in Nevernissian language.
#
# Usage:
#   update-compendium-foo-nn.sh [trim]
#
# The script can be called from anywhere, because PO paths are
# hardcoded within the script relative to its own location.
# If the 'trim' argument is not given (i.e. script is called
# without arguments), messages in the old compendium that are
# no longer found in project PO files are preserved in
# the new compendium; if 'trim' is given, they are removed.

# Directory where this script resides.
cmddir=`dirname $0`
# Paths of directories containing PO files, space-separated.
# (Make sure the compendium itself is not in here!)
podirs="$cmddir/ui $cmddir/doc"
# Path to the compendium.
comppo="$cmddir/compendium-foo-nn.po"

trim=$1

# If there is already a compendium, preserve it for later.
test -f $comppo &amp;&amp; mv $comppo $comppo.old

# Collect PO files from given paths into a file.
find $podirs -iname \*.po | sort &gt; polist

# Pre-process PO files in the project, creating temporary
# PO files named *.po.tmpcomp:
# - remove fuzzy and untranslated messages
# - declare obsolete messages non-obsolete
# - remove extracted comments, source references, flags
for pofile in `cat polist`; do
    msgattrib $pofile \
        --translated --no-fuzzy --clear-obsolete --force-po \
    | grep -v '^#[:.,]' &gt; $pofile.tmpcomp
done
# Update file list to contain temporary PO files.
sed -i "s/$/.tmpcomp/" polist

# Reduce headers of temporary PO files to necessary minimum,
# proper header for the compendium will be added later.
posieve -q set-header -f polist \
    -srmallcomm \
    -sremoverx:'^(?!MIME-Version$|Content-Type$|Content-Transfer-Encoding$)'

# Create raw compendium from temporary PO files:
# - aggregate translations for repeated messages
# - sort messages by key
msgcat --sort-output --force-po -f polist -o $comppo

# Clean up temporary PO files and file list.
cat polist | xargs rm
rm polist

# Resolve aggregated messages to most frequent variant.
# It is safe to unfuzzy resolved messages, since at
# this point assured that only translated messages
# have been aggregated.
posieve -q resolve-aggregates $comppo -sunfuzzy

# Remove meta-messages which are found in many PO files but
# should in general be differently translated in each.
msggrep -v $comppo -o $comppo \
    -JFe 'NAME OF TRANSLATORS' \
    -JFe 'EMAIL OF TRANSLATORS' \
    -JFe 'ROLES_OF_TRANSLATORS' \
    -JFe 'CREDIT_FOR_TRANSLATORS' \

# Set the compendium header.
# Use current date as revision date.
dtnow=`date '+%Y-%m-%d %H:%M%z'`
posieve -q set-header $comppo -screate \
    -stitle:'Compendium of Foo translation into Nevernissian.' \
    -sfield:'Project-Id-Version:compendium-foo-nn' \
    -sfield:"PO-Revision-Date:$dtnow" \
    -sfield:'Last-Translator:Simulacrum' \
    -sfield:'Language-Team:Nevernissian &lt;l10n-nn@neverwhere.org&gt;' \
    -sfield:'Language:nn' \
    -sfield:'Plural-Forms:nplurals=9; plural=n==1 ? ...' \

# If the old compendium was preserved, add it to the new compendium
# in order to retain messages no longer found in the project
# (unless trimming was requested).
if test -f $comppo.old &amp;&amp; test x"$trim" != xtrim; then
    msgcat --use-first --sort-output $comppo $comppo.old -o $comppo
    # ...old compendium must be the second argument, in order
    # not to override possibly updated translations of
    # existing messages in the project.
fi

# Test if new compendium is different from the old, with
# the exception  of creation time. If they are the same,
# discard the new compendium.
if test -f $comppo.old; then
    for cpfile in $comppo $comppo.old; do
        grep -v '^"PO-Revision-Date:.*\\n"$' $cpfile &gt;$cpfile.nrd
    done
    if cmp -s $comppo.nrd $comppo.old.nrd; then
        mv $comppo.old $comppo
    else
        rm $comppo.old
    fi
    rm $comppo.nrd $comppo.old.nrd
fi

# Canonically wrap the compendium.
msgcat $comppo -o $comppo

# All done.
</pre>
<p>This script should be periodically called to update the compendium, and the updated file committed, such that all translators will automatically get it when they update their local repository copies. If after some (long) time the compendium becomes to big due to accumulation of old messages, running the script once with the <code class="literal">trim</code> argument will cause all old messages to be dropped.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cmcompuse" id="sec-cmcompuse"></a>10.1.3.&nbsp;Applying the PO Compendium</h3>
</div>
</div>
</div>
<p>With a centralized PO compendium in place,</p>
<p>Translators who use a dedicated PO editor with internal TM should configure the editor to read the compendium into the internal TM. This may be done, for example, by including the compendium PO file (or the directory in which it resides) into editor's translation project paths. If the compendium is kept under version control, the editor should automatically update its internal TM from the compendium whenever the repository is updated and the editor started again. In this way, editor's internal TM becomes transient in nature, there being no problem if it gets corrupted or deleted.</p>
<p>When working on a particular PO file with a properly configured PO editor, as the translator jumps from one to another incomplete (untranslated or fuzzy) message, when the message is similar to one or few messages in the compendium (i.e. in internal TM) the editor will somehow "offer" those similar messages. Ideally, for each similar message the editor should show not only the possible translation, but also the difference between the two original texts (that of the current message and the TM match). This will allow the translator to quickly see how the offered translation should be adapted to fit the current original.</p>
<p>Dedicated PO editors may also offer <span class="emphasis"><em>batch</em></span> application of the TM. This means that when the PO file is opened, the translator executes a command which fills in all untranslated messages with matches from the TM, making some translated (on exact matches) and some fuzzy (partial matches). However, simpleminded <span class="emphasis"><em>batch application of the TM should be considered dangerous</em></span>. For one, exact matches in the source language may not be exact matches in the original; especially short messages frequently need different translations. But the translator will simply jump over each batch-translated message and fail to see this. The other problem comes up if the material in the compendium is not sufficiently reviewed, in which case every match from the TM, even on long messages, should be at least casually reviewed by the translator. Thus, if there is no way to configure batch application to be less indiscriminate, it is best to avoid it alltogether, or else the quality of translation may suffer.</p>
<p>Translators who use a general text editor to work on PO files can still make use of the compendium. One option could be merging the PO file with its template in presence of the compendium, just before starting to work on it:</p>
<pre class="programlisting">
$ msgmerge alpha.po alpha.pot -C compendium.po --update --previous
</pre>
<p>The <code class="option">-C</code> option to <span class="command"><strong>msgmerge</strong></span> specifies the compendium from which to draw exact and partial matches, when there is no match in the PO file itself. This option can be repeated to add several compendia. The <code class="option">--update</code> option is to modify the PO file in place, rather than writing the merged PO file to standard output. The <code class="option">--previous</code> option is to get previous fields (<code class="literal">#| ...</code> comments) on fuzzy messages. Unfortunatelly, this method is a command line version of the batch application of the TM in a dedicated PO editor, and suffers from the same problem of indiscriminate exact matches that the translator will later fail to check. Therefore it should not be used (at least not for general translation).</p>
<p>Fortunatelly, Pology provides the <span class="command"><strong>poselfmerge</strong></span> command, which is a wrapper around <span class="command"><strong>msgmerge</strong></span>, and has several options to mitigate the indiscriminancy problem of batch application of TM. To avoid silent exact matches on short messages, the <code class="option">-W</code>/<code class="option">--min-words-exact</code> can be used to set the minimum length of a message in words at which the exact match will be accepted; otherwise the message is made fuzzy. If every exact match should be checked by the translator, no matter the length of the message, there is the <code class="option">-x</code>/<code class="option">--fuzzy-exact</code> to make all exact matches fuzzy.<sup>[<a name="id619018" href="#ftn.id619018" class="footnote" id="id619018">47</a>]</sup> These options have counterpart fields in Pology user configuration, so that the translator does not have to remember to use them on every run, and the PO template is not used at all. See <a class="xref" href="#sec-miselfmerge" title="7.2.&nbsp;Self-Merging PO Files with poselfmerge">Section&nbsp;7.2, “Self-Merging PO Files with <span class="command"><strong>poselfmerge</strong></span>”</a> for details.</p>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cbeffedit" id="sec-cbeffedit"></a>10.2.&nbsp;Efficiently Translating with a Text Editor</h2>
</div>
</div>
</div>
<p>Dedicated PO editors provide not only direct editing enhancements (no dealing with PO format syntax, jumping through incomplete messages, automatic removal of fuzzy elements, etc), but also translation-oriented features like spell checking, translation memory collection and application, glossary suggestions, and, going beyond standalone PO files, translation project overview and statistics. Why would someone, in spite of this, prefer to work on PO files with a general text editor? There are various reasons. Some people do not like how elements of currently translated PO message are scattered all over the window (as is typical of many PO editors), out of eye focus, and some elements even not shown. Other people like to have modularity in the translation workflow, rather than relying on the PO editor for everything and accepting its limitations. Some people are simply well accustomed to their text editor and do not want a higher level editor "abstracting" the PO format for them.</p>
<p>When translating PO files with a general text editor, you will have to use some command line tools to achieve reasonable efficiency and quality.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cbeffedfeat" id="sec-cbeffedfeat"></a>10.2.1.&nbsp;Expected Features of the Text Editor</h3>
</div>
</div>
</div>
<p>Starting from the text editor itself, it should have several general text-editing features. Capable editors all have these features, but they should nevertheless be mentioned, so that you can look for them.</p>
<p>The most important feature is probably <span class="emphasis"><em>syntax highlighting</em></span>, where special parts of the text are displayed in different color, weight, or slant. In a PO file, message field keywords (<code class="varname">msgid</code>, <code class="varname">msgstr</code>) should stand out from the text itself, text in comments should look different from the text in fields, internal text elements (e.g. markup tags) should be highlighted, etc. In this way you can quickly focus on what you should be editing, and on the surrounding context of the text. Syntax higlighting was originaly introduced for various programming language source files, but has since spread to other types of structured text files; established editors should have syntax highlighting for PO files as well.</p>
<p>Capable editors usually provide special methods of navigating through the file, above simply scrolling up and down line by line or page by page. One particularly useful method would be <span class="emphasis"><em>line bookmarking</em></span>. While in the middle of editing a given line, you have to search through the PO file for something (e.g. how a certain phrase was translated earlier): you can then bookmark the line, search as much as you like, and return to the same line by jumping to the bookmark. Otherwise you would have to remember which line (by number) it was to jump back to it, or search for the text that you remember from that line.<sup>[<a name="id664379" href="#ftn.id664379" class="footnote" id="id664379">48</a>]</sup></p>
<p>It will usually be possible to start the editor with one or more file paths as command-line arguments, to open those files at once. This is useful when a selection of PO files in need of some editing is determined by an external command, which writes out their paths. These paths can then be fed directly to the editor, rather than having to open them manually one by one (and possibly missing some) through editor's file dialog.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cbeffstats" id="sec-cbeffstats"></a>10.2.2.&nbsp;Statistics on PO Files</h3>
</div>
</div>
</div>
<p>Having good statistics on a single or a group of PO files is necessary for estimating the translation effort, for example how much time should be allotted for updating the existing translation for impending next release of the source material. Pology's workhorse for computing statistics is <a class="link" href="#sv-stats" title="3.5.30.&nbsp;stats">the <span class="command"><strong>stats</strong></span> sieve</a> of <span class="command"><strong>posieve</strong></span>.</p>
<p><a name="p-trpsetup1" id="p-trpsetup1"></a>Assume the following arrangement of PO files for language <code class="literal">nn</code> and their templates:</p>
<pre class="programlisting">
l10n-nn/
    ui/
        alpha.po
        bravo.po
        ...
    doc/
        alpha.po
        bravo.po
        ...
l10n-templates/
    ui/
        alpha.pot
        bravo.pot
        ...
    doc/
        alpha.pot
        bravo.pot
        ...
</pre>
<p>If the current working directory is <code class="filename">l10n-nn/</code>, to compute statistics on a single PO file, <span class="command"><strong>posieve</strong></span> can be executed like this:</p>
<pre class="programlisting">
$ posieve stats ui/alpha.po
</pre>
<p>This will display a table with message counts, word counts and characters counts, as well as ratios to total, per category of messages (translated, fuzzy, untranslated, obsolete). To have the same output for all PO files in the <code class="filename">ui/</code> directory taken together, or in the whole project, respectively:</p>
<pre class="programlisting">
$ posieve stats ui/
$ posieve stats
</pre>
<p>Note that word count is a much better base for estimating the translation effort than message count.</p>
<p>When statistics is computed for several PO files (or a directory, or several directories full of PO files), frequently it is necessary to get statistics per file (or per directory). This is done by adding the <code class="option">byfile</code> or <code class="option">bydir</code> sieve parameter:</p>
<pre class="programlisting">
$ posieve stats -s byfile ui/
</pre>
<p>However, this will output one full table for each file, which may be a bit too much data to grasp. Instead, you can request bar display, where each file is represented by a single-line bar. The bar shows either the number of messages or the number words per category, depending on whether <code class="option">msgbar</code> or <code class="option">wbar</code> was issued. To get word bars per file in <code class="filename">ui/</code> directory, you can execute:</p>
<pre class="programlisting">
$ posieve stats -s byfile -s wbar ui/
</pre>
<p>Fuzzy messages introduce some uncertainty in effort estimation. If the statistics shows 50 fuzzy messages with 700 words, you cannot conclude from that if changes in those messages are small (e.g. cleaned style, punctuation) and translation can be quickly updated, or substantial (entirely new messages with passing similarity to earlier message) and require heavy editing. For this reason the <span class="command"><strong>stats</strong></span> sieve provides the <code class="option">ondiff</code> parameter: for each fuzzy message the difference from previous message is computed, and based on that a part of the word count is assigned to translated category and the rest to untranslated (thus leaving nominal zero words in the fuzzy category). The result is that, for example, a PO file with a lot of messages fuzzy due to punctuation changes will show in statistics as almost completely translated by number of words.</p>
<p>If the translation project is organized such that new empty PO files are not automatically derived from new PO templates, then when running statistics just over language PO files it will happen that templates which do not have a counterpart PO file are not counted as fully empty PO files. To have such templates counted, the two-argument <code class="option">templates</code> parameter can be issued; the first parameter is a path segment of the language directory, and the second parameter what to replace it with to get the corresponding template directory path. In the translation project setup as above, this is how you would compute the statistics on <code class="filename">ui/</code> directory while taking templates into account:</p>
<pre class="programlisting">
$ posieve stats -s templates:l10n-nn:l10n-templates ui/
</pre>
<p>The path replacement is always done on absolute paths, so in this example it is not a problem that the relative paths (<code class="filename">ui/alpha.po</code>...) do not contain original and replacement segments.</p>
<p>The translation project may not be organized such that each language has its own top directory. Instead, language PO files may be grouped by application and PO domain, and named by language code:</p>
<pre class="programlisting">
project/
    alpha/
        po/
            aa.po
            bb.po
            ...
    bravo/
        po/
            aa.po
            bb.po
            ...
    ...
</pre>
<p>In this setup the <span class="command"><strong>stats</strong></span> sieve can still be run on directory paths as arguments, in order to get statistics on all PO files of a given language, by using the <code class="option">-I</code>/<code class="option">--include-path</code> option of <span class="command"><strong>posieve</strong></span> to single out the desired language. For example, to get statistics on all PO files of the <code class="literal">nn</code> language in a single table:</p>
<pre class="programlisting">
$ posieve stats project/ -I 'nn.po'
</pre>
<p>or by file in form of message bars:</p>
<pre class="programlisting">
$ posieve stats -s byfile -s msgbar project/ -I 'nn.po'
</pre>
<p>The value of the <code class="option">-I</code> option is in fact a <a class="link" href="#sec-cmregex" title="9.3.&nbsp;Regular Expressions">regular expression</a>, and the option can be repeated, which allows to finely tune the file selection when necessary.</p>
<p>As for other statistics tools, Gettext's <span class="command"><strong>msgfmt</strong></span> with <code class="option">--statistics</code> option could be considered as one (though it shows only translated, fuzzy, and untranslated message counts), and especially the <a class="ulink" href="http://translate.sourceforge.net/wiki/toolkit/pocount" target="_top">the <span class="command"><strong>pocount</strong></span> command from Translate Toolkit</a>.</p>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cbeffupdate" id="sec-cbeffupdate"></a>10.2.3.&nbsp;Updating PO Files After Merging</h3>
</div>
</div>
</div>
<p>When a single PO file is to be translated from scratch, then it is easy to just open it in the text editor and start translating messages one by one. However, usually more frequent than this is translation maintenance, in which you need to go through a bunch of freshly merged PO files and update new untranslated and fuzzy messages. The problem then is twofold: how to efficiently check which files need updating, and how to efficiently go through messages that need to be updated within a file.</p>
<p>To see which PO files need to be updated, you can simply run the <span class="command"><strong>stats</strong></span> sieve with <code class="option">byfile</code> and <code class="option">msgbar</code>/<code class="option">wbar</code> parameters (and possibly <code class="option">ondiff</code>), as explained in the previous section. After that you would have to manually observe incomplete files and open them in the editor one by one, which is tedious and prone to oversight. Instead, you can also add the <code class="option">incompfile</code> parameter to <span class="command"><strong>stats</strong></span>, which will write paths of all incomplete PO files into a file. If PO files are organized as in <a class="link" href="#p-trpsetup1">the previous example</a>, and you want to update translations in <code class="filename">ui/</code> subdirectory, you would run:</p>
<pre class="programlisting">
$ posieve stats -s byfile -s wbar -s incompfile:toupdate.out ui/
</pre>
<p>Now <code class="filename">toupdate.out</code> will contain the paths of incomplete files. If the editor can be started from the command line with a number of file path arguments, you can directly feed it <code class="filename">toupdate.out</code>, e.g. by adding <code class="filename">`cat toupdate.out`</code> to the editor command.</p>
<p>If the translation project is organized such that each new template results in new empty PO file, you may wish to update only those PO files which where worked on before, i.e. those not entirely empty. For this you can add the <code class="option">mincomp</code> parameter, which sets the minimal completeness (the ratio of translated to total messages) at which to take a PO file into consideration, with a very small value:</p>
<pre class="programlisting">
$ posieve stats -s mincomp:1e-6 -s incompfile:toupdate.out ui/
</pre>
<p><code class="literal">1e-6</code> is short for <code class="literal">0.000001</code>, which means to take into consideration only those PO files which have more than one in a million translated files. Since there is no PO file with a million messages, this effectively means to include every PO file which has at least one translated message in it.</p>
<p>Once the incomplete PO files are open in the editor, to be able to jump through incomplete messages, you need to somehow use editor's search function. For fuzzy messages it is easy, you can just search for the <code class="literal">, fuzzy</code> string. Untranslated messages, on the other hand, are more problematic. You may think of searching for <code class="literal">msgstr ""</code>, but this would also find long wrapped messages:</p>
<pre class="programlisting">
msgid ""
"Blah blah blah [...]"
"blah blah."
msgstr ""
"Bla bla bla [...]"
"bla bla."
</pre>
<p>To make untranslated messages stand out unambiguously, there is <a class="link" href="#sv-tag-untranslated" title="3.5.31.&nbsp;tag-untranslated">the <span class="command"><strong>tag-untranslated</strong></span> sieve</a>. It simply adds <code class="literal">untranslated</code> flag to all untranslated messages (but not to fuzzy unless explicitly requested), so that you can search for <code class="literal">, untranslated</code> in the editor. The most convenient is to run <span class="command"><strong>tag-untranslated</strong></span> on the <code class="filename">toupdate.out</code> file produced by <span class="command"><strong>stats</strong></span> using the <code class="option">-f</code>/<code class="option">--from-files</code>:</p>
<pre class="programlisting">
$ posieve tag-untranslated -f toupdate.out
</pre>
<p>Fuzzy messages may be such only due to small changes in the original text, for example a single word changed in a paragraph-length message. This is not so easy to see by manually comparing the original and the translation. However, since fuzzy messages should have the previous original text in comments (if merged with <code class="option">--previous</code> option of <span class="command"><strong>msgmerge</strong></span>), it is possible to automatically embed differences into those comments with <a class="link" href="#sv-diff-previous" title="3.5.13.&nbsp;diff-previous">the <span class="command"><strong>sv-diff-previous</strong></span> sieve</a>; see its documentation for an example. You should run this sieve on <code class="filename">toupdate.out</code> as well:</p>
<pre class="programlisting">
$ posieve diff-previous -f toupdate.out
</pre>
<p>Your editor may even highlight the difference segments added to the previous original text, making them stand out quite clearly.</p>
<p>Since normally you want both to mark untranslated messages and to add differences to fuzzy messages before going through PO files, you can run the two sieves at once:</p>
<pre class="programlisting">
$ posieve tag-untranslated,diff-previous -f toupdate.out
</pre>
<p>As you go through incomplete messages and update the translation, you should remove any <code class="literal">fuzzy</code> or <code class="literal">untranslated</code> flags, and previous fields in <code class="literal">#| ...</code> comments, so that in the end you can commit (upload, send) clean updated PO files. But sometimes it will happen that you realize that you do not have enough time to update everything, and you want to commit what you have completed by that moment. The problem is that there will still be some <code class="literal">untranslated</code> flags and embedded differences remaining throughout the files, and leftover embedded differences would e.g. interfere with subsequent merging. To automatically remove these remaining elements, you simply run the two sieves with the <code class="option">strip</code> parameter:</p>
<pre class="programlisting">
$ posieve tag-untranslated,diff-previous -s strip -f toupdate.out
</pre>
<p>When you update a PO file, for the sake of clarity and copyright you should also update its header with your personal data (the author comment, the <code class="literal">Last-Translator:</code> field, etc.) You could do this manually, but it is much simpler to set your data once in the <a class="link" href="#sec-cmconfig" title="9.2.&nbsp;User Configuration">Pology user configuration</a> and run <a class="link" href="#sv-update-header" title="3.5.35.&nbsp;update-header">the <span class="command"><strong>update-header</strong></span> sieve</a> over all updated files<sup>[<a name="id646005" href="#ftn.id646005" class="footnote" id="id646005">49</a>]</sup>:</p>
<pre class="programlisting">
$ posieve update-header -f toupdate.out
</pre></div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-cbsumasc" id="sec-cbsumasc"></a>10.3.&nbsp;Summit with Ascription</h2>
</div>
</div>
</div>
<p>Summit and ascription workflows, described in <a class="xref" href="#ch-summit" title="Chapter&nbsp;5.&nbsp;Summitting Translation Branches">Chapter&nbsp;5, <i>Summitting Translation Branches</i></a> and <a class="xref" href="#ch-ascript" title="Chapter&nbsp;6.&nbsp;Ascribing Modifications and Reviews">Chapter&nbsp;6, <i>Ascribing Modifications and Reviews</i></a>, fit excellently together. Ascription enables review-based release control on summit scatter (<a class="xref" href="#sec-sucfgascf" title="5.3.7.&nbsp;Filtering by Ascription on Scatter">Section&nbsp;5.3.7, “Filtering by Ascription on Scatter”</a> shows how to do it), while summit removes the needed for different ascription file trees per branch (and the associated effort at branch cycling). All the information that you need to set up a summit with ascription are explained in the chapters mentioned; the only thing left for this section is to show the order of actions and the resulting file structure, as implied by the technical requirements.</p>
<p>The first thing to set up is the summit. From the viewpoint of ascription, it is not important which summit mode is used; indeed, while the direct summit is still not advised, putting ascription on top would alleviate some of its disadvantages. In the following the summit over dynamic templates is assumed, because it is a bit less involved than the summit over static templates, but nevertheless demonstrates all important points.</p>
<p>After configuring and initializing the summit over dynamic templates, let the summit top directory only (that is, omitting branches) look like this:</p>
<pre class="programlisting">
l10n-nn/
    summit/
        foo-module/
            alpha.po
            bravo.po
            ...
        bar-module/
            kilo.po
            lima.po
            ...
        ...
    summit-config
</pre>
<p>PO files in the summit are shown split into several submodules for generality. Unlike in the chapter on summit, the summit directory is placed here within a parent language directory, and the summit configuration file <code class="filename">summit-config</code> in the parent directory instead of the summit directory. This is in order to have a clearer structure when the ascription is added.</p>
<p>The ascription is set up after the summit, such that it takes only the summit directory into account, having nothing to do with branches. After the ascription is configured and initialized, the summit with ascription tree should look like this:</p>
<pre class="programlisting">
l10n-nn/
    summit/
        foo-module/
            alpha.po
            bravo.po
            ...
        bar-module/
            kilo.po
            lima.po
            ...
        ...
    summit-ascript/
        foo-module/
            alpha.po
            bravo.po
            ...
        bar-module/
            kilo.po
            lima.po
            ...
        ...
    ascription-config
    summit-config
</pre>
<p>Here the ascription tree root is set to <code class="filename">summit-ascript/</code> in the ascription configuration file <code class="filename">ascription-config</code>. With this, setting up the summit with ascription workflow is completed.</p>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-cbsamultsum" id="sec-cbsamultsum"></a>10.3.1.&nbsp;Several Summits with Unified Ascription</h3>
</div>
</div>
</div>
<p>In some circumstances you may want to have <span class="emphasis"><em>several</em></span> separate summits with unified ascription. This may be the case, for example, when the translation project is such that the user interface and documentation PO files are put into separate file trees in branches, and most paired UI-documentation PO files have same names.<sup>[<a name="id600810" href="#ftn.id600810" class="footnote" id="id600810">50</a>]</sup></p>
<p>The parent language directory in this scenario, with summits and ascription set up, could look like this:</p>
<pre class="programlisting">
l10n-nn/
    summit/
        ui/
            foo-module/
                alpha.po
                bravo.po
                ...
            bar-module/
                kilo.po
                lima.po
                ...
            ...
            summit-config
        doc/
            foo-module/
                alpha.po
                bravo.po
                ...
            bar-module/
                kilo.po
                lima.po
                ...
            summit-config
    summit-ascript/
        ui/
            foo-module/
                alpha.po
                bravo.po
                ...
            bar-module/
                kilo.po
                lima.po
                ...
            ...
        doc/
            foo-module/
                alpha.po
                bravo.po
                ...
            bar-module/
                kilo.po
                lima.po
                ...
            ...
    ascription-config
</pre>
<p>Note here the location of <code class="literal">summit-config</code> files: each is within its own summit directory, which are <code class="filename">summit/ui/</code> and <code class="filename">summit/doc/</code>. On the other hand, there is a single <code class="literal">ascription-config</code> file, which covers all summits. This means that summit operations (merging, scattering) must be performed from within their respective summit directories (since <span class="command"><strong>posummit</strong></span> looks through the parent directories for first <code class="literal">summit-config</code> file), while ascription operations can be performed from anywhere.</p>
<p>Having unified ascription is especially convenient in <a class="link" href="#sec-sumntbasic" title="5.2.1.&nbsp;Centralized Summit Maintenance">centralized summit maintenance</a>, since translators and reviewers are concerned only with ascription (running <span class="command"><strong>poascribe</strong></span> to commit, select for review, etc.) regardless of how many summits there are.</p>
</div>
</div>
<div class="footnotes"><br>
<hr width="100" align="left">
<div class="footnote">
<p><sup>[<a name="ftn.id601369" href="#id601369" class="para" id="ftn.id601369">45</a>]</sup> To be sure, some short messages can be quite similar in many unrelated PO files. But having TM matches only on such messages will result in very small time savings, if measurable at all.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id599985" href="#id599985" class="para" id="ftn.id599985">46</a>]</sup> At one point, the script creates a temporary PO file for each original PO file, and then calls <span class="command"><strong>msgcat</strong></span> on these temporary files to create the first, raw compendium. These temporary files have fuzzy and untranslated messages removed, and some other adjustments, before concatenation. One could think that all these adjustments could instead be done on the raw compendium. The problem is that then there would be no unambiguous way to tell which fuzzy messages in the raw compendium were fuzzy to begin with, and which were made fuzzy by <span class="command"><strong>msgcat</strong></span> due to agreggation of translations. With fuzzy messages removed prior to concatenation, in de-aggregation by frequency that follows it is known that messages with fuzzy flags are those aggregated.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id619018" href="#id619018" class="para" id="ftn.id619018">47</a>]</sup> The translator can still see when the match was exact, because normal fuzzy messages will have previous fields and fuzzied exact matches will not.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id664379" href="#id664379" class="para" id="ftn.id664379">48</a>]</sup> One trick is also hitting undo once, which will normally skip to the line in which the last modification was made, and then hit redo to recover the modification.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id646005" href="#id646005" class="para" id="ftn.id646005">49</a>]</sup> If you use <a class="link" href="#ch-ascript" title="Chapter&nbsp;6.&nbsp;Ascribing Modifications and Reviews">ascription</a>, you should instead tell <span class="command"><strong>poascribe</strong></span> to update headers for you when committing. This is done by adding <code class="literal">update-headers = yes</code> to <code class="literal">[poascribe]</code> section in user configuration.</p>
</div>
<div class="footnote">
<p><sup>[<a name="ftn.id600810" href="#id600810" class="para" id="ftn.id600810">50</a>]</sup> On the other hand, you may still have a unified summit, by defining a <a class="link" href="#sec-sustpptransf" title="5.1.4.&nbsp;Transforming Branch Paths">path transformation</a> in summit configuration to disambiguate UI and documentation PO files sharing the same domain name.</p>
</div>
</div>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="ch-prog" id="ch-prog"></a>Chapter&nbsp;11.&nbsp;Programming with Pology</h2>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-prfile" id="sec-prfile"></a>11.1.&nbsp;PO File Abstraction</h2>
</div>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-prmsg" id="sec-prmsg"></a>11.1.1.&nbsp;Message</h3>
</div>
</div>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-prcat" id="sec-prcat"></a>11.1.2.&nbsp;Catalog</h3>
</div>
</div>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-prhead" id="sec-prhead"></a>11.1.3.&nbsp;Header</h3>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-prmonitor" id="sec-prmonitor"></a>11.2.&nbsp;Monitored Objects</h2>
</div>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-prsieves" id="sec-prsieves"></a>11.3.&nbsp;Writing Sieves</h2>
</div>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-prhooks" id="sec-prhooks"></a>11.4.&nbsp;Writing Hooks</h2>
</div>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-prascsel" id="sec-prascsel"></a>11.5.&nbsp;Writing Ascription Selectors</h2>
</div>
</div>
</div>
</div>
<div class="sect1">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="sec-prcstyle" id="sec-prcstyle"></a>11.6.&nbsp;Coding Style</h2>
</div>
</div>
</div>
<div class="sect2">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="sec-prcsi18n" id="sec-prcsi18n"></a>11.6.1.&nbsp;User-Visible Text and Internationalization</h3>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
